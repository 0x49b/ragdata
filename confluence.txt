[{"text": "Build ENV  Namen und Beschreibung ist noch von Github/Gitlab    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Name                                 Beschreibung                                                                                                                                                                                                                                                                                                                            ------------------------------------ ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ --------   CI_CONCURRENT_ID                     The unique ID of build execution in a single executor.                                                                                                                                                                                                                                                                                   CI_CONCURRENT_PROJECT_ID             The unique ID of build execution in a single executor and project.                                                                                                                                                                                                                                                                       CI_CONFIG_PATH                       The path to the CI/CD configuration file. Defaults to  .gitlab-ci.yml . Read-only inside a running pipeline                                                                                                                                                                                                                              CI_ENVIRONMENT_NAME                  The name of the environment for this job. Available if  environment:name  is set.                                                                                                                                                                                                                                                        CI_ENVIRONMENT_SLUG                  The simplified version of the environment name, suitable for inclusion in DNS, URLs, Kubernetes labels, and so on. Available if  environment:name  is set. The slug is  truncated to 24 characters . A random suffix is automatically added to  uppercase environment names .                                                            CI_ENVIRONMENT_URL                   The URL of the environment for this job. Available if  environment:url  is set                                                                                                                                                                                                                                                           CI_RELEASE_DESCRIPTION               The description of the release. Available only on pipelines for tags. Description length is limited to first 1024 characters                                                                                                                                                                                                             CI_KUBERNETES_ACTIVE                 Only available if the pipeline has a Kubernetes cluster available for deployments.  true  when available.                                                                                                                                                                                                                                CI_OPEN_MERGE_REQUESTS               A comma-separated list of up to four merge requests that use the current branch and project as the merge request source. Only available in branch and merge request pipelines if the branch has an associated merge request. For example,  gitlab-org/gitlab!333,gitlab-org/gitlab-foss!11 .                                             CI_PLATFORM                          Name of the CI/CD Platform (\"Tekton\" or \"Jenkins\")                                                                                                                                                                                                                                                                                   :tick:    CI_KUBERNETES_CLUSTER                OpenShift cluster name where the pipeline runs (TODO: im Pod abrufbar? oder sonst inject via Helm Value \u2192 Controller Env Var)                                                                                                                                                                                                        :tick:    CI_KUBERNETES_NAMESPACE              OpenShift namespace/project name where the pipeline runs                                                                                                                                                                                                                                                                             :tick:    CI_CONTROLLER_URL                    The URL of the controller                                                                                                                                                                                                                                                                                                            :tick:    Workflow Information                                                                                                                                                                                                                                                                                                                                                          GITHUB_ACTIONS                       Indicates if GitHub Actions is running.                                                                                                                                                                                                                                                                                                  GITHUB_WORKFLOW                      Name of the event that triggered the workflow.                                                                                                                                                                                                                                                                                           GITHUB_EVENT_NAME                    Name of the event that triggered the workflow.                                                                                                                                                                                                                                                                                           GITHUB_EVENT_PATH                    Name of the event that triggered the workflow.                                                                                                                                                                                                                                                                                           GITHUB_WORKSPACE                     Default working directory on the runner.                                                                                                                                                                                                                                                                                                 GITHUB_REPOSITORY                    Repository name                                                                                                                                                                                                                                                                                                                          GITHUB_REPOSITORY_OWNER              Repository owner's name                                                                                                                                                                                                                                                                                                                  GITHUB_REPOSITORY_ID                 Repository ID                                                                                                                                                                                                                                                                                                                            GITHUB_REPOSITORY_OWNER_ID           GITHUB_REPOSITORY_OWNER_ID                                                                                                                                                                                                                                                                                                               Commit, Branch und Tag Information                                                                                                                                                                                                                                                                                                                                            CI                                   Fixed value \"true\" indicating a CI environment                                                                                                                                                                                                                                                                                       :tick:    CI_ACTOR                             Email address of the user who started the pipeline                                                                                                                                                                                                                                                                                   :tick:    CI_COMMIT_AUTHOR                     The author of the commit in  Name <email>  format.                                                                                                                                                                                                                                                                                   :tick:    CI_COMMIT_BEFORE_SHA                 The previous latest commit present on a branch or tag. Is always  0000000000000000000000000000000000000000  for merge request pipelines, the first commit in pipelines for branches or tags, or when manually running a pipeline.                                                                                                        CI_COMMIT_BRANCH                     The commit branch name. Available in branch pipelines, including pipelines for the default branch. Not available in merge request pipelines or tag pipelines.                                                                                                                                                                        :tick:    CI_COMMIT_DESCRIPTION                The description of the commit. If the title is shorter than 100 characters, the message without the first line.                                                                                                                                                                                                                          CI_COMMIT_MESSAGE                    The full commit message.                                                                                                                                                                                                                                                                                                             :tick:    CI_COMMIT_REF_NAME                   The branch or tag name for which project is built.                                                                                                                                                                                                                                                                                       CI_COMMIT_SHA                        The commit revision the project is built for.                                                                                                                                                                                                                                                                                        :tick:    CI_COMMIT_TAG                        The commit tag name. Available only in pipelines for tags.                                                                                                                                                                                                                                                                           :tick:    CI_COMMIT_TAG_MESSAGE                The commit tag message. Available only in pipelines for tags.                                                                                                                                                                                                                                                                            CI_COMMIT_TIMESTAMP                  The timestamp of the commit in the  ISO 8601  format. For example,  2022-01-31T16:47:55Z.                                                                                                                                                                                                                                            :tick:    CI_COMMIT_TITLE                      The title of the commit. The full first line of the message.                                                                                                                                                                                                                                                                             Bitbucket/Repo Information                                                                                                                                                                                                                                                                                                                                                    CI_REPOSITORY_NAME                   Bitbucket/Git repository name                                                                                                                                                                                                                                                                                                        :tick:    CI_REPOSITORY_SLUG                   Bitbucket/Git repository slug/key                                                                                                                                                                                                                                                                                                    :tick:    CI_REPOSITORY_OWNER                  The Bitbucket project key                                                                                                                                                                                                                                                                                                            :tick:    CI_REPOSITORY_URL                    The HTTP(S) address of the repository                                                                                                                                                                                                                                                                                                :tick:    CI_GIT_URL                           The Git /checkout) URL to the repository                                                                                                                                                                                                                                                                                             :tick:    Project Information (Gitlab)                                                                                                                                                                                                                                                                                                                                                  CI_DEFAULT_BRANCH                    The name of the project\u2019s default branch.                                                                                                                                                                                                                                                                                                CI_PROJECT_ID                        The ID of the current project. This ID is unique across all projects on the GitLab instance.                                                                                                                                                                                                                                             CI_PROJECT_NAME                      The name of the directory for the project. For example if the project URL is  gitlab.example.com/group-name/project-1 ,  CI_PROJECT_NAME  is  project-1 .                                                                                                                                                                                CI_PROJECT_NAMESPACE                 The project namespace (username or group name) of the job.                                                                                                                                                                                                                                                                               CI_PROJECT_NAMESPACE_ID              The project namespace ID of the job.                                                                                                                                                                                                                                                                                                     CI_PROJECT_PATH_SLUG                 $CI_PROJECT_PATH  in lowercase with characters that are not  a-z  or  0-9  replaced with  -  and shortened to 63 bytes. Use in URLs and domain names.                                                                                                                                                                                    CI_PROJECT_PATH                      The project namespace with the project name included.                                                                                                                                                                                                                                                                                    CI_PROJECT_REPOSITORY_LANGUAGES      A comma-separated, lowercase list of the languages used in the repository. For example  ruby,javascript,html,css . The maximum number of languages is limited to 5. An issue  proposes to increase the limit .                                                                                                                           CI_PROJECT_URL                       The HTTP(S) address of the project.                                                                                                                                                                                                                                                                                                      CI_PROJECT_VISIBILITY                The project visibility. Can be  internal ,  private , or  public .                                                                                                                                                                                                                                                                       CI_JOB_STAGE                         The name of the job\u2019s stage.                                                                                                                                                                                                                                                                                                             CI_JOB_STATUS                        The status of the job as each runner stage is executed. Use with  after_script . Can be  success ,  failed , or  canceled .                                                                                                                                                                                                              CI_JOB_TIMEOUT                       The job timeout, in seconds.                                                                                                                                                                                                                                                                                                             CI_JOB_TOKEN                         A token to authenticate with  certain API endpoints. The token is valid as long as the job is running.                                                                                                                                                                                                                                   CI_JOB_URL                           The job details URL.                                                                                                                                                                                                                                                                                                                     CI_JOB_STARTED_AT                    The UTC datetime when a job started, in  ISO 8601  format. For example,  2022-01-31T16:47:55Z .                                                                                                                                                                                                                                          Pipeline Information                                                                                                                                                                                                                                                                                                                                                          CI_PIPELINE_ID                       The instance-level ID of the current pipeline \u2192  Tekton PipelineRun name                                                                                                                                                                                                                                                             :tick:    CI_PIPELINE_SOURCE                   How the pipeline was triggered. Can be  push ,  web ,  schedule ,  api ,  external ,  chat ,  webide ,  merge_request_event ,  external_pull_request_event ,  parent_pipeline ,  trigger, or  pipeline . For a description of each value, see  Common  if  clauses for  rules , which uses this variable to control when jobs run.       CI_PIPELINE_TRIGGERED                true  if the job was  triggered .                                                                                                                                                                                                                                                                                                        CI_PIPELINE_URL                      The URL for the pipeline details (\u2192 Tekton Control Panel Pipeline Run)                                                                                                                                                                                                                                                               :tick:    CI_PIPELINE_CREATED_AT               The UTC datetime when the pipeline was created, in  ISO 8601  format. For example,  2022-01-31T16:47:55Z.                                                                                                                                                                                                                            :tick:    CI_PIPELINE_CONFIG_NAME              The name of the matching pipeline config in estaTektonPipeline.json                                                                                                                                                                                                                                                                  :tick:    CI_PIPELINE_TRIGGER                  Tekton Pipeline triggerType (\"GITEVENT\", \"USER\" or \"CRON\")                                                                                                                                                                                                                                                                           :tick:                                                                                                                                                                                                                                                                                                                                                                                 ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- "}, {"text": "Esta Tekton Results - Setup and Evaluation  Content  -   Content  -   Introduction      -   Result      -   Record      -   Tekton-Results instances  -   Setup  -   Setup Namespaced Tekton Results  -   Some usefull SQL commands      -   Test with Index creations      -   Delete Schema and User      -   Reset Password of user  -   Tekton Result Setup Strategies      -   Global Results      -   Namespace Scoped Watcher  -   DB Setup Options Tekton Result - Namespaced      -   Option 1 Standard - Postgresql Setup per Namespace by Deployment      -   Option 2 PGO Operator - Postgresql Setup per Namespace by Custom         Resource (schematic picture same as above)      -   Option 3 Single Cluster DB Instance - Self managed Postgresql         Instance on Aws01t      -   Option 4 Sigle RDS Instance - Multiple Schemas in one DB  -   Setup Esta-Tekton RDS Schemas  Introduction  To store the Tekton PipelineRun and TaskRun informations we will use either our own solution or a standard solution like Tekton-Results.  Tekton Results watches all the Tekton Resources for changes and stores them into it's Postgresql DB. Tekton-Results DB fills two tables.   Result  In the Result table all parent objects and its relations to its child objects are stored. In our case PipelineRuns with the relations to its TaskRuns and PipelineRuns which are stored as YAML in the records table.  Record  In the record table all PipelineRun and TaskRun Yamls are stored.   Tekton-Results consist of 2 main components: the api and the watcher service. The Watcher service listens to all Tekton resource changes and reads the resources, stores them over the api service into the DB. The api service offers read and write access through GRPC or REST Api.  Tekton-Results instances  We built up 2 Tekton-Results instances with following details:  +----------------------+----------------------+----------------------+ |                      | DEV - Clew01d        | PRD - Aws01t         | +======================+======================+======================+ | Openshift Namespace  | htt                  | h                    | |                      | ps://console-openshi | ttps://console-opens | |                      | ft-console.apps.clew | hift-console.apps.aw | |                      | 01d.sbb-aws-dev.net/ | s01t.sbb-aws-test.ne | |                      | k8s/cluster/projects | t/project-details/ns | |                      | /esta-tekton-results | /esta-tekton-results | +----------------------+----------------------+----------------------+ | PostgreSQL Db        | https://ssp.dbms.sb  | https://ssp.dbms.sbb | |                      | b.ch/manageinstancea | .ch/manageinstanceaw | |                      | ws?i=esta-tekton-dev | s?i=esta-tekton-prod | |                      |                      |                      | |                      | The credentials you  |                      | |                      | can find in the      |                      | |                      | Keypass file.        |                      | +----------------------+----------------------+----------------------+ | S3 Bucket for the    | S3_BUCKET_NAME=est   | Not yet setup        | | PipelineRun/TaskRun  | a-tekton-results-dev |                      | | Logs                 |                      |                      | |                      | S3_ENDPOI            |                      | | Config happens in    | NT=https://s3.eu-cen |                      | |                      | tral-1.amazonaws.com |                      | | tekto                |                      |                      | | n-results-api-config | S3_HOST              |                      | |                      | NAME_IMMUTABLE=false |                      | |                      |                      |                      | |                      | S3                   |                      | |                      | _REGION=eu-central-1 |                      | |                      |                      |                      | |                      | S3_ACC               |                      | |                      | ESS_KEY_ID=<Keypass> |                      | |                      |                      |                      | |                      | S3_SECRET_           |                      | |                      | ACCESS_KEY=<Keypass> |                      | +----------------------+----------------------+----------------------+ | The Watcher is       | args:                |                      | | mainly configured    |                      |                      | | through the start    |   - -api_addr        |                      | | parameter of the     |                      |                      | | docker image which   |   -                  |                      | | you can see in this  | tekton-re            |                      | | piece of             | sults-api-service.{{ |                      | | sourcecode:          | .Values.namespace    |                      | |                      | }}.svc               |                      | | https                | .cluster.local:50051 |                      | | ://code.sbb.ch/proje |                      |                      | | cts/KD_ESTA/repos/es |   -                  |                      | | ta-tekton-results/br | -comple              |                      | | owse/charts/esta-tek | ted_run_grace_period |                      | | ton-results/template |                      |                      | | s/deployment.yaml#94 |   - '120h'           |                      | |                      |                      |                      | |                      |   - -namespace       |                      | |                      |                      |                      | |                      |   -                  |                      | |                      | esta-tekton-predev   |                      | |                      |                      |                      | |                      |   - -auth_mode       |                      | |                      |                      |                      | |                      |   - insecure         |                      | +----------------------+----------------------+----------------------+ | REST Urls            | https://             | https://rest         | |                      | tekton-results-api-s | -esta-tekton-results | |                      | ervice-tekton-pipeli | .apps.aws01t.sbb-aws | |                      | nes.apps.clew01d.sbb | -test.net/apis/resul | |                      | -aws-dev.net/apis/re | ts.tekton.dev/v1alph | |                      | sults.tekton.dev/v1a | a2/parents/-/results | |                      | lpha2/parents/esta-t |                      | |                      | ekton-predev/results |                      | +----------------------+----------------------+----------------------+ | Argocd Repo          | ht                   | ht                   | |                      | tps://code.sbb.ch/pr | tps://code.sbb.ch/pr | |                      | ojects/KD_PAAS/repos | ojects/KD_PAAS/repos | |                      | /ocp-argocd/browse/p | /ocp-argocd/browse/p | |                      | rojects/esta/applica | rojects/esta/applica | |                      | tions/tekton-results | tions/tekton-results | |                      |                      |                      | |                      | https://code.sbb.c   | https://code.sbb.ch  | |                      | h/projects/KD_PAAS/r | /projects/KD_PAAS/re | |                      | epos/ocp-argocd/brow | pos/ocp-argocd/brows | |                      | se/projects/esta/val | e/projects/esta/valu | |                      | ues/groups/stage/dev | es/groups/stage/test | |                      | /tekton-results.yaml | /tekton-results.yaml | +----------------------+----------------------+----------------------+ | ArgoCD's             | https://ocp-argoc    | https://ocp-argoc    | |                      | d.sbb-cloud-dev.net/ | d.int.sbb-cloud.net/ | |                      | applications?showFav | applications?showFav | |                      | orites=false&proj=&s | orites=false&proj=&s | |                      | ync=&health=&namespa | ync=&health=&namespa | |                      | ce=&cluster=&labels= | ce=&cluster=&labels= | +----------------------+----------------------+----------------------+  Setup  The setup happens mainly through the ocp-argcd repo and Argocd instances. Afterwards some modifications are needed:  1.  DB Secret: Adapt the Secret: tekton-results-postgres  2.  Create the key/certificate and then the secret with the keys  Setup Namespaced Tekton Results  To Setup the new User we created a esta_tekton_creator user with special privileges to create new users. This is a one time thing per database.  We created this user already for the dev and the prod database.  CREATE ROLE esta_tekton_creator PASSWORD 'secret' NOSUPERUSER CREATEDB CREATEROLE INHERIT LOGIN; GRANT CONNECT ON DATABASE esta_tekton TO esta_tekton_creator; GRANT ALL PRIVILEGES ON DATABASE esta_tekton TO esta_tekton_creator WITH GRANT OPTION;  For the namespaced Tekton-Results Setup I created a repository to deploy tekton-results with the Helm Chart:  https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-results/browse  Then I also created a new schema esta-tekton-predev and a user esta-tekton-predev which then needed to be granted with following SQL Statements:  DO $do$ BEGIN IF EXISTS ( SELECT FROM pg_catalog.pg_roles WHERE rolname = 'test7_tekton') THEN RAISE NOTICE 'Role \"test7_tekton\" already exists. Skipping.'; ELSE CREATE ROLE test7_tekton PASSWORD 'abcdefg' INHERIT LOGIN; CREATE SCHEMA test7_tekton; GRANT CONNECT ON DATABASE esta_tekton TO test7_tekton; ALTER ROLE test7_tekton set SEARCH_PATH = 'test7_tekton'; PERFORM pg_catalog.set_config('search_path', 'public', false); grant usage on schema test7_tekton to test7_tekton; GRANT ALL ON SCHEMA test7_tekton TO test7_tekton; END IF; END $do$;  Ticket which describes the creation of user esta_tekton_creator: DB-654 - Abrufen der Vorgangsdetails... STATUS  Some usefull SQL commands  Test with Index creations  I created several indexes:  CREATE INDEX idx_results_name ON esta_tekton.results(name); CREATE INDEX idx_records_name ON esta_tekton.records(name); CREATE INDEX idx_records_updated_time ON esta_tekton.records(updated_time); But all queries used for fetching the PipelineRuns were not using the Indexes:  explain select rc.id, rc.name, rc.data, rc.type, rc.data from esta_tekton.results as rs inner join esta_tekton.records as rc on rs.name = rc.name order by rc.updated_time desc; explain select rc.id, rc.name, rc.data, rc.type, rc.data from esta_tekton.results as rs inner join esta_tekton.records as rc on rs.name = rc.name order by rc.updated_time desc; explain select rc.id, rc.name, rc.data, rc.type, rc.data from esta_tekton.results as rs, esta_tekton.records as rc where rs.name = rc.name order by rc.updated_time desc limit 1000; So the indexes have no impact.  Delete Schema and User  This SQL commands drop the schema and it's tables. And then also drop the user.  DROP SCHEMA <schema_name> CASCADE; REVOKE CONNECT ON DATABASE esta_tekton FROM <user_name>; DROP ROLE <user_name>;  Reset Password of user  To reset the password of the Db User:  ALTER USER <user> WITH PASSWORD 'yourNewPassword';  Tekton Result Setup Strategies  Global Results  With the actual POC Setup we have a global Tekton Resource Watcher, which process all resources in all namespaces.  []  Namespace Scoped Watcher  Another Setup would be, to install tekton results namespace scoped with its own schema per namespace. Also the watcher and api would run with namespace limited service account. This would be security wise a much better solution.  Also stability wise we wouldn't have a single point of failure, except the database. The esta-tekton-pipeline-controller could actually access directly the database.  []  DB Setup Options Tekton Result - Namespaced  Option 1 Standard - Postgresql Setup per Namespace by Deployment  Here we would just setup a Postgresql Pod for each namespace with it's own PV which is then accessed by the Tekton-Results Api. Of course at first, this seems to be simple, but in case of a problem we need to manage 80-100 Postgresql instances.  Also this solution will consume unnecessary lot's of hardware ressources and seems to me like unnecessary overhead.    Pro                                                   Con   ----------------------------------------------------- ----------------------------------------------------------------------------------------   Simple Setup by Deployment and ArgoCd                 Managed by Esta   Ressource usage are billed directly to the project    Very high resource usage and overhead since 1 Postgresql instance per Tekton namespace   Reduced network traffic and latency for SQL Queries   Need to manage 80 Postgres Instances by ourselves                                                         Postgres Knowhow needed                                                         Updates need to be managed by Esta  []  Option 2 PGO Operator - Postgresql Setup per Namespace by Custom Resource (schematic picture same as above)  With this setup we would use the same operator as PGO uses to manage the Postgresql instances for all Tekton namespaces. But still we would have in each tekton-namespace it's own Postgresql instance.    Pro                                                   Con   ----------------------------------------------------- ----------------------------------------------------------------------------------------   Simple Setup by Custom Resource and ArgoCD            Managed by Operator and Esta   Ressource usage are billed directly to the project    Very high resource usage and overhead since 1 Postgresql instance per Tekton namespace   Reduced network traffic and latency for SQL Queries   Need to manage 80 Postgres Instances by ourselves   Updates are handled by the Operator                   Postgres Knowhow needed                                                           Option 3 Single Cluster DB Instance - Self managed Postgresql Instance on Aws01t    With this setup we would have a self managed Postgresql DB instance on the aws01t Cluster. It can be selfmanaged or with the PGO Operator. But in the end, the setup happens by ourselves and is also managed by ESTA. The schematic setup is the same as with the Amazon RDS, just the instance is managed by ourselves. Also here we need to build up some DB Knowhow to manage, migrate, update the Postgresql DB.   So in the end we will have one Postgresql Server instance with one Database. The Esta-Tekton Setup process will create a new Scheme and DB User for each Tekton-Namespace.     Pro                                                           Con   ------------------------------------------------------------- ---------------------------------------------------------------------------------------   Simple Setup by DeploymentConfig or Operator                  Managed by Esta   Reduced network traffic and latency for SQL Queries           Postgressql Knowhow needed    Low Resource usage with one PGSQL Instance and many schemas   Updates managed by Esta   Full controll over the PGSQL Instance                         Shared costs                                                                 If this single instance is not working, access to historic Pipelineruns not possible   []  Option 4 Sigle RDS Instance - Multiple Schemas in one DB  The actual discussed solution and most probably most straight forward solution is to use one single RDS instance with many DB schemas and a DB User for each schema.    Pro                                            Cons   ---------------------------------------------- -------------------------------------------------------   Already setup                                  Network Latency since it runs outside of cluster   Separation of Data through Schemas and Users   Need to give rights to Admin user to create new users   PGSQL Instance managed by Amazon               PGSQL Instance managed by Amazon   Schema Setup through SQL already tested           Setup already tested                              Relatively affordable costs                      []  Setup Esta-Tekton RDS Schemas  At the moment my favorable solution is Option 4 with a single RDS DB instance and multiple Schemas. This solution makes it also easy to maintain this Database from outside, has low resource costs and also allows to run statistics over all Tekton-Namespaces without making cross Database Queries.  The schema setup seems also relatively easy to maintain and a possible solution I would like to show in following graphic. The idea behind is, that we have the full DB User which at the moment can create schemas and change users search path to the schema. At the moment the full DB User cannot create new users, but that can be solved. So to handle old and new tekton instances migrating to tekton-results, we would need to write an operator. This operator should do following things:  -   Look for new Schema creation CR's on the tekton clusters  -   Create a new DB User: xxx_tekton  -   Create a new Schmema: xxx_tekton  -   Grant created User to created schema  -   Change searchpath of the default schema from the user to the newly     created schema  -   Create the DB secret in the xxx_tekton namespace so tekton-results     and the esta-tekton-pipeline-controller can access it  This Operator accesses the Database with a privileged user to create new users and schemas.  [] "}, {"text": "Tekton UI Architektur  Package Diagram  []  Class Diagram Pipeline  []  HTML Structure Pipelines and Pipeline Detail  []  Class Diagram Repositories  []  HTML Structure Repositories and Repository Detail  []  [] "}, {"text": "Tekton Build Cache Konzept  Technisches Konzept f\u00fcr ein Caching System f\u00fcr ESTA Tekton Build Pipelines, zur Optimierung der Buildzeiten von Maven, Npm, Go und Python Builds.  Die grundlegende Evaluation von Caching Technologien wurde im Rahmen eines Architekturentscheids gemacht.  -   Grundlagen  -   Ablauf Load Cache  -   Ablauf Save Cache  -   Cache Keys      -   Key Composition      -   Dependency Hash      -   Metadateien      -   Recovery Key  -   Access Control      -   Variante A)      -   Variante B)  -   Cache Lifecycle      -   Periodischer Cache Refresh  -   Technische Aspekte  -   Monitoring      -   Messwerte      -   Auswertung  Grundlagen  Das Caching System f\u00fcr Tekton soll ein Optimum an Performance, Disk/Volume Space und Parallelit\u00e4t erreichen.  Grunds\u00e4tzlicher Ansatz f\u00fcr das Caching: Cache Dumps (Snapshots) in einem S3 Bucket (\u2192 Variante 4 in Shared Caches f\u00fcr Tekton Pipelines) gem\u00e4ss der Idee von Github Actions.  Das Caching System f\u00fcr ESTA Tekton ist also eine Art Key-Value Store mit Dateien als Values und eindeutigen Keys. Als Backend wird S3 verwendet und f\u00fcr die Verwendung in den Tekton Pipelines werden via Tekton Builder Images zwei Funktionen (Binaries) angeboten: \"Load Cache from Store\" und \"Save Cache into Store\". Zus\u00e4tzliche Hilfsfunktionen z.B. f\u00fcr die Generierung von Cache-Keys k\u00f6nnen ebenfalls via Builder Image angeboten werden.  Ablauf Load Cache  Wird vor dem eigentlichen Build Tasks ausgef\u00fchrt, um einen bestehenden Cache Dump aus dem Store zu laden und ins lokale Dateisystem des Pods zu entpacken.  1.  Hash berechnen basierend auf Lock Files (e.g. package-lock.json)  2.  Cache-Key mit Hash erstellen  3.  Abfrage von Cache-Entry mit diesem Key  4.  Fallback auf neuste hash-loses Entry (restore-key)  5.  Download des Cache-Dumps und Entpacken in Pod Volume  []  Ablauf Save Cache  Wird nach dem Build Task ausgef\u00fchrt, um den lokalen Cache als kompletten Dump persistent im Store zu speichern.  1.  Hash berechnen basierend auf Lock Files  2.  Cache-Key mit Hash erstellen  3.  Bestehendes Cache-Entry mit diesem Key pr\u00fcfen  4.  Cache-Lock mit dem berechneten Key pr\u00fcfen  5.  Wenn kein Entry und kein Lock existieren:      1.  Cache-Lock auf diesen Key registrieren (mit TTL ca. 5 Minuten)      2.  Lokalen Cache komprimieren und hochladen      3.  Cache-Lock entfernen  6.  Falls Entry oder Lock existiert: Skip  []  Cache Keys  Cache Keys sollen den Zustand einer bestimmten Dependency-Konstellation f\u00fcr ein Projekt (Repository) repr\u00e4sentieren. Davon ausgehend, dass als Storage Backend S3 verwendet wird, beinhalten die Cache Keys auch / um eine hierarchische Dateistruktur auf dem Cache Service aufzubauen. Einzelne Ordner k\u00f6nnen auf S3 mit IAM Policies (z.B. Access Restrictions) oder Lifecycle Rules belegt werden.  Beispiel: clew-tekton/kd-esta--esta-metrics/maven-v1-2022.2-qfhewoiffhqawsoifhqaf  Pattern: <tekton-namespace>/<repo-slug>/<package-manager>-<cache-api-version>[-<date-slot>]-<hash>  Key Composition  -   tekton-namespace: Name des Tekton Namespace. Access Policies werden     auf dieser Ebene enforced.  -   repo-slug: Unique Key des Projekt Repositories (Tekton Label     tekton.esta.sbb/repository)  -   package-manager: Package Manager/Technologie (maven, npm, go,     poetry, etc.)  -   cache-api-version: Version des Cache Service APIs  -   date-slot: Zeitliche Komponente des Cache Eintrags (optional)  -   hash: Dependency Hash  Dependency Hash  Der Hash repr\u00e4sentiert die aktuelle Liste aller Projekt-Dependencies mit (exakten) Versionen. Er soll als String von 24 Zeichen basierend auf Metadateien des spezifischen Package-Managers berechnet werden. F\u00fcr die verschiedenen Technologien resp. Package-Manager (Maven, Npm, Go, Poetry) m\u00fcssen also unterschiedliche Metadateien verwendet werden. Die Berechnung des Hashes soll basieren auf der Checksumme aller Metadateien erfolgen.  Beispiel NPM:  for file in `find . -name \"package-lock.json\" -not -path \"./node_modules/*\"`; do shasum $file >> checksums.txt; done  shasum checksums.txt | head -c 24  Metadateien  -   Maven: pom.xml  -   NPM: package-lock.json (Fallback auf package.json)  -   Go: go.sum (Fallback auf go.mod)  -   Python: poetry.lock (Fallback auf pyproject.toml)  Recovery Key  Bei \u00e4ndernden Dependencies ergibt sich ein neuer Hash und damit wird kein Cache-Eintrag mit dem aktuellen Key gefunden. Um nicht mit einem leeren Cache zu starten, wir der letzte Cache-Eintrag f\u00fcr den Cache Key ohne den Hash als Ausgangszustand geladen. Der Recovery Key entspricht also dem Cache Key ohne den Dependency Hash. Zum Beispiel: clew-tekton/kd-esta--esta-metrics/maven-v1-2022.2-  Das Lookup des Recovery Keys erfolgt \u00fcber ein Listing alles Keys, welche mit dem Recovery Key beginnen, sortiert nach Erstellungsdatum.  Access Control  Ausgangslage: F\u00fcr die Speicherung wird ein globaler S3 Bucket f\u00fcr alle Caches aufgesetzt.  Anforderung: Tekton Namespaces d\u00fcrfen nur auf \"eigene\" Cache Dumps zugreifen (read/write) k\u00f6nnen.  Die Separation nach Namespaces erfolgt durch Unterordner im S3 Bucket. F\u00fcr das Enforcement von Access Policies auf diesen Namespace-Ordnern stehen aktuell zwei Varianten zur weiteren Pr\u00fcfung:  -   A) Individuelle Access Tokens f\u00fcr S3 + IAM Roles pro Namespace  -   B) Cache-Access Proxy in Kubernetes/Openshift pr\u00fcft Herkunft     (Namespace) von Anfragen  Grunds\u00e4tzlich soll eine Create-only (write-once-read-many - WORM) Policy auf dem S3 Bucket eingerichtet werden. Damit wird verhindert, dass Cache Dumps (gewollt oder ungewollt) ver\u00e4ndert werden k\u00f6nnen. Dies kann mittels Object Lock oder indirekt \u00fcber Versioning in S3 umgesetzt werden.  Variante A)  Mittels IAM Policies kann der Zugriff auf Ordner und Unterordner f\u00fcr jeden Tekton Namespace definiert werden. Voraussetzung daf\u00fcr sind jedoch individuelle IAM Access Tokens f\u00fcr jeden Tekton Namespace. Diese, sowie die zugeh\u00f6rigen IAM Policies m\u00fcssen beim Setup eines Tekton Namespace angelegt werden.    Vorteile                                                  Nachteile   --------------------------------------------------------- -----------------------------------------------------------------------------------   Native Steuerung und Konfiguration direkt in S3 und IAM   Registrierung von IAM Roles, Policies und Access Credentials beim Setup notwendig   Enforcement und Monitoring mit AWS Tools                  Access Credentials im Tekton Namespace vorhanden  Beim Setup eines Tekton Nameaspace m\u00fcssen IAM Roles, Policies und Access Credentials auf AWS registriert werden und als Secret (Access Credentials) gespeichert werden. Wie das automatisiert gemacht werden soll (Terraform, ~~Crossplane~~, andere) und was der Aufwand daf\u00fcr ist, muss noch evaluiert werden.  ~~Variante B)~~  In dieser Variante verf\u00fcgt der Tekton Namespace \u00fcber keinen direkten Zugriff auf den S3 Bucket (kein Access Token). S\u00e4mtliche Requests werden an einen Proxy Service auf demselben Cluster geleitet, welcher mit Network Policies auf OpenShift gesteuert wird.  Dieser Proxy Service pr\u00fcft die Herkunft des HTTP Requests anhand von HTTP Headers und identifiziert somit den Tekton Namespace als \"Requester\" und stellt sicher, dass dieser nur auf Bucket Ressourcen in seinem Cache Ordner zugreifen darf.    Vorteile                                                 Nachteile   -------------------------------------------------------- --------------------------------------------------------------   Setup von Tekton Namespace unver\u00e4ndert                   Neue Komponente von ESTA entwickelt, deployed und maintained   S3 Access Token nur in dediziertem Namespace vorhanden   Monitoring muss selbst aufgesetzt werden                                                            Machbarkeit noch offen  Voraussetzung f\u00fcr Variante B) ist, dass die Herkunft eines HTTP Request innerhalb von Openshift (aus welchem Pod/Namespace) sicher gepr\u00fcft werden kann. Das ist ohne zus\u00e4tzliche Tools (z.B. ServiceMesh) oder Hacks (ServiceAccount Token mitschicken) nicht m\u00f6glich. Der Implementationsaufwand f\u00fcr diese Variante wird gem\u00e4ss ersten Untersuchungen vermutlich unverh\u00e4ltnism\u00e4ssig hoch ausfallen.  Cache Lifecycle  Bei der Verwendung von S3 als Storage Backend kann mittels Lifecycle Configuration eine automatische L\u00f6schung von \"alten\" Cache Eintr\u00e4gen eingestellt werden. Damit entf\u00e4llt ein pro-aktives periodisches Pr\u00fcfen und Aufr\u00e4umen des Caches.  Als Vorschlag soll beim Aufsetzen des S3 Buckets eine max. Vorhaltezeit von 7 Tagen auf Cache Dateien konfiguriert werden.  F\u00fcr .lock Dateien soll max age auf 5 Minuten eingestellt werden.  Periodischer Cache Refresh  Durch die Verwendung der date-slot Komponente im Cache Key kann eine periodische (z.B. monatlich oder quartalsweise) Erneuerung der Caches erreicht werden.  TODO  Vor- und Nachteile von diesem Feature m\u00fcsse noch evaluiert werden. ESTA-5237 - Abrufen der Vorgangsdetails... STATUS  Technische Aspekte  -   F\u00fcr die Kompression von Cache Dumps soll Tar + Zstandard verwendet     werden.  -   F\u00fcr das Entpacken der Caches im Tekton Task (Pod) soll ein     spezifisches Volume verwendet werden.     \u2192 zu pr\u00fcfen ist noch, ob ein emptyDir ausreichend ist (Achtung:     Ephemeral Storage Limit auf Openshift Nodes) oder ob daf\u00fcr pro     Pipelinerun ein Workspace PVC angelegt werden muss.  Monitoring  Die Cache Verwendung (Cache Hits/Misses), die Cache Gr\u00f6sse sowie die Zeit f\u00fcr Load und Save Operationen als auch die Build Performance insgesamt soll periodisch \u00fcberpr\u00fcft und monitored werden)  TODO  Ein Konzept zum Monitoring wird separat ausgearbeitet (siehe unten). ESTA-5238 - Abrufen der Vorgangsdetails... STATUS  Messwerte    Messwert                    Metriken/Quelle   --------------------------- ----------------------------------------------------------------------------   Cache Hits                  Als Tekton Result speichern/auslesen ~~S3 Request Metrics (Get requests)~~   Cache Misses                Als Tekton Result speichern/auslesen ~~S3 Request Metrics (4xx errors)~~   Cache Gr\u00f6sse                Amazon S3 dimensions / S3 Console oder S3 Storage Lens   Load Times                  Tekton Metrics (TaskRun Duration; *task=esta-cache-load)   Save Times                  Tekton Metrics (TaskRun Duration; *task=esta-cache-save)   Overall Build Performance   Tekton Metrics (PipelineRun Duration)  Auswertung  Die Messwerte sollen mit Prometheus gesammelt und in einem Grafana Dashboard visualisiert werden. Die Tekton Metriken sind bereits verf\u00fcgbar, f\u00fcr die S3 Metriken muss Cloudwatch eingerichtet und ein Prometheus Fetcher aufgesetzt werden.  Falls die Integration der S3 Metriken in Grafana zu aufw\u00e4ndig wird, k\u00f6nnen die Metriken auch \u00fcber die AWS Console (Bucket metrics) angeschaut werden. "}, {"text": "Builder Image Config  Neu bauen wir grosse Builder Images mit mehreren preinstallierten Java, Node und Maven Versionen. Urspr\u00fcnglich wollten wir mit sdkmanrc., nvmrc., pyenvrc. und goenvrc. arbeiten. Da diese aber alle etwas andere Strategien haben bei der Auswahl der installierten und verwendeten Versionen, wird der Update Prozess etwas schwierig und unkontrolliert. Bei gewissen rc files kann mit Wildcards gearbeitet werden. Wenn z.B. die Version 3.10.^ angegeben wird, so installiert pyenv automatisch die neuste 3.10.x Version. Bei der Selektion funktioniert das leider nicht. Dort muss man dann die explizite Version angeben. Bei sdkmanrc. gab es mal einen Feature Request zu einer Wildcardversionsunterst\u00fctzung, implementiert wurde das allerdings nie.  Wir wollen Wildwuchs verhindern und doch m\u00f6glichst immer mit den neuesten Versionen Builden. Das heisst wir wollen dem User die M\u00f6glichkeit geben die entsprechende Major Versionen auszuw\u00e4hlen.  Im Builderimage gibt es ein Script, welches dann aus den Majorversionen die entsprechend korrekten preinstalled Versionen von Java, Maven, Kotlin, Python usw. selektiert. Somit ist der Code in den Tasks kurz und pr\u00e4gnant.  Wer andere Distributionen verwenden m\u00f6chte, kann relativ einfach ein selbst maintained Builderimage mit Preinstalled Versions erstellen. z.B. \u00fcber custom Build Arguments und weiteren releasejobs im estaTektonPipeline.json.  Versionshandling im Builder Block estaTektonPipeline.json  Um das ganze Version Handling der Builders und dessen Konfiguration etwas zu streamlinen sollen die Konfigurationen f\u00fcr Java, JavaGraal, Kotlin, NPM, Go in einem eigenen Builder Block passieren.  Ziel ist dabei auch eine Entkoppelung von der Selektion des SDK's \u00fcber das Helper Script wie sdkman, nvm, pyenv usw., da diese Technologien oder unsere Strategie ja wieder \u00e4ndern k\u00f6nnen.  Generell werden nur die Major Versionen angegeben und die effektive Version wird dann durch ein Script im Image ermittelt und gesetzt.  Im estaTektonPipeline.json w\u00fcrden dann die entsprechenden Bl\u00f6cke pro Technologie wie folgt aussehen.    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Java             Java Graal           Kotlin            Python             Node           Custom Settings - 2. Ausbaustufe erm\u00f6glicht das Nachinstallieren von Versionen    ---------------- -------------------- ----------------- ------------------ -------------- ---------------------------------------------------------------------------------   \"builder\": {     \"builder\": {         \"builder\": {      \"builder\": {       \"builder\": {   \"builder\": {   \"java\": \"17\",    \"javaGraal\": \"17\",   \"kotlin\": \"1.7\"   \"python\": \"3.10\"   \"node\": \"16\"   \"builderImage\": \"esta.docker.bin.sbb.ch/esta/myjavaBuilderImage:latest\",   \"node\": \"16\",    \"maven\": \"3.8\"       },                },                 },             \"builderImageArgs\": [\"java=17.0.3.1-librca\", \"maven=3.8.1\"]   \"maven\": \"3.8\"   },                                                                       },   },                                                                                            ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Default Versionhandling pro Namespace  Pro Tekton Namespace sollen die default Versionen konfiguriert werden k\u00f6nnen, so dass nicht in jedem estaTektonPipeline.json die Versionsangabe gepflegt werden m\u00fcssen. Diese werden dann falls nicht im estaTektonPipelien.json gesetzt als default verwendet werden.  Das wird \u00fcber values.yaml Files gesteuert und kann dann im ArgoCd AppTemplate pro Tekton Namespace entsprechend konfiguriert werden.  javaDefaultVersion: '17' javaGraalDefaultVersion: '17' mavenDefaultVersion: '3.8' kotlinDefaultVersion: '1.7' nodeDefaultVersion: '16' pythonDefaultVersion: '3.10' goDefaultVersion: '1.16'  Builderimages mit Version Selection Script  Die Builderimages f\u00fcr Mave, Java, Kotlin, NPM usw. wie auch f\u00fcr Python haben ein Script, welchem man die Major Version \u00fcbergeben kann und es wird aufgrund deren automatisch die richtige vorinstallierte Version selektiert.  []  Angepasste Builder Images \u00fcber parameterisierbaren Build starten  Falls jemand auf Basis unserers Builderimages ein angepasstes Buildimage bauen m\u00f6chte, k\u00f6nnen wir angepasste Builderimages die sich selber Updaten aber andere Versionen/Distributions verwenden die nicht Standard SBB sind. Da k\u00f6nnten wir 2 Wege gehen:  1.  Ein parameterisierter Build steuerbar \u00fcber das     estaTektonPipeline.json bei dem man dann \u00fcber BuildArgs die     gew\u00fcnschten Distributionen angibt. Die Buildargs werden dann von     einem Script im Dockerfile entsprechend interpretiert und die     entsprechenden SDK's installiert.  2.  Zus\u00e4tzliche Dockerfiles die auf dem Basis Dockerimage basieren und     man dann manuell die entsprechenden Versionen setzt und installiert.  Beide Varianten haben ihre Vor- und Nachteile. Denke aber dass das eine gangbare Ausbaustufe ist. "}, {"text": "Shared Caches f\u00fcr Tekton Pipelines  +--------------------------+------------------------------------------+ | Fragestellung            | Wie sollten geteilte und persistente     | |                          | Caches f\u00fcr Tekton Pipelines              | |                          | aufgebaut/konfiguriert werden, damit ein | |                          | Optimum an Performance, Disk/Volume      | |                          | Space und Parallelit\u00e4t erreicht werden   | |                          | kann.                                    | |                          |                                          | |                          | Build Pipelines f\u00fcr Maven, NPM und       | |                          | andere Technologien, welche Dependencies | |                          | herunterladen m\u00fcssen, ist ein Cache in   | |                          | Form eines Persistent Volumes notwendig, | |                          | um die Build-Performance zu optimieren   | |                          | und damit nicht bei jedem Build alle     | |                          | Dependencies neu geladen werden m\u00fcssen.  | |                          | Viele Projekte haben eine gemeinsame     | |                          | Schnittmenge von Dependencies und somit  | |                          | ist es sinnvoll den Cache (z.B. Maven)   | |                          | f\u00fcr alle Java-Projekte zu teilen. Das    | |                          | ist aktuell so umgesetzt mit einem PVC   | |                          | \"shared-XXX-cache\", welches f\u00fcr          | |                          | Pipelines als Workspace gemountet wird.  | |                          | Auf Openshift (AWS) steht aktuell nur    | |                          | ReadWriteOnce Storage Class f\u00fcr PVCs zur | |                          | Verf\u00fcgung und diese hat gewisse          | |                          | Einschr\u00e4nkungen f\u00fcr den gleichzeitigen   | |                          | Zugriff von parallel laufenden           | |                          | Pipelines: \"the volume can be mounted as | |                          | read-write by a single node\". Wollen     | |                          | also mehrere Pipelines (Task Pods)       | |                          | dieses Volume read-write mounten, muss   | |                          | Pod2 warten, bis Pod1 terminiert, was    | |                          | potenziell zu Verz\u00f6gerungen in den Build | |                          | Pipelines f\u00fchrt.                         | |                          |                                          | |                          | Es gilt nun weitere M\u00f6glichkeiten zur    | |                          | Optimierung der Caching-Architektur zu   | |                          | pr\u00fcfen und abzuw\u00e4gen.                    | |                          | ESTA-5103 - Der Jira-Vorgang existiert   | |                          | nicht oder Sie sind nicht                | |                          | anzeigeberechtigt.                       | +==========================+==========================================+ | Rahmenbedingung          | -   Tekton l\u00e4uft auf Openshift auf AWS   | |                          |     Clustern                             | |                          |                                          | |                          | -   Es steht keine Storage Class von Typ | |                          |     ReadWriteMany zur Verf\u00fcgung          | +--------------------------+------------------------------------------+ | Annahmen                 | -   Pro Batch Node k\u00f6nnen 8 Build Pods   | |                          |     parallel laufen (allocatable: 16 CPU | |                          |     / 24Gi Memory; Pod limit: 2 CPU / 3  | |                          |     Gi)                                  | |                          |                                          | |                          | -   Bei hoher Last muss davon            | |                          |     ausgegangen werden, dass Pipeline    | |                          |     Tasks (Pods) auf unterschiedlichen   | |                          |     Nodes gestartet werden.              | |                          |                                          | |                          | -   Die Gr\u00f6sse eines Projekt-Caches      | |                          |     liegt zwischen wenigen MB und 2 GB   | |                          |     (\u00d8 500M)                             | |                          |                                          | |                          | -   Die verf\u00fcgbare Ephemeral Storage     | |                          |     Size pro Node ist relativ klein      | |                          |     (~1GB)                               | |                          |                                          | |                          | -   Kosten f\u00fcr Openshift Block Storage   | |                          |     (PVC) gem\u00e4ss CON Preisliste (SATA    | |                          |     non-prod): CHF 2.91 / GB / Monat     | |                          |                                          | |                          | -   F\u00fcr S3 Datentransfer fallen keine    | |                          |     Kosten an, da \"intern\" von S3 zu     | |                          |     einem anderen AWS Service (EC2)      | |                          |     transferiert wird                    | |                          |                                          | |                          | Einfache Analyse eines Maven Caches      | |                          | (ESTA Tekton Controller):                | |                          | du -sh /workspace/cache: 211M            | |                          | tar czf cache-dump.tgz                   | |                          | /workspace/cache/: 166M / 5.717s         | |                          | Analyse eines NPM Caches (ESTA Tekton    | |                          | UI):                                     | |                          | du -sh /workspace/cache: 121M            | |                          | tar czf npm-cache-dump.tgz               | |                          | /workspace/cache: 112M / 3.765s          | +--------------------------+------------------------------------------+ | Alternativen / Varianten | Variante 1                               | |                          |                                          | |                          | Ein geteilter Cache f\u00fcr alle Projekte    | |                          | eines Build Stacks (Status quo)          | |                          |                                          | |                          | Konzept: ein gesharter Cache pro Build   | |                          | Namespace (\u00e4hnlich wie auf einem lokalen | |                          | Computer)                                | |                          |                                          | |                          |   V                                      | |                          | orteile                        Nachteile | |                          |   ------------                           | |                          | ------------------- -------------------- | |                          | ---------------------------------------- | |                          |   Keine \u00c4nde                             | |                          | rungen erforderlich   Blockiert parallel | |                          |  laufende Pipelines (auf mehreren Nodes) | |                          |   Keine redund                           | |                          | anten Daten         Grosses Cache Volume | |                          |   Schnelles                              | |                          |  Cache Warming         Cleanup: wipe all | |                          |                                          | |                          | Processing Overhead: 0s                  | |                          |                                          | |                          | Kosten pro Montat: ~ CHF 28 (fix pro     | |                          | Namespace; 2 x 5G Cache Size)            | |                          |                                          | |                          | Variante 2                               | |                          |                                          | |                          | Separate Caches pro Projekt/Repository   | |                          |                                          | |                          | Konzept: ein Cache Volume pro Projekt    | |                          | resp. Repository. Dieser Cache enth\u00e4lt   | |                          | (nur) die Dependencies f\u00fcr ein           | |                          | spezifisches Projekt und die read-write  | |                          | Einschr\u00e4nkungen verhindern lediglich     | |                          | parallele Builds desselben Projekts. Der | |                          | Cache muss f\u00fcr jedes Projekt neu         | |                          | aufgebaut werden, was Redundanz und      | |                          | langsame erste Builds mit sich bringt.   | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   -------------------------------        | |                          | --------- ------------------------------ | |                          |   Minimale \u00c4nderungen erf                | |                          | orderlich         Viele redundante Daten | |                          |   Kleine Cache Volumes                   | |                          |                  Langsames Cache Warming | |                          |   Blockierung auf ein Projekt b          | |                          | eschr\u00e4nkt   Cleanup: wipe all (pro Repo) | |                          |                                          | |                          | Processing Overhead: 0s                  | |                          |                                          | |                          | Kosten pro Monat: ~ CHF 56 (dynamisch    | |                          | pro Repo; Annahme: 10 Repos \u00e0 2G Cache   | |                          | Size)                                    | |                          |                                          | |                          | Variante 3                               | |                          |                                          | |                          | Mehrere dynamisch allozierte Caches      | |                          | (konfigurierbare Anzahl)                 | |                          |                                          | |                          | Konzept: mehrere gesharte Caches \u00e4hnlich | |                          | wie Variante 1, welche dynamisch den zu  | |                          | startenden Pipelines zugewiesen werden.  | |                          | Die Blockierung von parallelen Builds    | |                          | wird damit entsch\u00e4rft. Der ESTA Tekton   | |                          | Controller \"verwaltet\" die Caches und    | |                          | pr\u00fcft vor dem Start einer Pipeline,      | |                          | welches Cache Volume verf\u00fcgbar ist. Das  | |                          | ergibt einen gewissen Verwaltungsaufwand | |                          | und zus\u00e4tzliche Logik im Controller die  | |                          | potenziell \"out-of-sync\" sein kann und   | |                          | im schlimmsten Fall einen Lock von       | |                          | Pipelines zur Folge haben kann.          | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   -------------------------              | |                          | ----------------------- ---------------- | |                          | ---------------------------------------- | |                          |   Blockierung kann per Conf              | |                          | ig beeinflusst werden   Redundante Daten | |                          |                                          | |                          | Gute Verteilung von Cache Daten          | |                          |          Zus\u00e4tzliche Logik im Controller | |                          |                                          | |                          |                           Nicht \"frei ge | |                          | gebene\" Caches blockieren neue Pipelines | |                          |                                          | |                          |                        Cleanup: wipe all | |                          |                                          | |                          | Processing Overhead: ~ 1s                | |                          |                                          | |                          | Kosten pro Monat: ~ CHF 56               | |                          | (konfigurierbar pro Namespace; Annahme:  | |                          | 4 Caches \u00e0 5G Cache Size)                | |                          |                                          | |                          | POC implementiert in Pipeline Templates  | |                          | und Controller.                          | |                          |                                          | |                          | Variante 4                               | |                          |                                          | |                          | Cache-Dumps werden zentral gespeichert   | |                          | und in Pipeline Workspace kopiert        | |                          | (Github Style)                           | |                          |                                          | |                          | Konzept: Cache Daten werden beim         | |                          | Pipeline Start von einer zentralen       | |                          | Storage (Service) mit einem bestimmten   | |                          | Key (pro Projekt/Artefakt/Version) in    | |                          | den Pipeline Workspace oder ein Lokales  | |                          | Volume geladen und nach dem Build wieder | |                          | gepackt und in die Storage zur\u00fcck        | |                          | geschrieben. Dabei gibt es einen         | |                          | Fallback auf den Cache eines anderen     | |                          | Projekts desselben Build Stacks, um      | |                          | nicht wie Variante 2 f\u00fcr jedes Projekt   | |                          | mit einem leeren Cache starten zu        | |                          | m\u00fcssen. Dieser Ansatz wird auch von      | |                          | Github Actions angeboten.                | |                          |                                          | |                          | Die genaue Technologie f\u00fcr einen         | |                          | zentralen Storage Service muss noch      | |                          | evaluiert werden. AWS S3 oder etwas      | |                          | \u00e4hnliches wie Azure Blob Storage. Es     | |                          | ben\u00f6tigt zudem einen Dienst oder Job um  | |                          | nicht mehr verwendete Cache-Entries      | |                          | periodisch zu l\u00f6schen, um die Storage    | |                          | Gr\u00f6sse unter Kontrolle zu halten.        | |                          |                                          | |                          |   Vort                                   | |                          | eile                           Nachteile | |                          |                                          | |                          | ---------------------------------- ----- | |                          | ---------------------------------------- | |                          |   Keine Blockierung                      | |                          | durch PVCs       Komplexe Implementation | |                          |   Kleine Caches                          | |                          |         Zus\u00e4tzlicher Dienst erforderlich | |                          |   Cleanup: inkrementell nach Usage   Dat | |                          | entransfer (copy) vor und nach dem Build | |                          |                                          | |                          | Processing Overhead: ~ 11s (~ 3s         | |                          | (Query+Download) + 0.831s (Unpack) +     | |                          | 5.712s (Tar GZ) + 1.363s (Upload))       | |                          |                                          | |                          | Kosten pro Monat: ~ USD 1.24 (Annahme:   | |                          | 10 Repos mit je 10 Cache Entries \u00e0 500M  | |                          | = 50GB; 400 Builds pro Monat (\u2192 4        | |                          | COPY/LIST/PUT Operations pro Build + je  | |                          | 1GB Datentransfer))                      | |                          |                                          | |                          | POC mit S3 implementiert in Pipeline     | |                          | Templates.                               | |                          |                                          | |                          | Variante 5                               | |                          |                                          | |                          | Varninsh Cache als Proxy f\u00fcr bin.sbb.ch  | |                          |                                          | |                          | Pro Tekton Build Namespace wird ein      | |                          | Varnish Cache Deployment mit             | |                          | persistenter Storage (File Storage       | |                          | Backend via PVC) hochgefahren, welches   | |                          | als Proxy f\u00fcr Maven und NPM Repos        | |                          | konfiguriert wird.                       | |                          |                                          | |                          |                                          | |                          | Vorteile                       Nachteile | |                          |   ------------------------------ -----   | |                          | ---------------------------------------- | |                          |   Keine Blockier                         | |                          | ung durch PVCs   Zus\u00e4tzliches Deployment | |                          |   Keine Redundan                         | |                          | z                Wenig Knwohow vorhanden | |                          |   Cleanup: automatisch           Kan     | |                          | n kein SSL; erfordert zus\u00e4tzlichen Proxy | |                          |                                          | |                          | Processing Overhead: 0s                  | |                          |                                          | |                          | Kosten pro Monat: ~ CHF 117 (fix pro     | |                          | Namespace; 5G Cache Size + zus\u00e4tzliche   | |                          | CPU + Memory f\u00fcr Varnish Pods)           | +--------------------------+------------------------------------------+ | Entscheidung             | Variante 4                               | +--------------------------+------------------------------------------+ | Begr\u00fcndung               | Am ARCH-Sync wurde diese Variante mit S3 | |                          | Storage als kosteng\u00fcnstigste und am      | |                          | besten skalierbare Option gew\u00e4hlt und in | |                          | einem Folgemeeting im Detail besprochen. | |                          | Eine Cache Eviction-Policy kann direkt   | |                          | in S3 konfiguriert werden, so dass nur   | |                          | wenige Logick f\u00fcr das Management des     | |                          | Caches selbst implementiert werden muss. | +--------------------------+------------------------------------------+ | Wer                      | Jeanneret Julien (IT-PTR-CEN1-BDE3)      | |                          | Spirig Lukas (IT-PTR-CEN2-SL3)           | +--------------------------+------------------------------------------+ | Wann                     | 29.07.2022                               | +--------------------------+------------------------------------------+ "}, {"text": "ESTA Tekton Operator  Ziel: Anwender k\u00f6nnen  ESTA Tekton selbst\u00e4ndig via Custom Resource in einem OpenShift Namespace installieren.  -   Erforderliche Ressourcen      -   Namespace Setup      -   ESTA Tekton Deployment  -   Setup Prozess      -   OAuth Setup (Azure AD App Registration)      -   Credential Exchange          -   Bitbucket User          -   Artifactory User          -   AWS S3 Access Key          -   Azure Blob Storage  -   Technologie      -   Operator Credentials      -   Operator Config Options      -   Entwurf Custom Resource      -   TODOs / Refactorings  Erforderliche Ressourcen  Namespace Setup  Quellen: ocp-argocd/namespace-configuration-operator, esta-tekton-pipeline-config  -   LimitRange      -   sbb-esta-tekton-pipeline-defaults  -   ResourceQuota      -   esta-tekton-pipeline-quota  -   ServiceAccount      -   esta-tekton-pipeline-sa      -   esta-tekton-pipeline-root-sa :question:      -   esta-tekton-controller-sa  -   RoleBinding      -   esta-tekton-sa-scc-anyuid      -   esta-tekton-pipeline-sa      -   esta-tekton-pipeline-root-sa :question:      -   esta-tekton-controller-sa  -   Secret      -   azure-ad-client-credentials      -   esta-tekton-basicauth-docker      -   esta-tekton-basicauth-git      -   esta-tekton-oauth-client-ids      -   esta-tekton-sonar-api-key      -   esta-owasp-db-secret      -   esta-tekton-pipeline-env      -   argocd-env-secret      -   smtp-server-secret  Default LimitRanges (sbb-default-limits) und ResourceQuota (default-mini-project-quota) m\u00fcssen vom Operator resp. vom Helm Chart via Hook gel\u00f6scht werden.  ESTA Tekton Deployment  Quellen: esta-tekton-pipeline-controller, esta-tekton-pipeline-ui  -   Deployment      -   esta-tekton-pipeline-controller      -   esta-tekton-pipeline-ui  -   Service      -   esta-tekton-pipeline-controller      -   esta-tekton-pipeline-ui  -   Route      -   esta-tekton-pipeline-controller-sbb-cloud      -   esta-tekton-pipeline-ui-sbb-cloud  -   ConfigMap      -   esta-tekton-pipeline-controller-application-yaml      -   esta-tekton-pipeline-controller-notification-text-yaml      -   esta-tekton-bitbucket-config      -   sbb-certificates  -   PersistentVolumeClaim      -   esta-tekton-pipeline-controller-workspace  Setup Prozess  1.  Anlegen der Namespace Config Resources (LimitRange, ResourceQuota)  2.  Initialisierung Umsysteme      1.  OAuth Setup      2.  Bitbucket          1.  User erstellen :question:          2.  Access Token registrieren :question:          3.  Secret esta-tekton-basicauth-git anlegen      3.  Artifactory          1.  User erstellen :question:          2.  Access Token registrieren :question:          3.  Secret esta-tekton-basicauth-docker anlegen      4.  AWS IAM User & Policy          1.  Terraform apply          2.  Secret esta-tekton-aws-cache-credentials anlegen      5.  Azure Blob Storage Setup          1.  Vorgehen noch unbekannt  3.  ESTA Tekton Deployment      1.  esta-tekton-pipeline-config Helm Chart installieren  OAuth Setup (Azure AD App Registration)  Kann wie bisher \u00fcber einen Taskrun ausgef\u00fchrt werden. Es sollen aber pro Namespace individuelle Azure AD API Credentials generiert werden, wie dies im Konzept Azure AD App Registration Prozess beschrieben wird.  Credential Exchange  Bitbucket User  Falls via API m\u00f6glich: ein neuer Benutzer wird angelegt (falls nicht existent) Falls via API m\u00f6glich: der Operator generiert via API einen Access Token f\u00fcr den angegebenen Benutzer und speichert diesen im Secret esta-tekton-basicauth-git. Falls via API m\u00f6glich: Der Operator generiert ebenfalls einen SSH Key und speichert via API den Pubkey in Bitbucket. Der Private Key wird in einem Secret esta-tekton-ssh-git gespeichert.  Vault Integration  Eine allf\u00e4llige Anbindung von Hashicorp Vault ist zu pr\u00fcfen. Im besten Fall kann f\u00fcr den Tekton Namespace lediglich ein Vault Key konfiguriert werden.  Artifactory User  Falls via API m\u00f6glich: ein neuer Benutzer wird angelegt (falls nicht existent) Falls via API m\u00f6glich: Der Operator generiert via API einen Access Token f\u00fcr den angegebenen Benutzer und speichert diesen im Secret esta-tekton-basicauth-docker.  Vault Integration  Eine allf\u00e4llige Anbindung von Hashicorp Vault ist zu pr\u00fcfen. Im besten Fall kann f\u00fcr den Tekton Namespace lediglich ein Vault Key konfiguriert werden.  AWS S3 Access Key  F\u00fcr den Cache Zugriff muss im gesharten AWS Account ein IAM User & Policy angelegt werden. Das kann wie bisher mittels Terraform in einem Taskrun im Operator Namespace ausgef\u00fchrt werden. Als Alternative ist die direkte Ausf\u00fchrung von Terraform im Operator (Pod) zu pr\u00fcfen.  Azure Blob Storage  Der Prozess ist noch nicht bekannt  Technologie  Der Operator soll prim\u00e4r \u00fcber ein Helm Chart die oben aufgef\u00fchrten Ressourcen in den Zielnamespace bringen und damit den Namespace Configuration Operator sowie das bestehende Helm Chart (esta-tekton-pipeline-config) abl\u00f6sen resp. vereinen.  Controller und UI werden als Dependencies \u00fcber die individuellen Charts der einzelnen Komponenten in den konfigurierten Version herunterladen und im Namespace installieren.  Auch die App Registration und die Tasks f\u00fcr die Credential Exchange k\u00f6nnen als Job oder TaskRun im Helm Chart definiert und im Operator Namespace verarbeitet werden, \u00e4hnlich wie das bisher mit ArgoCD gemacht wird.  Ein Helm-based Operator kann hier als technologische Grundlage dienen. Ein POC gem\u00e4ss dem Quickstart Guide mit diesem Helm Chart wurde erfolgreich durchgef\u00fchrt.  Operator Credentials  (Als Secrets im Operator Namespace hinterlegt)  -   AWS Key & Secret zum Anlegen der IAM User & Policies  -   Azure AD API Client-id und Secret  -   Defaults f\u00fcr esta-tekton-sonar-api-key, esta-owasp-db-secret und     smtp-server-secret     (\u2192 \u00fcber Watches/valueOverrides injected)  Operator Config Options  -   pipelineCacheBackend: (AWS_S3 oder AZURE_BLOB)  -   azureAdApiHost: azure-ad.api.sbb.ch  -   awsTerraform:      -   backendBucket: terraform-esta-tekton-infrastructure-prod      -   s3BucketName: esta-tekton-pipeline-cache-prod  -   Default Values f\u00fcr esta-tekton-pipeline-config Helm Chart  Entwurf Custom Resource  esta-tekton-cr.yaml  apiVersion: esta.sbb.ch/v1beta1  kind: EstaTektonBuildSystem  metadata:  name: my-own-tekton  namespace: esta-tekton-dev  spec:  releaseVersion: 0.14.12  appRegistration:  owners:  - userPrincipalName: replace-with-REQUESTER  allowedADGroups:  # DG_RBT_ESTA  - a51563af-953f-485b-8cf0-b37bc8d7c5fe  # add your groups here     apiAccessClientIds: []  bitbucket:  host: code.sbb.ch  username: esta-build-clew  artifactory:  host: bin.sbb.ch  username: esta-build-clew  storageQuota:  default: 1Ti  overrides:  ki-tekton: 2Ti    # values aus esta-tekton-pipeline-config Helm Chart   esta-tekton-pipeline-controller:  appVersion: 2.15.1  pipelineTemplateVersion: 0.11.5     defaultMavenGoals: clean install     additionalTemplateRepos:       - https://code.sbb.ch/scm/kd_esta_test/esta-tekton-pipeline-custom-templates.git?at=refs/heads/master     splunkIndex: sbb_esta-tekton_internal_prod_events   esta-tekton-pipeline-ui:  appVersion: 2.10.0    splunkIndex: sbb_esta-tekton_internal_prod_events  Subchart Versioning  Bislang unklar ist, wie die Versionen der Subcharts (esta-tekton-pipeline-controller und esta-tekton-pipeline-ui) als Parameter \u00fcber die Custom Resource definiert werden kann.  TODOs / Refactorings  -   \"stage\" Value in esta-tekton-pipeline-* Charts m\u00fcssen mit     .Release.Namespace ersetzt werden.  -   Die konkreten Permissions f\u00fcr den Service Account des Operators     resp. der TaskRuns im Operator Namespace m\u00fcssen definiert werden     (muss Secrets im Zielnamespace anlegen/\u00fcberschreiben k\u00f6nnen)  -   Der Release-Prozess muss neu definiert werden. \u00dcber den (einfachen)     Helm Operator k\u00f6nnen nur statische Werte f\u00fcr die App Versionen     hinterlegt werden.     Eine Option w\u00e4re, ein Helm Chart analog zum CLEW ArgoCD Chart     anzubieten, welches prim\u00e4r die Custom Resource mit vor-definierten     Values f\u00fcr Controller und UI schreibt. "}, {"text": "ESTA Tekton Pipeline  The ESTA Tekton Pipeline provides an easy-to-use CI/CD system with a standardized process for building and deploying your software projects on Openshift.  The key benefits for using ESTA Tekton are:  -   Easy setup for projects using the standard SBB stacks like     SpringBoot, Angular/Typescript and Go  -   Simple build configuration with a single JSON file similar to the     well known estaCloudPipeline.json  -   Fast migration for builds from ESTA Cloud Pipeline (the deployment     part needs a little more effort)  -   Makes use of Lean Gitflow and Semantic Versioning  -   Scalable build infrastructure using dedicated Openshift 4 clusters  -   Extensible using custom pipelines and individual build namespaces  -   Standard ESTA Tekton Pipelines with options to be customized  -   Customized builder images if necessary  -   Flexible pipeline configurations which get triggered by User, REST     API or Bitbucket Webhooks  Architecture Overview  Build and Deployment Setup for individual Business Units:  []  Build and Deployment Workflow with Tekton Pipelines:  []  Documentation  -   Getting Started      -   Prerequisites      -   Setup your Build Namespace      -   Enable your Repository for Tekton      -   Start your first Tekton Pipeline      -   What's next?  -   Core Concepts      -   Tekton Pipelines for CI/CD      -   Deployment with ArgoCD      -   ESTA Tekton Pipelines  -   Dedicated Build Namespaces      -   Tekton Build Clusters      -   Setup your own Build Namespace      -   Secrets to access your resources  -   Deployment with ArgoCD and Helm Charts      -   Setup ArgoCD for your Deployments      -   Create Helm Charts       -   Manage ArgoCD Deployments in Git      -   Update ArgoCD Values from Tekton Pipelines  -   ESTA Tekton Workflow      -   Continuous Integration      -   Release Process      -   Bitbucket Integration      -   Notifications  -   ESTA Tekton Parameters - estaTektonPipeline.json      -   Steps and Stages      -   Helm Charts      -   Docker Settings      -   Examples      -   Parameter Documentation  -   Tekton Control Panel      -   Authentication      -   Projects and Repositories      -   Start Builds and Releases      -   Monitor Pipeline Runs      -   ESTA Cloud Pipeline Migration Tool      -   User Permissions      -   Pipeline Secrets      -   System Configuration  -   Advanced Topics      -   Custom Pipelines      -   Custom Pipeline Tasks      -   Environment Variables in Pipeline Tasks      -   Java and Maven Versions      -   Using Buildpacks      -   SonarCloud Test Coverage  -   Migrating from ESTA Cloud Pipeline      -   Migrating estaCloudPipeline.json      -   Dockerfile Migration      -   OpenShift Templates to Helm Migration  -   How-to Tekton  -   Known Issues  Release Notes  Notes about releases of ESTA Tekton and it's components can be found in this CHANGELOG.  Our backlog for future development with the possibility to vote in listed in Planned Features. "}, {"text": "Esta-Tekton Quarkus Native Build  Vieles kann auf dem Standardguide von Quarkus nachgelesen werden. Ich m\u00f6chte hier trotzdemnochmals die Erfahrungen kurz zusammenfassen.  Der Standardguide f\u00fcr Quarkus-Native kann hier gefunden werden: https://quarkus.io/guides/native-reference  Umstellung auf Nativebuild  1.  Anpassung des Dockerfiles  2.  GraalVm selektieren:     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-controller/browse/estaTektonPipeline.json#5  3.  Quarkus Buildparameter setzen:     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-controller/browse/estaTektonPipeline.json#58  4.  Quarkus Native Block im application.yml konfigurieren:     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-controller/browse/src/main/resources/application.yaml#55  5.  Externe Library Klassen welche per Reflection instanziert werden     registrieren:     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-controller/browse/src/main/java/ch/sbb/esta/tekton/pipeline/nativebuild/RegisterReflections.java  6.  Eigene Klassen welche per Reflection instanziert werden annotieren:     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-controller/browse/src/main/java/ch/sbb/esta/tekton/pipeline/service/appregistration/model/AccessToken.java#5  Dann kann der lokale Build per:   mvn package -DskipTests -Dnative -Dquarkus.native.debug.enabled=true -Dquarkus-profile=dev   gestartet werden. Sobald der Build erfolgreich durchlief kann das native image wie folgt gestartet werden:  ./target/esta-tekton-pipeline-controller-x.y.z-SNAPSHOT-runner  Tekton-Client f\u00fcr Quarkus Nativebuild aufbereiten  Da die tekton-client library nicht in der aktuellen Version f\u00fcr den Quarkus Nativebuild aufbereitet ist, wurde ein eigenes repo mit einem eigenen Build angelegt, um den tekton-client f\u00fcr den nativebuild konfiguriert zu haben.   https://code.sbb.ch/projects/KD_ESTA/repos/esta-quarkus-tekton-client/browse  Debuggen einer Native App  Das debuggen einer Nativeapp geht nur unter Linux. Leider hat auch unter Linux mit GDB das debuggen per Intellij Debugger nicht funktioniert. Das attachen des Debugger klappt nicht.  Man f\u00fchrt den debugger wie folgt aus 'gdb target/esta-tekton-pipeline-controller-x.y.z-SNAPSHOT-runner' dann erh\u00e4lt man eine Konsole und tippt dort 'run' das Programm wird ausgef\u00fchrt, aber leider konnte der debugger nicht attached werden.   Erfolgreiches publishen der App  Im Endeffekt konnten wir die App erfolgreich auf esta-tekton-dev und clew-tekton ausrollen. "}, {"text": "Rebuild Konzept  Wir hatten einmal einen Rebuild Button welcher den Build mit den gleichen Parametern startete wie zuvor. Nun war das Verhalten nicht immer sprechend, denn wenn wir den Head eines Branches buildeten, wollen wir nach einem Commit wieder den Head des Branches rebuilden.  Es gibt aber auch F\u00e4lle wo wir genau den gleichen Build nochmals starten wollen. Das ist dann der Fall wenn der Build aufgrund von unerkl\u00e4rlichen Infrastrukturproblemen nochmals laufen soll. Hier sollen einige Anwendungsf\u00e4lle aufgelistet werden und so die Rebuildbuttons begr\u00fcndet werden.  Build Pipeline  Bei der Build Pipeline gibt es verschiedene Gr\u00fcnde weshalb sie failed:  -   Infrastrukturfehler  -   Testfehler  -   Buildfehler  -   Abbruch durch User  Hier haben wir 2 Rebuild Szenarien:  1.  Restart des exakt gleichen gleichen Tags/Commits (Rebuild aufgrund     Infrastrukturfehler/Flunky Tests ohne Ver\u00e4nderung des Sources)   2.  Restart des Builds mit dem letzten Tags/Commit auf dem Branch (z.B.     Test wird korrigiert oder Sourcecode wird korrigiert).   Szenario Rebuild Tag/Branch  Wird ein Build restarted, welcher auf Basis eines Tags gestartet wurde, muss der Build erneut auf Basis des Tags restartet werden. Das heisst es darf nicht der gleiche commit restartet werden, da sich das Tag ja in der Zwischenzeit verschieben k\u00f6nnte. Der Commit unter dem Tag muss also neu ermittelt werden vor dem Buildstart.   Wird ein branch build restartet, muss der letzte Commit (HEAD) ermittelt werden und mit diesem restartet werden.  Szenaio exakter Rebuild  Dieser Rebuild wird dann ben\u00f6tigt, wenn z.B. ein Infrastrukturproblem vorlag. Das w\u00e4re dann ein simpler Restart der Pipeline wie wir es fr\u00fcher hatten. Also mit identischen Parametern.  Tagging Pipeline  Die Tagging Pipeline wird \u00fcber einen Dialog gestartet und ver\u00e4ndert den Zustand im Git Repository. Nun kann es aus verschiedenen Gr\u00fcnden passieren, dass die Tagging Pipeline failed.   1.  Infrastruktur Probleme  2.  Race Condition beim Push eines Commits  3.  Andere Fehler in der Pipeline  Ein Tag wird auf dem Head des selektierten Branches gemacht. Dazu wird die commit Id der Buildpipeline \u00fcbergeben. Nun, wenn das Tagging fehlschl\u00e4gt, w\u00fcrden sich 2 Rebuild Buttons anbieten:  Szenario Restart same commit  Wenn z.B. durch ein Infrastrukturfehler oder eine Racecondition ein Tagging nicht abgeschlossen werden kann, will man nochmals den exakt gleichen Tagging Prozess durchf\u00fchren. Das heisst man startet einen neuen Build basiert auf dem gleichen Commit. Das kommt einem simplen Restart mit den selben Parametern innerhalb Openshift gleich.   Restart last branch-commit  Bei diesem Restart Knopf, soll der letzte commit des Branches ermittelt und die Pipeline nochmals restarted werden. Dieses Szenario tritt z.B. ein, wenn man eine Tagging Pipeline startete und pl\u00f6tzlich noch einen commit reinnehmen m\u00f6chte. Man bricht die Pipeline ab, macht seinen commit und restartet die Pipeline. Das Tagging geschieht dann auf Basis des letzten Commits.   Staging Pipeline  Die Staging Pipeline wird immer auf der gleichen Version aufbauen. Parameter sollten sich nicht ver\u00e4ndern. Bei der Staging Pipeline macht nur ein simpler Restart mit den exakt gleichen Buildparametern Sinn. Somit h\u00e4tten wir hier einfach einen simplen Restart Button.   Fehlende GitEvent Configs  Beim klicken des Rebuild Buttons kann es sein, dass Fehlermeldungen erscheinen aufgrund fehlenden GitEvent Configs. Hier sollte im Tooltip des Buttons und auch in der Fehlermeldung des Buildstarts eine klare Fehlermeldung dargestellt werden.   Rebuild Matrix Anforderungen  +--------------+----------------+----------------+----------------+ | Pipeline Typ | Exakter        | Tag Rebuild    | Branch Rebuild | |              | Rebuild        | (Im UI         | (Im UI         | |              |                | gleicher       | gleicher       | |              | (simpler       | Button wie     | Button wie Tag | |              | Openshift      | Branch         | Rebuild)       | |              | Pipeline       | Rebuild)       |                | |              | Restart)       |                | (Intelligenter | |              |                | (Intelligenter | Rebuild auf    | |              |                | Rebuild auf    | Basis eines    | |              |                | Basis eines    | Branches)      | |              |                | Tags)          |                | +==============+================+================+================+ | Build        | :tick:         | :tick:         | :tick:         | +--------------+----------------+----------------+----------------+ | Tagging      | :tick:         |                | :tick:         | +--------------+----------------+----------------+----------------+ | Stageing     | :tick:         |                |                | +--------------+----------------+----------------+----------------+  Buttons auf dem UI  Die Buttons auf dem UI sollen wie folgt aussehen:  [] "}, {"text": "Support Howto's  Delete an Esta-Tekton Namespace  1.  Usually we get a ticket to delete the namespace  2.  Remove the xyz-namespace.yaml from esta-app-argocd repo, create a PR     and merge it  3.  Afterwards you can create a new ticket on clew.sbb.ch for the CON     Team to delete the namespace on the cluster  4.  Delete the Cache Bucket with the same name as the productive     namespace name on AWS S3  5.  Delete the Tekton-Results Schema:      1.  Connect with following details to Postgres with your postgres         client (in our case Intellij)      2.  User: esta_tekton_creator      3.  URL:         jdbc:postgresql://esta-tekton-prod.czdfgxj0x1zx.eu-central-1.rds.amazonaws.com:5432/postgres      4.  PW: you'll find the password for the esta_tekton_creator in the         ESTA Keepass File      5.  Execute following script while the schema-name and user name is         the same as the namespace installation.      6.  DROP SCHEMA <schema-name> CASCADE;      7.  REVOKE CONNECT ON DATABASE esta_tekton FROM <schema-name>;      8.  DROP ROLE <user-name>; "}, {"text": "Tekton Resolvers Review  ClusterTasks werden mit Tekton v0.41.0 deprecated. Das neue Konzept nennt sich Resolvers und l\u00e4sst vielseitige M\u00f6glichkeiten zum laden von Pipelines und Tasks zu. Siehe auch den Blogpost von RedHat.  Nachfolgend haben wird die verschiedenen Resolvers analysiert und deren Eignung f\u00fcr den Einsatz in ESTA Tekton beurteilt.  ESTA-5478 - ESTA Tekton Task & Pipeline Resolvers Konzept Closed  Cluster Resolver  Dies ist der direkte Ersatz f\u00fcr ClusterTasks und die taskRef kann einfach umgestellt werden.  + Die Tasks sind OpenShift kompatibel mit RedHat Images - Unterst\u00fctzt keine Versionierung  Fazit: bedingt brauchbar  Git Resolver  Mit entsprechender Default Config w\u00e4re die Integration recht einfach:  taskRef:  resolver: git  params:  - name: org  value: KD_ESTA  - name: repo  value: esta-tekton-pipeline-templates  - name: pathInRepo  value: tasks/esta-cache-load.yaml  - name: revision  value: 0.14.7  \"revision\" k\u00f6nnte via Template oder Pipeline Parameter definiert werden.  + M\u00f6glicher Ersatz f\u00fcr Custom Repos und Tasks - Bei Github (public Repos), haben die meisten Tasks Image-Referenzen, die auf OpenShift geblockt sind (nicht via bin.sbb.ch) - Default Config mit Bitbucket Server (authenticated API) ist global und ben\u00f6tigt ein Secret mit Bitbucket Access Token (read-only) - Resolver unterst\u00fctzt nur HTTP Access Tokens, welche pro Projekt resp. Repo ausgestellt werden k\u00f6nnen. Zugriff auf mehrere Projekte in Bitbucket (pro Tekton Namespace) ist also nicht m\u00f6glich.  git-resolver-config  kind: ConfigMap  apiVersion: v1  metadata:  name: git-resolver-config  namespace: openshift-pipelines  ...  data:  default-url: ''  # NOTE: omitting the namespace config will read the configured secret from the Tekton namespace  # api-token-secret-namespace: openshift-pipelines  api-token-secret-name: bitbucket-resolver-token  api-token-secret-key: token  server-url: 'https://code.sbb.ch'  default-revision: master  scm-type: bitbucketserver  fetch-timeout: 1m  default-org: KD_ESTA  Fazit: brauchbar  Hub Resolver  - Die meisten Tasks haben Image-Referenzen, die auf Openshift geblockt sind (nicht via bin.sbb.ch)  Fazit: unbrauchbar  Bundles Resolver  + Einfache Erstellung von Bundles mit `tkn bundle push` + Einfache Integration in die Pipeline Templates m\u00f6glich (f\u00fcr Task-Referenzen) + Versionierung via Pipeline Parameter m\u00f6glich (siehe Beispiel unten BUNDLE_IMAGE: esta.docker.bin.sbb.ch/esta/esta-tekton-pipeline-bundle:latest)  taskRef:    resolver: bundles    params:      - name: bundle        value: $(params.BUNDLE_IMAGE)      - name: name        value: esta-cache-load  Fazit: brauchbar  Fazit  Als brauchbare Konzepte haben sich Bundles und Git Resolver gezeigt. Der ESTA Tekton Task Katalog k\u00f6nnte mit wenig Aufwand als Bundle released und publiziert werden. Auch Custom Tasks k\u00f6nnten \u00fcber ein Bundle referenziert werden, allerdings m\u00fcssten die Kunden selber diese Bundles erstellen und pflegen.  Die Pipeline Templates lassen sich jedoch nicht \u00fcber einen Resolver einbinden, aus dem einfachen Grund, dass ESTA Tekton PipelineRuns mit inline PipelineSpec ben\u00f6tigt, um die Pipelines vor dem Start noch zu modifizieren. Dies l\u00e4sst sich nur bewerkstelligen, indem die Pipeline Templates direct als Kubernetes Ressource eingelesen werden k\u00f6nnen. Ein \"Import\" der Pipeline Templates in den spezifischen Namespace ist also zwingend notwendig und in diesem Zug k\u00f6nnen auch die Tekton Tasks direkt importiert werden und m\u00fcssen nicht via Resolver geladen werden. So bleibt sichergestellt, dass die Pipelines und die Tasks konsistent und miteinander kompatibel sind.  Die Anforderung, Tasks und Pipelines pro Namespace oder gar pro Repo zu parametriesieren (z.B. esta-maven-build mit h\u00f6heren Memory Requests, siehe ESTA-5461), kann mit keinem der oben genannten Konzepte direkt umgesetzt werden. Hier muss die taskRef im Pipeline Template angepasst werden und verschiedene Varianten des Tasks im Katalog (egal ob lokal oder via Resolver) bereitgestellt werden. Dazu sollte der Einsatz von Helm Templating f\u00fcr die Generierung des Task Katalogs in Betracht gezogen werden (\u2192 ESTA-5484). Die esta-tekton-pipeline-templates k\u00f6nnen parallel als Helm Chart und als Tekton Bundle released werden, um die gr\u00f6sstm\u00f6gliche Flexibilit\u00e4t anzubieten.  Custom Pipelines und Tasks  Die aktuelle Implementierung von Custom Tasks und Custom Pipelines in ESTA Tekton sollte indes erweitert werden, so das Pipelines und Tasks auch via Bundles oder Git Resolver referenziert werden k\u00f6nnen. Damit k\u00f6nnte der direkte Import von Custom Repositories in den Namespace abgel\u00f6st werden. Die Abnehmer m\u00fcssten in diesem Fall selber Bundles erstellen. Daf\u00fcr k\u00f6nnten wir aber geeignete Werkzeuge (z.B. einen Bundle Build Task in Tekton) anbieten.  Weitere Schritte  -   ~~Git Resolver f\u00fcr Bitbucket (code.sbb.ch) testen und     dokumentieren~~  -   Resolver Unterst\u00fctzung f\u00fcr Custom Tasks und Pipelines in     estaTektonPipeline.json einbauen (taskRef erweitern) \u2192  ESTA-5495 -     ESTA Tekton Resolvers f\u00fcr Custom Tasks/Pipelines Open  -   esta-tekton-pipeline-templates als Helm Chart anbieten \u2192      ESTA-5484 - ESTA Tekton: Tekton Templates als Helm Chart Closed "}, {"text": "Tekton Pipeline Log Persistance  +--------------------------+------------------------------------------+ | Fragestellung            | Wie sollen Pipeline Logs vollst\u00e4ndig und | |                          | hochverf\u00fcgbar gelesen und gespeichert    | |                          | werden?                                  | |                          |                                          | |                          | In Tekton sind die Logs ausschliesslich  | |                          | in den Pods der jeweiligen TaskRuns      | |                          | gespeichert. Nach Abschluss eines        | |                          | Pipeline Tasks sind diese nicht mehr     | |                          | vollst\u00e4ndig abrufbar, da sie auf der     | |                          | Node nicht komplett vorgehalten werden.  | |                          | Um die Logs auch nach L\u00f6schung der Pods  | |                          | noch verf\u00fcgbar zu haben, sammelt der     | |                          | ESTA Tekton Controller nach Beendigung   | |                          | eines Pipeline Runs die Logs aus allen   | |                          | Containern. Zu diesem Zeitpunkt sind     | |                          | diese aber schon nicht mehr vollst\u00e4ndig. | |                          | Die Logs m\u00fcssen also bereits zur         | |                          | Laufzeit der Pipeline aus den jeweiligen | |                          | Containers gezogen und persistent        | |                          | gespeichert werden.                      | |                          |                                          | |                          | Wie und mit welchen Hilfsmitteln kann    | |                          | dies nun am effizientesten und           | |                          | unterbrechungsfrei (HA) erreicht werden? | |                          |                                          | |                          | ESTA-5317 - ESTA Tekton Logging HA       | |                          | Konzept Closed                           | +==========================+==========================================+ | Rahmenbedingung          | -   Betrifft ausschliesslich Logs aus    | |                          |     Tekton Pipelines resp. TaskRuns      | |                          |                                          | |                          | -   Keine cluster-weite Logging L\u00f6sung   | |                          |     gesucht                              | |                          |                                          | |                          | -   Am Cluster Setup soll wenn m\u00f6glich   | |                          |     nichts ge\u00e4ndert werden m\u00fcssen        | +--------------------------+------------------------------------------+ | Annahmen                 | -   Logs eines PipelineRuns k\u00f6nnen       | |                          |     mehrere 100MB gross werden           | +--------------------------+------------------------------------------+ | Alternativen / Varianten | Variante 1                               | |                          |                                          | |                          | ESTA Tekton Controller streamed die Logs | |                          | zur Laufzeit                             | |                          |                                          | |                          | Der Controller hat bereits einen Watcher | |                          | auf Pipeline Events und kann so beim     | |                          | Start einer Pipeline den Log Stream      | |                          | lesen und laufend ins lokale Dateisystem | |                          | schreiben.                               | |                          |                                          | |                          |   Vorteile             Nachteile         | |                          |   -------------------- ---               | |                          | ---------------------------------------- | |                          |   Einfache Umsetzung   Nicht HA          | |                          |                        H                 | |                          | oher Ressourcenverbrauch der Controllers | |                          |                                          | |                          | Variante 2                               | |                          |                                          | |                          | Ein einfacher Service streamed Logs      | |                          | Pod-basiert                              | |                          |                                          | |                          | Einfach umzusetzende L\u00f6sung mit einem    | |                          | eigenen kleinen Service (Quarkus native) | |                          | der einen Watcher auf PipelineRun Events | |                          | registriert und bei jedem Start die Logs | |                          | direkt von den Pods via fabric8 liest    | |                          | und pro Pod/Task in individuellen        | |                          | Dateien speichert. Die abgeschlossenen   | |                          | Logs werden gzipped und nach S3          | |                          | hochgeladen.                             | |                          |                                          | |                          |   Vort                                   | |                          | eile                           Nachteile | |                          |   ----------------------------------     | |                          |  --------------------------------------- | |                          |   Ein                                    | |                          | fache Umsetzung                 Nicht HA | |                          |   Deployment mit Tekton Helm Chart       | |                          |    Zus\u00e4tzliches Deployment (Maintenance) | |                          |                                          | |                          | Variante 3a                              | |                          |                                          | |                          | Logging nach Splunk (full)               | |                          |                                          | |                          | Bestehende Infrastruktur nutzen und die  | |                          | TaskRuns mit Annotations so              | |                          | konfigurieren, dass sie nach Splunk      | |                          | loggen. Die Logs m\u00fcssen dann vom Tekton  | |                          | Control Panel resp. dem Backend aus      | |                          | Splunk gelesen werden. Optimalerweise    | |                          | wird f\u00fcr die Speicherung in Splunk ein   | |                          | spezifischer Index f\u00fcr die Applikation   | |                          | (Tekton Namespace) verwendet, welcher    | |                          | explizit bestellt und konfiguriert wird. | |                          | Siehe dazu  ESTA-5185 - Esta Tekton      | |                          | Optional Splunk Logging Open             | |                          |                                          | |                          |   Vorteile               Nachteile       | |                          |   ---------------------- --              | |                          | ---------------------------------------- | |                          |   HA                     Teuer           | |                          |   Einfach einzuricht                     | |                          | en   Refactoring des Controllers oder UI | |                          |   Kosten beim Kunden                     | |                          | Lifetime nicht in Sync mit Tekton Config | |                          |                                          | |                          |       Access von Tekton auf Splunk Logs? | |                          |                                          | |                          | Variante 3b                              | |                          |                                          | |                          | Logging nach Splunk (light)              | |                          |                                          | |                          | Basierend auf ESTA-5185 kann vom Kunden  | |                          | ein Splunk Index konfiguriert werden, in | |                          | welchen die Pipeline Logs geschrieben    | |                          | werden. Ist ein Splunk Index             | |                          | konfiguriert, wird im Tekton Control     | |                          | Panel beim PipelineRun ein Link auf ein  | |                          | Search Query in Splunk angezeigt,        | |                          | \u00e4hnlich wie diese in der Openshift       | |                          | Console gemacht wird.                    | |                          |                                          | |                          | Das bisherige Logging in Tekton wird     | |                          | beibehalten mit dem Verweis, dass die    | |                          | Openshift Infrastruktur das Logging nur  | |                          | im aktuellen Rahmen erm\u00f6glicht. Wer      | |                          | grosse und vollst\u00e4ndige Logs will, muss  | |                          | Splunk aktivieren (opt-in).              | |                          |                                          | |                          |   Vorteile                 Nachteile     | |                          |   ------------------------ ------------  | |                          | ---------------------------------------- | |                          |   HA                                     | |                          |     Default Logging bleibt unvollst\u00e4ndig | |                          |   Einfach einzurichten     Keine perf    | |                          | ekte Integration in Tekton Control Panel | |                          |   Kein Refactoring n\u00f6tig                 | |                          |   Kosten beim Kunden                     | |                          |                                          | |                          | Variante 4                               | |                          |                                          | |                          | Log Deamon mit fluentd und S3 als Output | |                          |                                          | |                          | Quellen:                                 | |                          |                                          | |                          | -   Fluentd <> K8S integration via       | |                          |     annotations                          | |                          |                                          | |                          | -   Application Logging in Kubernetes    | |                          |     with fluentd                         | |                          |                                          | |                          | -   Cluster-level Logging in Kubernetes  | |                          |     with Fluentd                         | |                          |                                          | |                          |   Vorteile        Nachteile              | |                          |   --------------- -                      | |                          | ---------------------------------------- | |                          |   HA                                     | |                          |              Refactoring des Controllers | |                          |   Native L\u00f6sung                          | |                          |  Ben\u00f6tigt Node-Konfiguration (Deamonset) | |                          |                                          | |                          | ~~Variante 5~~                           | |                          |                                          | |                          | Openshift Cluster Logging mit            | |                          | Elasticsearch                            | |                          |                                          | |                          | Quellen:                                 | |                          |                                          | |                          | -   Logging subsystem for Red Hat        | |                          |     OpenShift                            | |                          |                                          | |                          | -   Elastic Observability mit Elastic    | |                          |     Cloud on Kubernetes (ECK)            | |                          |                                          | |                          |                                          | |                          | Vorteile                       Nachteile | |                          |   ------------------------------ --      | |                          | ---------------------------------------- | |                          |   Supportete L\u00f6sung von RedHat           | |                          | Ganzer Elasticsearch Stack auf Openshift | |                          |                                          | |                          |              Wird von CON nicht approved | +--------------------------+------------------------------------------+ | Entscheidung             | Variante 1 (mit evtl. Migration nach     | |                          | Variante 2)                              | +--------------------------+------------------------------------------+ | Begr\u00fcndung               | Einfachste und schnellste Umsetzung zum  | |                          | aktuellen Zeitpunkt.                     | |                          | Kann schrittweise mit Storage auf S3 (\u2192  | |                          | ESTA-5267) und Leader-Election zu einer  | |                          | HA-L\u00f6sung erweitert oder bei Bedarf in   | |                          | einen eigenen Service (\u2192 Variante 2)     | |                          | ausgelagert werden.                      | +--------------------------+------------------------------------------+ | Wer                      | Spirig Lukas (IT-PTR-CEN2-SL3) ,         | |                          | Wallrapp Manuel (IT-PTR-EXT-EXT2 -       | |                          | Extern) , Jeanneret Julien               | |                          | (IT-PTR-CEN1-BDE3) , Br\u00fcderli Thomas     | |                          | (IT-PTR-CEN2-SL2) , H\u00e4rtwig Mario        | |                          | (IT-PTR-CEN2-BDE5) , Burger Alain        | |                          | (IT-PTR-CEN2-YPT4) , Wattinger Matthias  | |                          | (IT-PTR-CEN1-YPT1)                       | +--------------------------+------------------------------------------+ | Wann                     | 24.11.2022                               | +--------------------------+------------------------------------------+ "}, {"text": "Esta Demo Operator - Workshop  Content Table  -   Content Table  -   Agenda  -   What is an Operator for?  -   Operator SDK  -   Terminology CRD and CR  -   How does the esta-demo-operator-quarkus setup looks like  -   Breakouts to create your own Operator on base of the example     Operator  -   Example esta-demo-operator-quarkus  -   Vorbereitung  -   Erkenntnisse zu Fabric 8, Operator SDK Bootproblemen und SBB Windows     mit EAIO  Agenda  In the Esta-Demo-Operator Workshop we will do following  1.  What are Kubernetes Operators (15min -Jose)  2.  Operator-SDK - Java Operator generieren (5 min - Manu)  3.  Golang vs Java Operators (5 min)  4.  Esta-Demo-Operator-Quarkus explained (15min - Manu~~)~~  5.  ~~Generate your own Java Operator with the Operator-SDK and Quarkus     (5min) ~~  6.  Use Case Abl\u00f6sung estaCloudPipeline.json vs Operator \u2192 Unklarheiten?     (10min)  7.  Team Breakouts (Kafka, AzureAd, Apim) - Create and build Operator on     base of the sample Operator (1h 15min)  What is an Operator for?  The Operator Pattern in Openshift is a kind of Observer Pattern where an application (Container in a Pod) listens for certain resource changes in all namespaces within a cluster. If resource changes, the operator executes it's logic and updates the resource. This can be useful to setup, modify or delete resources within the Openshift Cluster or even outside. In the esta case we will have our first use cases in the deployment of AzureAd AppRegistrations, APIM Registrations or Kafka Configurations.  Operator SDK  Documentation:  https://javaoperatorsdk.io/docs/intro-operators  Terminology CRD and CR  We have 2 terms we hear often in the operator environment:  CRD: Custom Resource Definition defines how a Custom Resource should look like. What input fields and what status fields the resource can have.  CRD  # Generated by Fabric8 CRDGenerator, manual edits might get overwritten!  apiVersion: apiextensions.k8s.io/v1  kind: CustomResourceDefinition  metadata:  name: azureaddemoes.esta.sbb.ch  spec:  group: esta.sbb.ch  names:  kind: AzureAdDemo  plural: azureaddemoes  singular: azureaddemo  scope: Namespaced  versions:  - name: v1  schema:  openAPIV3Schema:  properties:  spec:  properties:  appRegistrationJson:  type: string  appRegSecretRef:  type: string  appRegistrationYaml:  type: string  type: object  status:  properties:  jsonResponse:  type: string  state:  enum:  - INVALID_YAML  - APPLIED  - ERROR  - CHANGES_NOT_ALLOWED  type: string  message:  type: string  type: object  type: object  served: true  storage: true  subresources:  status: {}  CR: Custom Resource    CRD  apiVersion: esta.sbb.ch/v1  kind: AzureAdDemo  metadata:  name: montagstest  spec:  appRegSecretRef: appregistration-demo-secret  appRegistrationYaml: >-  apiVersion: azure-ad-api/v1  appRegistration:  - displayName: SBB IAM Test Application for testing Openshift Operators  id: 91b1264a-2f4c-11ed-a261-0242ac120002  megaId: 5A135B9654C78175  redirectUris:  - uri: http://localhost:8080  type: WEB  owners:  - userPrincipalName: christian.egli3@sbb.ch  - userPrincipalName: manuel.wallrapp@sbb.ch  passwords:  - displayName: pw1  endDateTime: 2022-10-24T00:00:00Z  roles:  - id: b848539c-2f4b-11ed-a261-0242ac120002  assignedToADGroups:  - 8e180531-b0b5-4cb7-8825-b1f98d9a79f5  - 6a1d58ca-06bf-4503-9825-6f2934aed896  CR after processed by the operator:  CR after processed by the operator  apiVersion: esta.sbb.ch/v1  kind: AzureAdDemo  metadata:  annotations:  kubectl.kubernetes.io/last-applied-configuration: |  {\"apiVersion\":\"esta.sbb.ch/v1\",\"kind\":\"AzureAdDemo\",\"metadata\":{\"annotations\":{},\"name\":\"montagstest\",\"namespace\":\"esta-operator-demo\"},\"spec\":{\"appRegSecretRef\":\"appregistration-demo-secret\",\"appRegistrationYaml\":\"apiVersion: azure-ad-api/v1\\nappRegistrations:\\n - displayName: SBB IAM Test Application for testing Openshift Operators\\n id: 91b1264a-2f4c-11ed-a261-0242ac120002\\n megaId: 5A135B9654C78175\\n redirectUris:\\n - uri: http://localhost:8080\\n type: WEB\\n owners:\\n - userPrincipalName: christian.egli3@sbb.ch\\n - userPrincipalName: manuel.wallrapp@sbb.ch\\n passwords:\\n - displayName: pw1\\n endDateTime: 2022-10-24T00:00:00Z\\n roles:\\n - id: b848539c-2f4b-11ed-a261-0242ac120002\\n assignedToADGroups:\\n - 8e180531-b0b5-4cb7-8825-b1f98d9a79f5\\n - 6a1d58ca-06bf-4503-9825-6f2934aed896\"}}  creationTimestamp: \"2022-09-12T09:27:26Z\"  generation: 4  name: montagstest  namespace: esta-operator-demo  resourceVersion: \"605054260\"  uid: f4c6a6f6-fa87-4aa3-830c-71ab854e8cc5  spec:  appRegSecretRef: appregistration-demo-secret  appRegistrationYaml: |-  apiVersion: azure-ad-api/v1  appRegistrations:  - displayName: SBB IAM Test Application for testing Openshift Operators  id: 91b1264a-2f4c-11ed-a261-0242ac120002  megaId: 5A135B9654C78175  redirectUris:  - uri: http://localhost:8080  type: WEB  owners:  - userPrincipalName: christian.egli3@sbb.ch  - userPrincipalName: manuel.wallrapp@sbb.ch  passwords:  - displayName: pw1  endDateTime: 2022-10-24T00:00:00Z  roles:  - id: b848539c-2f4b-11ed-a261-0242ac120002  assignedToADGroups:  - 8e180531-b0b5-4cb7-8825-b1f98d9a79f5  - 6a1d58ca-06bf-4503-9825-6f2934aed896  status:  jsonResponse: '[{\"appDisplayName\":\"SBB IAM Test Application for testing Openshift  Operators\",\"clientId\":\"3095b924-4738-4ed4-9f5e-3ea1560bd002\",\"createdClientSecrets\":[],\"fileBasedRegistrationId\":\"91b1264a-2f4c-11ed-a261-0242ac120002\",\"registrationErrors\":{\"isCreated\":true,\"errors\":[]}}]'  message: \"\"  state: APPLIED  How does the esta-demo-operator-quarkus setup looks like  An Operator consists mainly 3 core components:  1.  Custom Resource Definition in form of a YAML which defines what     resources the Operator is observing  2.  Operator itself which is a Docker Conatiner running in a Pod     somewhere in the cluster  3.  Custom Resource is the resource the Operator should process. It is     usually also a YAML file which get's applied to a namespace.  The whole picture is explained a little better in this diagram.   []  []  In the end, an Operator is a simple app which listens to Custom Resource changes in one or all namespaces, processes this changes, writes a status into the Custom Resource.   Breakouts to create your own Operator on base of the example Operator  1.  Fork the Esta-Demo-Operator to esta-azurad-operator,     esta-kafka-operator, esta-apim-operator  2.  Adapt the sample Operator incl. Tests to your needs  3.  Build the operator locally so we have the CRD's and     Deploymentconfigs  4.  Push your changes, build your first Operator Release  5.  Add your yaml files (Deployment, Service, Route, CRD) to the     corresponding ocp-argocd  project (Instructions from us)  6.  We deploy our Operator through ArgoCd  7.  Create a CustomResource and see how the Operator reacts  Example esta-demo-operator-quarkus  Sourcecode: https://code.sbb.ch/projects/KD_ESTA_TEST/repos/esta-demo-operator-quarkus/browse  Deployment: https://code.sbb.ch/projects/OM_PAAS/repos/ocp-argocd/browse/projects/esta/applications/esta-demo-operator-quarkus?at=refs%2Fheads%2Ffeature%2FESTA-5242  Vorbereitung  -   Pr\u00e4sentation      -   Operator Slides (Jose) :tick:      -   Quarkus Example Explained (Manu)  -   personalized namespaces (Jose legt an mit Berechtigungen f\u00fcr User)      -   uxyz-operator-workshop (u...) :tick:          -   alle NS wurden erstellt und die entsprechenden Users             berechtigt             https://console-openshift-console.apps.clew01d.sbb-aws-dev.net/k8s/cluster/projects?project-name=operator-workshop      -   runtime-operator-workshop :tick:  -   Deployment, Service, SeviceAccount, ClusterRole \u2192 ocp-argocd (wird     vom Operator mvn build generiert)      -   azureAd      -   kafka      -   apim  -   Charts vorbereiten f\u00fcr alle 3 Operators (Jose) :tick:  -   Demo Operator forken und f\u00fcr alle 3 Teams vorbereiten.       -   Build muss laufen      -   Docker Image vorhanden  Erkenntnisse zu Fabric 8, Operator SDK Bootproblemen und SBB Windows mit EAIO  Egli Christian (IT-PTR-CEN2-SL2) Benutzer-9af42 Jeanneret Julien (IT-PTR-CEN1-BDE3) Gr\u00fcner Michael (IT-PTR-CEN2-BDE16)  und Wallrapp Manuel (IT-PTR-EXT-EXT2 - Extern)   Wir haben gestern ziemlich viel Zeit investiert Fabric8 bzw. den Java Demo Operator auf Windows zum laufen zu bringen. Schlussendlich gab es 3 Ursachen f\u00fcr die Verbindungs- / Bootstrap-Probleme von Fabric8 bzw. dem Operator SDK.   1.  Intellij wird bei der EAIO Installation \u00fcber ein bat File gestartet,     welches eine NO_PROXY Variable setzt. In dieser Variable war der     Host sbb-aws-dev.net nicht gelistet, welches dann die Verbindung aus     dem internen SBB Netz nicht erm\u00f6glichte.  2.  Als wir aber auch keine Verbindung \u00fcber SBB Free aufbauen konnten,     haben wir in der Library von Fabric8 festegestellt, dass fabric8 das     .kube/config file nicht nur im $HOME sucht sondern auch im $HOME_DIR     welches unter Windows auf das Laufwerk H: zeigt. Das heisst auch     dort muss die .kube/config liegen. Wurde beides richtig gesetzt,     startet Fabric8 und der Demo Operator einwandfrei.  3.  Das automatische generieren und applien muss im application.yaml     deaktiviert werden (untersten 2 Zeilen):   4.  quarkus:  5.  container-image:  6.  build: false  7.  name: azuread-operator-operator  8.  operator-sdk:  9.  bundle:  10. enabled: false  11. crd:  12. apply: false    generate: false "}, {"text": "Esta-Tekton AzureAd-, APIM-, Kafka-Registration Prototyp - Technologieauswahl  ESTA-5242 - Esta-Tekton AzureAd-, APIM-, Kafka-Registration Prototyp Closed Nach dem Workshop mit Spirig Lukas (IT-PTR-CEN2-SL3)  Jeanneret Julien (IT-PTR-CEN1-BDE3)  Br\u00fcderli Thomas (IT-PTR-CEN2-SL2) Masen Igor (IT-PTR-CEN2-SL11) Barahona Jos\u00e9 Luis (IT-PTR-CEN2-BDE16) Wallrapp Manuel (IT-PTR-EXT-EXT2 - Extern)   haben wir entscheiden auf Openshift Operators als Technologie f\u00fcr AzureAd, APIM und Kafka Registrations zu setzen. Wir werden eine Beispielimplementierung anhand AzureAd Registration f\u00fcr einen Workshop mit den jeweiligen Teams vorbereiten.  Uns stehen zur Zeit 3 Technologien zur Auswahl:   -   Operatorhttps://flow.sbb.ch/browse/ESTA-5242  -   Tekton Taskrun  -   Openshift Job.  Jede dieser Technologien bringt vor on und Nachteile. Dabei wollen wir evaluieren welchen technologischen Weg wir gehen wollen.  +--------------------+-----------------+---------+---------------+ |                    | Operator        | Tekton  | Openshift Job | |                    |                 | Taskrun |               | +====================+=================+=========+===============+ | Entwicklungsstart  | :cross:         | :tick:  | :tick:        | | ohne CON           |                 |         |               | +--------------------+-----------------+---------+---------------+ | Rollout \u00fcber alle  | :tick:          | :tick:  | :tick:        | | Cluster ohne CON   |                 |         |               | +--------------------+-----------------+---------+---------------+ | Namespace          | :tick:          | :tick:  | :tick:        | | spezifisches       |                 |         |               | | Rollout            |                 |         |               | +--------------------+-----------------+---------+---------------+ | Technologische     | (:cross:)       | :tick:  | :tick:        | | Expertise ESTA     |                 |         |               | +--------------------+-----------------+---------+---------------+ | Expertise SBB /    | :cross:         | :cross: | :tick:        | | Azure AD, Kafka,   |                 |         |               | | APIM Team          |                 |         |               | +--------------------+-----------------+---------+---------------+ | Releases von Helm  | :question:      | :tick:  | :tick:        | | & Docker in        |                 |         |               | | Artifactory        |                 |         |               | +--------------------+-----------------+---------+---------------+ | Existierender      | :cross:         | :tick:  | :tick:        | | Esta-Standard      |                 |         |               | | Build&Deployment   |                 |         |               | | Prozess            |                 |         |               | +--------------------+-----------------+---------+---------------+ | Gitops \u00fcber Argocd | :tick:          | :tick:  | :tick:        | +--------------------+-----------------+---------+---------------+ | Gitops \u00fcber Argocd | :tick:          | :cross: | :cross:       | | & CRD              |                 |         |               | +--------------------+-----------------+---------+---------------+ | Endprojekt         | :cross:         | :tick:  | :tick:        | | kann/muss          |                 |         |               | | verwendete Version |                 |         |               | | selber managen     |                 |         |               | | (z.B. per Angabe   |                 |         |               | | der                |                 |         |               | | Helmchartversion   |                 |         |               | | 2.2.^)             |                 |         |               | +--------------------+-----------------+---------+---------------+ | K\u00f6nnen Breaking    | (:cross:):tick: | :tick:  | :tick:        | | Changes bei Logik  |                 |         |               | | / Format der       |                 |         |               | | Konfiguration      |                 |         |               | | gemanaged werden?  |                 |         |               | |                    |                 |         |               | | Beim Operator      |                 |         |               | | m\u00fcssten im         |                 |         |               | | Sourcecode Weichen |                 |         |               | | eingebaut werden,  |                 |         |               | | um                 |                 |         |               | | Abw                |                 |         |               | | \u00e4rtskompatibilit\u00e4t |                 |         |               | | zu gw\u00e4hrleisten.   |                 |         |               | +--------------------+-----------------+---------+---------------+ | Kein erh\u00f6htes      | :tick:          | :tick:  | :tick:        | | Risiko f\u00fcr System  |                 |         |               | | Wide Failure       |                 |         |               | |                    |                 |         |               | | (Bsp Tekton        |                 |         |               | | Namespace Operator |                 |         |               | | ->                 |                 |         |               | | Secrets Voiding in |                 |         |               | | allen Tekton       |                 |         |               | | Namespaces)        |                 |         |               | | Ein Bug im         |                 |         |               | | Operator kann alle |                 |         |               | | Instanzen auf      |                 |         |               | | einmal zerst\u00f6ren.  |                 |         |               | | Bei einem Job oder |                 |         |               | | Pipelinerun        |                 |         |               | | release, betrifft  |                 |         |               | | es nicht alle auf  |                 |         |               | | einmal.            |                 |         |               | +--------------------+-----------------+---------+---------------+ | Fehlerhandling des | :tick:          | :tick:  | :tick:        | | Job-/Operators     |                 |         |               | | (Logs) wenn z.B.   |                 |         |               | | eine               |                 |         |               | | appRegistration    |                 |         |               | | nicht applied      |                 |         |               | | werden konnte      |                 |         |               | | (Im Operatorfall   |                 |         |               | | als Annotation auf |                 |         |               | | ConfigMap oder     |                 |         |               | | Status in der CRD) |                 |         |               | +--------------------+-----------------+---------+---------------+ | Vorgesehen f\u00fcr     | :tick:          | :tick:  | :tick:        | | Funktionalit\u00e4t um  |                 |         |               | | Modifikationen     |                 |         |               | | ausserhalb des     |                 |         |               | | Clusters           |                 |         |               | | durchzuf\u00fchren      |                 |         |               | +--------------------+-----------------+---------+---------------+  []  [] "}, {"text": "Getting Started  -   Prerequisites  -   Setup your Build Namespace  -   Enable your Repository for Tekton  -   Start your first Tekton Build  -   What's next?  Prerequisites  As shown in the Architecture Overview, ESTA Tekton is meant to run in individual namespaces owned by a certain business unit on a dedicated build cluster managed by CLEW. This is to ensure strict access control to your resources and therefore requires specific access credentials to your Bitbucket projects/repositories and Artifactory repositories. Before you start, create or request the following:  -   Bitbucket user with admin privileges to your project repositories  -   Artifactory user with write privileges to your Docker, Maven, NPM     and Helm repositories.  -   An RBT AD group including the users who shall have access to the     ESTA Tekton build system        How to get technical users for Bitbucket & Artifactory  If you do not yet have technical user accounts for Bitbucket and Artifactory, you must request them via a CLEW support ticket. When opening a ticket, select the components \"Artifactory\" and \"Bitbucket\". The user name should follow this pattern: esta-build-<your-project/dso-name>. Also provide an email address for the user or a safe group mailbox, since security relevant data are sent over this mailbox.  Setup your Build Namespace  To setup your ESTA Tekton build namespace, follow these steps:  1.  Get technical users on Bitbucket and Artifactory as mentioned in the     Prerequisites and grant them the according rights as described here.     If you don't already have such user accounts, please open a CLEW     support ticket to order them (see box above).  2.  Order the Tekton build namespace on the CLEW Self Service Portal.     For project name enter a simple name representing your project or     DSO.     Once the Tekton build system is ready, you'll receive an email     notification with a link to the Tekton Control Panel.  3.  When opening the Tekton Control Panel you probably see this warning     box:     []     Click it and follow the guided steps in the Setup Assistant.     When finished, your ESTA Tekton build system is ready.  Enable your Repository for Tekton  In order to make a certain Bitbucket repository tekton-ready, you need to create a file named estaTektonPipeline.json in the root directory of the default branch.  Here's a minimal example for a Java Maven application with a Dockerfile:  estaTektonPipeline.json  {  \"$schema\": \"https://clew-resources.sbb-cloud.net/tekton-schema.json\",  \"productName\": \"esta-tekton-pipeline-test\",  \"mvn\": {  \"parentPom\": \"pom.xml\"  },  \"docker\": {  \"artifactoryDockerRepo\": \"test.docker\"  },  \"pipelines\": [  {  \"name\": \"continuous\",  \"triggerType\": [\"GITEVENT\", \"USER\"],  \"branchNamePrefixes\": [  \"master\",  \"feature\"  ]  },  {  \"name\": \"release\",  \"triggerType\": [\"GITEVENT\"],  \"versionTagEventPatterns\": [  \"^(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\*|\\\\d+)\"  ],  \"build\": {  \"buildDockerImage\": true  }  }  ]  }  The JSON example in short:  -   $schema: is used for validation and also enables auto-completion in     IntelliJ or VSCode.  -   productName: this is the name of your project/product. This value is     used as a default to compose Docker image and Helm chart names.  -   mvn: indicates it is a Java Maven project  -   docker: defines a Docker image build which pushes the image to the     specified repository in Artifactory.  -   pipelines: this is a list of configurations to trigger build     pipelines on specific events:      -   \"continuous\": this profile triggers on Git pushes to a branch         starting with \"feature\". It simply runs a Maven build without         creating any artifacts.      -   \"release\": this profile triggers when a Git tag with a semantic         version (e.g. 1.2.24) is pushed. It also builds a Docker image         and pushes it to Artifactory.      -   \"xyz-snapshot-build\": you can create as many pipeline profile as         you want with your own trigger setup by filtered by branches,         event source or version tag pattern.  Build types  With the ESTA Tekton Pipeline we have more flexible build steps compared to the ESTA Cloud Pipeline. Before you had build types like continuous, release, snapshot and so on, now you can define as many build profiles as you want and even start your own custom pipelines behind it.  When pushing a new tag 1.2.25 to Bitbucket, this example builds the Java application, creates the jar, package it into the Docker image and push it to test.docker.bin.sbb.ch/test/esta-tekton-pipeline-test:1.2.25  For a complete documentation of the estaTektonPipeline.json schema, see ESTA Tekton Parameters - estaTektonPipeline.json.  The ESTA Tekton Controller will periodically scan all Bitbucket repositories in the configured Bitbucket projects. If it finds a estaTektonPipeline.json file, it will display the Bitbucket repository in the Tekton Control Panel. Behind the scenes the ESTA Tekton Controller registers its own url as a webhook in the repository with estaTektonPipeline.json available.  You can enforce a re-scan of your projects by clicking the sync button in the \"Projects\" view:  []  Migration  In case you already have a estaCloudPipeline.json you can either let the builds coexist or disable temporarily the ESTA Cloud Pipeline build by commenting the pipeline call in your Jenkinsfile. If you let both builds coexist, be aware, that there might both builds on Tekton and Jenkins triggered at the same time.  Start your first Tekton Build  Tekton pipelines are either started upon receiving webhook notifications from Bitbucket events like pushing new tags or commits or from the Tekton Control Panel.  a) Trigger build via Git  To start a continuous integration build, simply create a new branch named feature/tekton-test and push it to Bitbucket.  The above listed example configuration will now start a Tekton pipeline basically executing mvn clean package with all tests and then stop. If build and tests succeed, the pipeline run is successful otherwise failed. This build result is also reported to Bitbucket and displayed when creating pull requests.  b) Start Tagging via the Tekton Control Panel  Esta Tekton wants to enforce to create Git tags for each released version. Although this can be done directly with Git, the ESTA Tekton Tag assistant simplifies creating new releases.  Open the Tekton Control Panel, navigate to the repository you want to create a release for and click the \"Start Tagging\" button on the desired branch:  []  This will open a tagging assistant to guide you through the process. It first reads the current version from the pom.xml in your repository. It then suggests you the next versions by the semver pattern. Select the desired version or enter a custom tag name. The next step shows a summary of what the tagging pipeline will do. Besides creating a Git tag, it'll first apply the selected version to the project's pom.xml and if selected set the next SNAPSHOT version.  [][]  As shown in the Architecture Overview, the Git push executed by the tagging pipeline, triggers a webhook so the Tekton controller will process the Git event according to the settings in estaTektonPipeline.json. In the example showed in the screenshot, the creation of the Git tag 1.5.1 triggers the \"release\" build pipeline profile. It starts a Tekton pipeline to build the application and pushes the resulting Docker image to Artifactory.  Navigate to the \"Pipelines\" section in the Tekton Control Panel and watch the progress of the started pipelines there:  []  What's next?  Now you have enabled your first repository for Tekton and run a Tekton pipeline. It's time to  -   get familiar with the Tekton Control Panel  -   dive deeper into the ESTA Tekton Workflow  -   learn how to customize your builds using the estaTektonPipeline.json     file  -   find out how to configure notifications for build success and     failures  -   set up ArgoCD to deploy your applications with a single click  Learn more about the concepts and technologies behind ESTA Tekton in Core Concepts. "}, {"text": "Esta Tekton Openshift Rollenkonzept  Openshift Rollen Berechtigungsmatrix  F\u00fcr Openshift braucht es ein Rollenkonzept was f\u00fcr User mit welcher Rolle welche Ressourcen editieren, anlegen, l\u00f6schen, einsehen k\u00f6nnen.   R = Read, W = Write, D = Delete    Ressource      Rolle-Admin   Rolle-Write   Rolle-View   -------------- ------------- ------------- ------------   Deployment     R             R             R   Pod            R,W,D         R             R   ConfigMap      R,W,D         R             R   PVC            R,W,D         R             R   Secret         -             -             -   Task           R,W,D         R             R   TaskRun        R,W,D         R,W,D         R   Pipeline       R,W,D         R             R   PipelineRun    R,W,D         R,W,D         R   Template       R,W,D         R             R   Roles          R             R             R   RoleBindings   R             R             R  Nach Absprache mit Gerber J\u00fcrg (IT-PTR-CEN2-BDE16)  w\u00fcrden wir ~~3~~ 2 Cluster Rollen erfassen welche die entsprechenden Berechtigungen aus der Matrix oben abbilden. F\u00fcr die Rolle \"View\" kann die existierende \"view\" ClusteRole verwendet werden. Die Berechtigungen sind dann Namespace Scoped.  Mapping RBT Gruppen nach Esta-Tekton Rollen, nach Openshift Rolebindings  Im Esta-Tekton-UI k\u00f6nnen RBT Gruppen den verschiedenen Rollen zugewiesen werden:  []  W\u00e4hrend die RBT Gruppen auf Rollen im AzureAd gemappt werden, sollen gleichzeitig durch den Controller durch einen AppRegistrationRoleBindingSyncer die RoleBindings im Bitbucket Repo angelegt werden. Worauf dann ArgoCD die Rolebindings nach Openshift synchronisiert.  Damit die Openshift Rolebindings auf RBT Gruppen gemacht werden k\u00f6nnen, muss diese Story abgeschlossen sein: CON-7974 - LDAP/AD Groups in OpenShift Closed  Gem\u00e4ss Openshiftbug-Report: https://access.redhat.com/support/cases/#/case/03256619 sollte der Bugfix in Openshift 4.11 geliefert werden. Das heisst sobald auf aws01t Openshift 4.11 installiert ist, kann die L\u00f6sung implementiert werden.  []  RoleBindings f\u00fcr AD Gruppen in OpenShift anlegen  F\u00fcr die 3 Tekton Rollen sind die folgenden ClusterRoles verf\u00fcbgar:  -   Admin: sbb-esta-tekton-admin  -   Write: sbb-esta-tekton-edit  -   View: view  Mit diesen k\u00f6nnen nur RoleBindings im jeweiligen Tekton Namespace f\u00fcr User oder Gruppe angelegt werden:  esta-tekton-admin-dg-rbt-esta-test.yaml  kind: RoleBinding  apiVersion: rbac.authorization.k8s.io/v1  metadata:  name: esta-tekton-admin-dg-rbt-esta-test  namespace: esta-tekton-dev  subjects:  - kind: Group  apiGroup: rbac.authorization.k8s.io  name: DG_RBT_ESTA_TEKTON_TEST  roleRef:  apiGroup: rbac.authorization.k8s.io  kind: ClusterRole  name: sbb-esta-tekton-admin  Gut zu wissen: Gruppen sind ein Konstrukt von Openshift und kein Kubernetes Feature. Man kann RoleBindings f\u00fcr ein Subject von kind:Group mit einem beliebigen Name erstellen, auch wenn es (noch) keine Gruppe mit diesem Namen gibt. Der AD Group Sync funktioniert so, dass beim Login eines Users alle Gruppen, in denen dieser Mitglied ist angelegt resp. aktualisiert werden. "}, {"text": "ESTA Tekton Konzepte  -   Azure AD App Registration Prozess  -   Build ENV  -   Builder Image Config  -   Controller API Authentication aus Pipelines  -   Dynamische Pipeline Tasks (Draft)  -   Dynamisches Laden von Tasks aus Repository (Rejected)  -   Esta Tagging Pipelines - Besprechung  -   Esta-Tekton AzureAd-, APIM-, Kafka-Registration Prototyp -     Technologieauswahl  -   ESTA Tekton E2E User Stories  -   Esta Tekton Openshift Rollenkonzept  -   ESTA Tekton Operator  -   ESTA Tekton Releasing  -   Parameterisierte Builds  -   Rebuild Konzept  -   Tekton Build Cache Konzept  -   Tekton Build Credentials Exchange via Vault "}, {"text": "Testcontainers Integration in Build Pipelines  +--------------------------+------------------------------------------+ | Fragestellung            | Wie sollen Sidecars f\u00fcr die              | |                          | Unterst\u00fctzung von Testcontainers in den  | |                          | Build Pipelines integriert werden?       | |                          |                                          | |                          | Einer erster PoC im Rahmen von ESTA-5359 | |                          | hat gezeigt, dass mit Kubdock ein        | |                          | Sidecar f\u00fcr Build Tasks gestartet werden | |                          | kann, welcher das notwendige Docker API  | |                          | f\u00fcr Testcontainers zur Verf\u00fcgung stellt. | |                          | Die Frage ist nun, wie dieser Sidecar in | |                          | den ESTA Tekton Pipelines konfiguriert   | |                          | werden soll. Sidecars lassen sich nicht  | |                          | via Task Parameter ein/ausschalten       | |                          | sondern sind fix Bestandteil der Task    | |                          | Definition.                              | |                          |                                          | |                          | ESTA-5359 - ESTA Tekton: Unterst\u00fctzung   | |                          | testcontainer Closed                     | +==========================+==========================================+ | Rahmenbedingung          | -   Tekton l\u00e4uft auf Openshift auf AWS   | |                          |     Clustern                             | |                          |                                          | |                          | -   Build Stacks welche Testcontainers   | |                          |     unterst\u00fctzen: Java, Node, Go, Python | +--------------------------+------------------------------------------+ | Annahmen                 | -   Sidecars lassen sich nicht via Task  | |                          |     Parameter ein/ausschalten            | |                          |                                          | |                          | -   kubedock Image ist 72.4MB gross      | |                          |                                          | |                          | -   kubedock server hat kaum messbaren   | |                          |     Ressourcen-Verbrauch (Memory/CPU)    | +--------------------------+------------------------------------------+ | Alternativen / Varianten | Variante 1                               | |                          |                                          | |                          | Kubedock Sidecar ist Teil der Default    | |                          | Build Tasks und wird immer gestartet.    | |                          |                                          | |                          | Alle Build Tasks f\u00fcr Stacks, welche      | |                          | Testcontainers unterst\u00fctzen, werden fix  | |                          | mit einem Kubedock Sidecar erweitert.    | |                          | Dieser startet immer einen zus\u00e4tzlichen  | |                          | Container, ungeachtet dessen, ob f\u00fcr den | |                          | Build Testcontainers verwendet werden.   | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   ---------------                        | |                          | ------------------------------------- -- | |                          | ---------------------------------------- | |                          |   Einfache Integration                   | |                          |                      Ressourcen Overhead | |                          |   Keine spezifi                          | |                          | schen Konfiguration n\u00f6tig                | |                          | Wird in 9x% aller Builds nicht verwendet | |                          |   Keine Erweite                          | |                          | rung an estaTektonPipeline.json n\u00f6tig    | |                          |                                          | |                          | Variante 2                               | |                          |                                          | |                          | Je nach Pipeline Parameter werden        | |                          | spezifische Build Tasks mit Kubedock     | |                          | Sidecar referenziert.                    | |                          |                                          | |                          | F\u00fcr Stacks, welche Testcontainers        | |                          | unterst\u00fctzen, werden spezifischen Build  | |                          | Tasks in den Pipeline Templates mit      | |                          | einem Kubedock Sidecar gef\u00fchrt. Je nach  | |                          | Pipeline Parameter werden dann diese     | |                          | Tasks anstelle der normalen esta-*-build | |                          | Tasks eingebunden.                       | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   ------------------------------         | |                          | -------------------------------- ------- | |                          | ---------------------------------------- | |                          |   Kein unn\u00f6tiger Resso                   | |                          | urcenverbrauch                           | |                          |    Duplicated Code in den Task Templates | |                          |   Explizite Aktivierung im Rep           | |                          | o (via estaTektonPipeline.json )   Erwei | |                          | terung von estaTektonPipeline.json n\u00f6tig | |                          |                                          | |                          |                                          | |                          |         Spezifischen Konfiguration n\u00f6tig | |                          |                                          | |                          | Variante 3                               | |                          |                                          | |                          | Kubedock Server direkt in Build Task     | |                          | starten.                                 | |                          |                                          | |                          | Das Kubedock Binary wird bei Bedarf      | |                          | (z.B. Pipeline Parameter) direkt im      | |                          | entsprechenden Build Task gestartet und  | |                          | exposed das Docker API lokal im          | |                          | Container. Es wird also kein Sidecar     | |                          | ben\u00f6tigt, daf\u00fcr muss das Binary in den   | |                          | entsprechenden Builder Images der        | |                          | unterst\u00fctzten Build Stack integriert     | |                          | werden. Wichtig hier ist, dass am Ende   | |                          | des Tasks der Kubedock Server wieder     | |                          | sauber heruntergefahren wird, also auch  | |                          | im Fehlerfall, wo das Task Script        | |                          | normalerweise abbricht (set -e).         | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |                                          | |                          | ---------------------------------------- | |                          | --------------------- ------------------ | |                          | ---------------------------------------- | |                          |   Kein Sidec                             | |                          | ar notwendig                             | |                          |             Builder Images +30MB gr\u00f6sser | |                          |   Explizite Aktivierung im Repo (via est | |                          | aTektonPipeline.json)   Shutdown des Kub | |                          | edock Servers muss sichergestellt werden | +--------------------------+------------------------------------------+ | Entscheidung             | Variante 3                               | +--------------------------+------------------------------------------+ | Begr\u00fcndung               | Direktes Einbinden von Utilities in die  | |                          | Builder Image entspricht dem Pattern,    | |                          | was wir aktuell in ESTA Tekton           | |                          | verfolgen. Impact bez\u00fcglich Overhead ist | |                          | in dieser Variante am kleinsten.         | +--------------------------+------------------------------------------+ | Wer                      | Spirig Lukas (IT-PTR-CEN2-SL3) Wallrapp  | |                          | Manuel (IT-PTR-EXT-EXT2 - Extern)        | |                          | Br\u00fcderli Thomas (IT-PTR-CEN2-SL2)        | +--------------------------+------------------------------------------+ | Wann                     | 22.06.2023                               | +--------------------------+------------------------------------------+ "}, {"text": "Sammlung von Esta-Tekton Issues  Inhalt  -   Inhalt  -   Vert.x Thread has been blocked for more than 2s.  -   JSON Schema Validation Unknown Keywords (then, else)  -   Events Closed Exception vermeiden indem auf den Pod Shutdown geh\u00f6rt     wird und dann der Reader closed wird  \u2022 Resolved  -   The client is using resource type xyz with unstable version v1beta  -   Pipelinerun cleanup failed  -   Taskrun is not a readiable ressource  Vert.x Thread has been blocked for more than 2s.   Korrektur f\u00fcr failed pipelinerun Pull Request #397: fix: no streaming for failed pipeline - Code (sbb.ch) Ticket f\u00fcr running pipelinerun [ESTA-5393] Tetkon: Log und Event streams blockieren die Thread - Flow (sbb.ch)  JSON Schema Validation Unknown Keywords (then, else)  Bug im library \"Unknown keyword then\" / \"else\" warning \u00b7 Issue #333 \u00b7 networknt/json-schema-validator (github.com)  Search | Splunk 9.0.2 (sbb.ch)  Events Closed Exception vermeiden indem auf den Pod Shutdown geh\u00f6rt wird und dann der Reader closed wird  { [-]    exception: { [+]    }    hostName: esta-tekton-pipeline-controller-7d85676464-v5d6h    level: WARN    loggerClassName: org.slf4j.impl.Slf4jLogger    loggerName: ch.sbb.esta.tekton.pipeline.service.openshift.events.TaskRunEventEmitter    mdc: { [+]    }    message: TaskRun/Pod Events Watcher closed for selector ki-kihub--vdv-v2017c-aus-chart-staging-2f0kqj-git-clone    ndc:    processId: 1    processName: quarkus-run.jar    sequence: 33735    threadId: 894    threadName: OkHttp https://198.18.0.1/...    timestamp: 2023-01-18T15:26:18.966+01:00 }  Show as raw text  Sollte mit [ESTA-5393] Tetkon: Log und Event streams blockieren die Thread - Flow (sbb.ch) gel\u00f6st (kein watch mehr)  Resolved  L\u00f6schen wenn sie best\u00e4tigt sind  Klicken Sie hier, um zu erweitern...  The client is using resource type xyz with unstable version v1beta  nicht gesehen die letzte 7 tagen: Search | Splunk 9.0.2 (sbb.ch)  Pipelinerun cleanup failed  Ich denke man versucht die logs zu l\u00f6schen wenn die Datei nicht da sind. Die gzip sollte es l\u00f6sen: Pull Request #393: feat: compress dumped pipeline/event logs with gzip - Code (sbb.ch)  Taskrun is not a readiable ressource  should be fixed with Pull Request #394: feat: remove taskrun is no readiable resource warning by not call ready on the resource - Code (sbb.ch) "}, {"text": "Deno vs. Bash for Pipeline Tasks  Nach einem Prototypen f\u00fcr die Verwendung von Deno als Alternative zu Shell/Bash Script in Pipeline Tasks haben wir uns f\u00fcr die Migration entschieden:  ESTA-5573 - ESTA Tekton: Deno Scripting Closed  Bei der Umsetzung sind allerdings einige Zweifel aufgekommen, ob dies der richtige Weg ist und ob die Verwendung von Deno nicht doch eher den Code komplexer und schlechter lesbar macht.  Warum Deno?  Developer Experience \u2013 unsere Entwickler sind fundierter in Typescript als in Bash  Pros  -   Loops sind einfacher  -   if mit && oder || sind einfacher  -   Einfachere JSON Verarbeitung  -   Modularisierung (Funktionen/Lib)  -   Testbarkeit  Cons  -   Deno Runtime muss in allen Images f\u00fcr Tekton Tasks installiert     werden  -   Shell Exec muss umst\u00e4ndlich gewrapped werden  -   Quoting von Shell Argumenten (Values m\u00fcssen z.T. gesplittet werden)     runCommand(\"helm\", [\"package\", chartDir, ...helmArgs.split(\" \")]  -   Keine Unterst\u00fctzung f\u00fcr Pipes | und File-Redirects >     Alternative: https://stackoverflow.com/a/62088422  -   source Command nur sehr hackish umgesetzt/emuliert  -   Kein Streaming     cat <large-file> vs. console.log(await     Deno.readTextFile(largeFilePath))  -   Shell Commands/Utilities sind meinst einfacher     z.B. File Upload: curl -T <filename> <url>  -   Asynchronit\u00e4t (await vergessen)  -   Zielpublikum/Open Source: Build Manager sind meist n\u00e4her bei Bash     als bei Typescript  -   Bashscript Beispiele f\u00fcr Bash Commands findet man sehr viele im Netz     die man 1:1 lokal testen und r\u00fcberkopieren kann. Mit Deno muss man     die zuerst noch umformen oder escapen.   -   1 Komplexit\u00e4tslayer f\u00fcr Fehlerursachen mehr  -   Modularisierung mit Funktionen geht auch mit Bash (Beispiel Tagging     Pipeline)  -   Bash Commands kann jedes Image vom Netz, Deno nicht.   -   Die Mehrheit der Commands sind Bash, Pipes usw. Ein kleiner Teil     sind Kontrollstrukturen.  -   Typisierung nervt manchmal. Macht das Scripting umst\u00e4ndlicher "}, {"text": "Deployment with ArgoCD and Helm Charts  -   Setup ArgoCD for your Deployments      -   Enable ArgoCD Sync via Tekton Pipelines      -   Connect to different ArgoCD instances from Tekton Pipelines  -   Create Helm Charts      -   Umbrella Charts      -   Best practice suggestions      -   Migrate OpenShift Templates to Helm Charts  -   Manage ArgoCD Deployments in Git (app of apps)  -   Update ArgoCD Values from Tekton Pipelines  Following the GitOps pattern, deployments to OpenShift shall be defined as Helm charts and applied using ArgoCD.  Note that ArgoCD only uses the templating functions of Helm charts but does not actually perform a Helm deployment.  Setup ArgoCD for your Deployments  Follow the ArgoCD Setup and Configuration guide to get your own ArgoCD instance up and running.  Enable ArgoCD Sync via Tekton Pipelines  In order to allow Tekton to trigger app syncs in ArgoCD, a specific user tektoncontroller should be created in ArgoCD and its credentials added to your Tekton build namespace.  -   When using the CLEW ArgoCD chart, the user tektoncontroller is     already configured.  -   If you're not using this chart, you have to create the     user tektoncontroller manually:    oc -n argocd patch configmap argocd-cm -p '{ \"data\": {   \"accounts.tektoncontroller\": \"apiKey\" } }'  Afterwards, you just have to generate a token for the user:  1.  Generate an access token for this user via the ArgoCD web UI:      1.  navigate to Settings > Accounts > tektoncontroller      2.  in the section Tokens click \"Generate New\"      3.  copy the new token  2.  Enter the ArgoCD host name (without https://) and the generated     access token to the secret with the name argocd-env-secret.      1.  in the Tekton Control Panel, navigate to Pipeline Secrets      2.  edit the secret argocd-env-secret and save the changes  Connect to different ArgoCD instances from Tekton Pipelines  By default, Tekton pipelines use the argocd-env-secret to connect to ArgoCD but you can create additional secrets with the keys ARGOCD_SERVER and ARGOCD_AUTH_TOKEN and reference the secret name in the stage config of your estaTektonPipeline.json:  \"stages\": [ { \"stageName\": \"dev\", \"argoCD\": { \"argoCdAppName\": \"<argocd-appname>\", \"autoSync\": true, \"argoCdSecret\": \"argocd-env-secret-<some-name>\"  } } ],  You can manage these secrets directly in the Pipeline Secrets section of your Tekton Control Panel.  Create Helm Charts  If your start from scratch, have a look at the esta-argocd blueprint providing a sample Helm chart with the minimal required resources to get an application running on OpenShift.  Another way is to use the Helm CLI to create a new chart:  $ helm create <chart-name>.  The generated chart, however, might be too complex and includes resources like HorizontalPodAutoscaler and Ingress which are not needed in our environments.  Umbrella Charts  Helm charts have the ability to include other charts, referred to as subcharts, via their dependencies section. When a chart is created for the purpose of grouping together related subcharts/services, such as to compose a whole set of micro-service deployments, we call this an umbrella chart. Use this technique to orchestrate complex deployments with cross-dependencies.  In order to use a Helm chart of an application/service as a dependency in an umbrella helm chart, the former needs to packaged and published to a Helm chart repository. Tekton build pipelines will do that for you and can push versioned charts to Artifactory (bin.sbb.ch/artifactory/xxxx.helm). Enable the packageAndDeployHelmChart flag in your estaTektonPipeline.json build pipeline config and define the repository name using the chartRepository property in the Helm configuration structure.  Best practice suggestions  Besides the Best Practices suggested by Helm, we'd like to highlight the following:  -   Create a values-xxx.yaml file for each stage/environment (e.g. dev,     test, int. prod)  -   Read the deployment version of the app (\u2192 docker image tags, etc.)     from .Values to maintain them individually for each stage  Migrate OpenShift Templates to Helm Charts  ESTA provides a tool to help you migrate existing OpenShift templates into Helm charts. See the OpenShift-Helm-Migration section for details.  Manage ArgoCD Deployments in Git (app of apps)  Although new applications can easily be added to ArgoCD via the UI or as Kubernetes resources (kind: Application), they're only persisted in OpenShift and may be lost during migration or due to accidental deletion. Therefore we recommend the declarative approach to manage them in Git and let ArgoCD sync its own configuration.  Read more about the app of apps pattern in the ArgoCD docs or use fork the ESTA ArgoCD Blueprint.  Update ArgoCD Values from Tekton Pipelines  See the Staging Section of ESTA Tekton Parameters to learn how to update deployment versions in ArgoCD after successful builds in ESTA Tekton. "}, {"text": "Migrating from ESTA Cloud Pipeline  -   Migrating estaCloudPipeline.json  -   Dockerfile Migration  -   OpenShift Templates to Helm Chart Migration  -   Kafka, APIM, IAM AppRegistration Deployment via ArgoCD  Migrating estaCloudPipeline.json  The migration of projects already using the ESTA Cloud Pipeline with an estaCloudPipeline.json is very easy. The Tekton Control Panel provides a fully automated converter to generate your new estaTektonPipeline.json. Read more about the ESTA Cloud Pipeline Migration Tool.  Dockerfile Migration  As opposed to the ESTA Cloud Pipeline, the build process in Tekton differs a bit. While the Cloud Pipeline first pushed the build artifacts (e.g. the app jar) to Artifactory in order to pull it again for building the Docker image, the Docker build process in Tekton has direct access to the build workspace and thus makes that step unnecessary. When using a custom Dockerfile (for Java projects you can omit this and use a standard template suitable for most apps) use the COPY command to copy the build artifacts file from the build output directory into your Docker image.  For a Java/Maven project, replace the ADD https://bin.sbb.ch/artifactory/...jar command with COPY target/<app-file-name>*.jar in your Dockerfile. The value of the currently built version is passed as APP_RELEASE_VERSION build arg and can be consumed in the Dockerfile with ARG APP_RELEASE_VERSION. An example Dockerfile can be found here.  Another difference to the ESTA Cloud Pipeline is the context directory for Docker builds. While in the Cloud Pipeline all file references (e.g. ADD or COPY) in the Dockerfile were relative to the directory where the Dockerfile resides, in Tekton the context directory is set to the project root unless you specify it explicitly with the contextDir property. Therefore you should review all ADD and COPY commands in your Dockerfile(s).  Additionally, do these steps from  https://code.sbb.ch/projects/KD_ESTA_BLUEPRINTS/repos/esta-cloud-angular/browse/docker/Dockerfile  OpenShift Templates to Helm Chart Migration  Although the ESTA Cloud Pipeline also supports deployments with Helm charts, you may still use the deprecated OpenShift Templates for your deployments. In order to move the deployment to ArgoCD these templates can be converted into Helm charts using a small utility tool. This guide describes the migration in detail.  Kafka, APIM, IAM AppRegistration Deployment via ArgoCD  For the kafkaDeployParameters in estaCloudPipeline.json there's no equivalent in estaTektonPipeline.json because deployment topics are handled by ArgoCD. To manage these resources GitOps-style you can find details linked here: Kafka, IAM AppRegistrations and APIM Deployments with Argocd "}, {"text": "Buildpacks@Tekton  -   Buildpack vs Builder  -   Docker vs Buildpack  -   Buildpacks Builders / Runtime Matrix      -   Heroku Buildpacks      -   Paketo Buildpacks      -   Google Buildpacks      -   Welches Buildpack sollen wir verwenden      -   Matrix  -   Buildpack Task bei ESTA Tekton  -   Newrelic Agent Buildpack  -   Ein paar Notizen und Links  Grunds\u00e4tzlich funktionieren die Buildpacks von Paketo und Heroku f\u00fcr Maven bereits mit Esta Tekton. Die Google Buildpacks sind f\u00fcr uns weniger interessant, da diese keinen so breiten Plattformsupport und Community Support / Marketplace haben.  Aus diesem Grunde gehen wir nicht weiter auf die Google Buildpacks ein.  Buildpack vs Builder  Was ist der Unterschied von Buildpacks und Buildern. Der Builder ist eigentlich derjenige der herausfindet welche Technologie man builden m\u00f6chte und verwendet dann das entsprechende Buildpack f\u00fcr die entsprechende Technologie. So gesehen sprechen wir hier von Heroku, Paketo oder Google Buildern, welche dann die entsprechenden Buildpacks und Runtimeimages hinten dran verwenden um ein Dockerimage zu builden.   []  Docker vs Buildpack  Mit unseren klassischen Docker Builds haben wir nat\u00fcrlich mehr Kontrolle \u00fcber den Buildprozess und k\u00f6nnen ihn nach Belieben anpassen.  Der Vorteil von Buildpacks ist, dass dort sehr viel spezialisiertes Docker- und Buildknowhow vorhanden ist, welches wir nicht haben.  Auch geschieht die Pflege des Builds und der Runtime durch die Community. So kann man ohne Dockerknowhow ein Buildimage erstellen. Weiter wird mit Buildpacks der ganze Dockerbuildprozess massiv optimiert, was zu sehr schnellen Builds f\u00fchrt. Eine gute Beschreibung findet man hier:  https://tanzu.vmware.com/developer/blog/understanding-the-differences-between-dockerfile-and-cloud-native-buildpacks/  An gewissen Stellen wird es weiterhin Sinn machen auf klassische Dockerbuilds zu setzen.   Buildpacks Builders / Runtime Matrix  Ich gehe nur auf die offiziell supporteten Buildpacks ein, da z.B. Heroku 9 offiziell supportete Buildpacks und mehr als 8000 community Buildpacks hat. Auch Paketo hat da einige aber nicht so viele Buildpacks. Heroku und Paketo sind f\u00fcr uns die interessantesten Builder welche g\u00e4ngige Buildpacks f\u00fcr alle ben\u00f6tigten Technologien anbieten.  Heroku Buildpacks  Heroku ist der Ursprung des Buildpackkonzepts und bietet 9 offiziell supportete und \u00fcber 8000 community Buildpacks f\u00fcr alle m\u00f6glichen Zwecke an. Heroku Buildpacks werden mit der MIT License ausgeliefert.   Unsere Tekton Pipeline kann mit Heroku Java Buildpacks builden. Es ben\u00f6tigt im Java Fall lokal noch folgende 2 Files:  system.properties in dem die Java Version angegeben wird:   java.runtime.version=11 F\u00fcr maven wird das maven settings.xml im Repo Root ben\u00f6tigt.  Paketo Buildpacks  Paketo bietet Community driven Builders mit Buildpacks an welche unter der Apache License 2 laufen. Sie bieten 3 verschiedene Runtime Images Base, Full und Tiny welche Paketo Stacks genannt sind. Tiny ist ein minimalistisches Image mit ca. 20Mb size + deiner App, funktioniert allerdings nur f\u00fcr native Apps. Es ist nicht Distroless sondern nur Distroless-like. Distroless Images werden wohl in unserem Umfeld mit Java Applikationen nicht m\u00f6glich sein. Gerade wegen diesen Paketo Stacks, finde ich Paketo zu bevorzugen. Weiter gef\u00e4llt mir die Einfachheit von Paketo. Der Paketo Builder erkennt f\u00fcr den Maven Build alle Attribute die zum Build ben\u00f6tigt werden, wo bei Heroku ein Configfile system.properties im root Verzeichnis abgelegt werden muss, was etwas unverst\u00e4ndlich erscheint.  Google Buildpacks  Auch Google sagt sie sind 100% buildpacks.io kompatibel, ein Austausch des Builders von Paketo zu Google hat jedoch nicht geklappt. Der Google Builder ist eher auf die Google Bed\u00fcrfnisse zugeschnitten und macht wohl weniger Sinn f\u00fcr uns. Zudem scheint er verglichen mit Paketo und Heroku kein umfangreiches Buildpack-\u00d6kosystem zu haben.  Welches Buildpack sollen wir verwenden  Im Java Fall w\u00fcrde ich auf die Paketo Builder und Buildpacks setzen, da sie verschiedene Builders wie auch Runtime Image-Auswahlen bieten.  Zudem bauen die Community Buildpack Tekton Tasks auf den Paketo Buildern auf, was eine gute Basis f\u00fcr unsere spezifischen Tasks ist.  Die Heroku supported Builder und Buildpacks sind alle sehr gut dokumentiert. Auch die Paketo Buildpacks haben eine ausreichende Doku. F\u00fcr spezifische Tasks muss also das entsprechende Buildpack gefunden werden. Dazu kann ein Heroku Buildpack oder ein Paketo Buildpack verwendet werden. Die Google Buildpacks verfolgen wir vorerst nicht weiter, ausser es gibt einen speziellen Request oder Usecase daf\u00fcr.   Matrix  In der Matrix habe ich prim\u00e4r die f\u00fcr die SBB relevanten Technologien aufgelistet    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------                              Paketo base                                                        Paketo full                                             Paketo tiny                              Heroku                               Google   -------------------------- ------------------------------------------------------------------ ------------------------------------------------------- ---------------------------------------- ------------------------------------ -----------------------   Builder Image              ubuntu:bionic + openssl + CA certs + compilers + shell utilities   ubuntu:bionic + many common C libraries and utilities   ubuntu:bionic + openssl +                Technologie spezifische Baseimages   Keine Infos gefunden                                                                                                                                                         CA certs + compilers + shell utilities                                            Runtime Image               ubuntu:bionic + openssl + CA certs                                ubuntu:bionic + many                                    distroless-like bionic +                 Ubuntu 20 base image                                                                                                                  common libraries and utilities                          glibc + openssl + CA certs                                                        Tekton compliant           :tick:                                                             :tick:                                                  :tick:                                   :tick:                               :tick:    Common C Libraries                                                                            :tick:                                                                                                                                    Java Graal Native Images   :tick:                                                             :tick:                                                  :tick:                                   :information: (Community)            :tick: (experimental)    Go                         :tick:                                                             :tick:                                                  :tick:                                   :tick:                               :tick:    Java (Maven)               :tick: (Version kann konfiguriert werden)                          :tick: (Version kann konfiguriert werden)                                                        :tick: (7,8,11,13,15,17)             :tick: (8, 11)    Java (Gradle)              :tick:                                                             :tick:                                                                                           :tick:                               :tick:    Scala                      :tick:                                                             :tick:                                                                                           :tick:                                   Node.js                    :tick:                                                             :tick:                                                                                           :tick:                               :tick:    NGINX                      :tick:                                                             :tick:                                                                                           :information: (Community)                .NET Core                  :tick:                                                             :tick:                                                                                           :information: (Community)            :tick:    Ruby                       :tick:                                                             :tick:                                                                                           :tick:                                   Python                     :tick:                                                             :tick:                                                                                           :tick:                               :tick:    PHP                        :tick:                                                             :tick:                                                                                           :tick:                               :tick:   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Buildpack Task bei ESTA Tekton  Der aktuelle Buildpack Task bei ESTA Tekton ist prim\u00e4r auf Java ausgelegt. Da m\u00fcsste man noch etwas Zeit investieren, wie man einen generischen Buildpack Task zur Verf\u00fcgung stellen m\u00f6chte.   Newrelic Agent Buildpack  ESTA-5156 - Abrufen der Vorgangsdetails... STATUS  Testweise wurde versucht, das Newrelic/Agent Buildpack in den Tekton Build Prozess zu integrieren. Der einzige Weg, ein Custom Buildpack in den Tekton Task zu bringen ist \u00fcber ein Custom Builder Image. Es ist nicht Teil der Paketo Builder Images und die CNB Binaries lassen aktuell keine Argumente zu, \u00fcber diese man zu verwendende Buildpacks angeben k\u00f6nnte, weder \u00fcber ein --buildpack Argument noch \u00fcber ein project.toml File im Repo, wie man das sonst \u00fcber das pack CLI machen kann.  Wir haben als POC ein Buildpacks Builder Image basierend auf dem paketobuildpacks/builder:base gebaut und f\u00fcr den Tekton Build Task verwendet. Siehe Repo esta-tekton-buildbacks-stack.  Ein Testbuild war erfolgreich und ein Java Image mit Newrelic Agent ist unter esta.docker.bin.sbb.ch/esta/esta-tekton-pipeline-java-buildpacks:newrelic verf\u00fcgbar. F\u00fcr das Deployment muss der Agent noch mit einem License Key aktiviert werden (siehe Helm Chart)  Ein paar Notizen und Links    Thema                                                                         Link   ----------------------------------------------------------------------------- ---------------------------------------------------------------------   Paketo Builder f\u00fcr Java, besteht aus mehreren buildpacks.                     https://github.com/paketo-buildpacks/java   Paketo Buildpacks configuration Doku                                          https://paketo.io/docs/reference/configuration/   Doku wie man eigene Buildpacks schreibt                                       https://buildpacks.io/docs/buildpack-author-guide/create-buildpack/   Ein bisschen verstecktes buildpack, handelt speziell runtime env variablen.   https://github.com/paketo-buildpacks/environment-variables   Tekton Task f\u00fcr Buildpacks welches auf dem Paketo Java Builder basiert        https://github.com/tektoncd/catalog/tree/main/task/buildpacks/0.3 "}, {"text": "Dedicated Build Namespaces  l  -   Tekton Build Clusters  -   Setup your own Build Namespace  -   Permit Tekton to Access your Resources      -   Bitbucket Access Credentials      -   Artifactory Access Credentials  -   'Batch' Build Nodes - Autoscaling, Nodeaffinity  Tekton Build Clusters  CLEW maintains an OpenShift 4 buildcluster dedicated to the new build system with optimized resources for running Tekton pipelines. In order to separate concerns, access control, ressource allocation and transparent billing, each business unit has its own Esta-Tekton build namespace.  The architecture and topology of these dedicated build clusters is to be defined.  Setup your own Build Namespace  Follow the steps described in the Getting Started Guide.  Permit Tekton to Access your Resources  The ESTA Tekton build system requires access to Bitbucket (where the sources are stored) and Artifactory (where the build artifacts are saved to). In order to follow the principle of least privilege, individual accounts and credentials (i.e. access tokens) should be created for each Tekton namespace. These credentials are used by the Tekton pipeline to read and write your project repositories and no others. The access credentials can be entered and changed via the Tekton Control panel in the System Configuration section.  We suggest to order specific system user accounts for both Bitbucket and Artifactory (suggestion: esta-build-<yourproject>). Create a CLEW support ticket (please provide an email address for this user) to request them unless you already have technical user accounts for your project.  Bitbucket Access Credentials  Once the user account is created you need to do the following:  1.  Grant \"admin\" permissions to the Bitbucket projects/repositories you     want to build with Tekton.     See this article how to grant admin rights to the Tekton system user     (admin rights are required to allow Tekton to register webhooks to     Git repositories).  2.  Allow the Tekton user to push to the master/main branch of your     repositories.     Open Project settings > Branch permissions and edit the permissions     on the master branch if configured.  3.  Create an Access Token to be used by Tekton (instead of the real     password).     See this guide how to do this. Make sure to select \"Repository     admin\" in the Repository permissions drop-down.  Artifactory Access Credentials  Access to Docker, NPM, Maven and Helm repositories on bin.sbb.ch needs to be explicitly granted to the Tekton build system. Order a new Artifactory user account and then follow these steps:  1.  Grant \"write\" privileges (i.e. \"Deploy/Cache\" and     \"Delete/Overwrite\") to the repositories where your project artifacts     shall be stored.     Follow this guide to authorize the Tekton user. Start at     https://bin.sbb.ch/ui/admin/management/permissions.  2.  Create an Identity Token for this user for the use in Tekton. We do     not recommend to use the password directly.     Read here how to create such a token.  'Batch' Build Nodes - Autoscaling, Nodeaffinity  Currently we support Build-Namespaces only on clusters aws02t and aws02t. These clusters are configured with specific nodes with the label \"batch\". All esta-tekton pipelines will run on this nodes. This nodes scale automatically up and also down to zero if not used. If there is no build running for a longer period of time, the Batch nodes are scaled to zero. If there is no batch node available it can take up to several minutes to start the batch node for your build. Once it is started, followup builds start instantly.  For the Tekton Pipelines to run on the 'Batch' nodes we apply automatically to every Pipeline following tolerations and affinity if not set manually in the pipeline.  podTemplate:  tolerations:  - key: node-role.kubernetes.io/batch  operator: Exists  effect: NoSchedule  affinity:  nodeAffinity:  requiredDuringSchedulingIgnoredDuringExecution:  nodeSelectorTerms:  - matchExpressions:  - key: node-role.kubernetes.io/batch  operator: Exists "}, {"text": "ESTA Tekton E2E User Stories  +----+-------------------------------+-------------------------------+ | ID | Beschreibung                  | Szenario/Akzeptanzkriterien   | +====+===============================+===============================+ | 3  | Ein eingeloggter User m\u00f6chte  | 1.  Navigiert zum Pipelines   | |    | einen Tagging Pipeline Run    |     Fenster                   | |    | finden. Der User weiss  in    |                               | |    | welchem Repository sich der   | 2.  Filtert nach Repository   | |    | Build befindet, deshalb       |                               | |    | filtert er die Suche.         | 3.  gibt \"tagging\" in das     | |    |                               |     Suchfeld ein              | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  User wird von der         | |    |                               |     Startseite zur Pipeline   | |    |                               |     Seite gef\u00fchrt             | |    |                               |                               | |    |                               | 2.  Nur die gefailten Builds  | |    |                               |     eines Repositories werden | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 3.  Nur der Build mit dem     | |    |                               |     gesuchtem Namen           | |    |                               |     erscheint                 | +----+-------------------------------+-------------------------------+ | 4  | Als eingeloggter User m\u00f6chte  | 1.  Navigiert zum Pipelines   | |    | ich das Pipelinerun YAML File |     Fenster                   | |    | von einem Build sehen         |                               | |    |                               | 2.  Klickt auf sein gesuchten | |    |                               |     Pipeline Build            | |    |                               |                               | |    |                               | 3.  Klickt auf das YAML       | |    |                               |     Fenster                   | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  User wird von der         | |    |                               |     Startseite zur Pipeline   | |    |                               |     Seite gef\u00fchrt             | |    |                               |                               | |    |                               | 2.  Der User wird auf eine    | |    |                               |     Seite weitergeleitet, wo  | |    |                               |     er Details zum Pipeline   | |    |                               |     Build findet              | |    |                               |                               | |    |                               | 3.  Das YAML File wird        | |    |                               |     angezeigt                 | +----+-------------------------------+-------------------------------+ | 1  | Eingeloggter User m\u00f6chte      | 1.  Navigiert zum Projects    | |    | einen Build laufen lassen     |     Fenster                   | |    |                               |                               | |    |                               | 2.  Klickt auf das richtige   | |    |                               |     Project                   | |    |                               |                               | |    |                               | 3.  Hovert auf das richtige   | |    |                               |     Repository bei der Last   | |    |                               |     Pipeline Runs Spalte      | |    |                               |                               | |    |                               | 4.  Klickt auf das Play Icon  | |    |                               |     um den Build laufen zu    | |    |                               |     lasssen                   | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  User wird von der         | |    |                               |     Startseite zur Projects   | |    |                               |     Seite gef\u00fchrt             | |    |                               |                               | |    |                               | 2.  User sieht eine Liste von | |    |                               |     Repositories welche zum   | |    |                               |     Project geh\u00f6ren           | |    |                               |                               | |    |                               | 3.  4 Icons tauchen auf in    | |    |                               |     der letzten Spalte        | |    |                               |                               | |    |                               | 4.  Der Build wird gestartet  | +----+-------------------------------+-------------------------------+ | 2  | Der User erstellt einen       | 1.  Navigiert zum Projects    | |    | Release Tag auf einem         |     Fenster                   | |    | Repository                    |                               | |    |                               | 2.  Klickt auf das richtige   | |    |                               |     Project                   | |    |                               |                               | |    |                               | 3.  Hovert auf das richtige   | |    |                               |     Repository bei der Last   | |    |                               |     Pipeline Runs Spalte      | |    |                               |                               | |    |                               | 4.  Klickt auf den Tag Button | |    |                               |                               | |    |                               | 5.  W\u00e4hlt den Branch aus      | |    |                               |                               | |    |                               | 6.  W\u00e4hlt einen Radiobutton   | |    |                               |     f\u00fcr den Version Tag       | |    |                               |                               | |    |                               | 7.  W\u00e4hlt einen Radiobutton   | |    |                               |     f\u00fcr die Developer Version | |    |                               |                               | |    |                               | 8.  Klickt auf den Next       | |    |                               |     Button                    | |    |                               |                               | |    |                               | 9.  Klickt auf den Execute    | |    |                               |     Button                    | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  User wird von der         | |    |                               |     Startseite zur Projects   | |    |                               |     Seite gef\u00fchrt             | |    |                               |                               | |    |                               | 2.  User sieht eine Liste von | |    |                               |     Repositories welche zum   | |    |                               |     Project geh\u00f6ren           | |    |                               |                               | |    |                               | 3.  4 Icons tauchen auf in    | |    |                               |     der letzten Spalte        | |    |                               |                               | |    |                               | 4.  Ein neues Fenster \u00f6ffnet  | |    |                               |     sich, wo man den Tag      | |    |                               |     erstellen kann            | |    |                               |                               | |    |                               | 5.  Branch wird ausgew\u00e4hlt    | |    |                               |                               | |    |                               | 6.  Radiobutton Eingabe wird  | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 7.  Radiobutton Eingabe wird  | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 8.  Die get\u00e4tigte Eingabe     | |    |                               |     wird stichpunktartig      | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 9.  Neuer Tag wird erstellt   | +----+-------------------------------+-------------------------------+ | 5  | Der User m\u00f6chte eine Pipeline | 1.  Navigiert zum Pipeline    | |    | Secret Key kopieren           |     Secrets Fenster           | |    |                               |                               | |    |                               | 2.  Klickt auf das gew\u00fcnschte | |    |                               |     Pipeline Secret           | |    |                               |                               | |    |                               | 3.  Klickt auf das Auge Icon  | |    |                               |     um den Value eines Keys   | |    |                               |     anzuzeigen                | |    |                               |                               | |    |                               | 4.  Kopiert den Key           | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird von der     | |    |                               |     Startseite zur Secrets    | |    |                               |     Seite gef\u00fchrt             | |    |                               |                               | |    |                               | 2.  Die verschiedenen Keys    | |    |                               |     eines Secrets werden      | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 3.  Der Value des Key wird    | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 4.  Value im Input-Feld       | |    |                               |     entspricht dem erwarteten | |    |                               |     Wert                      | |    |                               |                               | |    |                               | (Secret muss beim             | |    |                               | Initialisieren der Tests      | |    |                               | erstellt werden \u2192 Helm Chart) | +----+-------------------------------+-------------------------------+ | 6  | Der User f\u00fcgt ein Secret      | 1.  Navigiert zum Pipeline    | |    | hinzu und l\u00f6scht es wieder    |     Secrets Fenster           | |    |                               |                               | |    |                               | 2.  Klickt auf das gew\u00fcnschte | |    |                               |     Pipeline Secret           | |    |                               |                               | |    |                               | 3.  Klickt auf das Add        | |    |                               |     Key/Value Pair Button     | |    |                               |                               | |    |                               | 4.  Gibt beim Key Input Field | |    |                               |     einen Namen f\u00fcr das       | |    |                               |     Secret                    | |    |                               |                               | |    |                               | 5.  Gibt beim Value Input     | |    |                               |     Field den Value ein       | |    |                               |                               | |    |                               | 6.  Klickt auf den Save       | |    |                               |     Button um die \u00c4nderungen  | |    |                               |     zu speichern              | |    |                               |                               | |    |                               | 7.  Klickt auf den L\u00f6schen    | |    |                               |     Button                    | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zum Secret  | |    |                               |     Fenster weitergeleitet    | |    |                               |                               | |    |                               | 2.  Die verschiedenen Keys    | |    |                               |     eines Secrets werden      | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 3.  2 leere Input Felder      | |    |                               |     werden der Seite          | |    |                               |     hinzugef\u00fcgt, eines namens | |    |                               |     Key das andere Value      | |    |                               |                               | |    |                               | 4.  Der neue Key ist sichtbar | |    |                               |                               | |    |                               | 5.  Secret wird in der Liste  | |    |                               |     angezeigt                 | |    |                               |                               | |    |                               | 6.  Nach L\u00f6schung ist das     | |    |                               |     Secret wieder entfernt    | +----+-------------------------------+-------------------------------+ | 7  | ~~Der User gibt einer Gruppe  | 1.  Navigiert zum User        | |    | die Admin Rolle~~             |     Permissions Fenster       | |    |                               |                               | |    |                               | 2.  W\u00e4hlt die Admin Rolle aus | |    |                               |                               | |    |                               | 3.  Schreibt die              | |    |                               |     zuberechtigende Gruppe in | |    |                               |     das Input Field           | |    |                               |                               | |    |                               | 4.  Klickt auf den Add Group  | |    |                               |     Button                    | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Permission Seite          | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  Der Radiobutton mit dem   | |    |                               |     Wert Admin ist ausgew\u00e4hlt | |    |                               |                               | |    |                               | 3.  Der Name der              | |    |                               |     zuberechtigenden Gruppe   | |    |                               |     ist im Input Feld         | |    |                               |     sichtbar, der Add Group   | |    |                               |     Button wechselt seinen    | |    |                               |     State von disabled zu     | |    |                               |     activated                 | |    |                               |                               | |    |                               | 4.  Zusammen mit der Rolle    | |    |                               |     wird die neue Gruppe in   | |    |                               |     der untenstehenden Liste  | |    |                               |     angezeigt                 | +----+-------------------------------+-------------------------------+ | 8  | ~~User sieht sich die         | 1.  Navigiert zum Pipelines   | |    | PipelineRun Details in        |     Fenster                   | |    | Openshift an~~                |                               | |    |                               | 2.  Hovert auf dem            | |    |                               |     gew\u00fcnschten Pipeline Run  | |    |                               |                               | |    |                               | 3.  Klickt auf Openshift      | |    |                               |     Konsole                   | |    |                               |                               | |    |                               | 4.  Gelangt zum Openshift     | |    |                               |     Fenster mit den           | |    |                               |     PipelineRun Details       | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Pipelines Seite           | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  2 Icons erscheinen in der | |    |                               |     letzten Spalte            | |    |                               |                               | |    |                               | 3.  Ein neuer Tab f\u00fchrt den   | |    |                               |     User zur Openshift Seite  | |    |                               |                               | |    |                               | 4.  Sieht die Details des     | |    |                               |     PipelineRuns auf          | |    |                               |     Openshift                 | +----+-------------------------------+-------------------------------+ | 9  | User sieht sich die Tekton    | 1.  Navigiert zur Repository  | |    | Pipeline Runs in einem        |     Seite                     | |    | Repository an                 |                               | |    |                               | 2.  Hovert \u00fcber dem           | |    |                               |     gew\u00fcnschtem Repository    | |    |                               |                               | |    |                               | 3.  Klickt auf den Show       | |    |                               |     Pipelines Button          | |    |                               |                               | |    |                               | 4.  Klickt den Filter Button  | |    |                               |     auf dem master Branch     | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Repositories Seite        | |    |                               |     gef\u00fchrt, wo die           | |    |                               |     verschiedenen             | |    |                               |     Repositories angezeigt    | |    |                               |     werden                    | |    |                               |                               | |    |                               | 2.  4 Icons erscheinen in der | |    |                               |     letzten Spalte            | |    |                               |                               | |    |                               | 3.  Der User wird auf die     | |    |                               |     Repo-Details Seite        | |    |                               |     weitergeleitet wo er alle | |    |                               |     Pipeline Runs in dem      | |    |                               |     Repository sieht          | |    |                               |                               | |    |                               | 4.  Pipelines Listing passt   | |    |                               |     sich der Branch-Selektion | |    |                               |     an                        | +----+-------------------------------+-------------------------------+ | 10 | User l\u00f6scht ein Repository in | 1.  Navigiert zur Repository  | |    | der Liste                     |     Seite                     | |    |                               |                               | |    |                               | 2.  Hovert \u00fcber das           | |    |                               |     zul\u00f6schende Repository    | |    |                               |                               | |    |                               | 3.  Klickt auf das X Icon     | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Repositories Seite        | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  4 Icons erscheinen in der | |    |                               |     letzten Spalte            | |    |                               |                               | |    |                               | 3.  Das gel\u00f6schte Repository  | |    |                               |     verschwindet von der      | |    |                               |     Liste                     | +----+-------------------------------+-------------------------------+ | 11 | ~~User rescant die            | 1.  Navigiert zur Projects    | |    | Repositories eines            |     Seite                     | |    | Projektes~~                   |                               | |    | :tick: bereist vorhanden      | 2.  Hovert \u00fcber das           | |    |                               |     gew\u00fcnschte Projekt        | |    |                               |                               | |    |                               | 3.  Klickt auf das Icon mit   | |    |                               |     den 2 im Kreis drehenden  | |    |                               |     Pfeile, um den Scan zu    | |    |                               |     starten                   | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Projects Seite            | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  3 Icons erscheinen        | |    |                               |                               | |    |                               | 3.  Scan wird gestartet       | +----+-------------------------------+-------------------------------+ | 12 | ~~User konvertiert sein       | 1.  Navigiert zur Migration   | |    | estaCloudPipeline.json zu     |     Seite                     | |    | estaTektonPipeline.json und   |                               | |    | l\u00e4dt die Datei herunter~~     | 2.  kopiert den Inhalt seiner | |    | \u2192 in UI Playwright Tests      |     estaCloudPipeline.json    | |    |                               |                               | |    |                               | 3.  f\u00fcgt den kopierten Inhalt | |    |                               |     in das                    | |    |                               |     estaCloudPipeline.json    | |    |                               |     Input Field               | |    |                               |                               | |    |                               | 4.  Klickt auf den Download   | |    |                               |     Button                    | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Migration Seite           | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  Der Inhalt des            | |    |                               |     estaCloudPipeline.json    | |    |                               |     Datei befindet sich in    | |    |                               |     der Zwischenablage des    | |    |                               |     Users                     | |    |                               |                               | |    |                               | 3.  Der Inhalt des            | |    |                               |     estaCloudPipeline.json    | |    |                               |     Datei ist im Input Feld   | |    |                               |     ersichtlich               | |    |                               |                               | |    |                               | 4.  Das File wird vom Browser | |    |                               |     heruntergeladen           | +----+-------------------------------+-------------------------------+ | 13 | User vermutet Probleme mit    | 1.  Navigiert zur             | |    | den Caches, deshalb l\u00f6scht er |     Repositories Seite        | |    | Pipeline Caches f\u00fcr ein Repo  |                               | |    |                               | 2.  W\u00e4hlt ein Repo aus        | |    |                               |                               | |    |                               | 3.  Klickt auf den Button     | |    |                               |     \"Manage pipeline cache\"   | |    |                               |                               | |    |                               | 4.  W\u00e4hlt alle Cache-Eintr\u00e4ge | |    |                               |     aus                       | |    |                               |                               | |    |                               | 5.  Klickt auf Delete         | |    |                               |     selected                  | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Die Liste der Pipeline    | |    |                               |     Caches zeigt mind. 1      | |    |                               |     Eintrag                   | |    |                               |                               | |    |                               | 2.  Nach dem L\u00f6schen ist die  | |    |                               |     Liste leer                | +----+-------------------------------+-------------------------------+ | 14 | User will einige Repositories | 1.  Navigiert zur System      | |    | ausblenden                    |     Configuration Seite       | |    |                               |                               | |    |                               | 2.  User erstellt ein Regex   | |    |                               |     welches gewisse           | |    |                               |     Repositories ausblendet   | |    |                               |                               | |    |                               | 3.  Einf\u00fcgen des Regexes in   | |    |                               |     das Exclude Git           | |    |                               |     Repository regular        | |    |                               |     expression patterns Input | |    |                               |     Field                     | |    |                               |                               | |    |                               | 4.  Bet\u00e4tigt Enter Taste um   | |    |                               |     den Chip zu speichern     | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur         | |    |                               |     Configuration Seite       | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  -                         | |    |                               |                               | |    |                               | 3.  -                         | |    |                               |                               | |    |                               | 4.  Der Regex wird zu einem   | |    |                               |     Chip mit den man die      | |    |                               |     gew\u00fcnschten Repositories  | |    |                               |     ausblenden kann (Die      | |    |                               |     Repositories werden nicht | |    |                               |     mehr in der Liste         | |    |                               |     angezeigt)                | +----+-------------------------------+-------------------------------+ | 15 | Templates importieren         | 1.  Navigiert zur System      | |    |                               |     Configuration Seite       | |    |                               |                               | |    |                               | 2.  Klickt auf den Import     | |    |                               |     templates now Button      | |    |                               |                               | |    |                               | Resultat:                     | |    |                               |                               | |    |                               | 1.  Der User wird zur System  | |    |                               |     Configuration Seite       | |    |                               |     weitergeleitet            | |    |                               |                               | |    |                               | 2.  Die angezeigte Last       | |    |                               |     Import Zeit wird          | |    |                               |     aktualisiert              | +----+-------------------------------+-------------------------------+ "}, {"text": "ESTA Tekton Workflow  -   Continuous Integration      -   Scheduled/Nightly Builds      -   Snapshot Deployments  -   Release Process      -   Auto-releasing from Git Commits  -   Bitbucket Integration      -   Project Scanner      -   Build Status Notifications  -   Notifications      -   Variable substitution      -   Email Notifications      -   MS Teams Notifications      -   Customize Default Notification Texts  Continuous Integration  CI builds are usually triggered by pushed to the Bitbucket repository and shall not create any artifacts but simply build the application and run unit tests. The build status is then reported to Bitbucket and other recipients.  []  1.  Create a development branch in Git  2.  Bitbucket webhook triggers continuous build in ESTA Tekton     Controller  3.  Build pipeline runs and executes tests  4.  Tekton reports build status to Bitbucket and configured recipients  Scheduled/Nightly Builds  The ESTA Tekton system also allows to define scheduled pipeline runs via the estaTektonPipeline.json. This is done with a pipeline config block that includes \"CRON\" in the triggerType list and defines the schedule when to run start the pipeline with a cron expression. Source for the (build) pipeline run is the first entry from the branchNamePrefixes list or main branch if not specified.  Scheduled pipeline configuration example  {  ...  \"pipelines\": [  ...  {  \"name\": \"nightly\",  \"cron\": \"15 4 * * 1-5\",  \"triggerType\": [  \"CRON\"  ],  \"branchNamePrefixes\": [  \"master\"  ],  \"build\": {  \"buildDockerImage\": true,  \"versionTag\": \"nightly-${DATE}\"  }  }  ]  }  The example above starts a build pipeline at 04:15 on every day-of-week from Monday through Friday which builds a Docker image and assigns it the version tag \"nightly-YYYYMMDD\".  Scheduled pipelines and the time of their next execution are listed in the repository details inside the Tekton Control Panel.  Snapshot Deployments  Although ESTA Tekton suggests to create releases whenever you want to deploy an application or a service, the scenario of continuously deploying snapshots of the current state of development is real. The workflow could look as follows:  []   In order to make the deployment of snapshot builds via ArgoCD actually work, it's recommended to assign unique versions to each build. As a source for uniqueness one can use the current Git hash and/or the date/time of the build. Use the \"versionTag\" property with pre-defined parameters in your pipeline config to compose such tags under which the build artifacts are published:  Continuous snapshot pipeline configuration  {  ...  \"pipelines\": [  {  \"name\": \"continuous-snapshot\",  \"triggerType\": [  \"GITEVENT\",  \"USER\"  ],  \"branchNamePrefixes\": [  \"develop\"  ],  \"build\": {  \"buildDockerImage\": true,  \"versionTag\": \"snapshot-rev-${GIT_REV_SHORT}\"  \"sonarScan\": {  \"enabled\": true  }  },  \"stages\": [  \"dev\"  ]  }  ],  \"stages\": [  {  \"stageName\": \"dev\",  \"argoCD\": {  \"argoCdAppName\": \"springboot-tekton-dev\",  \"autoSync\": true  },  \"helm\": {  \"sourceRepository\": \"https://code.sbb.ch/scm/kd_example/argocd-apps-helm.git\",  \"chartFilePath\": \"clusters/aws01t/values/springboot-tekton.yaml\",  \"versionProperties\": [  \".deploymentVersion\"  ]  }  }  ]  This example will build a Docker image with a tag like snapshot-rev-1405327b60a and then update the deploymentVersion value of an ArgoCD source repository for automatic deployment.  Attention: Helm chart versioning  When using \"packageAndDeployHelmChart\":true in your pipeline config, the Helm chart from your repository will also be released with the version specified by the \"versionTag\" property. Please note that Helm requires versions that follow the semver pattern. Therefore the composition of the version needs to be adapted to produce valid semantic versions. Here are some examples that work:  -   \"0.0.0-snapshot-rev-${GIT_REV_SHORT}\"  -   \"0.0.${DATE}-snapshot-${GIT_REV_SHORT}\"  -   \"${DATETIME}-snapshot.rev-${GIT_REV_SHORT}\"  Using the package version  If the \"versionTag\" property is omitted, the build pipeline will take the version from package files like pom.xml or package.json and use this for the build artifacts. Because the version doesn't change on each build, deployment via ArgoCD will not work out of the box because ArgoCD will not detect any changes in the Helm chart. This can still work but requires a little hack inside the Helm chart used for deploying the application: add a random value to the Deployment resource template. With this, ArgoCD will detect changes on each refresh operation and sync the changed resource to Openshift.  Deployment resource template with random value  ...  spec:  template:  metadata:  {{- if hasSuffix \"-SNAPSHOT\" .Values.deploymentVersion }}      annotations:  rollme: {{ randAlphaNum 8 | quote }}  {{- end }}  Release Process  ESTA Tekton triggers the release build by a git tag. The GIT Tag is created by, developers or release managers directly through Bitbucket. It is also possible to create a new tag with the Tagging Assistant in Tekton Control Panel. Using the tagging assistant, the tagging pipeline not only creates a Git tag but also sets the given version to meta files like pom.xml, package.json and to Helm charts found inside the repository.   Another option is to start the tagging process over the Esta Tekton REST service. All actions which can be executed with the Esta Tekton Controller UI can also be executed through REST API calls.   []  1.  Create a release via the Tekton Control Panel  2.  Tagging pipeline sets new version and creates a tag in Git  3.  Bitbucket webhook triggers release build in ESTA Tekton Controller  4.  Build pipeline runs, executes tests and creates build artifacts     (Docker image, JAR, Helm charts)  5.  Tekton reports build status to configured recipients  6.  Staging pipeline updates Helm charts (optional) and triggers ArgoCD     to sync  Auto-releasing from Git Commits  Instead of starting the release process via the Tekton Control Panel or the REST API, a Tagging Pipeline can also be triggered by a Git commit on a certain branch (e.g. on pull request merge into master). With an according pipeline config block in the estaTektonPipeline.json, the parameters for the tagging pipeline (e.g. the automatic increment of the version) are defined. The pipeline trigger criteria like triggerType and branchNamePrefixes are evaluated to start a tagging pipeline on the desired events.  Tagging pipeline configuration example  {  ...  \"pipelines\": [  ...  {  \"name\": \"continuous-release\",  \"triggerType\": [  \"GITEVENT\"  ],  \"branchNamePrefixes\": [  \"master\"  ],  \"tagging\": {  \"versionIncrementPosition\": \"none\",  \"preReleaseVersionIncrement\": \"patch\"  }  }  ]  }  This example will start a tagging pipeline on each commit to the master branch which simply removes the -SNAPSHOT suffix from the pom.xml version (\"versionIncrementPosition\": \"none\") to create the release version and then set the new -SNAPSHOT version by incrementing the patch position.  See the Tagging pipeline parameter documentation for reference.  Control increment position with commit message  A common use-case is to decide about the severity of a change at the time when a change is committed to Git or a PR is merged or. With specific keywords inside the commit message one can override the configured versionIncrementPosition just for this change. Use one of the following terms to define whether the automatic release should be a major, minor or patch version increment: #major, #minor, #patch.  Bitbucket Integration  Project Scanner  The ESTA Tekton Controller periodically scans the configured Bitbucket projects for repositories which have a estaTektonPipeline.json (or .yaml) file in the root directory of their default branch. If such a file is detected, the repository is considered \"tekton-enabled\" and listed in the Tekton Control Panel. At the same time, the ESTA Tekton Controller registers a webhook to receive notifications on Git events from that repository.  Build Status Notifications  The status of build pipeline runs (started, success, failure) is immediately reported to Bitbucket using a reference to the commit/revision used in that pipeline run. The build status is then visualized in Bitbucket and can even be used as a hard criteria to merge pull requests.  []  Notifications  Notifications for pipeline runs and their termination status can be configured individually for each repository via the estaTektonPipeline.json file. Tekton can currently send notifications via email or Microsoft Teams. By default, build notifications with the termination status (success, failure) will be sent as email to the actor (i.e. the user who started the pipeline via Git push or Tekton Control Panel). Here's an email and teams notifications exmaple config:  estaTektonPipeline.json Notificatons Example  {  ...  \"notifications\": [  {  \"type\": \"EMAIL\",  \"recipients\": [\"$actor\", \"some.one-else@sbb.ch\"],  \"eventTypes\": [\"SUCCESS\", \"FAILURE\"],  \"branchNameExcludes\": [\"develop\"]     },  {  \"type\": \"TEAMS\",  \"enabled\": false,  \"webhookSecretName\": \"<secret-holding-connector-webhook-url>\",  \"pipelineTypes\": [\"BUILD\",\"STAGING\"],  \"eventTypes\": [\"SUCCESS\", \"FAILURE\", \"ABORTED\"],  \"title\": \"${PIPELINE_TYPE} Pipeline has ${PIPELINE_STATUS}\"  }  ]  }  You can specify any number of notification profiles with different type, filters and recipients.  See the Parameter Documentation for a complete description of all notification parameters.  Variable substitution  Notification texts and titles can be parametrized with placeholder values in the form ${VAR_NAME}. The following variables can be used to compose notification messages:  PRODUCT - The productName from estaTektonPipeline.json or the repository slug if not defined  PIPELINE_TYPE - The pipeline type that triggered this notification (one of \"TAGGING\", \"BUILD\", \"STAGING\", \"CUSTOM\")  PIPELINE_STATUS - The termination status of the pipeline (one of \"SUCCESS\", \"FAILED\", \"ABORTED\")  PIPELINE_CONFIG_NAME - Name of the pipeline config profile used  PIPELINERUN_NAME - Unique name of the pipeline run  PIPELINERUN_URL - URL to the pipeline run details page in the Tekton Control Panel  PIPELINERUN_CONSOLE_URL - URL to the pipeline run view in the OpenShift Console  GIT_REVISION - Git commit hash used in the pipeline run  GIT_BRANCH - Git branch the pipeline was started from (not always present)  GIT_URL - URL to the Git repository that was cloned into the pipeline workspace  VERSION_TAG - Release version (for tagging pipelines) or Git tag (for build and staging pipelines)  ERROR - Error message for failed pipeline runs  Email Notifications  For receiving email notifications, no specific configuration is needed. List all recipients to receive a notification message. The value \"$actor\" will be replaced with the email address of the initiating user.  MS Teams Notifications  In order to receive notifications in MS Teams, a webhook URL needs to be entered along with the general filters and the \"type\":\"TEAMS\" property. Webhook URLs can be registered to channels in MS Teams:  1.  Choose \"Connectors\" from the Options menu of the desired channel in     MS Teams  2.  Search for the \"Incoming Webhook\" connector and click the \"Add\"     button  3.  Give it a name and optionally upload a nice icon  4.  Click the \"Create\" button  5.  Copy the URL shown in the dialog and save it to a Pipeline Secret     with the key \"URL\"  6.  Configure the secret name in your estaTektonPipeline.json file  [Incoming Webhook in MS Teams]  Customize Default Notification Texts  The default notification texts can be configured for the entire ESTA Tekton build namespace. Talk to us if you want to customize them. "}, {"text": "ESTA Tekton Architekturentscheidungen  Anforderungen und Entscheidungen bez\u00fcglich der Architektur von ESTA Tekton:  -   Tagging Pipelines via estaTektonPipeline.json konfigurierbar  -   Caching Strategie f\u00fcr Bitbucket API-Abfragen  -   Performanceoptimierung PipelineRuns Listing  -   Shared Caches f\u00fcr Tekton Pipelines "}, {"text": "ESTA Tekton Releasing  Nachfolgend wird der Prozess beschrieben, wie ESTA Tekton released wird, inklusive der Kommunikation und dem Roll-out f\u00fcr unsere Abnehmer.  -   Versionierung      -   Semantic Versions  -   Unstable Releases  -   Stable Releases  -   Changelog  -   Release Announcements      -   Muster  \u2022 ESTA Tekton Version 1.14.0 released  \u2022 Summary  \u2022 Further information  -   Deployment  Versionierung  Ein Release des Gesamtsystems ESTA Tekton wird \u00fcber as Repo esta-tekton-pipeline-config gemacht, welches ein Umbrella Helm Chart mit den Dependencies und Values f\u00fcr die einzelnen Komponenten enth\u00e4lt. Die Versionierung folgt dem Semantic Versioning. F\u00fcr jedes Release wird ein Git Tag erstellt und das Helm Chart mit der entsprechenden Version nach bin.sbb.ch gepushed.  Semantic Versions  major: MAJOR Milestones minor: Feature Releases patch: Patches, kleine Improvements oder Hotfixes  TO BE DISCUSSED  Monorepo erstellen? \u2192  ESTA-5275 - Abrufen der Vorgangsdetails... STATUS  Unstable Releases  \"Release early, release often\" ist das Credo von ESTA Tekton. F\u00fcr die laufende Entwicklung releasen wir oft, meistens beim Abschluss eines neue Features oder einer Anpassung, die aufgrund von Kundenfeedback oder -w\u00fcnschen notwendig wird. F\u00fcr diese \"unstable\" Releases gibt es in unserem ArgoCD Helm Chart einen eigenen \"Cannel\", der von einzelnen Tekton Instanzen benutzt werden kann, wenn gew\u00fcnscht. Das kann auch nur tempor\u00e4r sein, um schnell einen Fix oder ein gew\u00fcnschtes Feature zu deployen.  Der Unstable Channel kann benutzt werden, indem in der jeweiligen ArgoCD App die Value .estaTekton.releaseVersionUnstable verwendet wird.  Stable Releases  Einen etwas langsameren Release-Zyklus bieten wir mit dem Stable Releases an. Diese werden publiziert, sobald eine unstable Version eine Weile in clew-tekton und anderen Instanzen ohne Probleme und Zwischenf\u00e4lle l\u00e4uft. Genaue Regeln oder eine zeitliche Periodizit\u00e4t f\u00fcr stable Releases sind nicht vorgesehen.  Der Stable Channel ist der Default f\u00fcr alle Tekton Instanzen und wird \u00fcber die Value .estaTekton.releaseVersion bezogen.  Lose Regel f\u00fcr Stable Releases: einmal pro Woche (Montags), wenn relevante \u00c4nderungen in Unstable vorhanden.  Changelog  Wie bisher wird im esta-tekton-pipeline-config Repo die Datei CHANGELOG.md mit Informationen zu Bugfixes, Features und Major Changes sowie mit den enthaltenen Versionen der einzelnen Komponenten gef\u00fchrt.  Idee: neue Features im Tekton Control Panel anzeigen (Notifications)  TO BE DISCUSSED  -   Sollen CLEW- oder ESTA- Tickets im Changelog vermerkt werden? \u2192 Ja,     gem\u00e4ss Entscheid aus  CLEW-24024 - Abrufen der Vorgangsdetails...     STATUS  -   Sollen (zumindest f\u00fcr stable Releases) Release Notes wie diejenigen     f\u00fcr die ESTA Cloud Pipeline in Confluence publiziert werden? \u2192 No  Release Announcements  F\u00fcr stable Releases wird eine Ank\u00fcndigung in Form eines Blogposts publiziert. Diese enth\u00e4lt den Changelog seit dem letzten Release und allenfalls wichtige Informationen falls Breaking Changes anfallen.  Hier ein Beispiel: ESTA Cloud Pipeline 1.67.0 Release.  Muster  ESTA Tekton Version 1.14.0 released    ---------- ---------------------------------------   Affects:   Users of the ESTA Tekton CI/CD system   ---------- ---------------------------------------  Summary  We just released the stable version 1.14.0 of the ESTA Tekton Build System.  -   This release includes major/breaking changes that affect XXX  -   This is a service release with a number of new features and     improvements which are listed below.  Further information  Major changes  -   Controller: change defaultMavenGoals to \"clean install\"  Bugfixes  -   Pipeline: support nested multi-module Maven builds  -   Pipeline: fix caching to make multistage Docker builds work  -   Controller: avoid startup errors when bitbucket credentials are     empty  -   Builder: fix permissions for non-root user (used for specific Maven     builds)  Features  -   UI: add info link explaining how to create a Bitbucket access tokens  See the full Changelog here.  All ESTA Tekton instances on the stable release channel will be automatically updated with this new version.  Buillder Image Tools Versionen  Im Changelog oder in den Announcements sollten ebenfalls die Versionen der Build Tools (z.B. Maven, Chrome Headless, etc.) erw\u00e4hnt werden, welche in den Builder Images aktuell verwendet werden.  Deployment  Alle Tekton Instanzen werden \u00fcber das ESTA ArgoCD deployed und sind standardm\u00e4ssig auf autosync und entweder die stable und die unstable Release Version konfiguriert.  Die releaseVersionUnstable Value wird via Staging Pipeline bei einem Release des Config Helm Charts angepasst und somit automatisch deployed.  Die releaseVersion Value wird manuell via Pull Request in den Values der jeweiligen Cluster angepasst und zeitnah zum Release Announcement gemerged.  Es bleibt jedoch einzelnen Abnehmern \u00fcberlassen, ihre Instanz auf eine fixen Version zu konfigurieren und sie selbst\u00e4ndig via Pull-Request anzupassen.  Update Downtime  Das Deployment des Tekton Controllers ist auf Recreate eingestellt, da die Verwendung eines PVC den redundanten Betrieb von mehreren Pods verhindert. Bei einem Update ist also mit einer kurzen Downtime von einigen Sekunden bis wenigen Minuten zu rechnen. In dieser Zeit \"verpasst\" der Controller Webhooks von Bitbucket und PipelineRun Status Changes von Kubernetes, was zu fehlenden Status-Updates, Notifications oder verpassten Builds bei einem Git Push f\u00fchren kann.  F\u00fcr ein Update ist also ein Zeitpunkt zu w\u00e4hlen, wo potenziell kein oder wenig Betrieb auf Tekton zu erwarten ist (z.B. Abends oder am fr\u00fchen Morgen). "}, {"text": "Enabling Test Reports in ESTA Tekton  The pre-defined build pipelines in ESTA Tekton (since 0.20.0) now have support to generate browseable reports for test execution during builds. This however, needs to be enabled per repository and depending on the project type and setup also require some additional settings in the project's test-runner configuration.  Enable testreport in estaTektonPipeline.json  The build pipeline block provides an additional set of properties:  Pipeline config with testreports  \"pipelines\": [  {  ...  \"build\": {  \"testreport\": {  \"enabled\": true,  \"artifactoryRepository\": \"esta-test.generic\",  \"resultsDir\": \"allure-report\",  \"reportQualifiers\": [\"${BRANCH_LABEL}\"],  \"previousQualifiers\": [\"${BRANCH_LABEL}\", \"master\"]  }  }  }  ...  ]  In this example, test report creation is explicitly enabled with the \"enabled\": true flag. Reports are uploaded to a repository in Artifactory named \"esta-test.generic\".  The reports are generated from JUnit/Surefire XML files created during the test run in the pipeline's build step with the help of the Allure Framework by Qameta. Use the \"resultsDir\" property to define where the XML files with test summaries are located after the build.  Trend and history with qualifiers  Test reports are stored under a unique file name and linked in the pipeline details of the Tekton Control panel. With the list of \"reportQualifiers\" you can specify aliases for the generated report files. Use them to create static links to project reports like \"latest\" or \"release\". When adding a list of \"previousQualifiers\", previously generated reports are considered to build a trend and history timeline in each new report. The list of aliases is searched until an existing report was found.  With the above example, reports are also stored under the label of the current branch with a fallback to use the last report labelled as \"master\". On the first build of a branch, the last report from master is used to visualize the difference. All further builds of the same branch will compare to the previous reports of the particular branch showing improvement or regression.  Artifactory repository for your reports  The generated test reports are saved to a Artifactory repository of type generic. By default a shared repository is used with a limited retention time configured. We therefore recommend to use your own repository and specify its name with the \"artifactoryRepository\" property.  1.  Order a new repository (type Generic) via the CLEW SSP  2.  Request to allow content browsing on this repository  3.  Grant write access to the repository to the Artifactory user     configured in ESTA Tekton  Configure test reports in Maven projects  For most Maven-based projects, no specific configuration needs to be added except enabling the testreport feature in estaTektonPipeline.json. Just make sure the maven-surefire-plugin is included in your pom.xml:  pom.xml  <plugin>  <groupId>org.apache.maven.plugins</groupId>  <artifactId>maven-surefire-plugin</artifactId>  <version>${maven-surefire-plugin.version}</version>  </plugin>  The default value for the \"resultsDir\" property is set to target/surefire-reports which is the default location for surefire reports.  Configure test reports in NPM/Angular projects  For JavaScript/NPM projects, an according reporter need to be configured for the test runner used in the project. There are report generators available for Karma, Jasmine, Mocha and CucumberJS. See the Karma documentation for details.  This example shows the changes required for Angular projects using Karma:  enable-allure-report.diff  --- a/.gitignore  +++ b/.gitignore  @@ -41,6 +41,7 @@  yarn-error.log  testem.log  /typings  +/allure-report  # System Files  .DS_Store  --- a/angular.json  +++ b/angular.json  @@ -123,7 +123,8 @@  \"watch\": false,  \"reporters\": [  \"dots\",  - \"sonarqube\"  + \"sonarqube\",  + \"allure\"  ]  }  }  --- a/estaTektonPipeline.json  +++ b/estaTektonPipeline.json  @@ -20,6 +20,11 @@  \"build\": {  \"sonarScan\": {  \"enabled\": true  + },  + \"testreport\": {  + \"enabled\": true,  + \"artifactoryRepository\": \"esta.generic\",  + \"resultsDir\": \"allure-report\"  }  }  },  --- a/karma.conf.js  +++ b/karma.conf.js  @@ -14,6 +14,7 @@ module.exports = function (config) {  require('karma-jasmine-html-reporter'),  require('karma-sonarqube-reporter'),  require('karma-coverage'),  + require('karma-allure-reporter'),  require('@angular-devkit/build-angular/plugins/karma'),  ],  client: {  @@ -45,7 +46,11 @@ module.exports = function (config) {  { type: 'cobertura' },  ],  },  - reporters: ['progress', 'kjhtml', 'sonarqube'],  + allureReport: {  + reportDir: 'allure-report',  + useBrowserName: false,  + },  + reporters: ['progress', 'kjhtml', 'sonarqube', 'allure'],  port: 9876,  colors: true,  logLevel: config.LOG_INFO,  --- a/package.json  +++ b/package.json  @@ -86,6 +86,7 @@  \"husky\": \"8.0.3\",  \"jasmine-core\": \"5.0.1\",  \"karma\": \"6.4.2\",  + \"karma-allure-reporter\": \"^1.4.6\",  \"karma-browserstack-launcher\": \"1.6.0\",  \"karma-chrome-launcher\": \"3.2.0\",  \"karma-coverage\": \"2.2.1\",  Configure test reports in Python/Poetry projects  Coming Soon. "}, {"text": "Tekton Archivierte Seiten  Hier werden die von Tekton nicht mehr ben\u00f6tigten Archivierte Seiten abgelegt. "}, {"text": "Calling the Tekton API from your application  The controller of the ESTA Tekton build system provides a RESTful API which is documented with OpenAPI/Swagger. The URL to the controller is a bit hidden but follows this schema:  https://esta-tekton-controller-<tekon-namespace>.sbb-cloud.net/  The API requires authentication with OAuth2 JWT tokens issued by Microsoft Azure AD. Here's the process for an application (machine-2-machine) to successfully authenticate to the controller API:  []  Prerequsites  1.  Register an Azure AD client and obtain client credentials (ID and     secret) for the client credential flow.  2.  Store the credentials to an OpenShift secret which is accessible for     the application which performs the API calls.  3.  Add the client ID to the app registration config for your Tekton     instance (ask the ESTA team to do this for your managed Tekton     instance)  Example shell script  # (1) Obtain an access token  export AUTH_TOKEN=$(curl -s --fail -X POST ${TOKEN_ENDPOINT} \\  -H 'Content-Type: application/x-www-form-urlencoded' \\  -d grant_type=client_credentials \\  -d client_id=${CLIENT_ID} \\  -d client_secret=${CLIENT_SECRET} \\  -d scope=${TEKTON_CLIENT_ID}/.default \\  | grep -o -E '\"access_token\":\"[^\"]+\"' | cut -f 2 -d \":\" | tr -d '\"\\n')  # (2) Perform an API request to the Tekton controller  curl ${TEKTON_CONTROLLER_URL}/api/bitbucket/projects/*/repos \\  -H \"Authorization: Bearer $AUTH_TOKEN\" \\  -H \"Accept: application/json\"  The script expects the following env variables:  -   TOKEN_ENDPOINT: URL to the Microsoft Login service (usually     https://login.microsoftonline.com/2cda5d11-f0ac-46b3-967d-af1b2e1bd01a/oauth2/v2.0/token)  -   CLIENT_ID: UUID of your Azure AD client  -   CLIENT_SECRET: Secret key of the client credentials  -   TEKTON_CLIENT_ID: The Azure AD UUID of your Tekton instance (ask the     ESTA team to get it for you)  -   TEKTON_CONTROLLER_URL: The URL to the ESTA Tekton controller (see     first paragraph)  The scope to be requested for this token is \"<tekton-client-id>/.default\".  The API documentation can be found when opening the controller URL in the browser and navigate to \"Swagger UI\". "}, {"text": "Environment Variables  To each pipeline task, the following environment variables are expose and can be consumed by the build tools or scripts (starting with version 0.27.0 of ESTA Tekton).    Name                                 Description   ------------------------------------ ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   CI_PLATFORM                          Name of CI/CD Platform (Tekton).   CI_KUBERNETES_NAMESPACE              Openshift namespace/project name where the pipeline runs.   CI_CONTROLLER_URL                    The URL of the Controller.   Commit, Branch and Tag Information      CI                                   Indicating a CI environment.   CI_ACTOR                             Email address of the user who started the pipeline.   CI_COMMIT_AUTHOR                     The author of the commit in name <email> format.   CI_COMMIT_BRANCH                     The commit branch name. Available in branch pipelines, including pipelines, including pipelines for the default branch. Not available in merge request pipelines or tag pipelines.   CI_COMMIT_MESSAGE                    The full commit message.   CI_COMMIT_SHA                        The commit revision the project is built for.   CI_COMMIT_REV_SHORT                  The short git revision.   CI_COMMIT_TAG                        The commit tag name. Available only in pipelines for tags.   CI_COMMIT_TIMESTAMP                  The timestamp of the commit.   Bitbucket/Repo Information              CI_REPOSITORY_NAME                   Bitbucket/Git repository name.   CI_REPOSITORY_SLUG                   Bitbucket/Git repository slug/key.   CI_REPOSITORY_OWNER                  The Bitbucket project key.   CI_REPOSITORY_URL                    The HTTP(S) address of the repository.   CI_GIT_URL                           The Git/Checkout URL to the repository.   Pipeline Information                    CI_PIPELINE_ID                       Tekton Pipeline Run name.   CI_PIPELINE_URL                      The URL for the pipeline details.   CI_PIPELINE_CREATED_AT               The UTC datetime when the pipeline was created.   CI_PIPELINE_CONFIG_NAME              The name of the matching pipeline config in estaTektonPipeline.json.   CI_PIPELINE_TRIGGER                  Tekton Pipeline triggerType(\"GITEVENT\", \"USER\" or \"CRON\"). "}, {"text": "How-to Tekton  A collection of how-to articles related to ESTA Tekton.  -   Calling the Tekton API from your application  -   Enabling Test Reports in ESTA Tekton  -   Migrating from ESTA Cloud Pipeline  -   Use Secrets in Docker Build Context "}, {"text": "Dynamisches Laden von Tasks aus Repository (Rejected)  Es soll m\u00f6glich sein einen Task dynamisch via einer Repository Referenz zu laden. Dies baut auf dem Konzept Dynamische Pipeline Tasks (Draft) auf.  Dabei soll via taskRef eine Referenz zu einem Repository angegeben werden k\u00f6nnen, z.B. \"taskRef\": \"KD_ESTA/echo@v1\". Der Wert nach @ kann eine beliebige Git Ref sein (also Tag, Commit Hash oder Branch).  W\u00e4hrend der Interpretation des estaTektonJson.json Files, soll vom entsprechenden Repository (und Git Ref) ein File names task.yml geladen und angewandt werden (vor oder mit PipelineRun). Dabei soll jedoch der Name des Tasks mit dem konkreten Git Hash (welcher durch die Git Ref aufgel\u00f6st wurde) postfixed werden: z.B. echo wird zu echo-52f09d56f5257fea936433878081ea7fcd972dc3 (dabei muss nat\u00fcrlich die TaskRef des PipelineRun angepasst werden). Damit soll sichergestellt werden, dass keine Konflikte durch Task Definitionen entstehen, wenn auf unterschiedlichen Branches oder Repositories unterschiedliche Versionen des Tasks verwendet werden.  Notizen  BitBucket unterst\u00fctzt folgenden Aufruf zum aufl\u00f6sen einer Git Ref (\"git rev-list -n 1 v1\"): https://code.sbb.ch/projects/KD_ESTA/repos/echo/commits?until=v1&limit=1  BitBucket unterst\u00fctzt folgenden Aufruf zum laden einer einzelnen Datei: https://code.sbb.ch/projects/KD_ESTA/repos/echo/raw/task.yml?at=52f09d56f5257fea936433878081ea7fcd972dc3  Beispiel  Repository KD_ESTA/echo mit Git Tag v1 (Hash 52f09d56f5257fea936433878081ea7fcd972dc3)  task.yaml  apiVersion: tekton.dev/v1beta1  kind: Task  metadata:  name: echo  spec:  description: |  Echos the parameters  ....  estaTektonPipeline.json File eines beliebigen Projektes  estaTektonPipeline.json  {  \"$schema\": \"https://clew-resources.sbb-cloud.net/tekton-schema.json\",  ...  \"pipelines\": [  {  \"name\": \"release\",  \"triggerType\": [\"GITEVENT\"],  \"versionTagEventPatterns\": \"^(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\*|\\\\d+)\",  \"build\": {  },  \"tasks\": [  {  \"name\": \"echo\",  \"taskRef\": \"KD_ESTA/echo@v1\",  \"params\": {  \"BUCKET_URL\": \"s3://test-bucket/static-www\",  \"SOURCE_DIR\": \"./dist\",  \"AWS_DEFAULT_REGION\": \"us-east-1\",  \"AWS_CREDENTIALS_SECRET\": \"pipeline-env-aws-credentails\"  },  \"runAfter\": \"quality-gate-check\",  \"runBefore\": \"helm-package-deploy\"  }  ]  }  ]  }  Angewandtes YAML im Tekton Namespace  task.yaml  apiVersion: tekton.dev/v1beta1  kind: Task  metadata:  name: echo-52f09d56f5257fea936433878081ea7fcd972dc3  spec:  description: |  Echos the parameters  .... "}, {"text": "Esta Tagging Pipelines - Besprechung  Beteiligte Personen: Br\u00fcderli Thomas (IT-PTR-CEN2-SL2) Jeanneret Julien (IT-PTR-CEN1-BDE3) Spirig Lukas (IT-PTR-CEN2-SL3) Wallrapp Manuel (IT-PTR-EXT-EXT2 - Extern)   ESTA-5190 - Helm Chart Snapshot Versionen publishen Closed  Diskussion  Weshalb kein SNAPSHOT:  -   Bei snapshot builds werden bestehende Artefakte \u00fcberschrieben. Falls     diese deployed werden, kann es sein, dass ein veraltetes Snapshot     Artefakt deployed wird. Das ist der Grund weshalb wir uns gegen     Snapshot Deployments und somit gegen Versionierung der Charts mit     einer Snapshot Version entschieden haben.   Weshalb SNAPSHOT:  -   In der Vergangenheit waren sich die Teams gew\u00f6hnt mit Snapshot     Versionen zu arbeiten. Hier werden vor allem Repo\u00fcbergreifende     Snapshot Dependencies verwendet. Teilweise wurden auch Snapshot     Versionen deployed. Dieses Pattern m\u00f6chten diverse Teams     weiterf\u00fchren. Push nach Master \u2192 Snapshotbuild \u2192 Deploy nach DEV.  Fragen:  -   Sollen Artefakte in Artifactory \u00fcberschrieben werden k\u00f6nnen?     ESTA-4962 - Der Jira-Vorgang existiert nicht oder Sie sind nicht     anzeigeberechtigt.  -   Soll Esta-Tekton ein Werkzeug sein um zu Builden - \u00e4hnlich wie     Jenkins oder wollen wir einen opinionated build Prozess aufzwingen?  -   K\u00f6nnen SNAPSHOTS \u00fcberhaupt durch ArgoCD deployed werden?   Vorschlag:  -   Updaten der Version im Helm Chart ist per Default inaktiv (auch f\u00fcr     Releases). Wenn man das Updaten der Version im Helmchart aktiviert,     wird die Version dann im Release- wie im Snapshotfall aktualisiert.     So w\u00e4re es konsistent.  -   Somit soll das Updaten der Version in Helmcharts per Default in der     Stagingpipeline gemacht werden.  [] "}, {"text": "Controller API Authentication aus Pipelines  Aus Tekton Pipelines sollen via Controller API weitere Pipelines gestartet werden k\u00f6nnen (ESTA-4989). Um API Requests an den Controller senden zu k\u00f6nnen, m\u00fcssen diese eine Authentifizierung enthalten, die vom Controller akzeptiert wird. In diesem Konzept wird beschrieben, wie ein solcher Authentifizierungs-Mechanismus aussehen k\u00f6nnte.  Grundidee  F\u00fcr jede Pipeline wird ein JWT generiert und via Env Variable den Tasks zur Verf\u00fcgung gestellt. Dieser Token ist nur solang g\u00fcltig, wie der PipelineRun noch l\u00e4uft.  Hintergrund:  Die Tokens sollen m\u00f6glichst kurzlebig und auch nur im Kontext eines spezifischen PipelineRuns nutzbar sein. Zwar k\u00f6nnten langlebige Tokens statisch in OpenShift Secrets hinterlegt werden, diese sind allerdings schwieriger zu rotieren. In den dynamischen Tokens k\u00f6nnen zudem Claims wie Username/Actor, welcher die aktuelle Pipeline gestartet hat, gespeichert werden und sie k\u00f6nnen damit gleich wie die OICD JWT (von Microsoft Login) behandelt werden.  Token Generierung  Bei jedem Start eines PipelineRuns wird ein JWT generiert, welcher an diese Pipeline gebunden ist. Die Claims sehen wie folgt aus:  {  \"iss\": \"esta-tekton-pipeline-controller@<tekton-namespace>\",  \"sub\": \"<pipelinerun-id>\",  \"exp\": 1707920236,  \"name\": \"John Doe\",  \"preferred_username\": \"john.doe@sbb.ch\",  \"roles\": [  \"TektonPipeline\"  ],  \"sbbuid\": \"u222555\"  }  -   Als Issuer (iss) wird der ESTA Tekton Controller und der     Namespace-Name verwendet. Damit lassen sich die selbst ausgestellten     Tokens von denen von Microsoft unterscheiden.  -   Als Subject (sub) wird die ID (Name) des PipelineRuns eingetragen.     Dar\u00fcber kann sp\u00e4ter gepr\u00fcft werden, ob der Token noch g\u00fcltig ist  -   Weitere Claims wie name, preferred_username und sbbuid werden vom     aktuellen Kontext (API Request) in den Pipeline Token \u00fcbertragen.  -   Der JWT wird mit einem Key signiert, welcher f\u00fcr jede Tekton Instanz     individuell generiert wird.  Token Validierung  Im Controller werden die JWT Tokens im Request Handling validiert. Dies wird aktuell bereits von OIDC in Quarkus gemacht, welcher mit dem Microsoft Login konfiguriert ist. Neu muss zuerst eine Fallunterscheidung aufgrund des Token Issuers gemacht werden. Ist es ein selbst ausgestellter Token, macht der Controller die Validierung selbst. Diese Validierung ist in folgende Schritte gegliedert:  1.  Pr\u00fcfung der Signatur  2.  Pr\u00fcfung des Ablaufdatums  3.  Pr\u00fcfung der PipelineRun Referenz (Subject) \u2192 der PipelineRun muss     existieren und den Status Running haben.  \u00dcbergabe an Pipeline Tasks  Die JWT Tokens sollen in den Pipeline Tasks als Env Variable (oder besser noch als File) konsumierbar sein. Von einer direkten Definition via podTemplate ist abzusehen, da so die effektiven Tokens sowohl im PipelineRun (Yaml) als auch im Pod (Yaml) sichtbar w\u00e4ren und von Tekton Results, Splunk, etc. auch gespeichert w\u00fcrden. Die Tokens sollen in einem OpenShift Secret angelegt und lediglich der Secret-Name als Pipeline Parameter \u00fcbergeben werden. Siehe auch How to use Kubernetes Secret in practice.  Hierbei wird also f\u00fcr jeden PipelineRun auch ein Secret in OpenShift angelegt, welches nach Beendigung der Pipeline wieder gel\u00f6scht werden sollte. Evtl. l\u00e4sst sich die L\u00f6schung \u00fcber eine Owner Reference an Kubernetes delegieren.  Umsetzung in Quarkus  Allgemeine Infos zum Authentifizierungsprozess in Quarkus finden sich hier: https://quarkus.io/guides/security-architecture  Die Token Generierung kann mit quarkus-smallrye-jwt-build implementiert werden. Siehe https://quarkus.io/guides/security-jwt-build  F\u00fcr die Signierung muss ein JSON Web Key (JWK) File angelegt werden. Dies kann als OpenShift Secret gespeichert und als Volume in den Controller Pod gemounted werden.  JWK File  {  \"kty\":\"oct\",  \"kid\":\"secretKey\",  \"k\":\"<random-secret-key>\"  }  In der Quarkus Config wird der Pfad zu diesem Key File f\u00fcr sign und verify angegeben:  application.yaml  smallrye:  jwt:  sign:  key:  id: secretKey  location: ${JWT_SIGN_KEY_FILE:/config/jwt-sign-key.json}  verify:  algorithm: HS256  key:  location: ${JWT_SIGN_KEY_FILE:/config/jwt-sign-key.json}  Die Unterscheidung f\u00fcr die interne JWT Validierung (oidc oder self-issued) kann \u00fcber eine HttpAuthenticationMechanism Klasse gemacht werden. Siehe Dealing with more than one HttpAuthenticationMechanism.  Durch die Verwendung von JWTAuthMechanism aus dem quarkus-security Modul wird die syntaktische Validierung des JWT (Signatur, Exp) bereits gemacht, so dass im Code nur noch die PipelineRun Referenz gepr\u00fcft werden muss.  Ein (unvollst\u00e4ndiger) POC ist in Commit 59242d8978 zu sehen und kann als Basis f\u00fcr die Umsetzung verwendet werden. "}, {"text": "Caching Strategie f\u00fcr Bitbucket API-Abfragen  +--------------------------+------------------------------------------+ | Fragestellung            | Wie sollen API-Abfragen auf Bitbucket    | |                          | (code.sbb.ch) im Controller optimal      | |                          | gecached werden?                         | |                          |                                          | |                          | Der ESTA Tekton Controller ben\u00f6tigt      | |                          | vielf\u00e4ltige Informationen \u00fcber           | |                          | Repositories von Bitbucket, welche \u00fcber  | |                          | dessen API abgefragt werden. Es werden   | |                          | h\u00e4ufig dieselben Anfragen gemacht oder   | |                          | mehrere API-Requests hintereinander, um  | |                          | komplexe Informationen, wie z.B. ob ein  | |                          | Repository \u00abtekton-enabled\u00bb ist, zu      | |                          | gewinnen. Die teilweise langen           | |                          | Antwortzeiten von Bitbucket,             | |                          | insbesondere bei kumulierten Abfragen    | |                          | und die potenziell hohe Last, die der    | |                          | ESTA Tekton Controller auf Bitbucket     | |                          | damit verursacht, legen ein Caching      | |                          | seitens Controller nahe. Dieses wurde    | |                          | bereits zu Beginn der Entwicklung sehr   | |                          | rudiment\u00e4r eingebaut und soll nun        | |                          | verfeinert werden. Konkret stellt sich   | |                          | die Frage nach den richtigen Werten f\u00fcr  | |                          | Vorhaltezeit, Gr\u00f6sse/Limits und Eviction | |                          | Strategie.                               | +==========================+==========================================+ | Rahmenbedingung          | -   Caching ist bereits vorhanden aber   | |                          |     \"schlecht\" oder \"falsch\" eingesetzt  | +--------------------------+------------------------------------------+ | Annahmen                 | -   Die Performance des Bitbucket APIs   | |                          |     bleibt konstant                      | +--------------------------+------------------------------------------+ | Alternativen / Varianten | Variante 0 (status quo)                  | |                          |                                          | |                          | Die aktuelle Cache-Strategie sieht ein   | |                          | statisches Caching mit einer             | |                          | automatisierten Eviction/Refresh alle 10 | |                          | Minuten via Scheduler f\u00fcr alle gecachten | |                          | Ressourcen.                              | |                          | Das Caching von Multi-Resultaten ist     | |                          | nicht korrekt implementiert (Quarkus     | |                          | Cache kann kein Multi).                  | |                          |                                          | |                          |   Vor                                    | |                          | teile                          Nachteile | |                          |   ----------                             | |                          | ----------------------- ---------------- | |                          | ---------------------------------------- | |                          |   Einfach                                | |                          |                      Nicht sehr effektiv | |                          |   Out-of-sync f\u00fcr max                    | |                          | . 10 Minuten   Inkonstante Antwortzeiten | |                          |                                          | |                          |                           Multis (Repo-L | |                          | isting, Branches) nicht richtig gecached | |                          |                                          | |                          | Variante 2                               | |                          |                                          | |                          | Die Caching Lifetime resp.               | |                          | Eviction-Strategie soll f\u00fcr die          | |                          | einzelnen Ressourcen individuell         | |                          | definiert und implementiert werden. Die  | |                          | von Bitbucket empfangenen Webhooks       | |                          | sollen als Informationsquelle f\u00fcr die    | |                          | Invalidierung und den allf\u00e4lligen        | |                          | Neuaufbau eines Caches herangezogen      | |                          | werden. \u00dcber die Webhooks wird der       | |                          | Controller proaktiv \u00fcber \u00c4nderungen an   | |                          | einem bestimmten Repo informiert. So     | |                          | kann z.B. der Cache f\u00fcr die Branches     | |                          | oder Tags eines Repos l\u00e4nger vorgehalten | |                          | und erst bei einem Update von Bitbucket  | |                          | invalidiert werden. Um das Risiko von    | |                          | verpassten Webhooks zu vermindern,       | |                          | k\u00f6nnen s\u00e4mtliche Caches periodisch (z.B. | |                          | 1x t\u00e4glich) invalidiert und neu          | |                          | aufgebaut werden.                        | |                          |                                          | |                          | Gleichzeit soll das Caching von Listen   | |                          | (tekton-enabled Repositories, Branches,  | |                          | Tags) korrekt mit den Quarkus Caching    | |                          | Mittlen refactored werden.               | |                          |                                          | |                          |   Vor                                    | |                          | teile                          Nachteile | |                          |   --                                     | |                          | ------------------------------- -------- | |                          | ---------------------------------------- | |                          |                                          | |                          | Optimierte Vorhaltezeit           M\u00f6glic | |                          | her out-of-sync f\u00fcr eine limitierte Zeit | |                          |   Konstant schnelle Antwor               | |                          | tzeiten   Komplexere Invalidierungslogik | |                          |                                          | |                          |           Quarkus 2.7.x Update notwendig | +--------------------------+------------------------------------------+ | Entscheidung             | Variante 2                               | +--------------------------+------------------------------------------+ | Begr\u00fcndung               | Beim Caching besteht eindeutig           | |                          | Handlungs- und Optimierungsbedarf. Die   | |                          | Verwendung von ESTA Tekton und somit     | |                          | auch die Last auf das Bitbucket API wird | |                          | zuk\u00fcnftig sicher zunehmen, so dass ein   | |                          | optimiertes Caching als sinnvoll und     | |                          | notwendig erachtet wird.                 | +--------------------------+------------------------------------------+ | Wer                      | Wallrapp Manuel (IT-PTR-EXT-EXT2 -       | |                          | Extern) Br\u00fcderli Thomas                  | |                          | (IT-PTR-CEN2-SL2)                        | +--------------------------+------------------------------------------+ | Wann                     | 26.01.2022                               | +--------------------------+------------------------------------------+ "}, {"text": "Core Concepts  -   Tekton Pipelines for CI/CD  -   Deployment with ArgoCD      -   Individual ArgoCD instances      -   App of Apps Pattern  -   ESTA Tekton Pipelines  Tekton Pipelines for CI/CD  In ESTA Tekton CI/CD we use Tekton or the OpenShift variant of it in its core. Tekton is available on the dedicated build cluster. For the build and release process ESTA Tekton implements standard pipelines based on Tekton. The Pipelines are started by the ESTA Tekton Controller (see Architecture Overview). Frontend to the builds is Tekton Control Panel. No direct access or deep understanding of Tekton is necessary for the user to operate the build system.  Tekton however is a very powerful tool and the ESTA Tekton build system also allows modifications or extensions to the standard pipelines we provide. It even supports to create completely custom pipelines which are still started and monitored by the controller. If the standardized build process doesn't cover all your needs, we recommend to learn more about Tekton Pipelines and start building your own. In the future it will be possible to overwrite the esta standard pipelines by your own. Of course the Clew team can support you with your needs or feature requests.  [Tekton cat]  Deployment with ArgoCD  For the deployment of the ESTA Tekton CI/CD system we recommend to use ArgoCD with Helm charts to describe the project deployment. Deployment is not an integrated part of Tekton pipelines and thus ArgoCD is only one option to choose, although the preferred one. The build pipelines can create Helm charts and publish them to a Helm repository in Artifactory. ArgoCD can be configured to apply these Helm charts from Artifactory or directly sync charts from a Git repository.  Individual ArgoCD instances  As shown in the Architecture Overview, individual ArgoCD instances are set up on the cluster where your projects are deployed and are just triggered by Tekton to sync after successful builds. The setup and configuration (including access control) is specific to each business unit for maximum flexibility and security.  App of Apps Pattern  ArgoCD promotes the GitOps approach.  So almost all of its configurations should be stored in Git. We recommend to implement the app of apps pattern as described in the ArgoCD documentation.  [Argo]  ESTA Tekton Pipelines  So what are ESTA Tekton Pipelines then?  It's a catalog of standard Tekton pipelines and tasks used to build and deploy SBB projects from a estaTektonPipeline.json definition. Each pipeline definition has a corresponding template (_run.yaml) to start a PipelineRun using a set of parameters. These files are primarily controlled by the ESTA Tekton Controller but can also be applied and run individually. The ESTA Tekton Controller makes sure that all those pipelines with their referenced task definitions are present in the build namespace.  [ESTA Tekton logo] "}, {"text": "Use Secrets in Docker Build Context  Sometimes it's necessary to consume a secret value (e.g. an access key) inside the Dockerfile when building images. Because the Docker build context has no access to the Tekton build task environment, the only way to pass certain environment variables is using build args. In ESTA Tekton, docker build args can be specified with the ocBuildVars property in the docker config block. When it comes to secret values, those shall be stored in a Pipeline Seceret and only be referenced in the ocBuildVars.  Here's how to achieve this:  1.  Add the secret value to a Pipeline Secret under a given key (e.g.     DOCKER_SECRET_KEY)        2.  Define a build argument in your estaTektonPipeline.json:    estaTektonPipeline.json    {    ...    \"docker\": {    \"ocBuildVars\": [    \"SECRET_KEY=$DOCKER_SECRET_KEY\"    ]    }    }  3.  Define the build argument in your Dockerfile and map it into an env     var:    Dockerfile    FROM ...    ARG SECRET_KEY    ENV MY_SECRET_KEY=${SECRET_KEY}  Watch the syntax!  Please be careful on the syntax in the estaTektonPipeline.json: use $VARNAME but not ${VARNAME}. The latter will be considered a pre-defined pipeline parameter and substituted before the pipeline is stated where no env vars from the pipeline secrets are yet available. "}, {"text": "Performanceoptimierung PipelineRuns Listing  +--------------------------+------------------------------------------+ | Fragestellung            | Wie k\u00f6nnen wir die Performance beim      | |                          | Listing von PipelineRuns im Tekton       | |                          | Control Panel verbessern?                | |                          |                                          | |                          | Aktuell wird vom Control Panel via       | |                          | Polling immer die vollst\u00e4ndige Liste     | |                          | aller PipelineRuns vom Backend bezogen,  | |                          | was lange Ladezeiten und viel            | |                          | Datenvolumen zur Folge hat. Prim\u00e4rer     | |                          | Grund daf\u00fcr sind die eingeschr\u00e4nkten     | |                          | Abfrage-M\u00f6glichkeiten von PipelineRuns   | |                          | via Kubernetes API (kein Paging, keine   | |                          | Sortierung, wenig Filter-Attribute). Wir | |                          | m\u00f6chten vom Client nach M\u00f6glichkeit nur  | |                          | Pipeline Runs laden, die sich seit dem   | |                          | letzten Poll ge\u00e4ndert haben.             | |                          |                                          | |                          | Eine Liste von 350 Pipeline Runs         | |                          | ben\u00f6tigt ca. 4 Sekunden Ladezeit. Diese  | |                          | Ladezeit ist ein dringlicher Indikator,  | |                          | dass hier optimiert werden muss. Zudem   | |                          | werden mit dem aktuellen                 | |                          | Update-Mechanismus im Client gel\u00f6schte   | |                          | Pipeline Runs nicht aus der Liste        | |                          | entfernt bis im Browser die App reloaded | |                          | wird. Auch diese Unsch\u00f6nheit soll mit    | |                          | den Optimierungen behoben werden.        | +==========================+==========================================+ | Rahmenbedingung          | -   Datenquelle f\u00fcr das Listing ist      | |                          |     nachwievor Openshift                 | |                          |                                          | |                          | -   Das bestehende API des Controllers   | |                          |     soll keine Breaking Change erfahren  | |                          |     (nur Erweiterungen)                  | +--------------------------+------------------------------------------+ | Annahmen                 | -   Die M\u00f6glichkeiten zur Abfrage von    | |                          |     Ressourcen via Kubernetes API        | |                          |     (fabric8 Library) bleiben            | |                          |     eingeschr\u00e4nkt                        | |                          |                                          | |                          | -   Die Zahl der PipelineRuns wird eher  | |                          |     zu- als abnehmen                     | +--------------------------+------------------------------------------+ | Alternativen / Varianten | Zuerst wurden die Anforderungen an das   | |                          | API zur Abfrage von PipelineRuns         | |                          | definiert. Der Client m\u00f6chte die         | |                          | folgenden Use-Cases abdecken:            | |                          |                                          | |                          | -   Listing aller PipelineRuns           | |                          |                                          | |                          | -   Listing der letzten X PipelineRuns   | |                          |     f\u00fcr ein Repository                   | |                          |                                          | |                          | -   Inkremetelle Updates von             | |                          |     ge\u00e4nderten/gel\u00f6schten Records        | |                          |                                          | |                          | Variante 1                               | |                          |                                          | |                          | Spiegelung der PipelineRuns in einer     | |                          | In-Memory Datenbank.                     | |                          |                                          | |                          | Eine Datendank mit Metadaten von         | |                          | PipelineRuns wird angelegt und vom       | |                          | Controller in Sync gehalten. Dar\u00fcber     | |                          | k\u00f6nnen schnelle Abfragen von Client      | |                          | beantwortet werden. Die f\u00fcr das Listing  | |                          | ben\u00f6tigten DTOs werden komplett in der   | |                          | DB gespeichert und es muss f\u00fcr das       | |                          | Listing keine Abfrage an Openshift       | |                          | gemacht werden. Die Aktualisierung der   | |                          | DB geschieht aufgrund von Kubernetes     | |                          | Events, welche \u00fcber einen Watcher        | |                          | subscribed werden. Beim Start der App    | |                          | werden alle PipelineRuns gelesen und die | |                          | DB bef\u00fcllt.                              | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   ----                                   | |                          | ---------------------------------------- | |                          | -------- ------------------------------- | |                          |   Sc                                     | |                          | hnelle Abfrage nach beliebigen Kriterien | |                          |  m\u00f6glich   Kopie der Daten aus Openshift | |                          |                                          | |                          |                 DB kann out-of-sync sein | |                          |                                          | |                          |                     H\u00f6herer Memorybedarf | |                          |                                          | |                          |                    Gr\u00f6sseres Refactoring | |                          |                                          | |                          | Variante 2                               | |                          |                                          | |                          | Benutzung der Quarkus Cache Funktionen   | |                          | f\u00fcr ein In-Memory Caching                | |                          |                                          | |                          | Die PipelineRunDTOs welche f\u00fcr das       | |                          | Listing ben\u00f6tigt werden, werden \u00fcber     | |                          | eine mit @CacheResult annotierte Methode | |                          | bezogen und k\u00f6nnen so direkt und ohne    | |                          | Abfrage an Openshift ausgegeben werden.  | |                          | Als Index kann direkt der Key-Index des  | |                          | Quarkus Caches benutzt werden. Das       | |                          | Filtering geschieht durch Iteration \u00fcber | |                          | die aus dem Cache gelesenen              | |                          | PipelineRunDTOs. Die Aktualisierung des  | |                          | Caches geschieht aufgrund von Kubernetes | |                          | Events, welche \u00fcber einen Watcher        | |                          | subscribed werden. Beim Start der App    | |                          | werden alle PipelineRuns gelesen und der | |                          | Cache bef\u00fcllt. L\u00f6schungen k\u00f6nnen         | |                          | ebenfalls in diesem Cache registriert    | |                          | und dem Client beim n\u00e4chsten Poll        | |                          | mitgeteilt werden. \u00dcber den Scheduler    | |                          | kann periodisch der Cache geleert und    | |                          | neu aufgebaut werden, um ihn 100% wieder | |                          | in sync zu bringen.                      | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   -------------------------------------- | |                          | ---------- ----------------------------- | |                          |   Schnelle Abfrage aus dem Memory        | |                          |                Partielle Kopie der Daten | |                          |   Anpassung der Filter-Kriterien einfa   | |                          | ch m\u00f6glich   Cache kann out-of-sync sein | |                          |   Mit Quarkus Boardmitteln umse          | |                          | tzbar               H\u00f6herer Memorybedarf | |                          |                                          | |                          | Variante 3                               | |                          |                                          | |                          | Inkrementelle Updates via Websockets an  | |                          | den Client senden                        | |                          |                                          | |                          | Die einzige Datenquelle bleibt Openshift | |                          | und alle Daten werden direkt daraus      | |                          | gelesen. Der Client \u00f6ffnet eine          | |                          | Websocket-Verbindung zum Controller,     | |                          | welcher \u00fcber \u00c4nderungen an PipelineRuns  | |                          | \u00fcber CloudEvent Notifications empf\u00e4ngt   | |                          | und diese direkt an den Client sendet.   | |                          |                                          | |                          |   Vorteile                    Nachteile  | |                          |   --------------------------- -------    | |                          | ---------------------------------------- | |                          |   Kein out-of-sync                       | |                          |            Websockets + Angular unstabil | |                          |   Keine kopierten Daten                  | |                          | Keine Erfahrung mit Websockets + Quarkus | |                          |   Instand-Updates im Client   Inita      | |                          | tialer Load im Client immer noch langsam | +--------------------------+------------------------------------------+ | Entscheidung             | Es wurde Variante 2 gew\u00e4hlt              | +--------------------------+------------------------------------------+ | Begr\u00fcndung               | Ein Caching kann mit den verf\u00fcgbaren     | |                          | Mitteln in Quarkus einfach umgesetzt     | |                          | werden. Nach dem Startup des Controllers | |                          | k\u00f6nnen Anfragen blitzschnell aus dem     | |                          | Cache beantwortet werden. Das Empfangen  | |                          | von Kubernetes Events hat sich in ersten | |                          | Tests als stabil erwiesen und optional   | |                          | kann der Cache periodisch im Hintergrund | |                          | gel\u00f6scht und neu aufgebaut werden. Durch | |                          | die Speicherung der f\u00fcr das Listing      | |                          | verwendeten DTOs im Cache (anstelle der  | |                          | kompletten PipelineRuns) bleibt der      | |                          | Memory-Bedarf \u00fcberschaubar.              | +--------------------------+------------------------------------------+ | Wer                      | Br\u00fcderli Thomas (IT-PTR-SL2) Wallrapp    | |                          | Manuel (IT-PTR-EXT-EXT2 - Extern)        | +--------------------------+------------------------------------------+ | Wann                     | 14.02.2022                               | +--------------------------+------------------------------------------+ "}, {"text": "Tekton Control Panel  -   Authentication  -   Projects and Repositories      -   Scan for Repositories      -   Repositories Overview      -   Repository Details  -   Start Builds and Releases      -   Start a Branch Builds      -   Create a new Release      -   Parametrized Builds (from Version 0.25.x)  -   Monitor Pipeline Runs      -   Pipeline Run Details  -   ESTA Cloud Pipeline Migration Tool  -   User Permissions  -   Pipeline Secrets  -   System Configuration  The Esta Tekton Control Panel is a UI to manage pipeline runs for your tekton-enabled repositories. If not configured otherwise, the URL looks as follows: https://tekton-control-panel-<your-build-namespace>.sbb-cloud.net and is provided after the setup of the Tekton build namespace.  Authentication  When opening the Tekton Control Panel, you'll be automatically authenticated with Azure AD (login.microsoftonline.com). You can individually give access to your Tekton Control Panel through RBT groups.  Projects and Repositories  Your ESTA Tekton system is configured to scan Bitbucket projects for repositories with a estaTektonPipeline.json file. The projects registered in your build namespace are listed here. The control panel also displays the build namespace name (1).  []  Scan for Repositories  You can enforce a re-scan of your projects by clicking the sync button (2). This might detect new repositories which are now tekton-enabled.  Repositories Overview  When clicking a project in the list or by selecting the Repositories menu on the left, all tekton-enabled repositories are listed. The list can be filtered using the selectors above the table (1). Some actions can directly be chosen from the options menu (2) in each row.  []  1.  You can filter repository by name or project. In case you filtered     out some repositories by regular expression from building and     listing, you can select the checkbox to show the filtered out     repositories.  2.  This repository actions can do:      1.  Filter Repository from the list, beeing built, or listed       2.  Show Pipelineruns      3.  Create a tag      4.  Run a build on branch or tag  Repository Details  Click a row in the listing to open the repository details view with more information and actions to execute on that repository.  []  The view lists all branches of the particular repository and the most recent pipeline runs.  These actions are available for the selected repository:  -   (1) Filter the recent pipeline runs to match the selected branch  -   (2) Open the tagging assistant to create a release from the     according branch  -   (3) Start a build for the selected branch with the dialog  -   (4) Start a build for the selected branch without the dialog  -   (5) Switch to the \"Pipelines\" view with this repository selected  -   (6) Manage the pipeline cache, here you can delete the cache if     necessary  Start Builds and Releases  Start a Branch Builds  Build pipelines can be started on a specific branch using the \"Run build\" button. From the dialog, simply select a branch (or a tag) as source and press the \"Execute\" button to start.  []   Pipeline configuration required!  A build pipeline is only started if there's a pipeline configuration in your estaTektonPipeline.json that matches the selected branch (\u2192 branchNamePrefixes) or tag (\u2192 versionTagEventPatterns) and includes the triggerType \"USER\". Otherwise the execution aborts with the error message No matching pipeline config for the given PipelineEvent.  Create a new Release  As described in the ESTA Tekton Workflow section, releases are always based on a Git tag. The Tekton Control Panel includes a guided process to create such a release tag. Click the \"Create new tag\" button on the desired branch to create a release from.  [] []  The tagging assistant will first read the current version (1) from meta files like pom.xml or package.json. It then suggests possible version tags (2) based on the semver pattern. There's also the option to enter a custom tag. If the custom tag already exists, you will not be able to continue the tagging. For Maven-based projects, the assistant also suggests the next development version (3) to be set to the pom.xml file in the selected branch. Click \"Next\" to see a summary of steps the tagging pipeline will take. Press the \"Execute\" button to start the tagging pipeline.  If configured accordingly in estaTektonPipeline.json (\u2192 versionTagEventPatterns), the creation of a Git tag will itself trigger a build pipeline to build the release artifacts.  Parametrized Builds (from Version 0.25.x)  Parametrized builds are now supported. You can start a Tagging Pipeline with Pipeline Parameters, which will be then propagated to each pipeline in the chain. From Tagging \u2192 Build \u2192 Staging.  Also if you build a tag, the controller try to find a previous tagging pipeline and read the parameters from there to display them in the UI. You can then edit the parameters for executing the build. The Staging Pipeline then reads the parameters from the preceding Build Pipeline.  In the screenshot you see an example from a tagging pipeline with Pipeline Parameters configured. At the moment you need to edit the parameters as Json, soon we will deliver an UI for it.  []  To see the \"Parameters\" step, you need configure the parameters block in your estaTektonPipeline.json. Here you can find an example.   \"parameters\": [  {  \"name\": \"test\",  \"type\": \"String\",  \"values\": [\"dev\"],  \"label\": \"Test Parameter\",  \"description\": \"test parameter\",  \"options\": [\"dev\", \"test\", \"prod\"]  },  {  \"name\": \"test2\",  \"type\": \"String\",  \"values\": [\"another default Value\"],  \"description\": \"test parameter\"  }  ],  Monitor Pipeline Runs  The \"Pipelines\" section in the main menu opens a list of current and past pipeline runs on your build namespace.  []  The listing can be filtered by status, project/repository and text search (1) and is sorted in descending order showing the most recent pipeline run on top. It shows the most relevant attributes of pipeline runs including the Git source (2). This can either be a commit, a tag or a branch. Hover on a row to choose an action like opening the logs or the openshift console (3).  Pipeline Run Details  All relevant information regarding a Tekton pipeline run are displayed in the Tekton Control Panel. You can watch the progress of a running pipeline including a live stream of the logs and events, the yaml configuration of the pipeline as well as all pipeline parameters. When finished, the logs are persisted for later investigation or reference.  []  []  This view also provides the action to perform a stop on the given pipeline run. It will stop all processes and set the status to cancelled.  ESTA Cloud Pipeline Migration Tool  When migrating a project previously built with the ESTA Cloud Pipeline to ESTA Tekton, the control panel provides an automatic conversion for existing estaCloudPipeline.json file to estaTektonPipeline.json.  []  Go to the Tools section in the main menu and simply copy and paste your existing estaCloudPipeline.json into the input field (1) and watch the conversion process (2). When successful, the resulting estaTektonPipeline.json can be copied or downloaded (3).  User Permissions  If you setup a new ESTA Tekton Namespace, you usually want to give access rights to a certain users.  User permissions can be granted to Azure AD groups and thus also to RBT groups. We suggest to create designated RBT groups to control access to your Tekton build system.  []  1.  Select the role you want to assign a certain group to  2.  You start typing or paste your Azure AG group name. After you typed     5 letters it shows possible options of groups to select. Select the     group you want to assign the selected role.  3.  You can delete an existing group-role assignment to remove access to     ESTA Tekton  4.  You can display the underlying Azure AD App Registration with all     group-role assignments and other details  ESTA Tekton provides four roles to manage different levels of access to the build system:  -   Admin: All access, including system configuration and user     permission management  -   Edit: Can start, stop, re-run and delete pipelines  -   View: Read-only view to Tekton enabled repositories and pipelines  -   Support: Required access to give technical support about ESTA Tekton  Azure Ad Group Openshift Sync  From Release 0.12.0 on the setup Azure Ad Groups will be synced towards your Openshift Tekton namespace (Apart from the Groups DG IT (1 Intern) and DG IT (2 Extern)). You will then have the same access rights in the Openshift Console as you have in the Esta-Tekton-Ui.    Let us support you!  Please assign the DG_RBT_ESTA group to either the Support or the Admin role. This helps us (the ESTA team) to help you in case you get stuck with Tekton.  Pipeline Secrets  If you want to configure your project specific secrets you can view, edit or create them for your build namespace.  []  Here you see an overview with general informations about each secret.  1.  If you want to create a new secret, you click on the \"Create Secret\"     button in the upper-right corner.  2.  If you want to edit or delete a secret, you can hover on a secret     and select either \"Delete\" or \"Edit Secret\"  Create new secret  []  1.  You have to define the name of the new pipeline secret.  2.  You can add a key to the new secret.  3.  You can give each key its value.  4.  If you don't need a Key / Value Pair you can delete it by clicking     on the trash icon.  5.  If you need more Key / Value Pair you can add new ones by clicking     on \"Add Key / Value Pair\".  6.  Click on the \"Save\" button in order to create the secret.  Edit secret  []  1.  You can edit the existing Key.  2.  You can edit the value given to the key.  3.  If you no longer need the Key / Value Pair you can delete it by     clicking on the trash icon.  4.  If you need a new Key / Value Pair you can add one by clicking on     \"Add Key / Value Pair\".  5.  You must click on the \"Save\" button to save your changes.  You can't edit the name of the secret.  System Configuration   []  1.  You can edit here your Bitbucket and Artifactory access credentials  2.  You can force the import of the template repos, for example if you     made a change in your custom templates. If you open the Accordion,     you can see each status of the imported template.  3.  You can invalidate the caches in case you face some weird behavior,     which might have to do with caches.  4.  Here you can exclude or include repositories by regex patterns.     After you entered your value you need to hit Enter to create a     'chip' and save it. The Caches for the repositories will be     refreshed with the new filter settings.  "}, {"text": "Cluster Setup f\u00fcr ESTA Tekton  Um einen OpenShift Cluster f\u00fcr ESTA Tekton \"ready\" zu machen, sind die folgenden Punkte zu erf\u00fcllen:  +---------+------+---------+---------+---------+--------+---------+ | Task    | Wer? | Wie?    | clew01d | a       | aws01t | trs01t  | |         |      |         |         | zure01d |        |         | +=========+======+=========+=========+=========+========+=========+ | Batch   | CON  | ocp-    | :tick:  | :tick:  | :tick: | :tick:  | | Nodes   |      | argocd: |         |         |        |         | | (mit    |      | Zus\u00e4    |         |         |        |         | | auto-s  |      | tzliche |         |         |        |         | | caling) |      | Cluster |         |         |        |         | | konfig  |      | Gruppe  |         |         |        |         | | urieren |      | \"cluste |         |         |        |         | |         |      | r/batch |         |         |        |         | |         |      | -nodes\" |         |         |        |         | |         |      | im      |         |         |        |         | |         |      | ins     |         |         |        |         | |         |      | tances/ |         |         |        |         | |         |      | <stage> |         |         |        |         | |         |      | /cluste |         |         |        |         | |         |      | rs.yaml |         |         |        |         | |         |      | hin     |         |         |        |         | |         |      | zuf\u00fcgen |         |         |        |         | |         |      | In      |         |         |        |         | |         |      | Cluste  |         |         |        |         | |         |      | r-spezi |         |         |        |         | |         |      | fischen |         |         |        |         | |         |      | Values  |         |         |        |         | |         |      | Inst    |         |         |        |         | |         |      | anz-Typ |         |         |        |         | |         |      | der     |         |         |        |         | |         |      | Batch   |         |         |        |         | |         |      | Nodes   |         |         |        |         | |         |      | def     |         |         |        |         | |         |      | inieren |         |         |        |         | |         |      | Via CON |         |         |        |         | |         |      | ArgoCD  |         |         |        |         | |         |      | sy      |         |         |        |         | |         |      | nchroni |         |         |        |         | |         |      | sieren. |         |         |        |         | +---------+------+---------+---------+---------+--------+---------+ | Op      | ESTA | ocp-    | :tick:  | :tick:  | :tick: | :tick:  | | enShift |      | argocd: |         |         |        |         | | Pi      |      | Zus\u00e4    | :tick:  | :tick:  | :tick: | :w      | | pelines |      | tzliche |         |         |        | arning: | | O       |      | Cluster | :tick:  | :tick:  | :tick: |         | | perator |      | Gruppe  |         |         |        | :w      | | instal  |      | \"       |         |         |        | arning: | | lieren, |      | applica |         |         |        |         | |         |      | tions/e |         |         |        |         | | ESTA    |      | sta-tek |         |         |        |         | | Tekton  |      | ton-bui |         |         |        |         | | Cluste  |      | ld-cont |         |         |        |         | | rRollen |      | roller\" |         |         |        |         | | er      |      | im      |         |         |        |         | | stellen |      | ins     |         |         |        |         | |         |      | tances/ |         |         |        |         | | Na      |      | <stage> |         |         |        |         | | mespace |      | /cluste |         |         |        |         | | Config  |      | rs.yaml |         |         |        |         | | uration |      | hinz    |         |         |        |         | | O       |      | uf\u00fcgen. |         |         |        |         | | perator |      | Nach    |         |         |        |         | | ESTA    |      | dem     |         |         |        |         | | Tekton  |      | A       |         |         |        |         | | Conf    |      | pproval |         |         |        |         | | uration |      | durch   |         |         |        |         | | anlegen |      | CON     |         |         |        |         | |         |      | mergen  |         |         |        |         | |         |      | und via |         |         |        |         | |         |      | CON     |         |         |        |         | |         |      | ArgoCD  |         |         |        |         | |         |      | s       |         |         |        |         | |         |      | ynchron |         |         |        |         | |         |      | isieren |         |         |        |         | |         |      | Zus     |         |         |        |         | |         |      | \u00e4tzlich |         |         |        |         | |         |      | muss    |         |         |        |         | |         |      | CON     |         |         |        |         | |         |      | \"outco  |         |         |        |         | |         |      | ld-coll |         |         |        |         | |         |      | ectord\" |         |         |        |         | |         |      | und     |         |         |        |         | |         |      | \"names  |         |         |        |         | |         |      | pace-co |         |         |        |         | |         |      | nfigura |         |         |        |         | |         |      | tion-op |         |         |        |         | |         |      | erator\" |         |         |        |         | |         |      | s       |         |         |        |         | |         |      | ynchron |         |         |        |         | |         |      | isieren |         |         |        |         | +---------+------+---------+---------+---------+--------+---------+ | Self-   | CON  | clew    | :tick:  | :tick:  | :tick: |         | | Service |      | -self-s |         |         |        |         | | f\u00fcr     |      | ervice- |         |         |        |         | | Tekton  |      | argocd: |         |         |        |         | | P       |      | Feature |         |         |        |         | | rojekte |      | \"esta   |         |         |        |         | | akt     |      | tekton\" |         |         |        |         | | ivieren |      | in dem  |         |         |        |         | |         |      | CON     |         |         |        |         | |         |      | backend |         |         |        |         | |         |      | Co      |         |         |        |         | |         |      | nfigMap |         |         |        |         | |         |      | t       |         |         |        |         | |         |      | emplate |         |         |        |         | |         |      | hinz    |         |         |        |         | |         |      | uf\u00fcgen. |         |         |        |         | |         |      | Via     |         |         |        |         | |         |      | CLEW    |         |         |        |         | |         |      | ArgoCD  |         |         |        |         | |         |      | sy      |         |         |        |         | |         |      | nchroni |         |         |        |         | |         |      | sieren. |         |         |        |         | +---------+------+---------+---------+---------+--------+---------+ | Neuer   | ESTA |         | :tick:  | :tick:  | :tick: |         | | Cluster |      |         |         |         |        |         | | in      |      |         |         |         |        |         | | es      |      |         |         |         |        |         | | ta-apps |      |         |         |         |        |         | | -argocd |      |         |         |         |        |         | | e       |      |         |         |         |        |         | | rfassen |      |         |         |         |        |         | +---------+------+---------+---------+---------+--------+---------+ | ArgoCD  | ESTA |         | :tick:  | :tick:  | :tick: |         | | Instanz |      |         |         |         |        |         | | cl      |      |         |         |         |        |         | | ew-esta |      |         |         |         |        |         | | -argocd |      |         |         |         |        |         | | au      |      |         |         |         |        |         | | fsetzen |      |         |         |         |        |         | +---------+------+---------+---------+---------+--------+---------+ "}, {"text": "OpenShift-Helm-Migration  During the migration from OpenShift templates to Helm charts you need to take care of some details. In the following a summary of our findings.  Helm-Chart-Converter  The ESTA-Helm-Chart-Converter is very useful for the heavy lifting but some details needs to be checked a/o modified by hand. The conversion in general is done like this:  \u00bb cd <path-to-project-to-migrate>/openshift  \u00bb <path-to-extracted-converter>/bin/esta-openshift-to-helm \\  defaults/app.yaml \\  <projektname> \\  -dv defaults/config.list \\  -sv <stage-1>=<stage-1>/config.list \\  -sv <stage-2>=<stage-2>/config.list \\  -sv <stage-n>=<stage-n>/config.list  So it might look like this:    \u00bb /mnt/c/devsbb/apps/esta-openshift-to-helm-0.2.4-SNAPSHOT/bin/esta-openshift-to-helm \\  defaults/app.yaml \\  playground \\  -dv defaults/config.list \\  -sv kihub-rt=kihub-rt/config.list \\  -sv kihub-rt_otc_test_07=kihub-rt_otc_test_07/config.list \\  -sv kihub-test=kihub-test/config.list \\  -sv kihub-test_otc_test_07=kihub-test_otc_test_07/config.list \\  -sv kihub-prod=kihub-prod/config.list \\  -sv kihub-prod_otc_asterix=kihub-prod_otc_asterix/config.list  ----------------  Chart name: playground  default values: defaults/config.list  stage values: [kihub-rt=kihub-rt/config.list, kihub-rt_otc_test_07=kihub-rt_otc_test_07/config.list, kihub-test=kihub-test/config.list, kihub-test_otc_test_07=kihub-test_otc_test_07/config.list, kihub-prod=kihub-prod/config.list, kihub-prod_otc_asterix=kihub-prod_otc_asterix/config.list]  output directory: generated-charts  ----------------  Checking for properties file defaults/config.list  Not overriding value REPLICAS with current content 1 with new value 1 from defaults/config.list  Checking for properties file kihub-rt/config.list  Checking for properties file kihub-rt_otc_test_07/config.list  Checking for properties file kihub-test/config.list  Checking for properties file kihub-test_otc_test_07/config.list  Checking for properties file kihub-prod/config.list  Checking for properties file kihub-prod_otc_asterix/config.list  Converting Deployment template  Converting Route template  Converting Route template  Converting Route template  Converting Route template  Converting Route template  Converting Route template  Converting Route template  Converting Route template  Converting Route template  Dumping chart for playground to generated-charts/playground/Chart.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values-kihub-rt.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values-kihub-rt_otc_test_07.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values-kihub-test.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values-kihub-test_otc_test_07.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values-kihub-prod.yaml  Dumping values for generated-charts/playground to generated-charts/playground/values-kihub-prod_otc_asterix.yaml  Dumping #1 objects of kind Deployment to file 'generated-charts/playground/templates/Deployment.yaml'  Dumping #9 objects of kind Route to file 'generated-charts/playground/templates/Route.yaml'  Dumping #1 objects of kind Service to file 'generated-charts/playground/templates/Service.yaml'  Creating helper file 'generated-charts/playground/templates/_helpers.tpl' with sample helper function  -----ATTENTION-----  Some properties have changed type in Helm  An example is the 'replicas' flag, which now has to be an unquoted int  Please check your values-files and any templates where the value is referenced  Appologies for the inconvenience  ^^^^^ATTENTION^^^^^  After that the generated Helm charts needs to be moved to the proper location:  \u00bb mv generated-charts ../charts  Now some details needs to be fixed on the generated files:  -   Replicas must be given as integer instead of string, so you need to     remove the single quotes  -   ~~Wrong version property key on the image tag must be fixed~~ fixed:     [CLEW-13271] OCP-Helm-Converter generiert falsches     Image-Version-Property - Flow (sbb.ch)  Migration of already existing Deployments  If an application is already deployed, it cannot be managed by Helm out of the box. In fact Helm requires some Labels and Annotations, which are missing if the application was deployed using another deployment approach (like using the traditional ESTA cloud pipeline). Because of this there are two approaches on how to go ahead:  a) Remove the app on OpenShift completely: DeploymentConfig, Service, Routes and ConfigMaps. After that the Helm based deployment is some kind of a \"restart\" of that app on OpenShift.  or  b) add Labels und Annotations manually to the DeploymentConfig, the Service, all Routes and ConfigMaps on the already existing application right on OpenShift:  -   Label:     app.kubernetes.io/managed-by: Helm  -   Annotations:   -   meta.helm.sh/release-name: <application>    meta.helm.sh/release-namespace: <namespace>  -   If you deploy using Helm now, you have the Helm Deployment parallel     to the previous deployment, as the previous one is a so called     \"DeploymentConfig\". This is a special OpenShift feature, which is     not required/used anymore, so the DeploymentConfig can be removed     afterwards.  As it is neccessary to remove the DeploymentConfig after the first Helm deployment, approach a) is suggested. But keep in mind that this approach includes a downtime of you application! "}, {"text": "Tekton Build Credentials Exchange via Vault  Mit diesem PoC wollen wir die M\u00f6glichkeit skizzieren, die Secrets f\u00fcr den Zugriff von Tekton auf Bitbucket und Artifactory transparent im jeweiligen Tekton Namespace anzulegen, ohne dass der Abnehmer damit in Ber\u00fchrung kommen muss.  F\u00fcr erste Tests wurde ein Vault Namespace auf NonProd f\u00fcr ESTA registriert: https://vault-nonprod.sbb.ch/ui/vault/secrets/kv/list/esta/openshift/  Lese-Zugriff sollte f\u00fcr alle Mitglieder von DG_RBT_ESTA funktionieren, Schreib-Zugriff ist f\u00fcr DG_RBT_ESTA_ADMIN registriert. F\u00fcr das Login in Vault muss man zuerst die Mitgliedschaft in den Gruppen DG_RBT_HASHICORPVAULT_USER_NONPROD resp. DG_RBT_HASHICORPVAULT_USER_PROD beantragen (via rbt.sbb.ch).  Die M2M Authentifizierung geschieht \u00fcber einen spezifischen Service Account im jeweiligen Namespace (siehe JWT Authentication). F\u00fcr den Test auf clew01d / esta-tekton-predev haben wir einen Service Account vault-auth-tekton erstellt und registriert.  Das Secret in Vault hat die folgende Struktur (JSON):  esta/openshift/esta-tekton-predev/bitucket-user-credentials  {  \"username\": \"esta-build-clew\",  \"password\": \"xxxxxx\",  \"ssh-privatekey\": \"-----BEGIN OPENSSH PRIVATE KEY-----\\n....\\n-----END OPENSSH PRIVATE KEY-----\\n\"  }  Nun k\u00f6nnen mit dem folgenden Ressourcen die Bitbucket User Credentials unter dem Pfad esta/openshift/esta-tekton-predev/bitucket-user-credentials in den Namespace esta-tekton-predev synchronisiert werden:    apiVersion: external-secrets.io/v1beta1  kind: SecretStore  metadata:  name: vault-secretstore-nonprod  namespace: esta-tekton-predev  spec:  provider:  vault:  auth:  jwt:  kubernetesServiceAccountToken:  audiences:  - 'https://kubernetes.default.svc'  expirationSeconds: 600  serviceAccountRef:  name: vault-auth-tekton  path: aws_clew01d  role: default  path: kv  server: 'https://vault-nonprod.sbb.ch/'  version: v2  ---  apiVersion: external-secrets.io/v1beta1  kind: ExternalSecret  metadata:  name: esta-tekton-basicauth-git-sync  namespace: esta-tekton-predev  spec:  data:  - secretKey: username  remoteRef:  key: esta/openshift/esta-tekton-predev/bitucket-user-credentials  property: username  - secretKey: password  remoteRef:  key: esta/openshift/esta-tekton-predev/bitucket-user-credentials  property: password  refreshInterval: 30s  secretStoreRef:  kind: SecretStore  name: vault-secretstore-nonprod  target:  creationPolicy: Owner  deletionPolicy: Retain  name: esta-tekton-basicauth-git-vault  template:  type: kubernetes.io/basic-auth  metadata:  annotations:  tekton.dev/docker-0: 'https://*.docker.bin.sbb.ch'  tekton.dev/docker-1: 'https://docker.bin.sbb.ch'  data:  username: \"{{ .username }}\"  password: \"{{ .password }}\"  ---  apiVersion: external-secrets.io/v1beta1  kind: ExternalSecret  metadata:  name: esta-tekton-ssh-git-sync  namespace: esta-tekton-predev  spec:  data:  - secretKey: privatekey  remoteRef:  key: esta/openshift/esta-tekton-predev/bitucket-user-credentials  property: ssh-privatekey  refreshInterval: 30s  secretStoreRef:  kind: SecretStore  name: vault-secretstore-nonprod  target:  creationPolicy: Owner  deletionPolicy: Retain  name: esta-tekton-ssh-git-vault  template:  type: kubernetes.io/ssh-auth  metadata:  annotations:  tekton.dev/git-0: code.sbb.ch  tekton.dev/git-1: codessh.sbb.ch  data:  known_hosts: |  [code.sbb.ch]:7999 ssh-rsa xxxxx  [codessh.sbb.ch]:7999 ssh-rsa xxxxx  [10.241.17.8]:7999 ssh-rsa xxxxx  ssh-privatekey: \"{{ .privatekey }}\"  Tekton Namespace Setup  Damit beim Bestellen eines Tekton Namespace die Credentials autom. via Vault in den Namespace gelangen sind die folgenden Schritte notwendig:  -   Bitbucket User mit Credentials anlegen und in Vault speichern (\u2192 WZU     Backend)  -   OpenShift Namespace anlegen (\u2192 CON Backend)  -   Service Account in OpenShift anlegen (\u2192 ??)  -   Service Account f\u00fcr JWT Auth in Vault registrieren (\u2192 Vault Backend)  -   SecretStore und ExternalSecret Ressources anlegen (\u2192     esta-tekton-pipeline-config Helm Chart) "}, {"text": "Azure AD App Registration Prozess  Die Authentifizierung am Tekton Control Panel und am Controller API erfolgt \u00fcber das Microsoft Login (SSO). Grundlage daf\u00fcr ist eine App Registration, welche \u00fcber das IAM API angelegt und gepflegt wird. Jede ESTA Tekton Instanz ben\u00f6tigt ihre eigene App Registration. Die automatisierte Erstellung einer App Registration ist bereits Teil des ESTA Tekton Setups und wird \u00fcber das esta-tekton-pipeline-config Helm Chart konfiguriert und mit einen Taskrun ausgef\u00fchrt.  F\u00fcr die Kommunikation mit dem Azure AD API wurden bisher statisch definierte Credentials verwendet, welche f\u00fcr alle Tekton Namespaces identisch sind und auch in jedem Namespace als Secret hinterlegt sind. Der App Registration Prozess soll nun auch die automatisierte Erstellung einer individuellen APIM Application f\u00fcr Azure AD pro Tekton Namespace beinhalten. Der Setup Prozess sieht dann wie folgt aus:  1.  APIM Application f\u00fcr Azure AD erstellen     (via ArgoCD mit APIM Credentials im ArgoCD Namespace hinterlegt)  2.  Client ID und Secret f\u00fcr Azure AD API als Secret     azure-ad-client-credentials im Tekton Namespace anlegen     (diese werden vom Controller auch f\u00fcr die Manipulation von     group-role Assignments verwendet)  3.  Azure AD App Registration via API registrieren     (mit den Credentials aus Secret azure-ad-client-credentials)  4.  Client ID in Secret esta-tekton-oauth-client-ids speichern  5.  ESTA Tekton Controller startet mit Values aus     azure-ad-client-credentials und esta-tekton-oauth-client-ids  Scripts f\u00fcr das Erstellen einer Azure AD Application via APIM API (1. und 2.)  (Client ID und Secret f\u00fcr das APIM API sind in ESTA Passwords hinterlegt)  create-azure-app.sh  #!/bin/bash  set -e  TEKTON_NAMESPACE=\"$1\" # provide the Tekton namespace as argument  APIM_ACCOUNT_ID=\"603\"  APIM_API_URL='https://api-backend.api.sbb.ch:443'  OAUTH_URL='https://sso.sbb.ch/auth/realms/SBB_Public/protocol/openid-connect/token'  CLIENT_ID='<apim-app-id>'  CLIENT_SECRET='<apim-app-secret>'  if [ -z \"${TEKTON_NAMESPACE}\" ]; then  echo \"Missing TEKTON_NAMESPACE argument. Aborting.\"  exit 1  fi  ##  ## Authenticate to APIM API  ##  AUTH_TOKEN=$(curl -s -X POST ${OAUTH_URL} \\  -H 'Content-Type: application/x-www-form-urlencoded' \\  -d grant_type=client_credentials \\  -d client_id=${CLIENT_ID} \\  -d client_secret=${CLIENT_SECRET} \\  | grep -o -E '\"access_token\":\"[^\"]+\"' | cut -f 2 -d \":\" | tr -d '\"\\n')  echo \"Successfully obtained created an APIM access token\"  ##  ## Create an APIM Azure AD Application  ##  cat > azure-app-request.json <<EOL  {  \"serviceId\": 163,  \"planId\": 1114,  \"name\": \"ESTA Tekton Azure AD ($TEKTON_NAMESPACE)\",  \"description\": \"Managing Azure AD App Registrations for ESTA Tekton\",  \"oauthFlow\": \"clientCredentials\",  \"authProvider\": \"AZURE_AD\",  \"megaId\": \"FEE502DB61786599\"  }  EOL  HTTP_STATUS=$(curl -sk -X POST \"${APIM_API_URL}/accounts/${APIM_ACCOUNT_ID}/applications\" \\  -H \"Accept: application/json\" \\  -H \"Authorization: Bearer ${AUTH_TOKEN}\" \\  -H \"Content-Type: application/json\" \\  -d '@azure-app-request.json' \\  -o azure-app-response.json \\  -w \"%{http_code}\")  if [[ ${HTTP_STATUS} -gt 299 ]]; then  echo \"App creation request failed with error $HTTP_STATUS\"  exit 2  fi  # extract application client ID and secret  APP_CLIENT_ID=$(jq -r .applicationId azure-app-response.json)  APP_CLIENT_SECRET=$(jq -r .secret azure-app-response.json)  echo \"New Application with ID $APP_CLIENT_ID created\"  ##  ## Create azure-ad-client-credentials secret  ##  cat > azure-ad-client-credentials.yaml <<EOL  kind: Secret  apiVersion: v1  metadata:  name: azure-ad-client-credentials  namespace: $TEKTON_NAMESPACE  type: Opaque  stringData:  clientId: '$APP_CLIENT_ID'  clientSecret: '$APP_CLIENT_SECRET'  scope: 'api://azure_ad_api.prod/.default'  tokenEndpoint: 'https://login.microsoftonline.com/2cda5d11-f0ac-46b3-967d-af1b2e1bd01a/oauth2/v2.0/token'  EOL  echo \"Successfully created secret azure-ad-client-credentials.yaml\"  # wait a bit for the new application to become active  sleep 90  # wait a bit for the new application to become active  sleep 20  ##  ## Test the app credentials  ##  RETRIES=0  AUTH_TOKEN=\"\"  while [ -z \"${AUTH_TOKEN}\" ] && [ $RETRIES -lt 20 ]; do  AUTH_TOKEN=$(curl -fs -X POST https://login.microsoftonline.com/2cda5d11-f0ac-46b3-967d-af1b2e1bd01a/oauth2/v2.0/token \\  -H 'Content-Type: application/x-www-form-urlencoded' \\  -d grant_type=client_credentials \\  -d client_id=\"${APP_CLIENT_ID}\" \\  -d client_secret=\"${APP_CLIENT_SECRET}\" \\  -d scope='api://azure_ad_api.prod/.default' \\  | grep -o -E '\"access_token\":\"[^\"]+\"' | cut -f 2 -d \":\" | tr -d '\"\\n')  RETRIES=$[$RETRIES+1]  if [ -z \"${AUTH_TOKEN}\" ]; then  echo \"No access access token obtained, retry #${RETRIES} in 10 seconds...\"  sleep 10  fi  done  if [ -z \"${AUTH_TOKEN}\" ]; then  echo \"Failed to obtain access token :-(\"  exit 1  fi  echo \"Querying registered applications:\"  curl -fsv -X 'GET' \\  'https://azure-ad.api.sbb.ch/v1/applications?displayNameStartsWith=SBB%20ESTA%20Tekton&listOnlyOwnApps=true' \\  -H 'accept: application/json' \\  -H \"Authorization: Bearer $AUTH_TOKEN\"  echo \"\"  echo \"All done.\"  Migration  F\u00fcr bestehende Tekton Namespaces sollten optimalerweise ebenfalls individuelle APIM Applications und neue App Registrations erstellt werden. Im Taskrun, welcher die App Registration ausf\u00fchrt, werden in einem ersten Schritt die bestehenden Group-Role-Assignments gelesen und in die statische App Registration YAML gepatched. F\u00fcr die Migration muss also die neue API Application ID als owner in die bestehenden App Registrations eingetragen werden. Diese Modifikation muss mit den alten globalen API Credentials erfolgen. Die vollst\u00e4ndige Migration erfolgt also in zwei Schritten:  1.  Re-Assign App Registration mit neuer APIM Application als Owner      1.  Copy azure-ad-client-credentials Secret      2.  Erstellen der APIM Application      3.  Download der App Registration (JSON)      4.  Hinzuf\u00fcgen der neuen APIM Application als Owner      5.  Upload der App Registration (JSON)  2.  Entfernen der alten APIM Application als Owner      1.  Download der App Registration (JSON)      2.  Entfernen der alten APIM Client ID als Owner      3.  Upload der App Registration (JSON)      4.  Entfernen des alten statischen azure-ad-client-credentials         Secret (Copy)  reassign-app-registration.sh  #!/bin/bash  # authenticate to Azure API (with old APIM client)  CLIENT_ID='<azure-ad-client-id>'  CLIENT_SECRET='<azure-ad-client-secret>'  AUTH_TOKEN=$(curl -sf -X POST https://login.microsoftonline.com/2cda5d11-f0ac-46b3-967d-af1b2e1bd01a/oauth2/v2.0/token \\  -H 'Content-Type: application/x-www-form-urlencoded' \\  -d grant_type=client_credentials \\  -d client_id=\"${CLIENT_ID}\" \\  -d client_secret=\"${CLIENT_SECRET}\" \\  -d scope='api://azure_ad_api.prod/.default' \\  | grep -o -E '\"access_token\":\"[^\"]+\"' | cut -f 2 -d \":\" | tr -d '\"\\n')  if [ -z \"$AUTH_TOKEN\" ]; then  echo \"Failed to authenticate!\"  exit 22  else  echo \"Got access token for azure_ad_api.prod\"  fi  # export app registration  APP_REG_CLIENT_ID=\"$1\" # pass client ID to patch as argument  NEW_CLIENT_ID='<new-tekton-azure-ad-client-id>'  curl -sf -X 'GET' \\  \"https://azure-ad.api.sbb.ch/v1/app-configs/json?clientId=${APP_REG_CLIENT_ID}\" \\  -H 'Accept: application/json' \\  -H \"Authorization: Bearer $AUTH_TOKEN\" \\  -o existing-app-registration.json  echo \"Downloaded app registration to existing-app-registration.json\"  # add new client as owner # remove old client ID and add new client as owner  jq \".appRegistrations[0].owners = (.appRegistrations[0].owners | map(select(.clientId // \"\" | contains(\\\"${APP_REG_CLIENT_ID}\\\") | not)) + [{\\\"clientId\\\":\\\"${NEW_CLIENT_ID}\\\"}]\" existing-app-registration.json > updated-app-registration.json  # upload patched app registration  curl -sf -X 'POST' \\  \"https://azure-ad.api.sbb.ch/v1/app-configs/json\" \\  -H 'accept: application/json' \\  -H 'Content-Type: application/json' \\  -H \"Authorization: Bearer $AUTH_TOKEN\" \\  -d @updated-app-registration.json  echo \"\"  echo \"Successfully updated app registration for client $APP_REG_CLIENT_ID\" "}, {"text": "Advanced Topics  -   Custom Pipelines      -   Custom Pipeline Templates in Project Repository      -   Import Custom Pipelines from your own Repository      -   Integration in estaTektonPipeline.json      -   Pipeline Parameters      -   Example  -   Custom Pipeline Tasks  -   Start-Pipeline Task (ready in future version 0.29.0)  -   Environment Variables in Pipeline Tasks      -   Expose env variables to Docker build context  -   Java and Maven Versions  -   Using Buildpacks  -   SonarCloud Test Coverage with JaCoCo  -   Using ssh for git operations in your custom task      -   Generate a new ssh key      -   Add Public Key to Bitbucket User esta-build-xyz      -   Add Git SSH Secret to the desired Tekton Namespace  -   Using Testcontainers      -   Known issues and troubleshooting  Custom Pipelines  Although the ESTA Tekton pipelines work out-of-the box with build stacks like Spring Boot, Angular and Go it's obvious that we do not cover all use-cases and workflows. One of the big advantages of using Tekton is the ability to create and run individual pipelines and thereby use existing tasks from ESTA Tekton or from the public Tekton Catalog. Create your completely custom build pipelines while still taking advantage of the ESTA Tekton Controller and its neat integration with Bitbucket.  Custom Pipeline Templates in Project Repository  Templates for custom pipelines or PipelineRuns respectively are stored directly within the repository along with the estaTektonPipeline.json file which references them.  As a convention, the PipelineRun templates shall be saved in the \"tekton\" folder and should be \"self-contained\". That means they'll be started by the ESTA Tekton Controller via an oc process -f <file> command with parameters extracted from the repository data and Git event. They preferably contain an inline pipeline definition with pipelineSpec, as shown in this example. This guarantees the execution of a custom pipeline with the right version from the according Git branch, tag or revision. A good point to start is to copy this template which is a bare minimum pipeline template.  Import Custom Pipelines from your own Repository  Custom pipelines and tasks can also be managed in a separate Git repository and made available in your own build namespace. Pipelines are then referenced by name instead of their filename. This general import of tasks and pipelines from additional repositories also allows to overwrite default tasks and pipelines defined by the ESTA Tekton system.  A list of Git repositories to import pipelines from can be added to the Tekton Build Namespace Config via a CLEW-Ticket with an additional parameter in the ArgoCD application definition:  esta-tekton-pipeline-config values.yaml addition  esta-tekton-pipeline-controller:  additionalTemplateRepos:  - https://code.sbb.ch/scm/kd_esta_test/esta-tekton-pipeline-custom-templates.git?at=refs/heads/master  Use fully qualified HTTP urls to the Git repository and denote the desired branch/tag/revision with the \"at\" query parameter.  From each repository .yaml files from the folders tasks and pipelines are periodically imported by the ESTA Tekton Controller. See this repository for some examples.  Integration in estaTektonPipeline.json  The use of custom pipelines instead of default ESTA Tekton pipelines is controlled with the pipeline configuration in estaTektonPipeline.json. Use the custom property to provide a custom pipeline specification.  A custom pipeline is referenced by either one of the following properties:    \"pipelineTemplate\": \"<name or file of pipelinerun template>\"   \"pipelineRef\": \"<name of pipeline>\"  pipelineTemplate refers to an OpenShift Template, which contains a PipelineRun object and any additional resources like PVCs, ConfigMaps, etc. if the property value ends with .yaml the according file within the \"tekton\" folder of the repository is used. Otherwise the value is considered a template name already present in the build namespace.  If instead the pipelineRef property is used in the pipeline configuration it is interpreted as a reference to a Pipeline resource stored in the Openshift build namespace. It'll be started using a default template.  Pipeline Parameters  The custom pipeline specification can define additional parameters which are passed to the pipelinerun template:  \"params\": {   \"VERSION_TAG\": \"snapshot.${DATE}\",   \"IMAGE_LABELS\": \"buildtype=snapshot\" }  The parameter values can contain interpolated strings which will be replaced with globally defined parameters (${PARAM_NAME}) or with values from estaTektonPipeline.json (${/json/pointer}).  Example  Here's an example of a pipeline configuration in estaTektonPipeline.json starting a custom pipeline:  Custom Pipeline definition  {  \"name\": \"custom-snapshot\",  \"enabled\": true,  \"triggerType\": [  \"GITEVENT\",  ],  \"branchNamePrefixes\": [  \"master\"  ]  \"custom\": {  \"pipelineTemplate\": \"custom-build-pipeline-run-template.yaml\",  \"params\": {  \"IMAGE_TAG\": \"snapshot.${DATE}\",  \"APP_NAME\": \"${/stages/1/argoCD/argoCdAppName}\"  }  }  }  Experimental  Please note that the custom pipelines feature is still experimental and subject to changes.  Custom Pipeline Tasks  In order to comply with the many requirements for customizing the standardized pipelines that come with ESTA Tekton, additional tasks can be injected into the build pipelines via pipeline configuration of estaTektonPipeline.json. With this powerful feature one can extend the Tekton pipelines using building blocks from the ESTA Tekton task catalog or even with custom Tekton tasks from your own repository.  Pipeline configuration with custom tasks  {  ...  \"pipelines\": [  {  \"name\": \"release\",  ...  \"tasks\": [  {  \"name\": \"s3-push\",  \"taskRef\": \"esta-s3-push\",  \"params\": {  \"BUCKET_URL\": \"s3://test-bucket/static-www\",  \"SOURCE_DIR\": \"./dist\",  \"AWS_REGION\": \"us-east-1\",  \"AWS_CREDENTIALS_SECRET\": \"pipeline-env-aws-credentails\"  },  \"runAfter\": \"quality-gate-check\",  \"runBefore\": \"maven-deploy\"  }  ]  }  ]  }  In this this example, the additional task \"esta-s3-push\" from the ESTA Tekton task catalog is inserted into the pipeline to run after the quality-gate-check and before the maven-deploy task. The parameters expected by the task are provided right in the pipeline config and can also inherit values from other parameters using interpolated strings. See the parameter documentation for detailed explanations of all properties.  []  Conventions for custom Tekton tasks  When creating your own custom Tekton tasks, the following conventions must be adhered to:  -   Defines exactly one workspace named \"source\"  -   Only accepts parameters of type \"string\"  -   Docker images used must be referenced via docker.bin.sbb.ch  Executing custom taks in the finally section  Tekton pipelines have a finally section where tasks are guaranteed to be executed in parallel after all PipelineTasks under tasks have completed regardless of success or error. In order to place a task in the finally section use the executionMode property with the value \"FINALLY\". By default, custom tasks in finally are only executed if the pipeline terminated successfully. Use the runCondition property as described in the the parameter documentation if your tasks should run always or on failure. The runBefore and runAfter properties are not allowed for finally tasks.  The use of custom tasks requires some basic knowledge of Tekton and the structure of the ESTA Tekton pipelines, namely the names of the existing tasks in order to inject the custom tasks before/after them and the pipeline workspace. A good point to start is to copy the generic esta-custom-exec task.  Start-Pipeline Task (ready in future version 0.29.0)  If you want to start another pipeline in your repository or another repository managed by the same Esta-Tekton instance, you can inject a new task into your pipeline configuration in your estaTektonPipeline.json.  Be aware, that the to be triggered pipeline config must have the triggerType: USER to be able to be started.  \"pipelines\": [  {  \"name\": \"release\",  \"build\": {  \"packageAndDeployHelmChart\": true  },  \"triggerType\": [\"GITEVENT\"],  \"versionTagEventPatterns\": [\"^(\\\\d+\\\\.)?(\\\\d+\\\\.)?(\\\\*|\\\\d+)$\"],  \"tasks\": [  {  \"name\": \"esta-start-pipeline\",  \"taskRef\": \"esta-start-pipeline\",  \"params\": {  \"GIT_PROJECT\": \"KD_ESTA_TEKTON_IT\",  \"GIT_REPOSITORY\": \"esta-tekton-go-image-test\",  \"GIT_REVISION\": \"refs/heads/master\",  \"PIPELINE_CONFIG_NAME\": \"continuous\"  },  \"runAfter\": \"git-clone\",  \"runBefore\": \"helm-lint\"  }  ]  }  ]  This will trigger a new Pipeline over the REST API of esta-tekton-pipeline-controller. Behind the scene is a JWT Token Secret generated which is valid as long the triggering pipeline is running. This Token will be passed to the REST call to start the pipeline. You need to set following Parameters:  +----------------------+----------------------------------------------+ | Parameter            | Description                                  | +======================+==============================================+ | GIT_PROJECT          | The Git Project for example KD_ESTA          | +----------------------+----------------------------------------------+ | GIT_REPOSITORY       | The name of the repository where you want to | |                      | trigger an esta-tekton build.                | +----------------------+----------------------------------------------+ | GIT_REVISION         | The revision, branch or tag you want to      | |                      | trigger the build on i.e:                    | |                      |                                              | |                      | refs/heads/master                            | |                      |                                              | |                      | refs/tags/1.2.3                              | +----------------------+----------------------------------------------+ | PIPELINE_CONFIG_NAME | (Optional) the name of the config you want   | |                      | to trigger. Otherwise all matching pipelines | |                      | will be startet.                             | +----------------------+----------------------------------------------+  Environment Variables in Pipeline Tasks  Custom environment variables can be exposed to pipeline tasks using OpenShift Secrets stored in your Tekton build namespace. By default the secret with the name esta-tekton-pipeline-env is loaded into pipeline tasks but a different secret name can be specified using the envSecret property in the pipeline config block. Each entry of the secret is now available as env var with the key name.  Pipeline configuration structure  {  \"pipelines\": [  {  ...  \"envSecret\": \"pipeline-env-continuous\"  }  ]  }  Pipeline secrets can easily be managed via the Tekton Control Panel even without direct access to OpenShift.  Expose env variables to Docker build context  While env variables from the given secrets are exposed to the build tasks in Tekton, they're not available in the Docker build context. In order to use them in a Dockerfile, they need to be passed as build arg to the Docker command. This can be achieved by mapping them with the ocBuildVars property in the estaTektonPipeline.json:  Docker configuration structure  {  \"docker\": {  ...  \"ocBuildVars\": [  \"MY_API_KEY\": \"$MY_API_KEY\"  ]  }  ...  }  In the Dockerfile, you can declare the build argument with ARG MY_API_KEY and then use it with ${MY_API_KEY}. The values from the pipeline secrets with the key MY_API_KEY is now available in the Docker build context.  Java and Maven Versions  The Java (JDK) version used for Maven builds can be chosen individually for each project from within the estaTektonPipeline.json file. The different versions are made available through custom builder images we use in the Tekton pipeline and which are maintained by the ESTA team. You can select the desired Java, Kotlin and Maven versions in the builder config block. Here's an example to select Java 11 for your builds:  Maven configuration structure  {  \"builder\": {  \"java\": \"11\",  \"maven\": \"3.5\"  }  }  The selection of versions available in the ESTA builder images is limited (see parameter documentation). In order to use other versions or JDKs you can create your own builder image and specify it with the \"customBuilderImage\" property.  Using Buildpacks  Container images can also be built using Buildpacks instead of a classic Dockerfile. In order to enable the use of Buildpacks in Tekton, simply add a \"buildpack\" block (top-level) to your estaTektonPipeline.json. The \"docker\" block defining the \"artifactoryDockerRepo\" property is also required to specify the target for the build container image.  Buildpack example  {  ...  \"buildpack\": {  \"envVars\": [  \"BP_NEW_RELIC_ENABLED=true\"  ]  },  \"docker\": {  \"artifactoryDockerRepo\": \"esta.docker\"  },  \"mvn\": {  ...  }  ...  }  By default ESTA Tekton uses the Paketo \"base\" builder image but also Heroku builder images are supported. Since Buildpacks analyze the source code and automatically add their magic to the final image, there's little to configure. Some buildpacks can be configured or enabled via environment variables. Check the documentation of the specific buildpacks you want to be used for your project.  See the parameter documentation for a complete reference.  Experimental  Please note that the buildpacks support is only experimental and subject to be removed again from the standard ESTA Tekton pipelines.  SonarCloud Test Coverage with JaCoCo  The test coverage report will be uploaded by the pipeline and is available on SonarQube. If the sonarscan step is not enabled, the coverage report will not be uploaded to SonarQube.  Using ssh for git operations in your custom task  If you have a task or build job which relies on ssh for git operations, there is a manual workaround to support clones and git operations through ssh. To achieve that you need to do following things:  1.  Generate a private/public keypair with ssh-keygen or your preferred     tool  2.  add the public key in your Bitbucket settings  3.  create a new secret with known_hosts and the private-key value  4.  link the secret with the tekton serviceaccount  Generate a new ssh key  You can generate a new key as showed in the screenshot with the tool ssh-keygen - important, don't set a passphrase otherwise Tekton won't be able to read the keyfile:  []  with the commands:  cat id_rsa  cat id_rsa.pub  you can display the content of the private and public key file.  Add Public Key to Bitbucket User esta-build-xyz  Login on bitbucket with your esta-build-xyz user in a private browser tab: https://code.sbb.ch/login?oauth_sso=false  Copy the content of id_rsa.pub into a new entry:  https://code.sbb.ch/plugins/servlet/ssh/account/keys  Add Git SSH Secret to the desired Tekton Namespace  ESTA Tekton is already prepared for using SSH keys but still requires a manual step performed by a system admin. Please create a CLEW  support ticket in order to let us configure an SSH key in your Tekton namespace.  Using Testcontainers  With the release 0.18.0 ESTA Tekton now supports to use Testcontainers in build pipelines.  The build pipelines for Java/Maven, NPM and Go will start a container environment if the testcontainers feature is enabled in the pipeline config as shown in this example:  estaTektonPipeline.yaml  ...  pipelines:  - name: continuous  ...  build:  testcontainers:  enabled: true  Here's a full example project showing a simple Springboot application connecting to a Postgres database. Look into the CustomerControllerTest class for the actual testcontainer integration.  The container environment to actually run the Testcontainers is provided by Kubedock which will essentially run the requested containers as pods in the Tekton namespace.  With the optional property kubedockParams in the testcontainers block in estaTektonPipeline.json you can define additional arguments passed to the kubedock server command in order to tweak the containers environment. See the Kubedock documentation for details.  Experimental Feature  The support for Testcontainers is new and still experimental and comes with limitations.  Testcontainers depends on Docker, and raw Docker unfortunately is an issue in an Kubernetes managed environment like we have with OpenShift. There's no official support for it and the integration in Tekton is done with best effort but is not 100% compatible with a local Docker environment. Some containers may fail to run in the restricted OpenShift environment.  Known issues and troubleshooting  No parallel execution of builds with testcontainers  Yes, the kubedock server is started with the --lock option which will only allow to run one server in the Tekton namespace. This is to avoid collisions of multiple running testcontainers with network bindings.  Failed to start container due to permission errors  Not all testcontainer images run smoothly with the random UIDs assigned by OpenShift. If permission errors occur, analyze the image and set the user to run the container with using the label com.joyrex2001.kubedock.runas-user.  In Java this can be done like this:  postgres = new PostgreSQLContainer<>(\"postgres:15-alpine\")  .withLabel(\"com.joyrex2001.kubedock.runas-user\", \"70\");  Debugging failing testcontainers  Finding the cause when testcontainers don't come up is a bit tricky with Kubedock on OpenShift because the failed pods are immediately deleted when the test run fails. Here's how you can debug this:  1.  Add a Thread.sleep(60000); to your test class before testcontainers     are being stopped  2.  Open the pods view of your Tekton namespace in the OpenShift Console     and search for \"kubedock\" (see screenshot below)  3.  Run the pipeline and watch the pods list until you see a kubedock     pod  4.  Click on the pod and look at the logs. They should reveal some     information why the container couldn't start.     Unfortunately failed pods are deleted a few seconds later by     Kubedock which makes analysis a bit hard.     For a more in-depth investigation, continue with the following     steps:  5.  Open the YAML view of the kubedock pod and copy it  6.  After the pod vanishes again, remove the status part of the YAML and     import it in OpenShift  7.  Analyze the pod details and logs to see why the testcontainer fails  By default you're not allowed to start your own pods in a managed ESTA Tekton namespace. Talk to us to get this permission in order to debug testcontainers.  [Pods view in OpenShift Console] "}, {"text": "ESTA Tekton Roadmap  The following roadmap is just an internal draft and thus shall not be taken as a commitment. Furthermore it's subject to change at any time.  Planned Features for ESTA Tekton  This is a loose collection of high-level features we plan to integrate into the ESTA Tekton CI/CD system.  Prio 1  -   estaCloudPipeline.json Migration tool :tick:  -   Full Buildpacks support :tick:  -   Tekton Namespace Setup via CLEW SSP :tick:  Prio 2  -   Parametrized Builds (via Tekton Control Panel)  -   JUnit, Cucumber (+ other) test report publishing  Prio 3  -   Python Support :tick:  -   Selectable Maven Versions (SDKman?)  Later  -   Mobile Build + Deployment  -   Hotfix Creation Assistant  -   Advanced Pipeline Configuration via YAML (like Github actions)  Out-of-scope Features  -   Kafka Deployment  -   APIM Registration  -   Azure AD App Registration  -   Solace Deployment (TMS)  -   Pre and Post Hooks in staging pipelines (preCiDeploymentJob,     postCiDeploymentJob)  These are topics specific to deployment and therefore are not an integrated part of ESTA Tekton which delegates deployment to ArgoCD. Solutions will be discussed with the CLEW Architect and eventually provided by CLEW.  Other TODOs for ESTA Tekton  -   Performance Tests / Benchmarks  -   Monitoring / Alerting  -   Security Audit "}, {"text": "ESTA Tekton Parameters - estaTektonPipeline.json  -   Pipelines      -   Trigger criteria      -   Build parameters  -   Stages  -   Helm Charts  -   Sonar Analysis  -   OWASP Dependency Check  -   Docker Settings  -   Examples      -   Java (Maven)      -   Node.js / NPM      -   Golang      -   Docker      -   Parametrized Builds      -   Custom Pipelines  -   Parameter Documentation      -   Global Properties      -   Docker configuration structure      -   Helm configuration structure      -   Builder configuration structure      -   Maven configuration structure      -   NPM configuration structure      -   Flutter configuration structure      -   Go configuration structure      -   Python configuration structure      -   Parameters configuration structure      -   Buildpack configuration structure      -   Pipeline configuration structure      -   Build pipeline configuration structure      -   Tagging pipeline configuration structure      -   Custom pipeline configuration structure      -   Sonar configuration structure      -   GitGuardian secrets scan configuration structure      -   OWASP dependency check configuration structure      -   Testcontainers configuration structure      -   Testreport configuration structure      -   Custom task configuration structure      -   Stage configuration structure      -   ArgoCD configuration structure      -   Notification configuration structure      -   Advanced Build Settings configuration structure  -   Pre-defined Pipeline Parameters  The estaTektonPipeline.json is the single file used to configure the build, release and deployment cycles of a software project. It's interpreted by the ESTA Tekton Controller and translated into concrete actions and Tekton pipeline Parameters to start the Tekton Pipelines.  A minimal example is shown in the Getting Started guide and the schema of this file shall be explained in detail here.  The JSON schema for this file is published at https://clew-resources.sbb-cloud.net/tekton-schema.json.   The most stable way in Intellij Idea to support context sensitive completion for YAML and JSON files we suggest to configure the schema globally. Only then it also worked seamlessly for YAML files. As showed in the screenshot. Other IDE's like MS Visual Studio Code support the same feature. You will find setup guide here https://medium.com/@alexmolev/boost-your-yaml-with-autocompletion-and-validation-b74735268ad7.   []  Pipelines  With the \"pipelines\" config blocks you can define individual \"pipeline profiles\" for different cases. Different than the \"steps\" in estaCloudPipeline.json, pipelines have no fixed type that implies a certain build workflow. The ESTA Tekton pipelines can be configured freely with individual names and settings.  A pipeline block has certain properties to define the trigger criteria and additional properties define the type of the pipeline and it desired output:  Build pipeline config block  {  \"name\": \"continuous-integration\",  \"enabled\": true,  \"triggerType\": [  \"USER\",  \"GITEVENT\"  ],  \"branchNamePrefixes\": [  \"deploy\"  ],  \"versionTagEventPatterns\": [  \"^(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\*|\\\\d+)-SNAPSHOT$\"  ],  \"build\": {  \"buildDockerImage\": true,  \"packageAndDeployHelmChart\": false,  \"additionalBuildParams\": \"-DskipITs\",     \"additionalDeployParams\": \"-DskipITs\",   }  }  Trigger criteria  -   triggerType: defines which events trigger this build step:      -   USER: Control panel action      -   GITEVENT: Bitbucket webhook      -   PIPELINE: Git commit triggered by a Tekton pipeline  -   branchNamePrefixes: filter events on Git branches starting with one     of the given values  -   versionTagEventPatterns: for Git tag events, the tag name needs to     match one of the given regex patterns  Build parameters  The property \"build\" indicates a build pipeline to run with the following settings:  -   buildDockerImage: build a Docker image and push it to Artifactory     (unless disabled by deployDockerImage:false)  -   packageAndDeployHelmChart: create a Helm chart and push it to the     Helm repository in Artifactory  -   deployArtifacts: deploy Maven or NPM artifacts to Artifactory  Please note that for each event (Bitbucket webhook, Control panel action or API call) all matching pipeline profiles will start an according pipeline.  Stages  The stages configuration represent deployment targets for your applications. The task of actually rolling out a deployment is not part of the ESTA Tekton pipeline but uses ArgoCD and Helm Charts as the only option right now. You can still configure certain aspects of the deployment process in estaTektonPipeline.json which are executed after a successful build.  The \"stages\" config blocks each describe a deployment target. Besides a unique \"stageName\", a stage config can contain an \"argoCD\" and a \"helm\" block. Here's an example:  Stage config block  {  \"stageName\": \"dev\",  \"argoCD\": {  \"argoCdAppName\": \"springboot-tekton-dev\",     \"autoSync\": true  },  \"helm\": {  \"sourceRepository\": \"https://code.sbb.ch/scm/kd_example/argocd-apps-helm.git\",  \"chartFilePath\": \"clusters/aws01t/values/springboot-tekton.yaml\",  \"versionProperties\": [  \".deploymentVersion\"  ]  }  The \"helm\" block is merged with the top-level \"helm\" block described below. If present in a staging block, the staging pipeline will update the release version from the triggering build in the Helm chart (repositoy, chart file) referenced by this config. By default the Helm chart is searched in the project repository unless explicitly specified by the \"sourceRepsitory\" property.   With the \"argoCD\" block the staging pipeline is advised to trigger a sync in ArgoCD on the application with the specified name. The hostname of the ArgoCD instance and the access token used for the connection are taken from a Secret stored in the Tekton build namespace.  See the JSON schema or Parameter Documentation for detailed description of these properties.  In order to trigger the deployment (staging) after a successful build, define a list of stage names in the pipeline config block using the \"stages\" property.  Helm Charts  Tekton build pipelines can also package and deploy Helm charts. The \"helm\" block holds the configuration for this:  Helm config block  {  \"chartFilePath\": \"./charts/springboot-tekton-app/Chart.yaml\",  \"chartRepository\": \"esta.helm.local\"  }  See the JSON schema or Parameter Documentation for detailed description of these properties.  Sonar Analysis  Tekton can also be used to perform sonar analyses. The \"sonarScan\" holds the configuration for this. The sonarScan block can be configured for each build profile separately.  SonarScan config block  {  \"enabled\": true,  \"projectKey\": \"springboot-tekton-app\"  }  For Maven, NPM Go or Docker projects you can create a sonar-project.properties file to set additional sonar scan analysis parameters according to the official documentation: https://docs.sonarqube.org/latest/analysis/analysis-parameters/  This also works for Maven, since we patch the maven configuration according to the sonar-project.properties. Even if you have a sonar-project.properties file, values like sonar.login, sonar.host.url, sonar.organization and so on will be automatically set through the esta-tekton build pipeline.  For Dockerfile analysis, make sure your Dockerfiles are named Dockerfile, Dockerfile.* or *.dockerfile to get detected and processed by Sonarqube.  See the JSON schema or Parameter Documentation for detailed description of these properties.  OWASP Dependency Check  You can also perform the OWASP Dependency Check to find vulnerabilities in your software. It is configured in the \"owaspDependencyCheck\" block. You can configure it for Javascript and Java projects.  The check is documented here: https://jeremylong.github.io/DependencyCheck/index.html  OWASP Dependency Check config block  {  \"enabled\": true  \"additionalParams\": \"--failOnCVSS 5\"  }  Docker Settings  Building and publishing Docker images as artifacts of the build process requires some configuration defined in the \"docker\" block. We support one single Docker build blocks but also multiple blocks which are defined as an array. Following some examples:  Docker config block  {  \"artifactoryDockerRepo\": \"esta.docker\",  \"imageName\": \"springboot-tekton-app\",  \"dockerFile\": \"docker/Dockerfile\"  }  Alternatively you can also use multiple Docker Build Blocks.  Docker config block  [  {  \"artifactoryDockerRepo\": \"esta.docker\",  \"imageName\": \"springboot-tekton-app\",  \"dockerFile\": \"docker/Dockerfile.spring\"  },  {  \"artifactoryDockerRepo\": \"esta.docker\",  \"imageName\": \"another-springboot-tekton-app\",  \"dockerFile\": \"docker/Dockerfile.other\"  }  ]  These docker builds run in parralel. If one docker image builds on top of another, specify that dependency with the runAfterImageName property referencing a imageName value.  See the JSON schema or Parameter Documentation for detailed description of these properties.  Examples  A collection of example estaTektonPipeline.json files is maintained in this repository.  Java (Maven)  For Java projects the ESTA Tekton system currently only supports Maven. In JSON add a \"mvn\" block to define a Maven build. A project can either be configured to push a Docker image and/or a JAR file to Artifactory as build artifacts.  -   SpringBoot application with Dockerfile and SonarScan  -   Library/JAR project  -   Nightly builds with Continuous Delivery  Note the difference!  When using a custom Dockerfile you may need to replace certain commands to work with Tekton. Read more about Dockerfile Migration.  Node.js / NPM  Node.js projects can be built with npm commands. To indicate an NPM project, add a \"npm\" block in JSON. The typical use case is for Angular applications which are compiled to static files and packed into an ngnix Docker image for serving.  -   Angular application (Nginx Docker image)  -   Angular application published on S3  -   Node.js module  Golang  -   Go application  Docker  Pure Docker image builds can be done with Tekton, too. All it needs is a \"docker\" block in JSON pointing to the Dockerfile(s) to use and to which Artifactory docker repository the images shall be pushed.  -   Simple Docker image build  -   Multiple Docker images  Parametrized Builds  Since version 0.27.x you can start builds with parameters. In the UI there will be just a text field, which shows the parameters as a JSON value prefilled. In future versions you will have better UI support for this feature. The JSON will be not validated against the parameter definition.  You find an example here. Also how you can iterate over the variables.  https://code.sbb.ch/projects/KD_ESTA_TEST/repos/esta-tekton-helm-sample/browse/estaTektonPipeline.yaml#41  Or this is how you define the parameters globally in your estaTektonPipeline.json.  \"parameters\": [  {  \"name\": \"env\",  \"type\": \"Choice\",  \"values\": [\"dev\"],  \"label\": \"Environment\",  \"description\": \"Target environment\",  \"options\": [\"dev\", \"test\", \"prod\"]  },  {  \"name\": \"notificationEmails\",  \"type\": \"Multichoice\",  \"values\": [\"john.doe@sbb.ch\", \"jane.doe@sbb.ch\"],  \"options\": [\"john.doe@sbb.ch\", \"jane.doe@sbb.ch\", \"some-one.else@sbb.ch\"]  \"description\": \"The email addresses which the notifications are sent to\"  },    {  \"name\": \"notificationSubject\",  \"type\": \"String\",  \"values\": [\"New release deployed\"],  \"description\": \"Subject of the notification email\"  }  ],  Details about the configuration you can find in the parameter documentation.  Upon pipeline execution, the parameter values will be exposed to each pipeline task as JSON formatted string via the environment variable USER_PIPELINE_PARAMETERS_JSON.  Also each parameter value get's exposed as a environment variable in the pod by it's name:  The parameter name \"env\" get's exposed as environment variable UP_ENV. With UP_ENV_SIZE you get the size of the array values. With UP_ENV_0, UP_ENV_1 you access it's values. \"notificationEmails\" will be written in the environment variable UP_NOTIFICATIONEMAILS.  You find an example here. Also how you can iterate over the variables.  https://code.sbb.ch/projects/KD_ESTA_TEST/repos/esta-tekton-helm-sample/browse/estaTektonPipeline.yaml#41  Custom Pipelines  This is an experimental feature of ESTA Tekton. Read more in the Advanced Topics.  -   Build multiple docker images  Parameter Documentation  This is the complete list of JSON properties supported by the estaTektonPipeline.json schema in the latest stable version.  Global Properties  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | productName | Name of the | no       | Git         |             | |             | product/a   |          | repository  |             | |             | pplication. |          | name        |             | |             | Defaults to |          |             |             | |             | the git     |          |             |             | |             | repository  |          |             |             | |             | name if not |          |             |             | |             | set.        |          |             |             | +-------------+-------------+----------+-------------+-------------+ | docker      | Defines the | no       |             |             | |             | output of   |          |             |             | |             | the Docker  |          |             |             | |             | images.     |          |             |             | |             | See Docker  |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | helm        | Configures  | no       |             |             | |             | the         |          |             |             | |             | creation    |          |             |             | |             | and         |          |             |             | |             | deployment  |          |             |             | |             | of Helm     |          |             |             | |             | charts.     |          |             |             | |             | See Helm    |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | builder     | Configures  | no       |             |             | |             | the         |          |             |             | |             | builders    |          |             |             | |             | like java,  |          |             |             | |             | kotlin,     |          |             |             | |             | python,     |          |             |             | |             | node, go    |          |             |             | |             |             |          |             |             | |             | See Builder |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | mvn         | Settings    | no       |             |             | |             | for Java    |          |             |             | |             | builds      |          |             |             | |             | using       |          |             |             | |             | Maven.      |          |             |             | |             | See Maven   |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | npm         | Settings    | no       |             |             | |             | for Node.js |          |             |             | |             | NPM builds. |          |             |             | |             | See NPM     |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | flutter     | Settings    | no       |             |             | |             | for Flutter |          |             |             | |             | builds.     |          |             |             | |             | See Flutter |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | go          | Settings    | no       |             |             | |             | for Golang  |          |             |             | |             | builds.     |          |             |             | |             | See Go      |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | buildpack   | Settings    | no       |             |             | |             | for         |          |             |             | |             | container   |          |             |             | |             | image       |          |             |             | |             | builds with |          |             |             | |             | Buildpacks. |          |             |             | |             | See         |          |             |             | |             | Buildpack   |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | pipelines   | Defines a   | no       | []          |             | |             | list of     |          |             |             | |             | pipeline    |          |             |             | |             | conf        |          |             |             | |             | igurations. |          |             |             | |             | See         |          |             |             | |             | Pipeline    |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | stages      | Defines a   | no       | []          |             | |             | list of     |          |             |             | |             | staging     |          |             |             | |             | /deployment |          |             |             | |             | conf        |          |             |             | |             | igurations. |          |             |             | |             | See Stage   |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | no          | Defines a   | no       | []          |             | | tifications | list of     |          |             |             | |             | n           |          |             |             | |             | otification |          |             |             | |             | settings.   |          |             |             | |             | See         |          |             |             | |             | N           |          |             |             | |             | otification |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | advancedBu  | Defines the | no       | []          |             | | ildSettings | advanced    |          |             |             | |             | build       |          |             |             | |             | settings.   |          |             |             | |             | See         |          |             |             | |             | Advanced    |          |             |             | |             | Build       |          |             |             | |             | Settings    |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+  Docker configuration structure    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name           Description                                                                                                                                  Required   Default value                                       Since version   ----------------------- -------------------------------------------------------------------------------------------------------------------------------------------- ---------- --------------------------------------------------- ---------------   artifactoryDockerRepo   Repository where the Docker image should be pushed to                                                                                        yes                                                                                       Must include the suffix \".docker\"                                                                                                                                                                               dockerFile              The path to the Dockerfile e.g. ./Dockerfile or docker/Dockerfile                                                                            no         \"./Dockerfile\"                                                                 If the given Dockerfile is not found for Maven projects, a Selfrunning Jar build is started where a Dockerfile is automatically generated.                                                                      imageName               Name of the docker image to create.                                                                                                          no         .productName                                                                   If omitted, the productName property will be used.                                                                                                                                                              baseImageFrom           The base docker image used in the Selfrunning Jar build case                                                                                 no         \"esta.docker.bin.sbb.ch/esta/ubi9/java-17:latest\"       contextDir              Directory for the Docker build to be executed from.                                                                                          no         \".\"                                                                            The path to the Dockerfile as well as all files referenced from within the Dockerfile are resolved from this directory.                                                                                         ocBuildVars             List of own image build arguments in the KEY=value format.                                                                                   no         []                                                                             Extra values passed as build args to the build command. Use them with ARG KEY inside the Dockerfile.                                                                                                            pomArtifactId           In case of a Maven multi-module project, you can choose the artifactId which is used to build the image.                                     no                                                                                        The property has no effect in case of a Selfrunning Jar build (see dockerFile property).                                                                                                                       ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  If your Dockerfile is not on the root folder and you're using copy steps in it, contextDir must be set and define the directory on which the Dockerfile is located! Otherwise the build will fail as it can't find the content to copy into the image during the build.  Helm configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | ch          | This is the | no       |             |             | | artFilePath | path from   |          |             |             | |             | your root   |          |             |             | |             | folder to   |          |             |             | |             | your Chart  |          |             |             | |             | file. For   |          |             |             | |             | example:    |          |             |             | |             | ./chart     |          |             |             | |             | s/your-repo |          |             |             | |             | /Chart.yaml |          |             |             | +-------------+-------------+----------+-------------+-------------+ | char        | The name of | no       |             |             | | tRepository | the Helm    |          |             |             | |             | repository  |          |             |             | |             | in          |          |             |             | |             | A           |          |             |             | |             | rtifactory. |          |             |             | |             | If          |          |             |             | |             | specified   |          |             |             | |             | the chart   |          |             |             | |             | is packaged |          |             |             | |             | and         |          |             |             | |             | uploaded to |          |             |             | |             | this        |          |             |             | |             | repository  |          |             |             | +-------------+-------------+----------+-------------+-------------+ | versio      | List of     | no       | \".version\"  |             | | nProperties | properties  |          |             |             | |             | of the Helm |          |             |             | |             | chart file  |          |             |             | |             | to set the  |          |             |             | |             | release     |          |             |             | |             | version to. |          |             |             | |             | Each        |          |             |             | |             | property is |          |             |             | |             | defined as  |          |             |             | |             | a yq        |          |             |             | |             | expression  |          |             |             | |             | (see        |          |             |             | |             | doc         |          |             |             | |             | umentation) |          |             |             | |             | which is    |          |             |             | |             | similar to  |          |             |             | |             | jq syntax.  |          |             |             | |             |             |          |             |             | |             | When used   |          |             |             | |             | in          |          |             |             | |             | .sta        |          |             |             | |             | ges[*].helm |          |             |             | |             | config      |          |             |             | |             | block you   |          |             |             | |             | can use the |          |             |             | |             | following   |          |             |             | |             | code        |          |             |             | |             | segment to  |          |             |             | |             | update the  |          |             |             | |             | dependecies |          |             |             | |             | in an       |          |             |             | |             | Umbr        |          |             |             | |             | ella-Chart: |          |             |             | |             |             |          |             |             | |             | \"versionP   |          |             |             | |             | roperties\": |          |             |             | |             | [           |          |             |             | |             |             |          |             |             | |             | \".dep       |          |             |             | |             | endencies[] |          |             |             | |             | |           |          |             |             | |             | sele        |          |             |             | |             | ct(.name==\\ |          |             |             | |             | \"name-of-yo |          |             |             | |             | ur-project\\ |          |             |             | |             | \").version\" |          |             |             | |             |             |          |             |             | |             | ]           |          |             |             | +-------------+-------------+----------+-------------+-------------+ | sourc       | The Git     | no       |             |             | | eRepository | repository  |          |             |             | |             | where Helm  |          |             |             | |             | charts for  |          |             |             | |             | staging     |          |             |             | |             | /deployment |          |             |             | |             | are         |          |             |             | |             | maintained. |          |             |             | |             | Only        |          |             |             | |             | allowed in  |          |             |             | |             | .sta        |          |             |             | |             | ges[*].helm |          |             |             | |             | config      |          |             |             | |             | block.      |          |             |             | |             | Default is  |          |             |             | |             | the current |          |             |             | |             | Git         |          |             |             | |             | repository. |          |             |             | +-------------+-------------+----------+-------------+-------------+ | source      | Git branch  | no       | \"master\"    |             | | BranchOrTag | where the   |          |             |             | |             | Helm charts |          |             |             | |             | should be   |          |             |             | |             | updated.    |          |             |             | |             | Only        |          |             |             | |             | allowed in  |          |             |             | |             | .sta        |          |             |             | |             | ges[*].helm |          |             |             | |             | config      |          |             |             | |             | block.      |          |             |             | +-------------+-------------+----------+-------------+-------------+ | lintArgs    | Additional  | no       |             |             | |             | arguments   |          |             |             | |             | for the     |          |             |             | |             | helm lint   |          |             |             | |             | command     |          |             |             | +-------------+-------------+----------+-------------+-------------+  Builder configuration structure    Property name        Description                                                                                                                                             Required   Default value   Since version   -------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- --------------- ---------------   java                 Java major version you want to use to build: 11, 17, 21, 17-Graal, 21-Graal                                                                             no         \"17\"               maven                Maven minor version you want to use to build: 3.8, 3.9                                                                                                  no         \"3.8\"              kotlin               Kotlin minor version you want to use to build: 1.7                                                                                                      no         \"1.7\"              node                 Node major version you want to use to build: 14, 16, 18, 20                                                                                             no         \"18\"               python               Python minor version you want to use to build: 3.7, 3.8, 3.9, 3.10, 3.11, 3.12                                                                          no         \"3.10\"             go                   Go minor version you want to use to build: 1.16, 1.18, 1.19, 1.20, 1.21, 1.22                                                                           no         \"1.18\"             customBuilderImage   You can define your own custom builder image which behaves the same as the esta-builder-image but has for example different sdk versions preinstalled   no                           Maven configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | parentPom   | Path to the | no       | \"pom.xml\"   |             | |             | parent pom  |          |             |             | |             | file. In    |          |             |             | |             | most cases  |          |             |             | |             | you don't   |          |             |             | |             | need to set |          |             |             | |             | this. By    |          |             |             | |             | default the |          |             |             | |             | pom.xml is  |          |             |             | |             | taken. But  |          |             |             | |             | if you have |          |             |             | |             | a parent    |          |             |             | |             | pom.xml in  |          |             |             | |             | another     |          |             |             | |             | subfolder,  |          |             |             | |             | you can     |          |             |             | |             | configure   |          |             |             | |             | it here.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | deployableA | Path to pom | no       | \"pom.xml\"   |             | | rtifactsPom | file which  |          |             |             | |             | specifies   |          |             |             | |             | the         |          |             |             | |             | deployable  |          |             |             | |             | jar         |          |             |             | |             | artifacts   |          |             |             | |             | for         |          |             |             | |             | A           |          |             |             | |             | rtifactory. |          |             |             | |             | This has no |          |             |             | |             | direct      |          |             |             | |             | influence   |          |             |             | |             | on the      |          |             |             | |             | Docker      |          |             |             | |             | build.      |          |             |             | |             |             |          |             |             | |             | This        |          |             |             | |             | property is |          |             |             | |             | not meant   |          |             |             | |             | to          |          |             |             | |             | determine   |          |             |             | |             | the         |          |             |             | |             | artifact    |          |             |             | |             | which get's |          |             |             | |             | packed into |          |             |             | |             | the Docker  |          |             |             | |             | image.      |          |             |             | +-------------+-------------+----------+-------------+-------------+ | artifacto   | The Maven   | no       |             |             | | ryMavenRepo | repository  |          |             |             | |             | in          |          |             |             | |             | Artifactory |          |             |             | |             | where the   |          |             |             | |             | Maven       |          |             |             | |             | artifacts   |          |             |             | |             | will be     |          |             |             | |             | published   |          |             |             | |             | to.         |          |             |             | |             | Required    |          |             |             | |             | when        |          |             |             | |             | depl        |          |             |             | |             | oyArtifacts |          |             |             | |             | in step     |          |             |             | |             | config is   |          |             |             | |             | enabled.    |          |             |             | |             | Must end    |          |             |             | |             | with the    |          |             |             | |             | suffix      |          |             |             | |             | \".mvn\"      |          |             |             | +-------------+-------------+----------+-------------+-------------+ | i           | Check if    | no       | false       |             | | sTychoBuild | Repository  |          |             |             | |             | use Tycho   |          |             |             | |             | Build       |          |             |             | +-------------+-------------+----------+-------------+-------------+ | forceUn     | Let builds  | no       | false       |             | | stableBuild | succeed     |          |             |             | |             | even if     |          |             |             | |             | tests fail  |          |             |             | |             | but report  |          |             |             | |             | pipeline    |          |             |             | |             | status as   |          |             |             | |             | UNSTABLE    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | bu          | N           | no       | \"esta-m     | 0.24.0      | | ildTaskName | ame/variant |          | aven-build\" |             | |             | of the      |          |             |             | |             | Tekton task |          |             |             | |             | used to     |          |             |             | |             | perform the |          |             |             | |             | build step. |          |             |             | |             | Default     |          |             |             | |             | tasks       |          |             |             | |             | available   |          |             |             | |             | for         |          |             |             | |             | selection:  |          |             |             | |             |             |          |             |             | |             | -           |          |             |             | |             |    \"esta-ma |          |             |             | |             | ven-build\": |          |             |             | |             |     2G      |          |             |             | |             |     memory; |          |             |             | |             |     max. 4G |          |             |             | |             |     memory  |          |             |             | |             |     and 2   |          |             |             | |             |     CPU     |          |             |             | |             |             |          |             |             | |             | -   \"es     |          |             |             | |             | ta-maven-bu |          |             |             | |             | ild-small\": |          |             |             | |             |     600M    |          |             |             | |             |     memory; |          |             |             | |             |     max.    |          |             |             | |             |     1.5G    |          |             |             | |             |     memory  |          |             |             | |             |     and 1   |          |             |             | |             |     CPU     |          |             |             | |             |             |          |             |             | |             | -   \"es     |          |             |             | |             | ta-maven-bu |          |             |             | |             | ild-large\": |          |             |             | |             |     6G      |          |             |             | |             |     memory; |          |             |             | |             |     max. 9G |          |             |             | |             |     memory  |          |             |             | |             |     4 CPU   |          |             |             | |             |             |          |             |             | |             | -           |          |             |             | |             |   \"esta-mav |          |             |             | |             | en-build-ex |          |             |             | |             | tra-large\": |          |             |             | |             |     20G     |          |             |             | |             |     memory; |          |             |             | |             |     max.    |          |             |             | |             |     24G     |          |             |             | |             |     memory  |          |             |             | |             |     and 6   |          |             |             | |             |     CPU     |          |             |             | +-------------+-------------+----------+-------------+-------------+  NPM configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | packageJson | Specifies   | no       | \"./pa       |             | |             | the path    |          | ckage.json\" |             | |             | where the   |          |             |             | |             | p           |          |             |             | |             | ackage.json |          |             |             | |             | is located. |          |             |             | |             | Needs to    |          |             |             | |             | end with    |          |             |             | |             | 'pa         |          |             |             | |             | ckage.json' |          |             |             | +-------------+-------------+----------+-------------+-------------+ | p           | Specifies   | no       |             |             | | ublishableP | the         |          |             |             | | ackageJsons | p           |          |             |             | |             | ackage.json |          |             |             | |             | files for   |          |             |             | |             | publishable |          |             |             | |             | projects    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | additiona   | Additional  | no       |             |             | | lNpmScripts | NPM         |          |             |             | |             | commands to |          |             |             | |             | run at      |          |             |             | |             | build time  |          |             |             | |             | as          |          |             |             | |             | specified   |          |             |             | |             | in          |          |             |             | |             | pa          |          |             |             | |             | ckage.json. |          |             |             | |             | Multiple    |          |             |             | |             | commands    |          |             |             | |             | can be      |          |             |             | |             | provided    |          |             |             | |             | separated   |          |             |             | |             | by a space. |          |             |             | +-------------+-------------+----------+-------------+-------------+ | targetRepo  | The target  | no       |             |             | |             | repository  |          |             |             | |             | in          |          |             |             | |             | Artifactory |          |             |             | |             | where the   |          |             |             | |             | NPM         |          |             |             | |             | artifacts   |          |             |             | |             | will be     |          |             |             | |             | published   |          |             |             | |             | to.         |          |             |             | |             | Required    |          |             |             | |             | when        |          |             |             | |             | depl        |          |             |             | |             | oyArtifacts |          |             |             | |             | in step     |          |             |             | |             | config is   |          |             |             | |             | enabled.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | bu          | N           | no       | \"esta       | 0.25.2      | | ildTaskName | ame/variant |          | -npm-build\" |             | |             | of the      |          |             |             | |             | Tekton task |          |             |             | |             | used to     |          |             |             | |             | perform the |          |             |             | |             | build step. |          |             |             | |             | Default     |          |             |             | |             | tasks       |          |             |             | |             | available   |          |             |             | |             | for         |          |             |             | |             | selection:  |          |             |             | |             |             |          |             |             | |             | -   \"esta-  |          |             |             | |             | npm-build\": |          |             |             | |             |     3G      |          |             |             | |             |     memory; |          |             |             | |             |     max. 6G |          |             |             | |             |     memory  |          |             |             | |             |     and 2   |          |             |             | |             |     CPU     |          |             |             | |             |             |          |             |             | |             | -   \"       |          |             |             | |             | esta-npm-bu |          |             |             | |             | ild-large\": |          |             |             | |             |     5G      |          |             |             | |             |     memory; |          |             |             | |             |     max. 9G |          |             |             | |             |     memory  |          |             |             | |             |     4 CPU   |          |             |             | |             |             |          |             |             | |             | -   \"esta-n |          |             |             | |             | pm-build-ex |          |             |             | |             | tra-large\": |          |             |             | |             |     12G     |          |             |             | |             |     memory; |          |             |             | |             |     max.    |          |             |             | |             |     20G     |          |             |             | |             |     memory  |          |             |             | |             |     and 6   |          |             |             | |             |     CPU     |          |             |             | +-------------+-------------+----------+-------------+-------------+  Flutter configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | b           | List of     | no       | pre         |             | | uildScripts | build       |          | pare-zip.sh |             | |             | scripts     |          |             |             | |             | which       |          |             |             | |             | should run  |          |             |             | |             | in the      |          |             |             | |             | flutter     |          |             |             | |             | build task. |          |             |             | |             | For         |          |             |             | |             | example:    |          |             |             | |             |             |          |             |             | |             | [\"prepa     |          |             |             | |             | re-zip.sh\", |          |             |             | |             | \"prepare-d  |          |             |             | |             | ev-zip.sh\"] |          |             |             | +-------------+-------------+----------+-------------+-------------+ | pubs        | The path to | no       | p           |             | | pecYamlPath | the flutter |          | ubspec.yaml |             | |             | p           |          |             |             | |             | ubspec.yaml |          |             |             | |             | file        |          |             |             | +-------------+-------------+----------+-------------+-------------+  Go configuration structure    ---------------------------------------------------------------------------------------------------------------   Property name        Description                                     Required   Default value   Since version   -------------------- ----------------------------------------------- ---------- --------------- ---------------   buildPackages        The packages to build                           no         \"./cmd/...\"         useMage              Enforce use of the build tool mage              no         false               additionalGoParams   Go build orders.                                no                                                 Multiple commands can be separated by spaces.                                 ---------------------------------------------------------------------------------------------------------------  Python configuration structure    -----------------------------------------------------------------------------------------------------------------------------------------------------------   Property name            Description                                                                             Required   Default value   Since version   ------------------------ --------------------------------------------------------------------------------------- ---------- --------------- ---------------   targetRepo               The target repository in Artifactory where the Python artifacts will be published to.   no                                                     Required when deployArtifacts in step config is enabled.                                                               additionalPythonParams   Multiple commands can be separated by spaces.                                           no                            -----------------------------------------------------------------------------------------------------------------------------------------------------------  Parameters configuration structure  The full functional parameter UI will be released in a future release as for the moment, we display a simple json structure in the UI.    Property name   Description                                                                                                                                                                                                                                                                       Required   Default value   Since version   --------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- --------------- ---------------   name            A unique name for this parameter. i.E. environments, emailadresses, and so on.                                                                                                                                                                                                    yes                        0.27.x   type            Type of the parameter to define how the parameter will be displayed in the UI and processed in the templates. Possible values are: String, Multiline, Choice, Multichoice, Boolean                                                                                                yes                        0.27.x   options         The options which will be displayed in the UI to select from. Here you can define for example for a parameter named environment the options: dev, test , int, prod which will be then displayed as a multichoice or choice checkbox or radiobutton selection control in the UI.   no                         0.27.x   values          The values array holds the preselected or predefined values which will be displayed in the UI. If you have the options dev, test , int, prod you can for example specify the preselected values: dev, test                                                                        no                         0.27.x   label           The labels value defines the label which is displayed in the UI. If not defined, the name will be used as label in the UI.                                                                                                                                                        no                         0.27.x   description     Just to describe the parameter. This will be shown as a tooltip in the ui when hovering over the question mark in the UI.                                                                                                                                                         no                         0.27.x  Buildpack configuration structure    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name   Description                                                                              Required   Default value                     Since version   --------------- ---------------------------------------------------------------------------------------- ---------- --------------------------------- ---------------   builder         The builder image to use. Currently Paketo and Heroku buildpack builders are supported   no         \"paketobuildpacks/builder:base\"       envVars         A list of environment variables to be set for the Buildpack lifecycle process.           no         []                                                   Specify them as strings of the format \"VAR_NAME=value\".                                                                                  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------  Pipeline configuration structure    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name              Description                                                                                                                                                                   Required   Default value                Since version   -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- ---------------------------- ---------------   name                       Unique name for this pipeline config.                                                                                                                                         yes                                                                   You can choose your own names.                                                                                                                                                                                            enabled                    Should this build profile be switched on or off (true / false)                                                                                                                no         true                             triggerType                List of triggers that will start this pipeline.                                                                                                                               no         \"USER\"                                                     \"USER\": is triggered through the REST API, usually from the Tekton Control Panel                                                                                                                                                                    \"GITEVENT\": is triggered by pushes (branch or tag) to the Git repository                                                                                                                                                                            \"PIPELINE\": is triggered by Git branch pushes issued by a Tekton pipeline                                                                                                                                                                           \"CRON\": is triggered by the ESTA Tekton Controller at the time configuered by cronTab. The CRON configuration will be only read from the default branch (main, master, ...)                                               branchNamePrefixes         List of prefixes of Git branches on which the pipeline should be executed                                                                                                     no                                          branchNamePatterns         List of regex patterns to match or not match Git branches on which the pipeline should be executed.                                                                           no                                                                    Has precedence over branchNamePatterns.                                                                                                                                                                                   versionTagEventPatterns    List of regex patterns for Git tags when pushed to Bitbucket.                                                                                                                 no                                                                    A regex like \"^(\\\\d+\\\\.)?(\\\\d+\\\\.)?(\\\\*|\\\\d+)$\" would match a tag like 10.5.100                                                                                                                                           cron                       Unix-style Cron expression to define times when automated pipeline runs should start. The cron configuration will be only read from the default branch (master, main, ...)    no                                                                    Required in conjunction with triggerType \"CRON\".                                                                                                                                                                                                    Please note: nicknames like \"@midnight\" are not supported.                                                                                                                                                                stages                     Define a list of stage names to trigger if pipeline run was successful                                                                                                        no         []                               build                      Start a build pipeline with these settings.                                                                                                                                   no                                                                    See Build pipeline configuration structure for details.                                                                                                                                                                   tagging                    Start a tagging pipeline with these settings.                                                                                                                                 no                                                                    See Tagging pipeline configuration structure for details.                                                                                                                                                                 custom                     Start a custom pipeline with these settings.                                                                                                                                  no                                                                    See Custom pipeline configuration structure for details.                                                                                                                                                                  envSecret                  OpenShift secret name holding env variables to be exposed in pipeline steps.                                                                                                  no         \"esta-tekton-pipeline-env\"                                 The name needs to start with \"pipeline-env\".                                                                                                                                                                              tasks                      List of additional tasks to be inserted into the pipeline.                                                                                                                    no         []                                                         See Custom task configuration structure for details and README.md for task documentation.                                                                                                                                 failOnQualityGateFailure   Whether to fail the pipeline if the quality gate fails.                                                                                                                       no         false                           ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Build pipeline configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | build       | Build a     | no       | false       |             | | DockerImage | Docker      |          | (true for   |             | |             | image       |          | docker-only |             | |             |             |          | re          |             | |             |             |          | positories) |             | +-------------+-------------+----------+-------------+-------------+ | deploy      | Push the    | no       | true        |             | | DockerImage | built       |          |             |             | |             | Docker      |          |             |             | |             | image to    |          |             |             | |             | Artifactory |          |             |             | +-------------+-------------+----------+-------------+-------------+ | depl        | Should the  | no       | false       |             | | oyArtifacts | generated   |          |             |             | |             | artifacts   |          |             |             | |             | (Mvn, NPM,  |          |             |             | |             | Go) be      |          |             |             | |             | deployed to |          |             |             | |             | Artifactory |          |             |             | +-------------+-------------+----------+-------------+-------------+ | pac         | Package a   | no       | false       |             | | kageAndDepl | Helm chart  |          |             |             | | oyHelmChart | and deploy  |          |             |             | |             | it to       |          |             |             | |             | Artifactory |          |             |             | +-------------+-------------+----------+-------------+-------------+ | additional  | Additional  | no       |             |             | | BuildParams | parameters  |          |             |             | |             | appended to |          |             |             | |             | commands    |          |             |             | |             | that        |          |             |             | |             | execute     |          |             |             | |             | builds      |          |             |             | |             | (mvn, npm   |          |             |             | |             | run, go     |          |             |             | |             | build)      |          |             |             | +-------------+-------------+----------+-------------+-------------+ | additionalD | Additional  | no       |             |             | | eployParams | deploy      |          |             |             | |             | parameters  |          |             |             | |             | added to    |          |             |             | |             | Maven       |          |             |             | |             | commands.   |          |             |             | +-------------+-------------+----------+-------------+-------------+ | add         | List of     | no       | []          |             | | itionalDock | additional  |          |             |             | | erImageTags | tags the    |          |             |             | |             | Docker      |          |             |             | |             | image shall |          |             |             | |             | be pushed   |          |             |             | |             | to          |          |             |             | +-------------+-------------+----------+-------------+-------------+ | sonarScan   | You can     | no       |             |             | |             | configure   |          |             |             | |             | the         |          |             |             | |             | sonarScan   |          |             |             | |             | for each    |          |             |             | |             | build step  |          |             |             | |             | separately. |          |             |             | |             | A simple    |          |             |             | |             | example     |          |             |             | |             | looks like  |          |             |             | |             | this:       |          |             |             | |             |             |          |             |             | |             | \"           |          |             |             | |             | sonarScan\": |          |             |             | |             | {           |          |             |             | |             |             |          |             |             | |             | \"enabled\":  |          |             |             | |             | true        |          |             |             | |             | }           |          |             |             | |             | For further |          |             |             | |             | information |          |             |             | |             | see the     |          |             |             | |             | sonar       |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | description |          |             |             | |             | below or    |          |             |             | |             | the sonar   |          |             |             | |             | details     |          |             |             | |             | above:      |          |             |             | |             | So          |          |             |             | |             | narAnalysis |          |             |             | +-------------+-------------+----------+-------------+-------------+ | owaspDepe   | You can     | no       |             |             | | ndencyCheck | configure   |          |             |             | |             | the         |          |             |             | |             | owaspDepe   |          |             |             | |             | ndencyCheck |          |             |             | |             | for each    |          |             |             | |             | build step  |          |             |             | |             | separately. |          |             |             | |             | A simple    |          |             |             | |             | example     |          |             |             | |             | looks like  |          |             |             | |             | this:       |          |             |             | |             |             |          |             |             | |             | \"           |          |             |             | |             | owaspDepend |          |             |             | |             | encyCheck\": |          |             |             | |             | {           |          |             |             | |             |             |          |             |             | |             | \"enabled\":  |          |             |             | |             | true        |          |             |             | |             | }           |          |             |             | |             | For further |          |             |             | |             | information |          |             |             | |             | see the     |          |             |             | |             | owasp       |          |             |             | |             | dependecy   |          |             |             | |             | check       |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | description |          |             |             | |             | below or    |          |             |             | |             | the details |          |             |             | |             | above:      |          |             |             | |             | OWASPDepe   |          |             |             | |             | ndencyCheck |          |             |             | +-------------+-------------+----------+-------------+-------------+ | gitguardian | Configure   | no       |             | 0.28.0      | |             | GitGuardian |          |             |             | |             | secrets     |          |             |             | |             | scan during |          |             |             | |             | build.      |          |             |             | |             | For details |          |             |             | |             | and further |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | options see |          |             |             | |             | the         |          |             |             | |             | GitGuardian |          |             |             | |             | secrets     |          |             |             | |             | scan        |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | +-------------+-------------+----------+-------------+-------------+ | tes         | Enable and  | no       |             |             | | tcontainers | configure   |          |             |             | |             | an          |          |             |             | |             | environment |          |             |             | |             | for running |          |             |             | |             | Tes         |          |             |             | |             | tcontainers |          |             |             | |             | in the      |          |             |             | |             | build step. |          |             |             | |             | Enabling    |          |             |             | |             | tes         |          |             |             | |             | tcontainers |          |             |             | |             | looks like  |          |             |             | |             | this:       |          |             |             | |             |             |          |             |             | |             | \"testc      |          |             |             | |             | ontainers\": |          |             |             | |             | {           |          |             |             | |             |             |          |             |             | |             | \"enabled\":  |          |             |             | |             | true        |          |             |             | |             | }           |          |             |             | |             | For details |          |             |             | |             | and further |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | options see |          |             |             | |             | the Tes     |          |             |             | |             | tcontainers |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | +-------------+-------------+----------+-------------+-------------+ | testreport  | Enable and  | no       |             |             | |             | configure   |          |             |             | |             | visual test |          |             |             | |             | reports     |          |             |             | |             | creation.   |          |             |             | |             | For details |          |             |             | |             | and         |          |             |             | |             | c           |          |             |             | |             | onfguration |          |             |             | |             | options see |          |             |             | |             | the         |          |             |             | |             | Testreport  |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | and this    |          |             |             | |             | how-to      |          |             |             | |             | article.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | versionTag  | Version tag | no       |             |             | |             | to use for  |          |             |             | |             | docker      |          |             |             | |             | builds with |          |             |             | |             | this        |          |             |             | |             | profile. If |          |             |             | |             | set, this   |          |             |             | |             | overrides   |          |             |             | |             | the version |          |             |             | |             | tag         |          |             |             | |             | derrived    |          |             |             | |             | from the    |          |             |             | |             | Git tag or  |          |             |             | |             | project     |          |             |             | |             | meta files. |          |             |             | |             | Can contain |          |             |             | |             | p           |          |             |             | |             | laceholders |          |             |             | |             | for         |          |             |             | |             | pre-defined |          |             |             | |             | pipeline    |          |             |             | |             | parameters  |          |             |             | |             | like        |          |             |             | |             | \"snapsh     |          |             |             | |             | ot-${DATE}\" |          |             |             | |             | or          |          |             |             | |             | \"           |          |             |             | |             | build-${BRA |          |             |             | |             | NCH_LABEL}\" |          |             |             | +-------------+-------------+----------+-------------+-------------+ | docker      | Override    | no       |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | docker      |          |             |             | |             | build       |          |             |             | |             | con         |          |             |             | |             | figuration. |          |             |             | |             | See Docker  |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | helm        | Override    | no       |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | Helm charts |          |             |             | |             | con         |          |             |             | |             | figuration. |          |             |             | |             | See Helm    |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | mvn         | Override    | no       |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | Maven build |          |             |             | |             | settings.   |          |             |             | |             | See Maven   |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | npm         | Override    | no       |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | settings    |          |             |             | |             | for NPM     |          |             |             | |             | builds.     |          |             |             | |             | See NPM     |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | flutter     | Override    | no       |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | settings    |          |             |             | |             | for Flutter |          |             |             | |             | builds.     |          |             |             | |             | See Flutter |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | go          | Override    | no       |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | settings    |          |             |             | |             | for Golang  |          |             |             | |             | builds.     |          |             |             | |             | See Go      |          |             |             | |             | co          |          |             |             | |             | nfiguration |          |             |             | |             | structure   |          |             |             | |             | for         |          |             |             | |             | details.    |          |             |             | +-------------+-------------+----------+-------------+-------------+  Tagging pipeline configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | v           | Regex       | no       | \"^(\\\\       |             | | ersionIncre | pattern     |          | d+)\\\\.(\\\\d+ |             | | mentPattern | defining    |          | )\\\\.(\\\\d+)\" |             | |             | how the     |          |             |             | |             | version is  |          |             |             | |             | i           |          |             |             | |             | ncremented. |          |             |             | |             | The first   |          |             |             | |             | segment in  |          |             |             | |             | brackets    |          |             |             | |             | will be     |          |             |             | |             | incremented |          |             |             | |             | by one and  |          |             |             | |             | the         |          |             |             | |             | following   |          |             |             | |             | brackets    |          |             |             | |             | will be set |          |             |             | |             | to 0.       |          |             |             | |             | Example:    |          |             |             | |             | \"REL-\\      |          |             |             | |             | \\d+\\\\.(\\\\d+ |          |             |             | |             | )\\\\.(\\\\d+)\" |          |             |             | |             | \u2013 this will |          |             |             | |             | increment   |          |             |             | |             | \"           |          |             |             | |             | REL-2.1.13\" |          |             |             | |             | to          |          |             |             | |             | \"REL-2.2.0\" |          |             |             | +-------------+-------------+----------+-------------+-------------+ | ve          | Which       | no       | \"minor\"     |             | | rsionIncrem | segment     |          |             |             | | entPosition | (major,     |          |             |             | |             | minor,      |          |             |             | |             | patch) to   |          |             |             | |             | increment   |          |             |             | |             | from the    |          |             |             | |             | ve          |          |             |             | |             | rsionIncrem |          |             |             | |             | entPattern. |          |             |             | |             |             |          |             |             | |             | If not      |          |             |             | |             | using       |          |             |             | |             | strict      |          |             |             | |             | semantic    |          |             |             | |             | versioning, |          |             |             | |             | the         |          |             |             | |             | position    |          |             |             | |             | can be      |          |             |             | |             | denoted     |          |             |             | |             | with \"one\", |          |             |             | |             | \"two\",      |          |             |             | |             | \"three\",    |          |             |             | |             | \"four\" or   |          |             |             | |             | \"five\". The |          |             |             | |             | used number |          |             |             | |             | must match  |          |             |             | |             | the number  |          |             |             | |             | of the      |          |             |             | |             | referenced  |          |             |             | |             | pair of     |          |             |             | |             | braces on   |          |             |             | |             | ve          |          |             |             | |             | rsionIncrem |          |             |             | |             | entPattern! |          |             |             | |             |             |          |             |             | |             | To disable  |          |             |             | |             | this        |          |             |             | |             | fu          |          |             |             | |             | nctionality |          |             |             | |             | you can use |          |             |             | |             | `none`.     |          |             |             | +-------------+-------------+----------+-------------+-------------+ | preR        | Should the  | no       |             |             | | eleaseVersi | next        |          |             |             | | onIncrement | pre-release |          |             |             | |             | version     |          |             |             | |             | (-SNAPSHOT) |          |             |             | |             | be set on   |          |             |             | |             | automatic   |          |             |             | |             | increment   |          |             |             | |             | and which   |          |             |             | |             | position    |          |             |             | |             | (major,     |          |             |             | |             | minor,      |          |             |             | |             | patch).     |          |             |             | |             | This option |          |             |             | |             | is only     |          |             |             | |             | considered  |          |             |             | |             | for Maven   |          |             |             | |             | projects    |          |             |             | |             | using       |          |             |             | |             | strict      |          |             |             | |             | sematic     |          |             |             | |             | versioning. |          |             |             | +-------------+-------------+----------+-------------+-------------+ | upda        | Should Helm | no       | true        |             | | teHelmChart | charts (if  |          |             |             | |             | defined in  |          |             |             | |             | helm block) |          |             |             | |             | be updated  |          |             |             | |             | in this     |          |             |             | |             | tagging     |          |             |             | |             | pipeline    |          |             |             | +-------------+-------------+----------+-------------+-------------+  For pure Maven builds, these settings should be something like this:  \"tagging\": {  \"updateHelmChart\": true,  \"versionIncrementPosition\": \"none\",  \"preReleaseVersionIncrement\": \"minor\"  },  With these settings the release build will just remove the -SNAPSHOT suffix, increment the version after the releasebuild and add -SNAPSHOT suffix again.  Custom pipeline configuration structure    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name      Description                                                                                                     Required   Default value   Since version   ------------------ --------------------------------------------------------------------------------------------------------------- ---------- --------------- ---------------   pipelineTemplate   Name of an OpenShift template defining a custom PipelineRun to process for this step.                           no                                               When ending with .yaml, the template is resolved to a file located in the 'tekton' folder of this repository.                                  pipelineRef        Name of a custom Pipeline to run for this step.                                                                 no                                               A Tekton pipeline with the given name must be defined in the build namespace.                                                                  params             Map (key: value) of parameters passed to the PipelineRun template.                                              no         {}                                    Values can contain placeholders for pre-defined pipeline parameters like \"rel-${VERSION_TAG}\".                                                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Sonar configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | enabled     | This flag   | yes      | false       |             | |             | decides     |          |             |             | |             | whether a   |          |             |             | |             | sonar       |          |             |             | |             | analysis is |          |             |             | |             | performed   |          |             |             | |             | or not.     |          |             |             | |             | Please also |          |             |             | |             | consult the |          |             |             | |             | details:    |          |             |             | |             | So          |          |             |             | |             | narAnalysis |          |             |             | |             |             |          |             |             | |             | If you want |          |             |             | |             | to do       |          |             |             | |             | Sonarscan   |          |             |             | |             | in a        |          |             |             | |             | release     |          |             |             | |             | build,      |          |             |             | |             | don't       |          |             |             | |             | forget to   |          |             |             | |             | set the     |          |             |             | |             | release     |          |             |             | |             | BranchName! |          |             |             | +-------------+-------------+----------+-------------+-------------+ | projectKey  | The         | no       | .           |             | |             | projectKey  |          | productName |             | |             | is the      |          |             |             | |             | project     |          |             |             | |             | into which  |          |             |             | |             | the         |          |             |             | |             | analysis    |          |             |             | |             | report is   |          |             |             | |             | loaded.     |          |             |             | +-------------+-------------+----------+-------------+-------------+ | ~~additio   | Additional  | no       |             | 0.25.0      | | nalParams~~ | maven       |          |             | (           | |             | options     |          |             | deprecated) | |             | like        |          |             |             | |             | \"-Dskip     |          |             |             | |             | Tests=true\" |          |             |             | |             | DEPRECATED! |          |             |             | |             | Set Sonar   |          |             |             | |             | options for |          |             |             | |             | Maven       |          |             |             | |             | builds to   |          |             |             | |             | buil        |          |             |             | |             | d.additiona |          |             |             | |             | lProperties |          |             |             | +-------------+-------------+----------+-------------+-------------+ | releas      | Specify the | no       |             |             | | eBranchName | branch name |          |             |             | |             | used for    |          |             |             | |             | SonarQube   |          |             |             | |             | in case     |          |             |             | |             | there is no |          |             |             | |             | git branch  |          |             |             | |             | in the      |          |             |             | |             | pipeline    |          |             |             | |             | context.    |          |             |             | |             | For all     |          |             |             | |             | builds      |          |             |             | |             | based on a  |          |             |             | |             | tag this    |          |             |             | |             | property is |          |             |             | |             | required to |          |             |             | |             | execute the |          |             |             | |             | sonar scan. |          |             |             | +-------------+-------------+----------+-------------+-------------+  GitGuardian secrets scan configuration structure    ------------------------------------------------------------------------------------------------------------------------------------   Property name   Description                                                               Required   Default value   Since version   --------------- ------------------------------------------------------------------------- ---------- --------------- ---------------   enabled         Enable the GitGuardian secrets scan on the current repository             yes        false           0.28.0    reportMode      How to report GitGuardian warnings.                                       no         \"UNSTABLE\"      0.28.0                   FAILED: make the pipeline fail with an error                                                                            UNSTABLE: report the pipeline to be unstable                                                                            LOG: only print the findings in the log                                                                  secretName      Alternative secret name to read GitGuardian credentials from.             no                         0.28.0                   Must contain entries named GITGUARDIAN_API_KEY and GITGUARDIAN_INSTANCE                                 ------------------------------------------------------------------------------------------------------------------------------------  OWASP dependency check configuration structure    -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name      Description                                                                                                                                                                                                                                                                                                                                                                                                             Required   Default value   Since version   ------------------ ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- --------------- ---------------   enabled            Do you want run the OWASP Dependency Check? (true / false)                                                                                                                                                                                                                                                                                                                                                              yes        false                                 The OWASP Dependency Check will by default just generate a report which can be displayed in Sonarqube. You need to click in Sonarqube on \"More\" \u2192 \"Dependency Check\". The OWASP Dependency Check Report will be displayed. If you want to fail the build if the dependency check finds too many issues, you need to set the according property in additionalParams. See the following documentation of the parameter.                                  additionalParams   Additional Parameter options like \"--failOnCVSS 5 --disableRetireJS\". You can find the possible parameter documentation on: https://jeremylong.github.io/DependencyCheck/dependency-check-cli/arguments.html                                                                                                                                                                                                            no                            -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Testcontainers configuration structure    ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name    Description                                                                                                                                            Required   Default value   Since version   ---------------- ------------------------------------------------------------------------------------------------------------------------------------------------------ ---------- --------------- ---------------   enabled          Enable pipeline environment for running Testcontainers.                                                                                                yes        false                               This option only has an effect in Maven, Npm and Go projects.                                                                                                                         kubedockParams   Additional arguments passed to the kubedock server command in order to tweak the containers environment. See the Kubedock documentation for details.   no                            ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Testreport configuration structure    ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name           Description                                                                                                       Required   Default value               Since version   ----------------------- ----------------------------------------------------------------------------------------------------------------- ---------- --------------------------- ---------------   enabled                 Enable the creation of test reports.                                                                              yes        false                                                  This option only has an effect in Maven, Npm and Go projects.                                                                                                artifactoryRepository   Name of the Artifactory repository where the generated reports are uploaded to.                                   no         \"esta-tekton.generic\"                                  Must end with .generic                                                                                                                                       resultsDir              Location where the result XMLs are located, from which the report should be created.                              no         \"target/surefire-reports\"       reportQualifiers        Additional qualifiers (aliases) to store the generated report with.                                               no         []                                                     These qualifiers can be used to connect new reports with in order to show Trend and history.                                                                 previousQualifiers      Copy history from the last report generated with these qualifiers to make the trend and history graphs working.   no         []                                                     The first matching qualifier will be used.                                                                                                                  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Custom task configuration structure    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name   Description                                                                                                                                                                        Required   Default value   Since version   --------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- --------------- ---------------   name            Name of this task. Needs to be unique within the pipeline spec.                                                                                                                    yes                            taskRef         Name of the Tekton task to execute. The according task needs to be present in the build namespace. See README.md for documentation of available tasks.                             yes                            params          Map (key: value) of parameters passed to the pipeline task.                                                                                                                        no         {}                                 Values can contain placeholders for pre-defined pipeline parameters like \"rel-${VERSION_TAG}\".                                                                                                                    executionMode   Mode how this task is executed.                                                                                                                                                    no         \"REGULAR\"                          REGULAR = injected into the regular pipeline execution (further specify with runAfter and runBefore)                                                                                                                             FINALLY = runs in the finally block (guarded with runConditions)                                                                                                                                                  runBefore       Name(s) of the pipeline task(s) this task must be preceded.                                                                                                                        no                                            Look at past pipeline runs to see the names and order of the standard pipeline tasks.                                                                                                                                            Only supported with executionMode \"REGULAR\".                                                                                                                                                                      runAfter        Name(s) of the pipeline task(s) this task shall execute after.                                                                                                                     no                                            If omitted, the task is appended to the end of the pipeline.                                                                                                                                                                     Only supported with executionMode \"REGULAR\".                                                                                                                                                                      runConditions   Condition(s) when this task should run.                                                                                                                                            no         \"success()\"                        Use short condition aliases \"success()\", \"failure()\", \"always()\" or expressions like \"$(tasks.build.status) in None,Succeed\". You can use Tekton variables in these expressions.                                                 Only supported with executionMode \"FINALLY\".                                                                                                                                                                     ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Stage configuration structure    ----------------------------------------------------------------------------------------------------------------------------------------------------   Property name   Description                                                                               Required   Default value   Since version   --------------- ----------------------------------------------------------------------------------------- ---------- --------------- ---------------   stageName       Unique name for this stage config                                                         yes                            argoCD          ArgoCD configuration structure used for deyploment.                                       no                                            See ArgoCD configuration structure below.                                                                                helm            Helm configuration defining charts used for deployment.                                   no                                            These stage settings overwrite properties from the global Helm configuration structure.                                                 See Helm configuration structure below.                                                                                 ----------------------------------------------------------------------------------------------------------------------------------------------------  ArgoCD configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | ar          | The app     | yes      | .           |             | | goCdAppName | name which  |          | productName |             | |             | will be     |          |             |             | |             | referenced  |          |             |             | |             | in ArgoCD.  |          |             |             | |             | Default     |          |             |             | |             | value is    |          |             |             | |             | the         |          |             |             | |             | top-level   |          |             |             | |             | productName |          |             |             | |             | property    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | autoSync    | If true,    | no       | false       |             | |             | the         |          |             |             | |             | deployment  |          |             |             | |             | pipeline    |          |             |             | |             | will        |          |             |             | |             | initiate an |          |             |             | |             | ArgoCD sync |          |             |             | +-------------+-------------+----------+-------------+-------------+ | a           | OpenShift   | no       | \"argocd-    |             | | rgoCdSecret | secret name |          | env-secret\" |             | |             | holding env |          |             |             | |             | variables   |          |             |             | |             | for the     |          |             |             | |             | argocd task |          |             |             | +-------------+-------------+----------+-------------+-------------+ | argoCdA     | ArgoCd app  | no       |             |             | | ppSyncFlags | sync flags  |          |             |             | |             | i.e.        |          |             |             | |             | --force     |          |             |             | |             | --replace,  |          |             |             | |             | with which  |          |             |             | |             | you can     |          |             |             | |             | control the |          |             |             | |             | way your    |          |             |             | |             | app should  |          |             |             | |             | be synced   |          |             |             | |             | by ArgoCD.  |          |             |             | |             | You find    |          |             |             | |             | the flags   |          |             |             | |             | documented  |          |             |             | |             | here:       |          |             |             | |             | https://arg |          |             |             | |             | o-cd.readth |          |             |             | |             | edocs.io/en |          |             |             | |             | /stable/use |          |             |             | |             | r-guide/com |          |             |             | |             | mands/argoc |          |             |             | |             | d_app_sync/ |          |             |             | |             |             |          |             |             | |             | For example |          |             |             | |             | if you are  |          |             |             | |             | using       |          |             |             | |             | --force     |          |             |             | |             | --replace,  |          |             |             | |             | it would    |          |             |             | |             | redeploy    |          |             |             | |             | also in     |          |             |             | |             | SNAPSHOT    |          |             |             | |             | case.       |          |             |             | +-------------+-------------+----------+-------------+-------------+  Notification configuration structure    ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   Property name         Description                                                                                                              Required   Default value   Since version   --------------------- ------------------------------------------------------------------------------------------------------------------------ ---------- --------------- ----------------------   type                  Type/delivery of notification messages.                                                                                  yes                                                 Currently supported are \"EMAIL\" or \"TEAMS\"                                                                                                              enabled               Enable or disable sending of notifications                                                                               no         true                eventTypes            Filter for events that trigger this notification.                                                                        no                                                  Possible values are \"SUCCESS\", \"FAILURE\", \"ABORTED\". If empty, all events will trigger notifications.                                                   pipelineTypes         Filter for pipeline types to trigger this notification.                                                                  no                                                  Possible values are \"TAGGING\", \"BUILD\", \"STAGING\", \"CUSTOM\"). If empty, all pipeline types will trigger notifications.                                  branchNameExcludes    List of prefixes of Git branches on which NO notifications shall be sent                                                 no         []                  recipients            List of recipient email addresses for EMAIL type notifications.                                                          (yes)      []                                       Use \"$actor\" as a placeholder for the user who triggered the pipeline event.                                                                            ~~webhookUrl~~        Webhook URL for TEAMS type notifications.                                                                                (yes)                      Deprecated in 0.24.0                         DEPRECATED. Save the webhook URL to a secret and reference with webhookSecretName and webhookUrlSecretKey instead.                                      webhookSecretName     Secret name providing the webhook URL for TEAMS type notifications                                                       (yes)                      0.24.0    webhookUrlSecretKey   Key of the secret entry holding the webhook URL for TEAMS type notifications                                             no         \"URL\"           0.24.0    title                 Override default title/subject for this notification.                                                                    no                                                  See the supported placeholders that will be replaced with the actual values.                                                                            message               Override default message text for this notification.                                                                     no                                                  See the supported placeholders that will be replaced with the actual values.                                                                           ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Advanced Build Settings configuration structure  +-------------+-------------+----------+-------------+-------------+ | Property    | Description | Required | Default     | Since       | | name        |             |          | value       | version     | +=============+=============+==========+=============+=============+ | buildWo     | Here you    | no       | 4Gi (mvn)   |             | | rkspaceSize | can define  |          | 3Gi (npm)   |             | |             | the build   |          | 3Gi         |             | |             | workspace   |          | (python)    |             | |             | size. You   |          | 2Gi (go)    |             | |             | need to do  |          | 1Gi         |             | |             | that in     |          | (others)    |             | |             | case your   |          |             |             | |             | build       |          |             |             | |             | process     |          |             |             | |             | produces    |          |             |             | |             | big         |          |             |             | |             | artifacts   |          |             |             | |             | and the     |          |             |             | |             | default     |          |             |             | |             | size of the |          |             |             | |             | build       |          |             |             | |             | pipeline    |          |             |             | |             | workspace   |          |             |             | |             | is not big  |          |             |             | |             | enough. You |          |             |             | |             | can set     |          |             |             | |             | something   |          |             |             | |             | like 2Gi or |          |             |             | |             | 500Mi as a  |          |             |             | |             | value.      |          |             |             | +-------------+-------------+----------+-------------+-------------+ | taggingWo   | Here you    | no       | 500Mi       |             | | rkspaceSize | can define  |          |             |             | |             | the tagging |          |             |             | |             | workspace   |          |             |             | |             | size. You   |          |             |             | |             | need to do  |          |             |             | |             | that in     |          |             |             | |             | case your   |          |             |             | |             | git         |          |             |             | |             | repository  |          |             |             | |             | contains    |          |             |             | |             | large files |          |             |             | |             | and the     |          |             |             | |             | default     |          |             |             | |             | size of the |          |             |             | |             | tagging     |          |             |             | |             | pipeline    |          |             |             | |             | workspace   |          |             |             | |             | is not big  |          |             |             | |             | enough. You |          |             |             | |             | can set     |          |             |             | |             | something   |          |             |             | |             | like 2Gi or |          |             |             | |             | 500Mi as a  |          |             |             | |             | value.      |          |             |             | +-------------+-------------+----------+-------------+-------------+ | bui         | Sets the    | no       | 2Gi         |             | | ldCacheSize | size of the |          |             |             | |             | cache       |          |             |             | |             | volume used |          |             |             | |             | for build   |          |             |             | |             | pipelines.  |          |             |             | |             | The cache   |          |             |             | |             | serves as a |          |             |             | |             | persistent  |          |             |             | |             | store for   |          |             |             | |             | downloaded  |          |             |             | |             | de          |          |             |             | |             | pendencies. |          |             |             | |             | Depending   |          |             |             | |             | on the      |          |             |             | |             | application |          |             |             | |             | the size of |          |             |             | |             | all         |          |             |             | |             | d           |          |             |             | |             | ependencies |          |             |             | |             | can vary    |          |             |             | |             | and         |          |             |             | |             | therfore    |          |             |             | |             | the cache   |          |             |             | |             | size can be |          |             |             | |             | adjusted    |          |             |             | |             | i           |          |             |             | |             | ndividually |          |             |             | |             | in case you |          |             |             | |             | see disk    |          |             |             | |             | space       |          |             |             | |             | errors. Set |          |             |             | |             | values like |          |             |             | |             | 800Mi or    |          |             |             | |             | 6Gi.        |          |             |             | +-------------+-------------+----------+-------------+-------------+ | pipe        | This sets   | no       | no value    |             | | lineTimeout | the global  |          | set         |             | |             | timeout of  |          | (1h0m0s)    |             | |             | the         |          |             |             | |             | Pipeline.   |          |             |             | |             | The Default |          |             |             | |             | of Tekton   |          |             |             | |             | Pipelines   |          |             |             | |             | is 1h0m0s   |          |             |             | |             | which       |          |             |             | |             | stands for  |          |             |             | |             | 1 hours 0   |          |             |             | |             | minutes 0   |          |             |             | |             | seconds. So |          |             |             | |             | you could   |          |             |             | |             | set for     |          |             |             | |             | example a   |          |             |             | |             | global      |          |             |             | |             | timeout to  |          |             |             | |             | 2h30m0s.    |          |             |             | +-------------+-------------+----------+-------------+-------------+ | t           | This sets   | no       | no value    | 0.28.0      | | askTimeouts | the timeout |          | set         |             | |             | of specific |          | (every task |             | |             | tasks. The  |          | 1h0m0s)     |             | |             | default for |          |             |             | |             | each is     |          |             |             | |             | task is     |          |             |             | |             | 1h0m0s      |          |             |             | |             | which       |          |             |             | |             | stands for  |          |             |             | |             | 1 hours 0   |          |             |             | |             | minutes 0   |          |             |             | |             | seconds.    |          |             |             | |             | The values  |          |             |             | |             | are to be   |          |             |             | |             | set in an   |          |             |             | |             | object. The |          |             |             | |             | name of the |          |             |             | |             | task is the |          |             |             | |             | key, and    |          |             |             | |             | the timeout |          |             |             | |             | time is the |          |             |             | |             | value:      |          |             |             | |             |             |          |             |             | |             | \"tas        |          |             |             | |             | kTimeouts\": |          |             |             | |             | {           |          |             |             | |             |             |          |             |             | |             | \"doc        |          |             |             | |             | ker-build\": |          |             |             | |             | \"2h0m0s\"    |          |             |             | |             | }           |          |             |             | +-------------+-------------+----------+-------------+-------------+  Pre-defined Pipeline Parameters  The following parameters are provided by the ESTA Tekton Controller and passed to pipeline templates when starting a pipeline. They can be used in custom pipeline templates as well as for placeholder substitution in values from estaTektonPipeline.json. Insert these parameters in JSON with this syntax: ${PARAM_NAME}  REPOSITORY - Bitbucket repository key in the form <project-key>--<repository-slug> (all lower-cased)  PRODUCT - The productName from estaTektonPipeline.json or the repository slug if not defined  RANDOMNAME - A random alpha-numeric value of 6 characters  GIT_URL - The git clone URL to the source repository  GIT_REVISION - The git revision (sha) to be cloned into the pipeline workspace  GIT_REV_SHORT - The short version of the GIT_REVISION (first 10 characters)  GIT_COMMIT_MESSAGE - The first line of the last commit message  GIT_BRANCH - Git branch name (not set when pipeline started from a Git tag)  DATE - The current date of the pipeline execution (yyyyMMdd)  DATETIME - The current date/time of the pipeline execution (yyyyMMddHHmmss)  ACTOR - Email address of the person/account who initiated the pipeline run  USER_ID - User ID (SBB employee number/unique identifier for system users) of the person/account who initiated the pipeline (since 0.28.0)  VERSION_TAG - Release version (for tagging) or Git tag (for release builds) \u2013 ATTENTION: This parameter is not available for builds based on a branch  BRANCH_LABEL - Normalized name of the Git branch (lower-cased, alpha-numeric)  CI - Could be used to determine if running on Tekton or not. Comparable to former check for BUILD_NUMBER on Jenkins based build systems.  PACKAGE_VERSION - Package Version is the current Version. The Version is written in pom.xml, package.json or estaTektonPipeline.json "}, {"text": "Parameterisierte Builds  Auf Jenkins existieren heute einige Pipelines mit Parameterisierbaren Builds. Solche Builds sollen auch in Esta-Tekton erm\u00f6glicht werden.  Wenn ein Build \u00fcber das Tekton Ui gestartet wird, soll es die M\u00f6glichkeit geben diverse im estaTektonPipeline.json vordefinierte Buildparameter \u00fcber das UI abzuf\u00fcllen.  Grunds\u00e4tzlich w\u00e4re eine Umsetzung nicht allzu kompliziert, der etwas aufw\u00e4ndigere Teil ist aber, im Ui die richtigen Felder zur nachfolgend richtigen Pipeline darzustellen. Gerade wenn eine Tagging Pipeline gestartet wird, soll anhand der Version (Version oder Preversion usw.) die richtige nachfolgende Pipeline evaluiert und auch etwaige Parameter richtig im UI dargestellt werden.   Anforderungen  Die groben Anforderungen sollen hier gelistet werden.  -   Liste der m\u00f6glichen Parameter werden in dem estaTektonPipeline.json     deklariert. :tick:  -   Default Values k\u00f6nnen pro Pipeline \u00fcberschrieben werden :question:  -   Im UI werden dann entsprechend die richtigen Parameter der     Buildpipeline dargestellt.   -   Im Tagging UI muss die Buildpipeline anhand der Version predicted     und entsprechend die default values abgef\u00fcllt werden. :question:  -   Jedem Parameter kann einer der Typen zugewiesen werden: String,     Multiline, Choice, MultiChoice, Boolean      -   Die UI Darstellung w\u00e4re wie folgt gemapped          -   String \u2192 Input Feld          -   Multiline \u2192 Multiline Feld          -   Choice \u2192 Radio Buttons (hier k\u00f6nnte auch Boolean dar\u00fcber             abgebildet werden)          -   Multi Choice \u2192 Checkboxen          -   Evtl. boolean Typ abbilden \u2192 Checkbox  -   In einem ersten Wurf w\u00fcrde im Build-Assistent-UI einfach ein grosses     Textfeld dargestellt, welches eine Liste aus Key=Values editierbar     macht. So k\u00f6nnen die Builds dann parametrisierbar gemacht werden  -   Fastbuildbutton w\u00fcrde bei parametrisierbaren builds die default     Werte \u00fcbergeben :question:  -   Die Key=Values sollen auch per externem File abgef\u00fcllt werden     k\u00f6nnen. Entweder automatisch per PipelineConfig oder im UI per     Upload Button oder Load from URL Button. :question:  -   Die Parameter werden als JSON in jedem TaskRun zur Verf\u00fcgung stehen.     :tick:  -   Die Parameter sollen von Pipeline zu Pipeline weitergereicht werden.     Dies soll durch die ganze Kette funktionieren: Tagging \u2192 Build \u2192     Staging. :tick:  -   Die Parameter werden als JSON vom Controller aus den Parametern     ausgelesen und an die n\u00e4chste Pipeline \u00fcbergeben. :tick:  -   Die Parameter sollen in den PipelineDetails im UI dargestellt     werden.  :tick:  -   Rerun mit Parameter soll zu einem sp\u00e4teren Zeitpunkt ebenfalls     funktionieren. Es wird dann ein UI mit den Parametern dargestellt.     :question:  Die Anforderungen sind noch nicht abschliessend.  EstaTektonPipeline.json  Parameter Definitiion  Die Konfiguration der Parameter wird wie folgt aussehen:  \"parameters\": [  {  \"name\": \"environment\",  \"type\": \"Multichoice\",  \"values\": [\"dev\",\"test\"],  \"label\": \"Environment to stage\",  \"description\": \"Environment to stage to\",  \"options\": [\"dev\", \"test\", \"prod\"]  },  {  \"name\": \"notificationEmails\",  \"type\": \"Multichoice\",  \"values\": [\"manuel.wallrapp@sbb.ch\",\"thomas.bruederli@sbb.ch\"],  \"options\": [\"manuel.wallrapp@sbb.ch\",\"thomas.bruederli@sbb.ch\",\"lukas.spirig@sbb.ch\"]  \"description\": \"The emailadresses which the notifications are sent to\"  }  ],  Parameter Werte anhand eines Fileparse setzen  Hier gibt es ein Beispiel wie Parameterwerte anhand einer File Url (z.B. \u00fcber Artifactory) gesetzt werden:  https://code.sbb.ch/projects/KI_KIHUB/repos/kihub-pipelines/browse/src/main/pipelines/mmi-cus-dev/Jenkinsfile-PrepareP2Update#13-38  Dieses Feature sollte bedacht werden, w\u00fcrde aber zu einem sp\u00e4teren Zeitpunkt nachgeliefert.  Ein Textfile welches z.B. in Artifactory abgelegt w\u00e4re h\u00e4tte dann folgenden content:  successmail: manuel.wallrapp@sbb.ch environment: dev  Dann kann pro Parameter ein Link auf das Textfile angegeben werden. Das heisst der Inhalt des Textfiles wird geholt und dann geschaut ob ein Parameter Wert vorhanden ist. Dieser wird dann geholt und entsprechend f\u00fcr den Build gesetzt.  Parameter als Placeholder :question:  Es sollen auch \u00e4hnlich wie die predefined Variablen Parameter als Placeholder verwendet werden k\u00f6nnen. Dazu gibt man einfach den Parameter wie folg an:  \"tasks\": [{  \"name\": \"post-build\",     \"taskRef\": \"custom-post-build-job\",     \"params\": {     \"STAGE\": \"${parameters:environment}\",     \"MAILTO\": \"${parameters:successemail}\",  \"runAfter\": \"maven-deploy\"  }]  Diese Variablen werden dann beim prozessieren des estaTektonPipeline.json eingesetzt.  estaTektonPipeline.json Beispiel  In estaTektonPipeline.json w\u00fcrde man global die Parameter definieren und sie dann pro Pipelinedefinition referenzieren. Das sieht dann in einem einfachen Json wie folg aus:  {  \"$schema\": \"../../main/resources/estaTektonPipelineSchema.json\",  \"productName\": \"esta-tekton-pipeline-test-docker\",  \"helm\": {  \"chartName\": \"esta-tekton-pipeline-test\",  \"chartRepository\": \"esta.helm.local\",  \"chartRootFolder\": \"./mycharts\"  },  \"mvn\": {  \"parentPom\": \"pom.xml\",  \"deployableArtifactsPom\": \"pom.xml\",  \"artifactoryMavenRepo\": \"esta.mvn\"  },    \"parameters\": [  {  \"name\": \"environment\",  \"type\": \"Multichoice\",  \"values\": [\"dev\",\"test\"],  \"label\": \"Environment to stage\",  \"description\": \"Environment to stage to\",  \"options\": [\"dev\", \"test\", \"prod\"]  },  {  \"name\": \"notificationEmails\",  \"type\": \"Multichoice\",  \"values\": [\"manuel.wallrapp@sbb.ch\",\"thomas.bruederli@sbb.ch\"],  \"options\": [\"manuel.wallrapp@sbb.ch\",\"thomas.bruederli@sbb.ch\",\"lukas.spirig@sbb.ch\"]  \"description\": \"The emailadresses which the notifications are sent to\"  }  ],   \"pipelines\": [  {  \"name\": \"snapshot\",  \"triggerType\": [  \"USER\"  ],  \"build\": {  \"packageAndDeployHelmChart\": true  },  \"tasks\": [          {           \"name\": \"post-build\",           \"taskRef\": \"custom-post-build-job\",            \"params\": {             \"STAGE\": \"${parameters:environment}\",             \"MAILTO\": \"${parameters:successemail}\"           },            \"runAfter\": \"maven-deploy\"          }       ]  }  ]  }  Parametertypen  Es werden folgende Parametertypen im estaTektonPipeline.json definierbar sein und dann entsprechend im Ui dargestellt:  -   String - ein normales Inputfeld  -   Multiline - ein multiline Inputfeld  -   Choice - eine Radiobox mit Singleauswahl  -   Multichoice - checkboxen mit Mehrfachauswahl  -   Boolean - ist wie Multichoice aber nur mit einer Checkbox  Jeder Parameter stellt noch ein ? mit Hovereffekt dar, welches eine Kurzbeschreibung des Parameters aufpoppt.   All diese Parameter k\u00f6nnen auch \u00fcber das REST Api von Esta-Tekton angesprochen werden.  Globale Default Values / Pipeline Default Values  Bei den Parametern sollen globale default Values gesetzt werden k\u00f6nnen. Die gelten dann \u00fcberall wo dieser Parameter verwendet wird. Dieser default value kann dann aber pro Pipeline nochmals \u00fcberschrieben werden. So k\u00f6nnen z.B. default Values f\u00fcr Cronjobs anders aussehen als Default Values f\u00fcr UI started jobs. Das \u00fcberschreiben pro Pipeline ist noch nicht implementiert.  Esta Tekton Ui Darstellung  Im Build Ui w\u00fcrden dann die Buildparameter beim Auswahl des branches dargestellt. Das heisst wenn der Branch oder Tag ausgew\u00e4hlt wird, ermittelt das Ui \u00fcber einen Call auf den Controller die richtige Pipeline(s) und kriegt somit gleich die Buildparameter mit. Werden mehrere Builds gestartet, werden die Parameter nach Pipeline gruppiert in Tabs dargestellt.  []  Die Parameter werden dann bei der Execution des Builds mitgegeben.  CHALLENGE  Beim Starten einer Tagging Pipeline via UI wird das Filtering der anzuzeigenden Parameter aufgrund der selektierten/eingegebenen Version gemacht. Falls mehrere Pipelines mit Parameter Spezifikation matchen, w\u00fcrden die Parameter in sepraten Panes betitelt nach der Zielpipeline dargestellt. Daf\u00fcr m\u00fcsste man das PipelineMatching nach GitEvent ausf\u00fchren und schauen welche Pipelines gestartet w\u00fcrden. Es m\u00fcssen die Zielparameter aller Pipelines dargestellt werden, da  Template Parameter  In den Templates wird es dann einen Parameter geben, der eine JSon Struktur mit den Parametern und dessen Werten beinhaltet.  Den Parameter w\u00fcrden wir mit USER_INPUT_PARAMETER benennen. Eine Convenience Funktion in den Tasks w\u00fcrde dann diese Parameter als Objekt oder Variablen im Typescript oder Bashscript zur Verf\u00fcgung stellen. Auch soll es convenience Funktionen zur Verarbeitung der Parameter geben. Der Inhalt dieses Parameters w\u00fcrde wie folgt aussehen:  Parameter Content  {  \"environment\": \"dev\"  \"successmail\": [\"manuel.wallrapp@sbb.ch\", \"julien.jeaneret@sbb.ch\"]  }  In Typescript ist die Verarbeitung relativ einfach. In Bash Script w\u00fcrde die Verarbeitung mit JQ geschehen.   Build Execution \u00fcber REST  Die Buildexecution kann auch \u00fcber REST geschehen wo auch die Parameter entsprechend gesetzt werden.   Build Execution Ablauf und Parameter Weitergabe  Bei der Buildexecution werden die Parameter vom UI oder REST service an den Controller weitergereicht. Auch wird mit diesen Parametern ein Parameter Substitution ausgef\u00fchrt. Das Gleiche wird auch f\u00fcr diese Variablen gemacht: ESTA Tekton Parameters - estaTektonPipeline.json#Pre-definedPipelineParameters  Die Parameter sollen folglich in der ganzen Pipeline Kette verwendbar sein. Das heisst der Parameter USER_INPUT_PARAMETER wird am Ende der Pipeline ausgelesen und in das PipelineEvent Objekt geschrieben um dann mit diesem Event Objekt die neue Pipeline (Tagging \u2192 Build \u2192 Staging) zu starten. In die neue Pipeline wird dieser Parameter USER_INPUT_PARAMETER dann erneut injected.   Auffinden von Parametern bei Bitbucket Events  Wenn die Taggingpipeline mit Parametern gestartet wird, so werden auch automatisch die Annotations auf der Pipeline gesetzt, welche die zu taggenden Versionen beschreiben.  Somit w\u00fcrde es bei einer Mavenpipeline 4 zus\u00e4tzliche Annotations geben:  -   gitProject (existiert bereits)  -   gitRepo (existiert bereits)  -   releaseVersion (effektiv released version)  -   nextVersion (z.B. next snapshot version)  Anhand dieser Informationen kann dann die nachfolgende Pipeline den Pipelinerun auffinden und den Parametern USER_INPUT_PARAMETER auslesen.   Injecten der Parameter in Pipeline und Tasks  Die User Defined Parameter werden folglich in alle Tasks, auch Custom Tasks \u00fcber TemplateModifiers und TaskModifiers injected werden. Somit k\u00f6nnen diese Parameter in allen Tasks verwendet werden.  Ablauf des Releaseprozesses und Parameterweitergabe  [] "}, {"text": "Esta Tekton Development  Notizen, Vorgehen, Ideen zur Esta Tekton Pipeline.   -   Gesamtarchitektur Esta Tekton Pipeline  -   Esta Tekton Tagging Process Detailed  -   Esta Tekton Controller Architektur      -   Start einer Tekton Pipeline  -   Deployment Setup von ESTA Tekton  -   Ablauf Release/Deployment Prozess mit ESTA Tekton, Helm und ArgoCD  -   Source Repositories  -   Feature Matrix (Draft)  -   Custom Pipelines (Draft)      -   Custom Pipeline Templates im Projekt-Repository      -   Custom Repository mit Pipeline und Task Definitionen      -   Integration in estaTektonPipeline.json  -   Controller REST API (Draft)  Gesamtarchitektur Esta Tekton Pipeline  []  Esta Tekton Tagging Process Detailed  []  Esta Tekton Controller Architektur  []  REST API (Klassen)  Definieren und bedienen das REST API. F\u00fcr den Datenaustausch werden interne Models in DTO (Data Transfer Objects) gemapped und umgekehrt.  Services (Module)  Enthalten Service-Klassen, welche die Businesslogik des Controllers implementieren und mit Umsystemen wie Bitbucket oder Openshift/Tekton kommunizieren.  Eventbus  Asynchrone Ereignisse werden \u00fcber den Eventbus gesendet, wo einzelne Service-Klassen Subscriptions registrieren, um die Ereignisse und deren Daten zu empfangen und zu verarbeiten.  Start einer Tekton Pipeline  TBD.  Deployment Setup von ESTA Tekton  Wir wollen die M\u00f6glichkeit bieten, dass jedes Team ihre eigenes ESTA Tekton Build System aufsetzen k\u00f6nnen. Dies geschieht \u00fcber ein Umbrella Chart und eine ArgoCD Konfiguration.  Ein m\u00f6gliches Setup soll anhand dieser Grafik aufgezeigt werden:  []  Ablauf Release/Deployment Prozess mit ESTA Tekton, Helm und ArgoCD  []  Source Repositories    -------------------------------------------------------------------------------------------------------------------------------   Beschreibung                      Link   --------------------------------- ---------------------------------------------------------------------------------------------   ESTA Tekton Controller            https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-controller/browse    Tekton Control Panel UI           https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-ui/browse    Tekton Pipeline Templates         https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-templates/browse    Tekton Builder Images             https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-java-builder-image/browse                                     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-helm-builder-image/browse                                     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-go-builder-image/browse                                     https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-python-builder-image/browse    Build Namespace Config            https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-pipeline-config/browse    Tekton Test/Dev Projects          https://code.sbb.ch/projects/KD_ESTA_TEST    Tekton Integrationtests           https://code.sbb.ch/projects/KD_ESTA/repos/esta-tekton-integrationtests/browse    Tekton Integrationtest Projects   https://code.sbb.ch/projects/KD_ESTA_TEKTON_IT/   -------------------------------------------------------------------------------------------------------------------------------  Feature Matrix (Draft)  Auf Basis des estaCloudPipeline.json ist in nachfolgender Matrix sichtbar welche Version der EstaTektonPipeline welche Features supported.  V1: Produktiver Pilot (1-5 Projekte builden mit Tekton)  V2: Rampup interner Release f\u00fcr CLEW Projekte Final: Release f\u00fcr erste public Migrationen  +-------+-------+-------+-------+-------+-------+-------+-------+ | Root  | Fe    | Esta  | V1    | V2    | Final | De    | JSON  | | Prope | ature | Cloud |       |       |       | fault | Path  | | rties | Be    | Pip   |       |       |       |       | /     | |       | schre | eline |       |       |       |       | B     | |       | ibung |       |       |       |       |       | emerk | |       |       |       |       |       |       |       | ungen | +=======+=======+=======+=======+=======+=======+=======+=======+ | p     | Name  | :c    | :     | :     | :     |       | .p    | | roduc | der   | ross: | tick: | tick: | tick: |       | roduc | | tName | Appli |       |       |       |       |       | tName | |       | katio |       |       |       |       |       |       | |       | n/des |       |       |       |       |       |       | |       | Pro   |       |       |       |       |       |       | |       | ducts |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | mainB | A     | :     | :c    | :c    | :c    |       |       | | ranch | ngabe | tick: | ross: | ross: | ross: |       |       | |       | des   |       |       |       |       |       |       | |       | Haupt |       |       |       |       |       |       | |       | Bra   |       |       |       |       |       |       | |       | nches |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ho    | An    | :     | :c    | :c    | :c    |       | Wird  | | tfixB | geabe | tick: | ross: | ross: | ross: |       | in    | | ranch | des   |       |       |       |       |       | Stepk | |       | H     |       |       |       |       |       | onfig | |       | otfix |       |       |       |       |       | g     | |       | Bra   |       |       |       |       |       | el\u00f6st | |       | nches |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | vers  | A     | :     | :     | :     | :     |       | Wird  | | ionin | ngabe | tick: | tick: | tick: | tick: |       | \u00fcber  | | creme | der   |       |       |       |       |       | Ta    | | ntPos | Ve    |       |       |       |       |       | gging | | ition | rsion |       |       |       |       |       | A     | |       | ma    |       |       |       |       |       | ssist | |       | jor.m |       |       |       |       |       | enten | |       | inor. |       |       |       |       |       | im    | |       | patch |       |       |       |       |       | GUI   | |       | w     |       |       |       |       |       | und   | |       | elche |       |       |       |       |       | Auto  | |       | ink   |       |       |       |       |       | -rele | |       | remen |       |       |       |       |       | asing | |       | tiert |       |       |       |       |       | Fe    | |       | w     |       |       |       |       |       | ature | |       | erden |       |       |       |       |       | ge    | |       | soll  |       |       |       |       |       | l\u00f6st. | +-------+-------+-------+-------+-------+-------+-------+-------+ | ad    | Erm\u00f6g | :     | :c    | :c    | :c    |       |       | | vance | licht | tick: | ross: | ross: | ross: |       |       | | dMode | im    |       |       |       |       |       |       | |       | Jenki |       |       |       |       |       |       | |       | nsgui |       |       |       |       |       |       | |       | mehr  |       |       |       |       |       |       | |       | Para  |       |       |       |       |       |       | |       | meter |       |       |       |       |       |       | |       | die   |       |       |       |       |       |       | |       | man   |       |       |       |       |       |       | |       | zum   |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | etzen |       |       |       |       |       |       | |       | kann  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | esta  | Gibt  | :     | :c    | :c    | :c    |       | Wird  | | Debug | ein   | tick: | ross: | ross: | ross: |       | \u00fcber  | |       | detai |       |       |       |       |       | addit | |       | llier |       |       |       |       |       | ional | |       | teres |       |       |       |       |       | B     | |       | Bui   |       |       |       |       |       | uildp | |       | ldlog |       |       |       |       |       | arams | |       | aus   |       |       |       |       |       | g     | |       |       |       |       |       |       |       | el\u00f6st | |       |       |       |       |       |       |       | oder  | |       |       |       |       |       |       |       | aber  | |       |       |       |       |       |       |       | den   | |       |       |       |       |       |       |       | Log   | |       |       |       |       |       |       |       | level | |       |       |       |       |       |       |       | des   | |       |       |       |       |       |       |       | Con   | |       |       |       |       |       |       |       | troll | |       |       |       |       |       |       |       | ers.  | +-------+-------+-------+-------+-------+-------+-------+-------+ | keep  | Pro   | :     | :c    | :c    | :c    |       |       | | Relea | perty | tick: | ross: | ross: | ross: |       |       | | seBui | we    |       |       |       |       |       |       | | ldLog | lches |       |       |       |       |       |       | | sOnJe | bis   |       |       |       |       |       |       | | nkins | zu 5  |       |       |       |       |       |       | |       | R     |       |       |       |       |       |       | |       | eleas |       |       |       |       |       |       | |       | ebuil |       |       |       |       |       |       | |       | dlogs |       |       |       |       |       |       | |       | spei  |       |       |       |       |       |       | |       | chert |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | send  | Per   | :     | :     | :     | :     | true  | .n    | | Build | De    | tick: | tick: | tick: | tick: |       | otifi | | Statu | fault |       |       |       |       |       | catio | | sMail | wird  |       |       |       |       |       | ns[*] | |       | ein   |       |       |       |       |       | .send | |       | B     |       |       |       |       |       | ingEn | |       | uilds |       |       |       |       |       | abled | |       | tatus |       |       |       |       |       |       | |       | Email |       |       |       |       |       |       | |       | gese  |       |       |       |       |       |       | |       | ndet, |       |       |       |       |       |       | |       | hier  |       |       |       |       |       |       | |       | kann  |       |       |       |       |       |       | |       | das   |       |       |       |       |       |       | |       | aus   |       |       |       |       |       |       | |       | gesch |       |       |       |       |       |       | |       | alten |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | erden |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | integ | Hier  | :     | :     | :     | :     |       | .ste  | | ratio | kann  | tick: | tick: | tick: | tick: |       | ps[*] | | nBuil | e     |       |       |       |       |       | .cron | | dCron | inges |       |       |       |       |       |       | |       | tellt |       |       |       |       |       |       | |       | we    |       |       |       |       |       |       | |       | rden, |       |       |       |       |       |       | |       | ob    |       |       |       |       |       |       | |       | der   |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | n\u00e4ch  |       |       |       |       |       |       | |       | tlich |       |       |       |       |       |       | |       | per   |       |       |       |       |       |       | |       | Cr    |       |       |       |       |       |       | |       | onjob |       |       |       |       |       |       | |       | ausge |       |       |       |       |       |       | |       | f\u00fchrt |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | erden |       |       |       |       |       |       | |       | soll  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | jdk   | Au    | :     | :     | :     | :     |       | .mvn  | | Label | swahl | tick: | tick: | tick: | tick: |       | .jdkL | |       | des   |       |       |       |       |       | abel  | |       | JDK's |       |       |       |       |       |       | |       | f\u00fcr   |       |       |       |       |       |       | |       | den   |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | (Soll |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | Zu    |       |       |       |       |       |       | |       | kunft |       |       |       |       |       |       | |       | \u00fcber  |       |       |       |       |       |       | |       | Maven |       |       |       |       |       |       | |       | gesc  |       |       |       |       |       |       | |       | hehen |       |       |       |       |       |       | |       | und   |       |       |       |       |       |       | |       | aussc |       |       |       |       |       |       | |       | hlies |       |       |       |       |       |       | |       | slich |       |       |       |       |       |       | |       | Op    |       |       |       |       |       |       | |       | enJdk |       |       |       |       |       |       | |       | verw  |       |       |       |       |       |       | |       | endet |       |       |       |       |       |       | |       | we    |       |       |       |       |       |       | |       | rden) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | op    | Open  | :     | :c    | :c    | :c    |       | T     | | enshi | shift | tick: | ross: | ross: | ross: |       | ekton | | ftTem | Tem   |       |       |       |       |       | baut  | | plate | plate |       |       |       |       |       | auf   | | Valid | Valid |       |       |       |       |       | Helm  | | ation | ation |       |       |       |       |       | auf.  | |       | pr\u00fcft |       |       |       |       |       |       | |       | jedes |       |       |       |       |       |       | |       | Tem   |       |       |       |       |       |       | |       | plate |       |       |       |       |       |       | |       | vor   |       |       |       |       |       |       | |       | V     |       |       |       |       |       |       | |       | alidi |       |       |       |       |       |       | |       | erung |       |       |       |       |       |       | |       | (     |       |       |       |       |       |       | |       | Deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | per   |       |       |       |       |       |       | |       | Ar    |       |       |       |       |       |       | |       | goCD) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | K     |       |       |       |       |       |       |       | | onfig |       |       |       |       |       |       |       | | struk |       |       |       |       |       |       |       | | turen |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | d     | Do    | :     | :     | :     | :     |       | .d    | | ocker | cker- | tick: | tick: | tick: | tick: |       | ocker | |       | Build |       |       |       |       |       |       | |       | Konf  |       |       |       |       |       |       | |       | igstr |       |       |       |       |       |       | |       | utkur |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | mvn   | M     | :     | :     | :     | :     |       | .mvn  | |       | aven- | tick: | tick: | tick: | tick: |       |       | |       | Build |       |       |       |       |       |       | |       | Konf  |       |       |       |       |       |       | |       | igstr |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | npm   | NPM-  | :     | :     | :     | :     |       | .npm  | |       | Build | tick: | tick: | tick: | tick: |       |       | |       | Konf  |       |       |       |       |       |       | |       | igstr |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | go    | Go-   | :     | :     | :     | :     |       | .go   | |       | Build | tick: | tick: | tick: | tick: |       |       | |       | Konf  |       |       |       |       |       |       | |       | igstr |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | s     | S     | :     | :     | :     | :     |       | .s    | | tages | tages | tick: | tick: | tick: | tick: |       | tages | |       | Str   |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | |       | f\u00fcr   |       |       |       |       |       |       | |       | das   |       |       |       |       |       |       | |       | St    |       |       |       |       |       |       | |       | aging |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | steps | Steps | :     | :     | :     | :     |       | .     | |       | Str   | tick: | tick: | tick: | tick: |       | steps | |       | uktur |       |       |       |       |       | \u2192     | |       | f\u00fcr   |       |       |       |       |       | .pipe | |       | das   |       |       |       |       |       | lines | |       | Setup |       |       |       |       |       |       | |       | von   |       |       |       |       |       |       | |       | ver   |       |       |       |       |       |       | |       | schie |       |       |       |       |       |       | |       | denen |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | typen |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | helm  | Helm  | :     | :     | :     | :     |       | .helm | |       | Ko    | tick: | tick: | tick: | tick: |       |       | |       | nfigu |       |       |       |       |       |       | |       | ratio |       |       |       |       |       |       | |       | nsstr |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | c     | C     | :     | :     | :     | :     |       | .pi   | | reden | reden | tick: | tick: | tick: | tick: |       | pelin | | tials | tials |       |       |       |       |       | es[*] | |       | Ko    |       |       |       |       |       | .envS | |       | nfigu |       |       |       |       |       | ecret | |       | ratio |       |       |       |       |       |       | |       | nsstr |       |       |       |       |       |       | |       | utkur |       |       |       |       |       |       | |       | um    |       |       |       |       |       |       | |       | C     |       |       |       |       |       |       | |       | reden |       |       |       |       |       |       | |       | tials |       |       |       |       |       |       | |       | der   |       |       |       |       |       |       | |       | Pip   |       |       |       |       |       |       | |       | eline |       |       |       |       |       |       | |       | mitzu |       |       |       |       |       |       | |       | geben |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | not   | Not   | :c    | :     | :     | :     |       | .not  | | ifica | ifica | ross: | tick: | tick: | tick: |       | ifica | | tions | tions |       |       |       |       |       | tions | |       | Ko    |       |       |       |       |       |       | |       | nfigu |       |       |       |       |       |       | |       | ratio |       |       |       |       |       |       | |       | nsstr |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | tea   | Teams | :     | :     | :     | :     |       | .     | | msNot | Ko    | tick: | tick: | tick: | tick: |       | notif | | ifica | nfigu |       |       |       |       |       | icati | | tions | ratio |       |       |       |       |       | ons[t | |       | nsstr |       |       |       |       |       | ype=t | |       | uktur |       |       |       |       |       | eams] | |       | um    |       |       |       |       |       |       | |       | Not   |       |       |       |       |       |       | |       | ifica |       |       |       |       |       |       | |       | tions |       |       |       |       |       |       | |       | einem |       |       |       |       |       |       | |       | Teams |       |       |       |       |       |       | |       | Ch    |       |       |       |       |       |       | |       | annel |       |       |       |       |       |       | |       | mitzu |       |       |       |       |       |       | |       | geben |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Do    | Fe    | Esta  | V1    | V2    | Final | De    | .d    | | cker- | ature | Cloud |       |       |       | fault | ocker | | Build | Be    | Pip   |       |       |       |       |       | | Str   | schre | eline |       |       |       |       |       | | uktur | ibung |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | a     | D     | :     | :     | :     | :     |       |       | | rtifa | ocker | tick: | tick: | tick: | tick: |       |       | | ctory | Repo  |       |       |       |       |       |       | | Docke | von   |       |       |       |       |       |       | | rRepo | A     |       |       |       |       |       |       | | (requ | rtifa |       |       |       |       |       |       | | ired) | ctory |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | o     | Open  | :     | :     | :     | :     | $.p   |       | | penSh | shift | tick: | tick: | tick: | tick: | roduc |       | | iftAp | A     |       |       |       |       | tName |       | | pName | pplik |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | sname |       |       |       |       |       |       | |       | (neu  |       |       |       |       |       |       | |       | opti  |       |       |       |       |       |       | |       | onal) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | docke | Falls | :     | :     | :     | :     | \"D    |       | | rFile | nicht | tick: | tick: | tick: | tick: | ocker |       | |       | ange  |       |       |       |       | file\" |       | |       | geben |       |       |       |       |       |       | |       | S     |       |       |       |       |       |       | |       | elfru |       |       |       |       |       |       | |       | nning |       |       |       |       |       |       | |       | Jar   |       |       |       |       |       |       | |       | wird  |       |       |       |       |       |       | |       | erst  |       |       |       |       |       |       | |       | ellt, |       |       |       |       |       |       | |       | sonst |       |       |       |       |       |       | |       | Docke |       |       |       |       |       |       | |       | rfile |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | imag  | Def   | :     | :     | :     | :     |       |       | | eName | ault: | tick: | tick: | tick: | tick: |       |       | |       | o     |       |       |       |       |       |       | |       | pensh |       |       |       |       |       |       | |       | iftAp |       |       |       |       |       |       | |       | pName |       |       |       |       |       |       | |       | ;     |       |       |       |       |       |       | |       | anso  |       |       |       |       |       |       | |       | nsten |       |       |       |       |       |       | |       | Name  |       |       |       |       |       |       | |       | des   |       |       |       |       |       |       | |       | Do    |       |       |       |       |       |       | |       | ckeri |       |       |       |       |       |       | |       | mages |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | bas   | Im    | :     | :     | :     | :     |       |       | | eImag | Fall  | tick: | tick: | tick: | tick: |       |       | | eFrom | des   |       |       |       |       |       |       | |       | Self  |       |       |       |       |       |       | |       | runni |       |       |       |       |       |       | |       | ngjar |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | |       | ist   |       |       |       |       |       |       | |       | das   |       |       |       |       |       |       | |       | das   |       |       |       |       |       |       | |       | Base  |       |       |       |       |       |       | |       | image |       |       |       |       |       |       | |       | we    |       |       |       |       |       |       | |       | lches |       |       |       |       |       |       | |       | wir   |       |       |       |       |       |       | |       | erben |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | o     | E     | :     | :ques | :     | :     |       |       | | cBuil | igene | tick: | tion: | tick: | tick: |       |       | | dVars | Umg   |       |       |       |       |       |       | |       | ebung |       |       |       |       |       |       | |       | svari |       |       |       |       |       |       | |       | ablen |       |       |       |       |       |       | |       | f\u00fcr   |       |       |       |       |       |       | |       | den   |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | -     |       |       |       |       |       |       | |       | Beis  |       |       |       |       |       |       | |       | piel: |       |       |       |       |       |       | |       | \"ocB  |       |       |       |       |       |       | |       | uildV |       |       |       |       |       |       | |       | ars:\" |       |       |       |       |       |       | |       | \"S    |       |       |       |       |       |       | |       | NAPSH |       |       |       |       |       |       | |       | OTVER |       |       |       |       |       |       | |       | SION= |       |       |       |       |       |       | |       | 1234, |       |       |       |       |       |       | |       | TIMES |       |       |       |       |       |       | |       | TAMP= |       |       |       |       |       |       | |       | 12134 |       |       |       |       |       |       | |       | 2323\" |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | new   | New   | :     | :c    | :ques | :ques |       |       | | Relic | Relic | tick: | ross: | tion: | tion: |       |       | |       | Ko    |       |       |       |       |       |       | |       | nfigu |       |       |       |       |       |       | |       | ratio |       |       |       |       |       |       | |       | nsstr |       |       |       |       |       |       | |       | uktur |       |       |       |       |       |       | |       | f\u00fcr   |       |       |       |       |       |       | |       | den   |       |       |       |       |       |       | |       | Self  |       |       |       |       |       |       | |       | Runni |       |       |       |       |       |       | |       | ngJar |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | c     | Build | :     | :c    | :c    | :c    |       |       | | heckO | wird  | tick: | ross: | ross: | ross: |       |       | | penSh | nur   |       |       |       |       |       |       | | iftDe | e     |       |       |       |       |       |       | | ploym | rfolg |       |       |       |       |       |       | | entRe | reich |       |       |       |       |       |       | | adyEn | sein, |       |       |       |       |       |       | | abled | wenn  |       |       |       |       |       |       | |       | das   |       |       |       |       |       |       | |       | Open  |       |       |       |       |       |       | |       | shift |       |       |       |       |       |       | |       | Deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | Ready |       |       |       |       |       |       | |       | ist   |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ar    | Supr  | :     | :c    | :     | :     |       |       | | tifac | esses | tick: | ross: | tick: | tick: |       |       | | toryS | the   |       |       |       |       |       |       | | upres | su    |       |       |       |       |       |       | | sProj | bfold |       |       |       |       |       |       | | ectSu | ercre |       |       |       |       |       |       | | bfold | ation |       |       |       |       |       |       | | erCre | in    |       |       |       |       |       |       | | ation | Ar    |       |       |       |       |       |       | |       | tifac |       |       |       |       |       |       | |       | tory. |       |       |       |       |       |       | |       | If    |       |       |       |       |       |       | |       | set   |       |       |       |       |       |       | |       | true  |       |       |       |       |       |       | |       |  your |       |       |       |       |       |       | |       | image |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | publ  |       |       |       |       |       |       | |       | ished |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | i.e.  |       |       |       |       |       |       | |       | est   |       |       |       |       |       |       | |       | a.doc |       |       |       |       |       |       | |       | ker.b |       |       |       |       |       |       | |       | in.sb |       |       |       |       |       |       | |       | b.ch/ |       |       |       |       |       |       | |       | youra |       |       |       |       |       |       | |       | ppnam |       |       |       |       |       |       | |       | e:ver |       |       |       |       |       |       | |       | sion, |       |       |       |       |       |       | |       | if    |       |       |       |       |       |       | |       | false |       |       |       |       |       |       | |       |  your |       |       |       |       |       |       | |       | image |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | publ  |       |       |       |       |       |       | |       | ished |       |       |       |       |       |       | |       | t     |       |       |       |       |       |       | |       | o est |       |       |       |       |       |       | |       | a.doc |       |       |       |       |       |       | |       | ker.b |       |       |       |       |       |       | |       | in.sb |       |       |       |       |       |       | |       | b.ch/ |       |       |       |       |       |       | |       | esta  |       |       |       |       |       |       | |       | /your |       |       |       |       |       |       | |       | appna |       |       |       |       |       |       | |       | me:ve |       |       |       |       |       |       | |       | rsion |       |       |       |       |       |       | |       |       |       |       |       |       |       |       | |       | Evtl. |       |       |       |       |       |       | |       | m     |       |       |       |       |       |       | |       | \u00fcssen |       |       |       |       |       |       | |       | wird  |       |       |       |       |       |       | |       | das   |       |       |       |       |       |       | |       | so    |       |       |       |       |       |       | |       | derso |       |       |       |       |       |       | |       | an    |       |       |       |       |       |       | |       | derse |       |       |       |       |       |       | |       | l\u00f6sen |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Ne    | Fe    | Esta  | V1    | V2    | Final | De    |       | | wReli | ature | Cloud |       |       |       | fault |       | | c-Con | Be    | Pip   |       |       |       |       |       | | figur | schre | eline |       |       |       |       |       | | ation | ibung |       |       |       |       |       |       | | Str   |       |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ap    | Name  | :     | :c    | :c    | :c    |       |       | | pName | of    | tick: | ross: | ross: | ross: |       |       | |       | the   |       |       |       |       |       |       | |       | a     |       |       |       |       |       |       | |       | pplic |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | New   |       |       |       |       |       |       | |       | R     |       |       |       |       |       |       | |       | elic. |       |       |       |       |       |       | |       | If    |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | spec  |       |       |       |       |       |       | |       | ified |       |       |       |       |       |       | |       | o     |       |       |       |       |       |       | |       | pensh |       |       |       |       |       |       | |       | iftAp |       |       |       |       |       |       | |       | pName |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | used. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | app   | A     | :     | :c    | :c    | :c    |       |       | | Label | pplic | tick: | ross: | ross: | ross: |       |       | |       | ation |       |       |       |       |       |       | |       | L     |       |       |       |       |       |       | |       | abels |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | New   |       |       |       |       |       |       | |       | Relic |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | ormat |       |       |       |       |       |       | |       | \"ca   |       |       |       |       |       |       | |       | tegor |       |       |       |       |       |       | |       | y1:va |       |       |       |       |       |       | |       | lue1, |       |       |       |       |       |       | |       | cate  |       |       |       |       |       |       | |       | gory2 |       |       |       |       |       |       | |       | :valu |       |       |       |       |       |       | |       | e2\".  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | licen | New   | :     | :c    | :c    | :c    |       |       | | seKey | Relic | tick: | ross: | ross: | ross: |       |       | |       | Li    |       |       |       |       |       |       | |       | cense |       |       |       |       |       |       | |       | Key   |       |       |       |       |       |       | |       | (requ |       |       |       |       |       |       | |       | ired) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | a     | New   | :     | :c    | :c    | :c    |       |       | | piKey | Relic | tick: | ross: | ross: | ross: |       |       | |       | API   |       |       |       |       |       |       | |       | Key.  |       |       |       |       |       |       | |       | Only  |       |       |       |       |       |       | |       | n     |       |       |       |       |       |       | |       | eeded |       |       |       |       |       |       | |       | if    |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | ecord |       |       |       |       |       |       | |       | Deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | InNew |       |       |       |       |       |       | |       | Relic |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | set   |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | true. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | r     | If    | :     | :c    | :c    | :c    |       |       | | ecord | true, | tick: | ross: | ross: | ross: |       |       | | Deplo | a     |       |       |       |       |       |       | | yment | m     |       |       |       |       |       |       | | InNew | arker |       |       |       |       |       |       | | Relic | is    |       |       |       |       |       |       | |       | set   |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | New   |       |       |       |       |       |       | |       | Relic |       |       |       |       |       |       | |       | d     |       |       |       |       |       |       | |       | uring |       |       |       |       |       |       | |       | de    |       |       |       |       |       |       | |       | ploym |       |       |       |       |       |       | |       | ent.  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Mvn   | Fe    | Esta  | V1    | V2    | Final | De    | .mvn  | | Kon   | ature | Cloud |       |       |       | fault |       | | figur | Be    | Pip   |       |       |       |       |       | | ation | schre | eline |       |       |       |       |       | | s-Str | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | pare  | Path  | :     | :     | :     | :     | \"pom  |       | | ntPom | to    | tick: | tick: | tick: | tick: | .xml\" |       | | (requ | p     |       |       |       |       |       |       | | ired) | arent |       |       |       |       |       |       | |       | pom,  |       |       |       |       |       |       | |       | def   |       |       |       |       |       |       | |       | ault: |       |       |       |       |       |       | |       | po    |       |       |       |       |       |       | |       | m.xml |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | de    | Path  | :     | :     | :     | :     |       |       | | ploya | to    | tick: | tick: | tick: | tick: |       |       | | bleAr | pom   |       |       |       |       |       |       | | tifac | which |       |       |       |       |       |       | | tsPom | spec  |       |       |       |       |       |       | |       | ifies |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | deplo |       |       |       |       |       |       | |       | yable |       |       |       |       |       |       | |       | artif |       |       |       |       |       |       | |       | acts, |       |       |       |       |       |       | |       | def   |       |       |       |       |       |       | |       | ault: |       |       |       |       |       |       | |       | po    |       |       |       |       |       |       | |       | m.xml |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | artif | The   | :     | :     | :     | :     |       |       | | actor | Maven | tick: | tick: | tick: | tick: |       |       | | yMave | repos |       |       |       |       |       |       | | nRepo | itory |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | rtifa |       |       |       |       |       |       | |       | ctory |       |       |       |       |       |       | |       | where |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | Maven |       |       |       |       |       |       | |       | arti  |       |       |       |       |       |       | |       | facts |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | publi |       |       |       |       |       |       | |       | shed. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | maven | The   |       | :c    | :ques | :     |       | Maven | | Label | used  |       | ross: | tion: | tick: |       | wird  | |       | Maven |       |       |       |       |       | erst  | |       | Ve    |       |       |       |       |       | wenn  | |       | rsion |       |       |       |       |       | n\u00f6tig | |       | can   |       |       |       |       |       | konfi | |       | be    |       |       |       |       |       | gurie | |       | sel   |       |       |       |       |       | rbar. | |       | ected |       |       |       |       |       |       | |       | (     |       |       |       |       |       |       | |       |       |       |       |       |       |       |       | |       | (     |       |       |       |       |       |       | |       |       |       |       |       |       |       |       | |       | \"A    |       |       |       |       |       |       | |       | pache |       |       |       |       |       |       | |       | Maven |       |       |       |       |       |       | |       | 3.5\", |       |       |       |       |       |       | |       |       |       |       |       |       |       |       | |       | \"A    |       |       |       |       |       |       | |       | pache |       |       |       |       |       |       | |       | Maven |       |       |       |       |       |       | |       | 3.6\"  |       |       |       |       |       |       | |       |       |       |       |       |       |       |       | |       | )     |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | NP    | Fe    | Esta  | V1    | V2    | Final | De    | .npm  | | M-Kon | ature | Cloud |       |       |       | fault |       | | figur | Be    | Pip   |       |       |       |       |       | | ation | schre | eline |       |       |       |       |       | | s-Str | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | targe | Path  | :     | :     | :     | :     |       |       | | tRepo | to    | tick: | tick: | tick: | tick: |       |       | |       | t     |       |       |       |       |       |       | |       | arget |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | addit | Npm   | :     | :     | :     | :     |       |       | | ional | build | tick: | tick: | tick: | tick: |       |       | | NpmSc | com   |       |       |       |       |       |       | | ripts | mands |       |       |       |       |       |       | |       | spec  |       |       |       |       |       |       | |       | ified |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | pac   |       |       |       |       |       |       | |       | kage. |       |       |       |       |       |       | |       | json. |       |       |       |       |       |       | |       | Comma |       |       |       |       |       |       | |       | sepa  |       |       |       |       |       |       | |       | rated |       |       |       |       |       |       | |       | mul   |       |       |       |       |       |       | |       | tiple |       |       |       |       |       |       | |       | com   |       |       |       |       |       |       | |       | mands |       |       |       |       |       |       | |       | can   |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | speci |       |       |       |       |       |       | |       | fied. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | p     | Spec  | :     | :     | :     | :     | \"pac  |       | | ackag | ifies | tick: | tick: | tick: | tick: | kage. |       | | eJson | where |       |       |       |       | json\" |       | |       | the   |       |       |       |       |       |       | |       | P     |       |       |       |       |       |       | |       | ackag |       |       |       |       |       |       | |       | eJson |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | lo    |       |       |       |       |       |       | |       | cated |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | pub   | Spec  | :     | :     | :     | :     |       |       | | lisha | ifies | tick: | tick: | tick: | tick: |       |       | | blePa | where |       |       |       |       |       |       | | ckage | the   |       |       |       |       |       |       | | Jsons | P     |       |       |       |       |       |       | |       | ackag |       |       |       |       |       |       | |       | eJson |       |       |       |       |       |       | |       | are   |       |       |       |       |       |       | |       | for   |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | ublis |       |       |       |       |       |       | |       | hable |       |       |       |       |       |       | |       | pro   |       |       |       |       |       |       | |       | jects |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | inst  | Will  | :     | :ques | :ques | :ques |       | Abk   | | allDe | exc   | tick: | tion: | tion: | tion: |       | l\u00e4ren | | pende | ecute |       |       |       |       |       | was   | | ncies | npm   |       |       |       |       |       | das   | |       | ci in |       |       |       |       |       | genau | |       | the   |       |       |       |       |       | m     | |       | b     |       |       |       |       |       | acht? | |       | ackgr |       |       |       |       |       |       | |       | ound. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | v     |       |       |       |       |       |       | |       | alue: |       |       |       |       |       |       | |       | true  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sta   | Fe    | Esta  | V1    | V2    | Final | De    | .stag | | ge Ko | ature | Cloud |       |       |       | fault | es[*] | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | stag  | Name  | :     | :     | :     | :     |       |       | | eName | der   | tick: | tick: | tick: | tick: |       |       | |       | Stage |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | isO   | Deplo | :     | :c    | :c    | :c    |       |       | | pensh | yment | tick: | ross: | ross: | ross: |       |       | | iftDe | kann  |       |       |       |       |       |       | | ploym | hier  |       |       |       |       |       |       | | entEn | gen   |       |       |       |       |       |       | | abled | erell |       |       |       |       |       |       | |       | ein   |       |       |       |       |       |       | |       | oder  |       |       |       |       |       |       | |       | aus   |       |       |       |       |       |       | |       | gesch |       |       |       |       |       |       | |       | altet |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | erden |       |       |       |       |       |       | |       | -     |       |       |       |       |       |       | |       | soll  |       |       |       |       |       |       | |       | \u00fcber  |       |       |       |       |       |       | |       | ArgoC |       |       |       |       |       |       | |       | DSync |       |       |       |       |       |       | |       | gest  |       |       |       |       |       |       | |       | euert |       |       |       |       |       |       | |       | we    |       |       |       |       |       |       | |       | rden. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | o     | Open  | :     | :c    | :c    | :c    |       |       | | pensh | shift | tick: | ross: | ross: | ross: |       |       | | iftPr | Name  |       |       |       |       |       |       | | oject | space |       |       |       |       |       |       | |       | wohin |       |       |       |       |       |       | |       | ges   |       |       |       |       |       |       | |       | taged |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | erden |       |       |       |       |       |       | |       | soll  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | o     | Open  | :     | :c    | :c    | :c    |       |       | | pensh | shift | tick: | ross: | ross: | ross: |       |       | | iftCl | Clus  |       |       |       |       |       |       | | uster | ter:  |       |       |       |       |       |       | |       | ot    |       |       |       |       |       |       | |       | c_obe |       |       |       |       |       |       | |       | lix,  |       |       |       |       |       |       | |       | otc   |       |       |       |       |       |       | |       | _test |       |       |       |       |       |       | |       | _04,  |       |       |       |       |       |       | |       | aws   |       |       |       |       |       |       | |       |  or   |       |       |       |       |       |       | |       |  vias |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | open  | The   | :     | :c    | :c    | :c    |       |       | | shift | Je    | tick: | ross: | ross: | ross: |       |       | | Jenki | nkins |       |       |       |       |       |       | | nsCre | Cre   |       |       |       |       |       |       | | denti | denti |       |       |       |       |       |       | | alsId | alId: |       |       |       |       |       |       | |       | 3     |       |       |       |       |       |       | |       | 4b644 |       |       |       |       |       |       | |       | 77-39 |       |       |       |       |       |       | |       | 60-4f |       |       |       |       |       |       | |       | ec-87 |       |       |       |       |       |       | |       | 91-cc |       |       |       |       |       |       | |       | 859e2 |       |       |       |       |       |       | |       | abcde |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | pre   | Je    | :     | :c    | :c    | :ques |       |       | | CiDep | nkins | tick: | ross: | ross: | tion: |       |       | | loyme | Job   |       |       |       |       |       |       | | ntJob | we    |       |       |       |       |       |       | | (pre  | lcher |       |       |       |       |       |       | | Tekto | vor   |       |       |       |       |       |       | | nPipe | dem   |       |       |       |       |       |       | | line) | St    |       |       |       |       |       |       | |       | aging |       |       |       |       |       |       | |       | ausge |       |       |       |       |       |       | |       | f\u00fchrt |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | erden |       |       |       |       |       |       | |       | soll  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | post  | Je    | :     | :c    | :c    | :ques |       |       | | CiDep | nkins | tick: | ross: | ross: | tion: |       |       | | loyme | Job   |       |       |       |       |       |       | | ntJob | we    |       |       |       |       |       |       | | (post | lcher |       |       |       |       |       |       | | Tekto | nach  |       |       |       |       |       |       | | nPipe | dem   |       |       |       |       |       |       | | line) | St    |       |       |       |       |       |       | |       | aging |       |       |       |       |       |       | |       | ausge |       |       |       |       |       |       | |       | f\u00fchrt |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | erden |       |       |       |       |       |       | |       | soll  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | preDe | Ein   | :     | :c    | :c    | :ques |       | Das   | | ployC | Be    | tick: | ross: | ross: | tion: |       | Deplo | | onfir | st\u00e4ti |       |       |       |       |       | yment | | mUser | gungs |       |       |       |       |       | wird  | | Mails | Email |       |       |       |       |       | \u00fcber  | |       | wird  |       |       |       |       |       | u     | |       | gesch |       |       |       |       |       | nters | |       | ickt, |       |       |       |       |       | chied | |       | in    |       |       |       |       |       | liche | |       | we    |       |       |       |       |       | A     | |       | lchem |       |       |       |       |       | rgoCD | |       | der   |       |       |       |       |       | Inst  | |       | Ben   |       |       |       |       |       | anzen | |       | utzer |       |       |       |       |       | mit   | |       | vor   |       |       |       |       |       | un    | |       | einem |       |       |       |       |       | tersc | |       | Deplo |       |       |       |       |       | hiedl | |       | yment |       |       |       |       |       | ichen | |       | das   |       |       |       |       |       | Bere  | |       | Deplo |       |       |       |       |       | chtig | |       | yment |       |       |       |       |       | ungen | |       | best\u00e4 |       |       |       |       |       | gel   | |       | tigen |       |       |       |       |       | \u00f6st.  | |       | m     |       |       |       |       |       |       | |       | uss.  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | k     | A     | :     | :c    | :c    | :ques |       | Soll  | | afkaD | list  | tick: | ross: | ross: | tion: |       | nur   | | eploy | of    |       |       |       |       |       | noch  | | Param | K     |       |       |       |       |       | per   | | eters | afkaD |       |       |       |       |       | H     | |       | eploy |       |       |       |       |       | elm/A | |       | Param |       |       |       |       |       | rgoCD | |       | eters |       |       |       |       |       | g     | |       | . Det |       |       |       |       |       | el\u00f6st | |       | ailed |       |       |       |       |       | w     | |       | doc   |       |       |       |       |       | erden | |       | ument |       |       |       |       |       |       | |       | ation |       |       |       |       |       | Wir   | |       | from  |       |       |       |       |       | w     | |       | the   |       |       |       |       |       | \u00fcrden | |       | Kafka |       |       |       |       |       | aller | |       | Team, |       |       |       |       |       | dings | |       | see   |       |       |       |       |       | die   | |       | here  |       |       |       |       |       | Tasks | |       | .     |       |       |       |       |       | /Pipe | |       |       |       |       |       |       |       | lines | |       |       |       |       |       |       |       | berei | |       |       |       |       |       |       |       | tstel | |       |       |       |       |       |       |       | len.  | +-------+-------+-------+-------+-------+-------+-------+-------+ | api   | A     | :     | :c    | :c    | :ques |       | Soll  | |       | list  | tick: | ross: | ross: | tion: |       | nur   | |       | of    |       |       |       |       |       | noch  | |       | APIM  |       |       |       |       |       | per   | |       | deplo |       |       |       |       |       | H     | |       | yment |       |       |       |       |       | elm/A | |       | p     |       |       |       |       |       | rgoCD | |       | arame |       |       |       |       |       | g     | |       | ters. |       |       |       |       |       | el\u00f6st | |       | For a |       |       |       |       |       | w     | |       | more  |       |       |       |       |       | erden | |       | det   |       |       |       |       |       |       | |       | ailed |       |       |       |       |       | Wir   | |       | docu  |       |       |       |       |       | w     | |       | menta |       |       |       |       |       | \u00fcrden | |       | tion, |       |       |       |       |       | aller | |       | see   |       |       |       |       |       | dings | |       | here. |       |       |       |       |       | die   | |       |       |       |       |       |       |       | Tasks | |       |       |       |       |       |       |       | /Pipe | |       |       |       |       |       |       |       | lines | |       |       |       |       |       |       |       | berei | |       |       |       |       |       |       |       | tstel | |       |       |       |       |       |       |       | len.  | +-------+-------+-------+-------+-------+-------+-------+-------+ | in    | In    | :     | :c    | :c    | :ques |       | Soll  | | stana | stana | tick: | ross: | ross: | tion: |       | nur   | |       | re    |       |       |       |       |       | noch  | |       | lease |       |       |       |       |       | per   | |       | p     |       |       |       |       |       | H     | |       | arame |       |       |       |       |       | elm/A | |       | ters. |       |       |       |       |       | rgoCD | |       | Also  |       |       |       |       |       | g     | |       | chec  |       |       |       |       |       | el\u00f6st | |       | k Pip |       |       |       |       |       | w     | |       | eline |       |       |       |       |       | erden | |       | H     |       |       |       |       |       |       | |       | elper |       |       |       |       |       | Wir   | |       | #clou |       |       |       |       |       | w     | |       | d_cre |       |       |       |       |       | \u00fcrden | |       | ateIn |       |       |       |       |       | aller | |       | stana |       |       |       |       |       | dings | |       | Relea |       |       |       |       |       | die   | |       | se-Cr |       |       |       |       |       | Tasks | |       | eatea |       |       |       |       |       | /Pipe | |       | nInst |       |       |       |       |       | lines | |       | anare |       |       |       |       |       | berei | |       | lease |       |       |       |       |       | tstel | |       |       |       |       |       |       |       | len.  | +-------+-------+-------+-------+-------+-------+-------+-------+ | appRe | A     | :     | :c    | :c    | :ques |       | Soll  | | gistr | list  | tick: | ross: | ross: | tion: |       | nur   | | ation | of    |       |       |       |       |       | noch  | |       | \"     |       |       |       |       |       | per   | |       | Apply |       |       |       |       |       | H     | |       | Azure |       |       |       |       |       | elm/A | |       | AD    |       |       |       |       |       | rgoCD | |       | Ap    |       |       |       |       |       | g     | |       | p-Reg |       |       |       |       |       | el\u00f6st | |       | istra |       |       |       |       |       | we    | |       | tion\" |       |       |       |       |       | rden. | |       | p     |       |       |       |       |       | Wir   | |       | arame |       |       |       |       |       | w     | |       | ters. |       |       |       |       |       | \u00fcrden | |       |       |       |       |       |       |       | aller | |       |       |       |       |       |       |       | dings | |       |       |       |       |       |       |       | die   | |       |       |       |       |       |       |       | Tasks | |       |       |       |       |       |       |       | /Pipe | |       |       |       |       |       |       |       | lines | |       |       |       |       |       |       |       | berei | |       |       |       |       |       |       |       | tstel | |       |       |       |       |       |       |       | len.  | +-------+-------+-------+-------+-------+-------+-------+-------+ | a     | A     | :c    | :     | :     | :     |       |       | | rgoCD | rgoCD | ross: | tick: | tick: | tick: |       |       | |       | Kon   |       |       |       |       |       |       | |       | figur |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | f\u00fcr   |       |       |       |       |       |       | |       | diese |       |       |       |       |       |       | |       | Stage |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Step  | Fe    | Esta  | V1    | V2    | Final | De    | .ste  | | Ko    | ature | Cloud |       |       |       | fault | ps[*] | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | name  | E     | :c    | :     | :     | :     |       |       | | (requ | indeu | ross: | tick: | tick: | tick: |       |       | | ired) | tiger |       |       |       |       |       |       | |       | Name  |       |       |       |       |       |       | |       | des   |       |       |       |       |       |       | |       | Steps |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ste   | Es    | :     | :c    | :c    | :c    |       |       | | pType | gibt  | tick: | ross: | ross: | ross: |       |       | | (requ | u     |       |       |       |       |       |       | | ired) | nters |       |       |       |       |       |       | |       | chied |       |       |       |       |       |       | |       | liche |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | typen |       |       |       |       |       |       | |       | (rel  |       |       |       |       |       |       | |       | ease, |       |       |       |       |       |       | |       | C     |       |       |       |       |       |       | |       | ontin |       |       |       |       |       |       | |       | uous, |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | tegra |       |       |       |       |       |       | |       | tion, |       |       |       |       |       |       | |       | cu    |       |       |       |       |       |       | |       | stom) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | isBu  | Ob    | :     | :     | :     | :     | false | .s    | | ildEn | diese | tick: | tick: | tick: | tick: |       | teps[ | | abled | Bui   |       |       |       |       |       | *].en | | (requ | ldkon |       |       |       |       |       | abled | | ired) | figur |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | gen   |       |       |       |       |       |       | |       | erell |       |       |       |       |       |       | |       | aktiv |       |       |       |       |       |       | |       | ist   |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | fail  | S     | :     | :c    | :c    | :c    |       |       | | OnXra | hould | tick: | ross: | ross: | ross: |       |       | | yScan | the   |       |       |       |       |       |       | | (d    | build |       |       |       |       |       |       | | eprec | fail  |       |       |       |       |       |       | | ated) | if    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | XRa   |       |       |       |       |       |       | |       | yscan |       |       |       |       |       |       | |       | finds |       |       |       |       |       |       | |       | v     |       |       |       |       |       |       | |       | iolat |       |       |       |       |       |       | |       | ions? |       |       |       |       |       |       | |       | (true |       |       |       |       |       |       | |       | /     |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | alse) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | de    | Do    | :     | :c    | :     | :     |       | Q     | | pende | you   | tick: | ross: | tick: | tick: |       | ualit | | ncyCh | want  |       |       |       |       |       | yscan | | eckEn | to    |       |       |       |       |       | Konf  | | abled | run   |       |       |       |       |       | igstr | |       | the   |       |       |       |       |       | uktur | |       | OWASP |       |       |       |       |       | um    | |       | depen |       |       |       |       |       | bauen | |       | dency |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | heck? |       |       |       |       |       |       | |       | (true |       |       |       |       |       |       | |       | /     |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | alse) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | d     | De    | :     | :c    | :     | :     |       |       | | epend | fine  | tick: | ross: | tick: | tick: |       |       | | encyC | addit |       |       |       |       |       |       | | heckA | ional |       |       |       |       |       |       | | dditi | scan  |       |       |       |       |       |       | | onalP | p     |       |       |       |       |       |       | | arams | arams |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | s     | Do    | :     | :c    | :     | :     |       | Qu    | | onarS | you   | tick: | ross: | tick: | tick: |       | ality | | canEn | want  |       |       |       |       |       | Scans | | abled | the   |       |       |       |       |       | prio? | |       | sonar |       |       |       |       |       |       | |       | scan  |       |       |       |       |       |       | |       | done? |       |       |       |       |       |       | |       | (true |       |       |       |       |       |       | |       | /     |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | alse) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | fail  | If    | :     | :c    | :     | :     |       | Qu    | | OnQua | en    | tick: | ross: | tick: | tick: |       | ality | | lityG | abled |       |       |       |       |       | S     | | ateFa | the   |       |       |       |       |       | cans? | | ilure | build |       |       |       |       |       | Wie   | |       | waits |       |       |       |       |       | oft   | |       | for   |       |       |       |       |       | ben   | |       | the   |       |       |       |       |       | utzt? | |       | r     |       |       |       |       |       |       | |       | esult |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | Qu    |       |       |       |       |       |       | |       | ality |       |       |       |       |       |       | |       | Gate  |       |       |       |       |       |       | |       | ana   |       |       |       |       |       |       | |       | lysis |       |       |       |       |       |       | |       | and   |       |       |       |       |       |       | |       | fails |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | |       | if it |       |       |       |       |       |       | |       | has   |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | been  |       |       |       |       |       |       | |       | pas   |       |       |       |       |       |       | |       | sed.  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | a     | Addit | :     | :     | :     | :     |       |       | | dditi | ional | tick: | tick: | tick: | tick: |       |       | | onalB | build |       |       |       |       |       |       | | uildP | param |       |       |       |       |       |       | | arams | eters |       |       |       |       |       |       | |       | such  |       |       |       |       |       |       | |       | as    |       |       |       |       |       |       | |       | -Dsk  |       |       |       |       |       |       | |       | ipITs |       |       |       |       |       |       | |       | which |       |       |       |       |       |       | |       | curr  |       |       |       |       |       |       | |       | ently |       |       |       |       |       |       | |       | only  |       |       |       |       |       |       | |       | a     |       |       |       |       |       |       | |       | ffect |       |       |       |       |       |       | |       | Maven |       |       |       |       |       |       | |       | and   |       |       |       |       |       |       | |       | NPM   |       |       |       |       |       |       | |       | bu    |       |       |       |       |       |       | |       | ilds. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | add   | Addit | :     | :c    | :     | :     |       | Was   | | ition | ional | tick: | ross: | tick: | tick: |       | m     | | alBui | build |       |       |       |       |       | achen | | ldPar | param |       |       |       |       |       | wir   | | amsFo | eters |       |       |       |       |       | mit   | | rSona | such  |       |       |       |       |       | den   | | rScan | as    |       |       |       |       |       | g     | |       | -     |       |       |       |       |       | anzen | |       | Dskip |       |       |       |       |       | Quali | |       | Tests |       |       |       |       |       | tysca | |       | =true |       |       |       |       |       | nner? | |       | ap    |       |       |       |       |       | V2    | |       | plied |       |       |       |       |       | wird  | |       | for   |       |       |       |       |       | s     | |       | Sona  |       |       |       |       |       | icher | |       | rQube |       |       |       |       |       | ein   | |       | scans |       |       |       |       |       | Teil  | |       | for   |       |       |       |       |       | impl  | |       | all   |       |       |       |       |       | ement | |       | build |       |       |       |       |       | iert. | |       | t     |       |       |       |       |       |       | |       | ypes. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | value |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | mpty. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | addit | Addit | :c    | :     | :     | :     |       |       | | ional | ional | ross: | tick: | tick: | tick: |       |       | | Docke | tags  |       |       |       |       |       |       | | rImag | the   |       |       |       |       |       |       | | eTags | D     |       |       |       |       |       |       | |       | ocker |       |       |       |       |       |       | |       | image |       |       |       |       |       |       | |       | shall |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | ushed |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | (     |       |       |       |       |       |       | |       | comma |       |       |       |       |       |       | |       | separ |       |       |       |       |       |       | |       | ated) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | tr    | S     | :     | :c    | :c    | :c    |       |       | | igger | hould | tick: | ross: | ross: | ross: |       |       | | Build | a     |       |       |       |       |       |       | | OnCom | Je    |       |       |       |       |       |       | | mitEn | nkins |       |       |       |       |       |       | | abled | build |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | exe   |       |       |       |       |       |       | |       | cuted |       |       |       |       |       |       | |       | at a  |       |       |       |       |       |       | |       | Bitb  |       |       |       |       |       |       | |       | ucket |       |       |       |       |       |       | |       | event |       |       |       |       |       |       | |       | on    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | m     |       |       |       |       |       |       | |       | ainBr |       |       |       |       |       |       | |       | anch? |       |       |       |       |       |       | |       | (true |       |       |       |       |       |       | |       | |     |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | alse) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | t     | We    | :c    | :     | :     | :     |       |       | | rigge | can   | ross: | tick: | tick: | tick: |       |       | | rType | have  |       |       |       |       |       |       | |       | here  |       |       |       |       |       |       | |       | diff  |       |       |       |       |       |       | |       | erent |       |       |       |       |       |       | |       | Tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | types |       |       |       |       |       |       | |       | like  |       |       |       |       |       |       | |       | (GITE |       |       |       |       |       |       | |       | VENT, |       |       |       |       |       |       | |       | US    |       |       |       |       |       |       | |       | ER/MA |       |       |       |       |       |       | |       | NUAL, |       |       |       |       |       |       | |       | CRON) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | st    | Das   | :     | :c    | :c    | :c    |       | Ar    | | aging | Stagi | tick: | ross: | ross: | ross: |       | goCD, | | (si   | ngpro |       |       |       |       |       | Ar    | | mple, | perty |       |       |       |       |       | goRol | | blueg | wird  |       |       |       |       |       | louts | | reen, | ben   |       |       |       |       |       |       | | cus   | \u00f6tigt |       |       |       |       |       |       | | tombr | um    |       |       |       |       |       |       | | anch, | die   |       |       |       |       |       |       | | s     | ver   |       |       |       |       |       |       | | ubseq | schie |       |       |       |       |       |       | | uent) | denen |       |       |       |       |       |       | |       | St    |       |       |       |       |       |       | |       | aging |       |       |       |       |       |       | |       | typen |       |       |       |       |       |       | |       | zu    |       |       |       |       |       |       | |       | unt   |       |       |       |       |       |       | |       | erst\u00fc |       |       |       |       |       |       | |       | tzen. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | s     | Diff  | :c    | :     | :     | :     |       |       | | tages | erent | ross: | tick: | tick: | tick: |       |       | |       | s     |       |       |       |       |       |       | |       | tages |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | rgoCd |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | deplo | S     | :     | :c    | :c    | :c    |       | Wird  | | yArti | hould | tick: | ross: | ross: | ross: |       | mit   | | facts | the   |       |       |       |       |       | b     | |       | gene  |       |       |       |       |       | uildD | |       | rated |       |       |       |       |       | ocker | |       | arti  |       |       |       |       |       | Image | |       | facts |       |       |       |       |       | und   | |       | (Mvn, |       |       |       |       |       | packa | |       | NPM,  |       |       |       |       |       | geAnd | |       | Go)   |       |       |       |       |       | Deplo | |       | be    |       |       |       |       |       | yHelm | |       | dep   |       |       |       |       |       | Chart | |       | loyed |       |       |       |       |       | ers   | |       | to    |       |       |       |       |       | etzt. | |       | Ar    |       |       |       |       |       |       | |       | tifac |       |       |       |       |       |       | |       | tory? |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | alse, |       |       |       |       |       |       | |       | since |       |       |       |       |       |       | |       | this  |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | hould |       |       |       |       |       |       | |       | n     |       |       |       |       |       |       | |       | eeded |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | case  |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | li    |       |       |       |       |       |       | |       | brary |       |       |       |       |       |       | |       | bu    |       |       |       |       |       |       | |       | ilds. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | b     | If    | :c    | :     | :     | :     | false |       | | uildD | true, | ross: | tick: | tick: | tick: |       |       | | ocker | D     |       |       |       |       |       |       | | Image | ocker |       |       |       |       |       |       | |       | Image |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | built |       |       |       |       |       |       | |       | and   |       |       |       |       |       |       | |       | dep   |       |       |       |       |       |       | |       | loyed |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | rtifa |       |       |       |       |       |       | |       | ctory |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | packa | If    | :c    | :     | :     | :     | false |       | | geAnd | true, | ross: | tick: | tick: | tick: |       |       | | Deplo | Helm  |       |       |       |       |       |       | | yHelm | Chart |       |       |       |       |       |       | | Chart | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | pac   |       |       |       |       |       |       | |       | kaged |       |       |       |       |       |       | |       | and   |       |       |       |       |       |       | |       | dep   |       |       |       |       |       |       | |       | loyed |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | rtifa |       |       |       |       |       |       | |       | ctory |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | juni  | With  | :     | :c    | :ques |       |       |       | | tTest | that  | tick: | ross: | tion: |       |       |       | | Repor | pro   |       |       |       |       |       |       | | tPath | perty |       |       |       |       |       |       | |       | you   |       |       |       |       |       |       | |       | can   |       |       |       |       |       |       | |       | dec   |       |       |       |       |       |       | |       | lare, |       |       |       |       |       |       | |       | where |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | surfi |       |       |       |       |       |       | |       | re-re |       |       |       |       |       |       | |       | ports |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | this  |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | ound. |       |       |       |       |       |       | |       | The   |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | eport |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | shown |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | Je    |       |       |       |       |       |       | |       | nkins |       |       |       |       |       |       | |       | a     |       |       |       |       |       |       | |       | fterw |       |       |       |       |       |       | |       | ards. |       |       |       |       |       |       | |       |       |       |       |       |       |       |       | |       | e. g. |       |       |       |       |       |       | |       | :     |       |       |       |       |       |       | |       | \"j    |       |       |       |       |       |       | |       | unitT |       |       |       |       |       |       | |       | estRe |       |       |       |       |       |       | |       | portP |       |       |       |       |       |       | |       | ath\": |       |       |       |       |       |       | |       | \"**   |       |       |       |       |       |       | |       | /sure |       |       |       |       |       |       | |       | fire- |       |       |       |       |       |       | |       | repor |       |       |       |       |       |       | |       | ts/*. |       |       |       |       |       |       | |       | xml\", |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | h     | Falls | :     | :     | :ques |       |       | Statt | | otfix | true  | tick: | tick: | tion: |       |       | Flag  | | Creat | wird  |       |       |       |       |       | ein   | | ionEn | am    |       |       |       |       |       | Pa    | | abled | Ende  |       |       |       |       |       | ttern | | (Re   | des   |       |       |       |       |       | f\u00fcr   | | lease | b     |       |       |       |       |       | den   | | Build | uilds |       |       |       |       |       | zu    | | only) | ein   |       |       |       |       |       | k     | |       | h     |       |       |       |       |       | reier | |       | otfix |       |       |       |       |       | enden | |       | B     |       |       |       |       |       | H     | |       | ranch |       |       |       |       |       | otfix | |       | ers   |       |       |       |       |       | B     | |       | tellt |       |       |       |       |       | ranch | |       | wird. |       |       |       |       |       | ang   | |       |       |       |       |       |       |       | eben. | +-------+-------+-------+-------+-------+-------+-------+-------+ | tr    | Falls | :     | :c    | :ques |       |       |       | | igger | true  | tick: | ross: | tion: |       |       |       | | Integ | wird  |       |       |       |       |       |       | | ratio | am    |       |       |       |       |       |       | | nBuil | Ende  |       |       |       |       |       |       | | dAfte | des   |       |       |       |       |       |       | | rRele | B     |       |       |       |       |       |       | | aseEn | uilds |       |       |       |       |       |       | | abled | ein   |       |       |       |       |       |       | | (Re   | I     |       |       |       |       |       |       | | lease | ntegr |       |       |       |       |       |       | | Build | ation |       |       |       |       |       |       | | only) | Build |       |       |       |       |       |       | |       | get   |       |       |       |       |       |       | |       | rigge |       |       |       |       |       |       | |       | red.  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | branc | Branc | :     | :     | :     | :     |       |       | | hName | hname | tick: | tick: | tick: | tick: |       |       | | Prefi | F     |       |       |       |       |       |       | | xes ( | ilter |       |       |       |       |       |       | | Conti | Liste |       |       |       |       |       |       | | nuous | auf   |       |       |       |       |       |       | | Build | we    |       |       |       |       |       |       | | only) | lchen |       |       |       |       |       |       | |       | d     |       |       |       |       |       |       | |       | ieser |       |       |       |       |       |       | |       | Bui   |       |       |       |       |       |       | |       | ldtyp |       |       |       |       |       |       | |       | h\u00f6ren |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | oll.  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ver   | Re    | :c    | :     | :     | :     |       |       | | sionT | gular | ross: | tick: | tick: | tick: |       |       | | agEve | expre |       |       |       |       |       |       | | ntPat | ssion |       |       |       |       |       |       | | terns | to    |       |       |       |       |       |       | |       | match |       |       |       |       |       |       | |       | Git   |       |       |       |       |       |       | |       | tags  |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | order |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | ex    |       |       |       |       |       |       | |       | ecute |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | step. |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | regex |       |       |       |       |       |       | |       | like  |       |       |       |       |       |       | |       | ^     |       |       |       |       |       |       | |       | (\\d+\\ |       |       |       |       |       |       | |       | .)?(\\ |       |       |       |       |       |       | |       | d+\\.) |       |       |       |       |       |       | |       | ?(\\*| |       |       |       |       |       |       | |       | \\d+)$ |       |       |       |       |       |       | |       | would |       |       |       |       |       |       | |       | match |       |       |       |       |       |       | |       | a     |       |       |       |       |       |       | |       | ve    |       |       |       |       |       |       | |       | rsion |       |       |       |       |       |       | |       | like  |       |       |       |       |       |       | |       | 10.   |       |       |       |       |       |       | |       | 5.100 |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | pr    | Jenki | :     | :c    | :     | :     |       | Kann  | | eCiSt | nsjob | tick: | ross: | tick: | tick: |       | mit   | | epJob | we    |       |       |       |       |       | C     | | (pre  | lcher |       |       |       |       |       | ustom | | Tekto | vor   |       |       |       |       |       | Tasks | | nPipe | dem   |       |       |       |       |       | reali | | line) | Build |       |       |       |       |       | siert | |       | ausge |       |       |       |       |       | w     | |       | f\u00fchrt |       |       |       |       |       | erden | |       | wird. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | pos   | Jenki | :     | :c    | :     | :     |       | Kann  | | tCiSt | nsjob | tick: | ross: | tick: | tick: |       | mit   | | epJob | we    |       |       |       |       |       | C     | | (post | lcher |       |       |       |       |       | ustom | | Tekto | nach  |       |       |       |       |       | Tasks | | nPipe | dem   |       |       |       |       |       | reali | | line) | Build |       |       |       |       |       | siert | |       | ausge |       |       |       |       |       | w     | |       | f\u00fchrt |       |       |       |       |       | erden | |       | wird. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | i     | S     | :     | :c    | :c    | :c    |       |       | | sS2IB | ource | tick: | ross: | ross: | ross: |       |       | | uildA | to    |       |       |       |       |       |       | | ctive | Image |       |       |       |       |       |       | |       | Build |       |       |       |       |       |       | |       | aktiv |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Helm  | Fe    | Esta  | V1    | V2    | Final | De    | .helm | | Ko    | ature | Cloud |       |       |       | fault |       | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | re    | Helm  | :     | :     | :     | :     |       |       | | lease | re    | tick: | tick: | tick: | tick: |       |       | |       | lease |       |       |       |       |       |       | |       | name  |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | de    |       |       |       |       |       |       | |       | ploy. |       |       |       |       |       |       | |       | (     |       |       |       |       |       |       | |       | manda |       |       |       |       |       |       | |       | tory) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | chart | Rel   | :     | :     | :     | :     |       |       | | RootF | ative | tick: | tick: | tick: | tick: |       |       | | older | path  |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | Helm  |       |       |       |       |       |       | |       | Chart |       |       |       |       |       |       | |       | root  |       |       |       |       |       |       | |       | fo    |       |       |       |       |       |       | |       | lder. |       |       |       |       |       |       | |       | (Def  |       |       |       |       |       |       | |       | ault: |       |       |       |       |       |       | |       | ./ch  |       |       |       |       |       |       | |       | arts) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | chart | Rel   | :     | :     | :     | :     |       |       | |       | ative | tick: | tick: | tick: | tick: |       |       | |       | path  |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | chart |       |       |       |       |       |       | |       | w     |       |       |       |       |       |       | |       | ithin |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | hartR |       |       |       |       |       |       | |       | ootFo |       |       |       |       |       |       | |       | lder. |       |       |       |       |       |       | |       | If    |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | spec  |       |       |       |       |       |       | |       | ified |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | roduc |       |       |       |       |       |       | |       | tName |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | used  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | versi | Name  | :c    | :c    | :     | :     |       |       | | onPro | of    | ross: | ross: | tick: | tick: |       |       | | perty | the   |       |       |       |       |       |       | |       | prop  |       |       |       |       |       |       | |       | erty/ |       |       |       |       |       |       | |       | field |       |       |       |       |       |       | |       | i     |       |       |       |       |       |       | |       | nside |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | char  |       |       |       |       |       |       | |       | tFile |       |       |       |       |       |       | |       | which |       |       |       |       |       |       | |       | holds |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | ve    |       |       |       |       |       |       | |       | rsion |       |       |       |       |       |       | |       | st    |       |       |       |       |       |       | |       | ring. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | repos | The   | :     | :     | :     | :     |       |       | | itory | name  | tick: | tick: | tick: | tick: |       |       | |       | of    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | Helm  |       |       |       |       |       |       | |       | repos |       |       |       |       |       |       | |       | itory |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | Ar    |       |       |       |       |       |       | |       | tifac |       |       |       |       |       |       | |       | tory. |       |       |       |       |       |       | |       | If    |       |       |       |       |       |       | |       | spec  |       |       |       |       |       |       | |       | ified |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | chart |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | pac   |       |       |       |       |       |       | |       | kaged |       |       |       |       |       |       | |       | and   |       |       |       |       |       |       | |       | upl   |       |       |       |       |       |       | |       | oaded |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | this  |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | eposi |       |       |       |       |       |       | |       | tory. |       |       |       |       |       |       | |       | Make  |       |       |       |       |       |       | |       | sure  |       |       |       |       |       |       | |       | that  |       |       |       |       |       |       | |       | you   |       |       |       |       |       |       | |       | do    |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | sp    |       |       |       |       |       |       | |       | ecify |       |       |       |       |       |       | |       | a     |       |       |       |       |       |       | |       | vi    |       |       |       |       |       |       | |       | rtual |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | eposi |       |       |       |       |       |       | |       | tory. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | t     | Time  | :     | :c    | :c    | :c    |       |       | | imeou | to    | tick: | ross: | ross: | ross: |       |       | | tInSe | wait  |       |       |       |       |       |       | | conds | for   |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | to be |       |       |       |       |       |       | |       | compl |       |       |       |       |       |       | |       | eted. |       |       |       |       |       |       | |       | Def   |       |       |       |       |       |       | |       | aults |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | 600s. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Go    | Fe    | Esta  | V1    | V2    | Final | De    | .go   | | Ko    | ature | Cloud |       |       |       | fault |       | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | targe | T     | :     | :     | :     | :     |       |       | | tRepo | arget | tick: | tick: | tick: | tick: |       |       | |       | A     |       |       |       |       |       |       | |       | rtifa |       |       |       |       |       |       | |       | ctory |       |       |       |       |       |       | |       | repos |       |       |       |       |       |       | |       | itory |       |       |       |       |       |       | |       | name. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | bui   |       | :c    | :     | :     | :     |       |       | | ldPac |       | ross: | tick: | tick: | tick: |       |       | | kages |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | us    |       | :     | :     | :     | :     |       |       | | eMage |       | tick: | tick: | tick: | tick: |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | add   |       | :     | :     | :     | :     |       |       | | ition |       | tick: | tick: | tick: | tick: |       |       | | alGoP |       |       |       |       |       |       |       | | arams |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ana   |       | :     | :c    | :ques | :     |       |       | | lysis |       | tick: | ross: | tion: | tick: |       |       | | Exclu |       |       |       |       |       |       |       | | sions |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | A     | Fe    | Esta  | V1    | V2    | Final | De    | .s    | | rgoCD | ature | Cloud |       |       |       | fault | tages | | Ko    | Be    | Pip   |       |       |       |       | [*].a | | nfigu | schre | eline |       |       |       |       | rgoCD | | ratio | ibung |       |       |       |       |       |       | | nsstr |       |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | arg   | The   | :c    | :     | :     | :     | $.p   |       | | oCdAp | app   | ross: | tick: | tick: | tick: | roduc |       | | pName | name  |       |       |       |       | tName |       | |       | which |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | refer |       |       |       |       |       |       | |       | enced |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | Ar    |       |       |       |       |       |       | |       | goCd. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | value |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | top-  |       |       |       |       |       |       | |       | level |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | roduc |       |       |       |       |       |       | |       | tName |       |       |       |       |       |       | |       | prop  |       |       |       |       |       |       | |       | erty. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | chart | The   | :c    | :     | :     | :     |       |       | | Repos | repos | ross: | tick: | tick: | tick: |       |       | | itory | itory |       |       |       |       |       |       | |       | where |       |       |       |       |       |       | |       | your  |       |       |       |       |       |       | |       | helm  |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | harts |       |       |       |       |       |       | |       | for   |       |       |       |       |       |       | |       | d     |       |       |       |       |       |       | |       | eploy |       |       |       |       |       |       | |       | ments |       |       |       |       |       |       | |       | are.  |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | cu    |       |       |       |       |       |       | |       | rrent |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | eposi |       |       |       |       |       |       | |       | tory. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | c     | Git   | :c    | :     | :     | :     | \"ma   |       | | hartB | b     | ross: | tick: | tick: | tick: | ster\" |       | | ranch | ranch |       |       |       |       |       |       | | OrTag | where |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | rgoCD |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | hould |       |       |       |       |       |       | |       | fetch |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | harts |       |       |       |       |       |       | |       | from. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | aut   | If    | :c    | :     | :     | :     | false |       | | oSync | true, | ross: | tick: | tick: | tick: |       |       | |       | the   |       |       |       |       |       |       | |       | deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | pip   |       |       |       |       |       |       | |       | eline |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | an    |       |       |       |       |       |       | |       | A     |       |       |       |       |       |       | |       | rgoCD |       |       |       |       |       |       | |       | sync. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Cred  | Fe    | Esta  | V1    | V2    | Final | De    | C     | | entia | ature | Cloud |       |       |       | fault | reden | | ls Ko | Be    | Pip   |       |       |       |       | tials | | nfigu | schre | eline |       |       |       |       | w     | | ratio | ibung |       |       |       |       |       | erden | | nsstr |       |       |       |       |       |       | in    | | uktur |       |       |       |       |       |       | Open  | |       |       |       |       |       |       |       | Shift | |       |       |       |       |       |       |       | Se    | |       |       |       |       |       |       |       | crets | |       |       |       |       |       |       |       | g     | |       |       |       |       |       |       |       | espei | |       |       |       |       |       |       |       | chert | +-------+-------+-------+-------+-------+-------+-------+-------+ | id    | Id of | :     | :c    |       |       |       |       | |       | Je    | tick: | ross: |       |       |       |       | |       | nkins |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | ecret |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | l     |       |       |       |       |       |       | |       | ookup |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | type  | Je    | :     | :c    |       |       |       |       | |       | nkins | tick: | ross: |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | reden |       |       |       |       |       |       | |       | tials |       |       |       |       |       |       | |       | type, |       |       |       |       |       |       | |       | pos   |       |       |       |       |       |       | |       | sible |       |       |       |       |       |       | |       | va    |       |       |       |       |       |       | |       | lues: |       |       |       |       |       |       | |       | st    |       |       |       |       |       |       | |       | ring, |       |       |       |       |       |       | |       | u     |       |       |       |       |       |       | |       | serna |       |       |       |       |       |       | |       | mePas |       |       |       |       |       |       | |       | sword |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | var   | Name  | :     | :c    |       |       |       |       | | iable | of    | tick: | ross: |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | nviro |       |       |       |       |       |       | |       | nment |       |       |       |       |       |       | |       | var   |       |       |       |       |       |       | |       | iable |       |       |       |       |       |       | |       | conta |       |       |       |       |       |       | |       | ining |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | ecret |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | set   |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | u     | Name  | :     | :c    |       |       |       |       | | serna | of    | tick: | ross: |       |       |       |       | | meVar | the   |       |       |       |       |       |       | | iable | e     |       |       |       |       |       |       | |       | nviro |       |       |       |       |       |       | |       | nment |       |       |       |       |       |       | |       | var   |       |       |       |       |       |       | |       | iable |       |       |       |       |       |       | |       | conta |       |       |       |       |       |       | |       | ining |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | use   |       |       |       |       |       |       | |       | rname |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | set   |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | p     | Name  | :     | :c    |       |       |       |       | | asswo | of    | tick: | ross: |       |       |       |       | | rdVar | the   |       |       |       |       |       |       | | iable | e     |       |       |       |       |       |       | |       | nviro |       |       |       |       |       |       | |       | nment |       |       |       |       |       |       | |       | var   |       |       |       |       |       |       | |       | iable |       |       |       |       |       |       | |       | conta |       |       |       |       |       |       | |       | ining |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | pas   |       |       |       |       |       |       | |       | sword |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | set   |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Teams | Fe    | Esta  | V1    | V2    | Final | De    | .     | | Notif | ature | Cloud |       |       |       | fault | notif | | icati | Be    | Pip   |       |       |       |       | icati | | on Ko | schre | eline |       |       |       |       | ons[t | | nfigu | ibung |       |       |       |       |       | ype=t | | ratio |       |       |       |       |       |       | eams] | | nsstr |       |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | url   | URL   | :     | :c    |       |       |       | .no   | |       | from  | tick: | ross: |       |       |       | tific | |       | the   |       |       |       |       |       | ation | |       | Micr  |       |       |       |       |       | s[*]. | |       | osoft |       |       |       |       |       | webho | |       | Teams |       |       |       |       |       | okUrl | |       | conn  |       |       |       |       |       |       | |       | ector |       |       |       |       |       |       | |       | conf  |       |       |       |       |       |       | |       | igura |       |       |       |       |       |       | |       | tion. |       |       |       |       |       |       | |       | Requ  |       |       |       |       |       |       | |       | ired. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | st    | N     | :     | :c    |       |       |       |       | | artNo | otify | tick: | ross: |       |       |       |       | | tific | build |       |       |       |       |       |       | | ation | start |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | not   | N     | :     | :c    |       |       |       |       | | ifySu | otify | tick: | ross: |       |       |       |       | | ccess | a     |       |       |       |       |       |       | |       | succe |       |       |       |       |       |       | |       | ssful |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | not   | N     | :     | :c    |       |       |       |       | | ifyAb | otify | tick: | ross: |       |       |       |       | | orted | an    |       |       |       |       |       |       | |       | ab    |       |       |       |       |       |       | |       | orted |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | noti  | N     | :     | :c    |       |       |       |       | | fyNot | otify | tick: | ross: |       |       |       |       | | Built | a     |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | |       | that  |       |       |       |       |       |       | |       | was   |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | built |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | noti  | N     | :     | :c    |       |       |       |       | | fyUns | otify | tick: | ross: |       |       |       |       | | table | an    |       |       |       |       |       |       | |       | uns   |       |       |       |       |       |       | |       | table |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | not   | N     | :     | :c    |       |       |       |       | | ifyFa | otify | tick: | ross: |       |       |       |       | | ilure | a     |       |       |       |       |       |       | |       | build |       |       |       |       |       |       | |       | fa    |       |       |       |       |       |       | |       | ilure |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | not   | N     | :     | :c    |       |       |       |       | | ifyBa | otify | tick: | ross: |       |       |       |       | | ckToN | back  |       |       |       |       |       |       | | ormal | to    |       |       |       |       |       |       | |       | n     |       |       |       |       |       |       | |       | ormal |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | tatus |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | n     | N     | :     | :c    |       |       |       |       | | otify | otify | tick: | ross: |       |       |       |       | | Repea | rep   |       |       |       |       |       |       | | tedFa | eated |       |       |       |       |       |       | | ilure | fa    |       |       |       |       |       |       | |       | ilure |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | AP    | Fe    | Esta  | V1    | V2    | Final | De    |       | | IM Ko | ature | Cloud |       |       |       | fault |       | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ins   | Ins   | :     | :c    |       |       |       |       | | tance | tance | tick: | ross: |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | APIM  |       |       |       |       |       |       | |       | plat  |       |       |       |       |       |       | |       | form. |       |       |       |       |       |       | |       | Va    |       |       |       |       |       |       | |       | lues: |       |       |       |       |       |       | |       | int / |       |       |       |       |       |       | |       | prod  |       |       |       |       |       |       | |       | (dev  |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | only  |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | open  |       |       |       |       |       |       | |       | for   |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | pub   |       |       |       |       |       |       | |       | lic)  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | cl    | S     | :     | :c    |       |       |       |       | | ientS | ecret | tick: | ross: |       |       |       |       | | ecret | of    |       |       |       |       |       |       | |       | API   |       |       |       |       |       |       | |       | C     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | cli   | ID of | :     | :c    |       |       |       |       | | entId | API   | tick: | ross: |       |       |       |       | |       | C     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | with  |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | ermis |       |       |       |       |       |       | |       | sions |       |       |       |       |       |       | |       | on    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | API   |       |       |       |       |       |       | |       | (C    |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | Cr    |       |       |       |       |       |       | |       | edent |       |       |       |       |       |       | |       | ials, |       |       |       |       |       |       | |       | Se    |       |       |       |       |       |       | |       | rvice |       |       |       |       |       |       | |       | Owner |       |       |       |       |       |       | |       | Role  |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | API)  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | clien | S     | :     | :c    |       |       |       |       | | tJenk | ecret | tick: | ross: |       |       |       |       | | insId | ID of |       |       |       |       |       |       | |       | API   |       |       |       |       |       |       | |       | C     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | with  |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | ermis |       |       |       |       |       |       | |       | sions |       |       |       |       |       |       | |       | on    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | API   |       |       |       |       |       |       | |       | (C    |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | Cr    |       |       |       |       |       |       | |       | edent |       |       |       |       |       |       | |       | ials, |       |       |       |       |       |       | |       | Se    |       |       |       |       |       |       | |       | rvice |       |       |       |       |       |       | |       | Owner |       |       |       |       |       |       | |       | Role  |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | API)  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | class | C     | :     | :c    |       |       |       |       | | ifier | onfig | tick: | ross: |       |       |       |       | |       | Class |       |       |       |       |       |       | |       | ifier |       |       |       |       |       |       | |       | For   |       |       |       |       |       |       | |       | Ap    |       |       |       |       |       |       | |       | imCon |       |       |       |       |       |       | |       | figur |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | Files |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Insta | Fe    | Esta  | V1    | V2    | Final | De    |       | | na Ko | ature | Cloud |       |       |       | fault |       | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | apiTo | In    | :     | :c    | :ques |       |       |       | | kenId | stana | tick: | ross: | tion: |       |       |       | |       | API   |       |       |       |       |       |       | |       | Token |       |       |       |       |       |       | |       | ID.   |       |       |       |       |       |       | |       | Only  |       |       |       |       |       |       | |       | used  |       |       |       |       |       |       | |       | if    |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | ecord |       |       |       |       |       |       | |       | Deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | true. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | v     |       |       |       |       |       |       | |       | alue: |       |       |       |       |       |       | |       | null  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | e     | In    | :     | :c    | :ques |       |       |       | | nviro | stana | tick: | ross: | tion: |       |       |       | | nment | e     |       |       |       |       |       |       | |       | nviro |       |       |       |       |       |       | |       | nment |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | use,  |       |       |       |       |       |       | |       | enum  |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | test| |       |       |       |       |       |       | |       | prod, |       |       |       |       |       |       | |       | def   |       |       |       |       |       |       | |       | ault: |       |       |       |       |       |       | |       | test  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | r     | If    | :     | :c    | :ques |       |       |       | | ecord | true  | tick: | ross: | tion: |       |       |       | | Deplo | a new |       |       |       |       |       |       | | yment | deplo |       |       |       |       |       |       | |       | yment |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | rec   |       |       |       |       |       |       | |       | orded |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | Ins   |       |       |       |       |       |       | |       | tana. |       |       |       |       |       |       | |       | Also  |       |       |       |       |       |       | |       | refer |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | h     |       |       |       |       |       |       | |       | ttps: |       |       |       |       |       |       | |       | //www |       |       |       |       |       |       | |       | .inst |       |       |       |       |       |       | |       | ana.c |       |       |       |       |       |       | |       | om/do |       |       |       |       |       |       | |       | cs/pi |       |       |       |       |       |       | |       | pelin |       |       |       |       |       |       | |       | e_fee |       |       |       |       |       |       | |       | dback |       |       |       |       |       |       | |       | /conf |       |       |       |       |       |       | |       | igura |       |       |       |       |       |       | |       | tion- |       |       |       |       |       |       | |       | and-a |       |       |       |       |       |       | |       | pi/). |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | v     |       |       |       |       |       |       | |       | alue: |       |       |       |       |       |       | |       | true  |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Kaf   | Fe    | Esta  | V1    | V2    | Final | De    |       | | ka Ko | ature | Cloud |       |       |       | fault |       | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | type  | e     | :     | :c    | :ques |       | Evtl. |       | |       | ither | tick: | ross: | tion: |       | G     |       | |       | t     |       |       |       |       | itops |       | |       | opics |       |       |       |       | mit   |       | |       | or    |       |       |       |       | C     |       | |       | users |       |       |       |       | harts |       | |       |       |       |       |       |       | l\u00f6sen |       | |       |       |       |       |       |       | / Mit |       | |       |       |       |       |       |       | Kafk  |       | |       |       |       |       |       |       | ateam |       | |       |       |       |       |       |       | bespr |       | |       |       |       |       |       |       | echen |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | env   | Kafka | :     | :c    | :ques |       |       |       | | ironm | e     | tick: | ross: | tion: |       |       |       | | entId | nviro |       |       |       |       |       |       | |       | nment |       |       |       |       |       |       | |       | (     |       |       |       |       |       |       | |       | test, |       |       |       |       |       |       | |       | inte, |       |       |       |       |       |       | |       | prod) |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | cli   | Id of | :     | :c    | :ques |       |       |       | | entId | the   | tick: | ross: | tion: |       |       |       | |       | C     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | API.  |       |       |       |       |       |       | |       | Fu    |       |       |       |       |       |       | |       | rther |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | forma |       |       |       |       |       |       | |       | tion, |       |       |       |       |       |       | |       | see   |       |       |       |       |       |       | |       | here  |       |       |       |       |       |       | |       | .     |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | cl    | S     | :     | :c    | :ques |       |       |       | | ientS | ecret | tick: | ross: | tion: |       |       |       | | ecret | of    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | API   |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | fil   | Glob  | :     | :c    | :ques |       |       |       | | eGlob | poi   | tick: | ross: | tion: |       |       |       | |       | nting |       |       |       |       |       |       | |       | to    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | k     |       |       |       |       |       |       | |       | afka- |       |       |       |       |       |       | |       | resou |       |       |       |       |       |       | |       | rces. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | va    |       |       |       |       |       |       | |       | lue:  |       |       |       |       |       |       | |       | kafka |       |       |       |       |       |       | |       | /{typ |       |       |       |       |       |       | |       | e}/{e |       |       |       |       |       |       | |       | nviro |       |       |       |       |       |       | |       | nment |       |       |       |       |       |       | |       | Id}/* |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | kaf   | kafka | :     | :c    | :ques |       |       |       | | kaAut | Autom | tick: | ross: | tion: |       |       |       | | omati | ation |       |       |       |       |       |       | | onUrl | URL.  |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | va    |       |       |       |       |       |       | |       | lue:  |       |       |       |       |       |       | |       | h     |       |       |       |       |       |       | |       | ttps: |       |       |       |       |       |       | |       | //kaf |       |       |       |       |       |       | |       | ka-au |       |       |       |       |       |       | |       | tomat |       |       |       |       |       |       | |       | ion-p |       |       |       |       |       |       | |       | rod.a |       |       |       |       |       |       | |       | pp.ob |       |       |       |       |       |       | |       | elix. |       |       |       |       |       |       | |       | otc.s |       |       |       |       |       |       | |       | bb.ch |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | s     | sso   | :     | :c    | :ques |       |       |       | | soUrl | URL.  | tick: | ross: | tion: |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | va    |       |       |       |       |       |       | |       | lue:  |       |       |       |       |       |       | |       | h     |       |       |       |       |       |       | |       | ttps: |       |       |       |       |       |       | |       | //sso |       |       |       |       |       |       | |       | .sbb. |       |       |       |       |       |       | |       | ch/au |       |       |       |       |       |       | |       | th/re |       |       |       |       |       |       | |       | alms/ |       |       |       |       |       |       | |       | SBB_P |       |       |       |       |       |       | |       | ublic |       |       |       |       |       |       | |       | /prot |       |       |       |       |       |       | |       | ocol/ |       |       |       |       |       |       | |       | openi |       |       |       |       |       |       | |       | d-con |       |       |       |       |       |       | |       | nect/ |       |       |       |       |       |       | |       | token |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Azure | Fe    | Esta  | V1    | V2    | Final | De    |       | | AD Ko | ature | Cloud |       |       |       | fault |       | | nfigu | Be    | Pip   |       |       |       |       |       | | ratio | schre | eline |       |       |       |       |       | | nsstr | ibung |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ins   | Ins   | :     | :c    | :     | :     | Soll  |       | | tance | tance | tick: | ross: | tick: | tick: | das   |       | |       | resp. |       |       |       |       | mit   |       | |       | stage |       |       |       |       | Pl    |       | |       | of    |       |       |       |       | ugins |       | |       | Azure |       |       |       |       | g     |       | |       | AD    |       |       |       |       | el\u00f6st |       | |       | API.  |       |       |       |       | oder  |       | |       | Pos   |       |       |       |       | fix   |       | |       | sible |       |       |       |       | imp   |       | |       | val   |       |       |       |       | lemen |       | |       | ues:  |       |       |       |       | tiert |       | |       | dev   |       |       |       |       | we    |       | |       | , int |       |       |       |       | rden? |       | |       | ,     |       |       |       |       |       |       | |       | prod  |       |       |       |       | Kann  |       | |       |       |       |       |       |       | mit   |       | |       |       |       |       |       |       | Helmc |       | |       |       |       |       |       |       | harts |       | |       |       |       |       |       |       | ein   |       | |       |       |       |       |       |       | REST  |       | |       |       |       |       |       |       | call  |       | |       |       |       |       |       |       | ausge |       | |       |       |       |       |       |       | f\u00fchrt |       | |       |       |       |       |       |       | we    |       | |       |       |       |       |       |       | rden? |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | a     | Path  | :     | :c    | :     | :     |       |       | | ppReg | to    | tick: | ross: | tick: | tick: |       |       | | istra | the   |       |       |       |       |       |       | | tionC | c     |       |       |       |       |       |       | | onfig | onfig |       |       |       |       |       |       | | Path  | file  |       |       |       |       |       |       | |       | (from |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | repos |       |       |       |       |       |       | |       | itory |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | oot): |       |       |       |       |       |       | |       | e.g.  |       |       |       |       |       |       | |       | \"app- |       |       |       |       |       |       | |       | regis |       |       |       |       |       |       | |       | trati |       |       |       |       |       |       | |       | on/es |       |       |       |       |       |       | |       | ta-ia |       |       |       |       |       |       | |       | m-blu |       |       |       |       |       |       | |       | eprin |       |       |       |       |       |       | |       | ts-ap |       |       |       |       |       |       | |       | p-reg |       |       |       |       |       |       | |       | istra |       |       |       |       |       |       | |       | tions |       |       |       |       |       |       | |       | .yml\" |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | cli   | Id of | :     | :c    | :     | :     |       |       | | entId | the   | tick: | ross: | tick: | tick: |       |       | |       | c     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | that  |       |       |       |       |       |       | |       | has   |       |       |       |       |       |       | |       | been  |       |       |       |       |       |       | |       | regis |       |       |       |       |       |       | |       | tered |       |       |       |       |       |       | |       | in    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | SBB   |       |       |       |       |       |       | |       | deve  |       |       |       |       |       |       | |       | loper |       |       |       |       |       |       | |       | p     |       |       |       |       |       |       | |       | ortal |       |       |       |       |       |       | |       |  to   |       |       |       |       |       |       | |       | a     |       |       |       |       |       |       | |       | ccess |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | Azure |       |       |       |       |       |       | |       | AD    |       |       |       |       |       |       | |       | API   |       |       |       |       |       |       | |       | (C    |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | C     |       |       |       |       |       |       | |       | reden |       |       |       |       |       |       | |       | tials |       |       |       |       |       |       | |       | f     |       |       |       |       |       |       | |       | low). |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | cl    | One   | :     | :c    | :     | :     |       |       | | ientS | of    | tick: | ross: | tick: | tick: |       |       | | ecret | the   |       |       |       |       |       |       | |  or   | two   |       |       |       |       |       |       | | jenki | param |       |       |       |       |       |       | | nsCre | eters |       |       |       |       |       |       | | denti | must  |       |       |       |       |       |       | | alsId | be    |       |       |       |       |       |       | |       | g     |       |       |       |       |       |       | |       | iven: |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | ither |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | lient |       |       |       |       |       |       | |       | s     |       |       |       |       |       |       | |       | ecret |       |       |       |       |       |       | |       | or    |       |       |       |       |       |       | |       | (pr   |       |       |       |       |       |       | |       | efera |       |       |       |       |       |       | |       | bly!) |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | jenki |       |       |       |       |       |       | |       | nsCre |       |       |       |       |       |       | |       | denti |       |       |       |       |       |       | |       | alsId |       |       |       |       |       |       | |       | r     |       |       |       |       |       |       | |       | efere |       |       |       |       |       |       | |       | ncing |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | se    |       |       |       |       |       |       | |       | cret. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | CiJo  | Fe    | Esta  | V1    | V2    | Final | De    |       | | bPara | ature | Cloud |       |       |       | fault |       | | meter | Be    | Pip   |       |       |       |       |       | | s  Ko | schre | eline |       |       |       |       |       | | nfigu | ibung |       |       |       |       |       |       | | ratio |       |       |       |       |       |       |       | | nsstr |       |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | ups   | SSH   | :     | :c    |       |       |       |       | | tream | url   | tick: | ross: |       |       |       |       | | GitRe | of    |       |       |       |       |       |       | | poUrl | the   |       |       |       |       |       |       | |       | ups   |       |       |       |       |       |       | |       | tream |       |       |       |       |       |       | |       | repos |       |       |       |       |       |       | |       | itory |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | u     | B     | :     | :c    |       |       |       |       | | pstre | ranch | tick: | ross: |       |       |       |       | | amGit | of    |       |       |       |       |       |       | | RepoB | the   |       |       |       |       |       |       | | ranch | ups   |       |       |       |       |       |       | |       | tream |       |       |       |       |       |       | |       | repos |       |       |       |       |       |       | |       | itory |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | u     | C     | :     | :c    |       |       |       |       | | pstre | ommit | tick: | ross: |       |       |       |       | | amGit | id of |       |       |       |       |       |       | | RepoC | the   |       |       |       |       |       |       | | ommit | ups   |       |       |       |       |       |       | |       | tream |       |       |       |       |       |       | |       | repos |       |       |       |       |       |       | |       | itory |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ |       |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Not   | Fe    | Esta  | V1    | V2    | Final | De    | .n    | | ifica | ature | Cloud |       |       |       | fault | otifi | | tions | Be    | Pip   |       |       |       |       | catio | | Ko    | schre | eline |       |       |       |       | ns[*] | | nfigu | ibung |       |       |       |       |       |       | | ratio |       |       |       |       |       |       |       | | nsstr |       |       |       |       |       |       |       | | uktur |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | type  | Typ   | :c    | :     | :     | :     | \"e    |       | | (requ | e/del | ross: | tick: | tick: | tick: | mail\" |       | | ired) | ivery |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | no    |       |       |       |       |       |       | |       | tific |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | mes   |       |       |       |       |       |       | |       | sages |       |       |       |       |       |       | |       | [\"    |       |       |       |       |       |       | |       | EMAIL |       |       |       |       |       |       | |       | \",\"TE |       |       |       |       |       |       | |       | AMS\"] |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | send  | Flag  | :c    | :     | :     | :     | true  |       | | ingEn | to    | ross: | tick: | tick: | tick: |       |       | | abled | enab  |       |       |       |       |       |       | |       | le/di |       |       |       |       |       |       | |       | sable |       |       |       |       |       |       | |       | se    |       |       |       |       |       |       | |       | nding |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | ifica |       |       |       |       |       |       | |       | tions |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | event | F     | :c    | :     | :     | :     |       |       | | Types | ilter | ross: | tick: | tick: | tick: |       |       | |       | for   |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | vents |       |       |       |       |       |       | |       | that  |       |       |       |       |       |       | |       | tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | this  |       |       |       |       |       |       | |       | no    |       |       |       |       |       |       | |       | tific |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | (\"STA |       |       |       |       |       |       | |       | RT\",\" |       |       |       |       |       |       | |       | SUCCE |       |       |       |       |       |       | |       | SS\",\" |       |       |       |       |       |       | |       | FAILU |       |       |       |       |       |       | |       | RE\",\" |       |       |       |       |       |       | |       | ABORT |       |       |       |       |       |       | |       | ED\"). |       |       |       |       |       |       | |       | If    |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | mpty, |       |       |       |       |       |       | |       | all   |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | vents |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | noti  |       |       |       |       |       |       | |       | ficat |       |       |       |       |       |       | |       | ions. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | pip   | F     | :c    | :     | :     | :     |       |       | | eline | ilter | ross: | tick: | tick: | tick: |       |       | | Types | for   |       |       |       |       |       |       | |       | pip   |       |       |       |       |       |       | |       | eline |       |       |       |       |       |       | |       | types |       |       |       |       |       |       | |       | tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | this  |       |       |       |       |       |       | |       | no    |       |       |       |       |       |       | |       | tific |       |       |       |       |       |       | |       | ation |       |       |       |       |       |       | |       | (\"TA  |       |       |       |       |       |       | |       | GGING |       |       |       |       |       |       | |       | \",\"BU |       |       |       |       |       |       | |       | ILD\", |       |       |       |       |       |       | |       | \"STAG |       |       |       |       |       |       | |       | ING\", |       |       |       |       |       |       | |       | \"CUST |       |       |       |       |       |       | |       | OM\"). |       |       |       |       |       |       | |       | If    |       |       |       |       |       |       | |       | e     |       |       |       |       |       |       | |       | mpty, |       |       |       |       |       |       | |       | all   |       |       |       |       |       |       | |       | pip   |       |       |       |       |       |       | |       | eline |       |       |       |       |       |       | |       | types |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | tr    |       |       |       |       |       |       | |       | igger |       |       |       |       |       |       | |       | noti  |       |       |       |       |       |       | |       | ficat |       |       |       |       |       |       | |       | ions. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | title | The   | :c    | :c    | :ques | :     |       |       | |       | me    | ross: | ross: | tion: | tick: |       |       | |       | ssage |       |       |       |       |       |       | |       | t     |       |       |       |       |       |       | |       | itle. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | title |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | taken |       |       |       |       |       |       | |       | from  |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | g     |       |       |       |       |       |       | |       | lobal |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | onfig |       |       |       |       |       |       | |       | map   |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | ESTA  |       |       |       |       |       |       | |       | T     |       |       |       |       |       |       | |       | ekton |       |       |       |       |       |       | |       | Contr |       |       |       |       |       |       | |       | oller |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | me    | The   | :c    | :c    | :ques | :     |       |       | | ssage | me    | ross: | ross: | tion: | tick: |       |       | |       | ssage |       |       |       |       |       |       | |       | body. |       |       |       |       |       |       | |       | De    |       |       |       |       |       |       | |       | fault |       |       |       |       |       |       | |       | value |       |       |       |       |       |       | |       | is    |       |       |       |       |       |       | |       | taken |       |       |       |       |       |       | |       | from  |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | g     |       |       |       |       |       |       | |       | lobal |       |       |       |       |       |       | |       | c     |       |       |       |       |       |       | |       | onfig |       |       |       |       |       |       | |       | map   |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | ESTA  |       |       |       |       |       |       | |       | T     |       |       |       |       |       |       | |       | ekton |       |       |       |       |       |       | |       | Contr |       |       |       |       |       |       | |       | oller |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | recip | List  | :c    | :     | :     | :     |       |       | | ients | of    | ross: | tick: | tick: | tick: |       |       | |       | reci  |       |       |       |       |       |       | |       | pient |       |       |       |       |       |       | |       | email |       |       |       |       |       |       | |       | addr  |       |       |       |       |       |       | |       | esses |       |       |       |       |       |       | |       | for   |       |       |       |       |       |       | |       | \"e    |       |       |       |       |       |       | |       | mail\" |       |       |       |       |       |       | |       | type  |       |       |       |       |       |       | |       | noti  |       |       |       |       |       |       | |       | ficat |       |       |       |       |       |       | |       | ions. |       |       |       |       |       |       | |       | The   |       |       |       |       |       |       | |       | S     |       |       |       |       |       |       | |       | tring |       |       |       |       |       |       | |       | \"$a   |       |       |       |       |       |       | |       | ctor\" |       |       |       |       |       |       | |       | will  |       |       |       |       |       |       | |       | be    |       |       |       |       |       |       | |       | rep   |       |       |       |       |       |       | |       | laced |       |       |       |       |       |       | |       | with  |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | email |       |       |       |       |       |       | |       | ad    |       |       |       |       |       |       | |       | dress |       |       |       |       |       |       | |       | of    |       |       |       |       |       |       | |       | user  |       |       |       |       |       |       | |       | who   |       |       |       |       |       |       | |       | st    |       |       |       |       |       |       | |       | arted |       |       |       |       |       |       | |       | the   |       |       |       |       |       |       | |       | pipe  |       |       |       |       |       |       | |       | line. |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | webho | We    | :c    | :     | :     | :     |       |       | | okUrl | bhook | ross: | tick: | tick: | tick: |       |       | |       | URL   |       |       |       |       |       |       | |       | for   |       |       |       |       |       |       | |       | \"t    |       |       |       |       |       |       | |       | eams\" |       |       |       |       |       |       | |       | type  |       |       |       |       |       |       | |       | not   |       |       |       |       |       |       | |       | ifica |       |       |       |       |       |       | |       | tions |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Nicht |       |       |       |       |       |       |       | | kon   |       |       |       |       |       |       |       | | figur |       |       |       |       |       |       |       | | ative |       |       |       |       |       |       |       | | Fea   |       |       |       |       |       |       |       | | tures |       |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+ | Su    | h     | :c    | :c    | :ques |       |       |       | | pport | ttps: | ross: | ross: | tion: |       |       |       | | von   | //www |       |       |       |       |       |       | | Co    | .conv |       |       |       |       |       |       | | nvent | entio |       |       |       |       |       |       | | ional | nalco |       |       |       |       |       |       | | co    | mmits |       |       |       |       |       |       | | mmits | .org/ |       |       |       |       |       |       | |       | en/v1 |       |       |       |       |       |       | |       | .0.0/ |       |       |       |       |       |       | +-------+-------+-------+-------+-------+-------+-------+-------+  Custom Pipelines (Draft)  Es versteht sich, dass die Standard Pipelines f\u00fcr Maven, NPM, Go und Docker Builds, welche von ESTA Tekton angeboten werden, nicht f\u00fcr alle Projekte und Bed\u00fcrfnisse gen\u00fcgen. Einer der Vorteile von Tekton ist, dass man einfach eigene Pipelines erstelllen kann und dabei auf bestehende Tasks von ESTA Tekton oder aus dem \u00f6ffentlichen Tekton Katalog zugreifen kann. Die Unterst\u00fctzung f\u00fcr Custom Pipelines in ESTA Tekton soll daher m\u00f6glichst einfach umgesetzt werden und in einer Form, wo die Funktionalit\u00e4t des ESTA Tekton Controllers f\u00fcr das Management bestm\u00f6glichst genutzt werden kann. So sehen wir zwei Stufen f\u00fcr die Definition und Anwendung von Custom Pipelines in Repos resp. Projekten vor:  Custom Pipeline Templates im Projekt-Repository  Templates f\u00fcr Custom Pipelines resp. PipelineRuns werden direkt im Repository gehalten, wo auch das estaTektonPipeline.json liegt und von selbigem referenziert.  Als Konvention gilt, dass die PipelineRun Templates im Ordner \"tekon\" gespeichert und \"self-contained\" sind. Das bedeutet, sie werden vom ESTA Tekton Controller direkt via oc process -f <file> verarbeitet und nicht im OpenShift Namespace applied. Sie enthalten vorzugsweise die Pipeline Definition inline mit pipelineSpec, wie in diesem Beispiel gezeigt. Damit wird gew\u00e4hrleistet, dass die Custom Pipeline in der richtigen Version aus dem entsprechenden Branch/Tag/Commit gestartet wird.  Custom Repository mit Pipeline und Task Definitionen  F\u00fcr gr\u00f6ssere Projekte k\u00f6nnen Tekton Tasks und Pipelines in einem eigenen Repository verwaltet werden. Diese werden dann vom Controller in den entsprechenden OpenShift Namespace importiert, analog zu den Standard ESTA Tekton Pipelines. Sie sind dann also global und in der im Controller konfigurierten Version vorhanden und werden \u00fcber ihre eindeutigen Namen gestartet oder referenziert. \u00dcber diesen Mechanismus k\u00f6nnen die Tasks und Pipelines von ESTA Tekton erg\u00e4nzt oder ggf. sogar \u00fcberschrieben werden.  Integration in estaTektonPipeline.json  Die Verwendung von Custom Pipelines wird \u00fcber die steps Definition im estaTektonPipeline.json gesteuert und zwar \u00fcber das Propertry customPipelines mit einer Liste von Pipeline Spezifikationen.  Eine Custom Pipeline wird dabei \u00fcber eine der folgenden Properties angegeben:  \"pipelineTemplate\": \"<Name oder Datei des PipelineRun Templates>\" \"pipelineRef\": \"<Name der Pipeline>\"  Mit pipelineTemplate wird auf ein OpenShift Template verwiesen, welches einen PipelineRun und allf\u00e4llige zus\u00e4zliche Resourcen wie PVCs erstellt. Endet das Property mit .yaml wird die enstprechende Datei im Ordner \"tekton\" des Repositors verwendet. Ansonsten wird der Wert als Name f\u00fcr ein im Namespace vorhandenes Template betrachtet.  Ist stattdessen pipelineRef in der Step Konfiguration angegeben, wird dies als Referenz auf eine im Namespace vorhandene Pipeline interpretiert und \u00fcber ein Standard PipelineRun Template gestartet.  Pipeline Parameter  Zus\u00e4tzliche Parameter, welche an die PipelineRuns \u00fcbergeben werden, k\u00f6nnen in der Custom Pipeline Konfiguration im estaTektonPipeline.json definiert werden:  \"params\": { \"VERSION_TAG\": \"snapshot.${DATE}\", \"IMAGE_LABELS\": \"buildtype=snapshot\"  }  Die Parameter Values k\u00f6nnen interpolierte Strings enthalten, welche mit vom Controller global definierten Parametern (${PARAM_NAME}) oder Werten aus dem estaTektonPipeline.json (${/json/pointer}) ersetzt werden.  Beispielkonfiguration eines Steps mit Custom Pipeline  Eine Beispielkonfiguration eines Buildsteps k\u00f6nnte so aussehen. Wie man sieht, k\u00f6nnen auch mehrere Pipelines definiert werden, welche vom Controller parallel gestartet werden:  { \"name\": \"snapshot\", \"enabled\": true, \"buildDockerImage\": true, \"triggerType\": [ \"GITEVENT\" ], \"customPipelines\": [ { \"pipelineTemplate\": \"custom-build-pipeline-run-template.yaml\", \"params\": { \"IMAGE_TAG\": \"snapshot.${DATE}\", \"APP_NAME\": \"${/stages/1/argoCD/argoCdAppName}\"  } } ] }  Controller REST API (Draft)    Route                                                           Methode   Beschreibung                                                                       Payload   --------------------------------------------------------------- --------- ---------------------------------------------------------------------------------- --------------------------   /api/bitbucket/projects                                         GET       Listet alle Bitbucket Projekte, welche im Controller registriert sind                 /api/bitbucket/projects/:pid                                    GET       Details zu einem Bitbucket Projekt                                                    /api/bitbucket/projects/:id/repos                               GET       Listet alle Tekton-enabled Bitbucket Repositories im Projekt                          /api/bitbucket/projects/:id/repos/:rid                          GET       Details zu einem Bitbucket Repository inkl. Branches und estaTektonPipeline.json      /api/bitbucket/projects/:id/repos/:rid/branches                 GET       Gibt die Branches zu einem Repository zur\u00fcck                                          /api/bitbucket/projects/:id/repos/:rid/branches/:branch/build   POST      Startet einen Pipeline Run f\u00fcr den gegebenen Branch                                {}   /api/bitbucket/projects/:id/repos/:rid/branches/:branch/tag     POST      Startet einen Tagging Pipeline Run \u00fcr den gegebenen Branch                         {\"versionTag\":\"1.2.3.0\"}   /api/pipelinerun?repository=kd-esta--foo&type=*                 GET       Listet alle Pipeline Runs welchen den angegegebenen Selektoren entsprchen             /api/pipelinerun/:id                                            GET       Details zu einem Pipeline Run                                                         /api/pipelinerun/:id                                            DELETE    L\u00f6schen eines Pipeline Runs mit allen verkn\u00fcpften Resourcen                           /api/pipelinerun/:id/logs[/stream]                              GET       Logs eines Pipeline Runs                                                              /api/pipelinerun/:id/rerun                                      POST      Neustart des Pipeline Runs                                                            /api/pipelinerun/:id/cancel                                     POST      Abbrechen eines laufenden Pipeline Runs                                               /api/pipelinerun/:id/delete                                     DELETE    Stop und L\u00f6schen eines Pipeline Runs                                                 Die Aktuelle Version des APIs wird mit Swagger/OpenAPI dokumentiert: https://esta-tekton-controller-esta-tekton-dev.sbb-cloud.net/swaggerui/ "}, {"text": "ESTA Tekton Self-Managed Migration  ESTA Tekton can now be installed individually using a prepared Helm chart which is maintained and released by ESTA. The preparation and use of this Helm chart is documented in the README of the esta-tekton-helm source repository (see section \"How to use\").  If you're already using ESTA Tekton as a managed service (ordered via the CLEW Self Service Portal), here are the steps required to migrate your Tekton instance into your own self-managed environment:  -   1 Backup the Tekton Results Database  -   2 (A) Migrate the OpenShift Namespace  -   3 (B) Create a new OpenShift Namespace  -   4 Shut down the managed ESTA Tekton instance  -   5 Install ESTA Tekton via ArgoCD  -   6 Restore the Tekton Results Database  Backup the Tekton Results Database  For new Tekton instances, a new database schema for storing pipeline runs will be created. In order to preserve the build history, we recommend to dump the existing database and later import the records into the new schema.  1.  Get the database credentials from the secret named     \"tekton-results-postgres\" in the existing Tekton namespace  2.  Use pg_dump to copy all data into a local file  Here's a shell script that performs these actions:  backup-tekton-db.sh  # 1. log in to the cluster that hosts your current Tekton namespace  # oc login ....  export TEKTON_NAMESPACE=\"<your-tekton-namespace>\"  export POSTGRES_SCHEMA=$(echo \"$TEKTON_NAMESPACE\" | sed 's/-/_/g')  for key in DB_HOST POSTGRES_DB POSTGRES_USER POSTGRES_PASSWORD; do  export $key=$(oc get secret tekton-results-postgres -n $TEKTON_NAMESPACE -o jsonpath=\"{.data.$key}\" | base64 -d);  done  PGPASSWORD=\"$POSTGRES_PASSWORD\" pg_dump -U $POSTGRES_USER -h $DB_HOST -p 5432 -n $POSTGRES_SCHEMA --no-privileges --no-comments --data-only $POSTGRES_DB > tekton-results-dump.sql  (A) Migrate the OpenShift Namespace  For a smooth transition it's best to keep the existing namespace but simply replace the deployment of ESTA Tekton. The following steps are required:  1.  Change the label clew.sbb.ch/project-type: build to the value     \"build-self\"  2.  Add the label iam.sbb.ch/appregistration: \"true\"  3.  Remove sensitive secrets: azure-ad-client-credentials,     esta-owasp-db-secret, esta-tekton-smtp-auth,     esta-tekton-sonar-api-key  4.  Grant admin rights to the new owner/customer  admin-role-binding.yaml  apiVersion: rbac.authorization.k8s.io/v1  kind: RoleBinding  metadata:  name: admin-uXXXXXX  subjects:  - kind: User  apiGroup: rbac.authorization.k8s.io  name: uXXXXXX  roleRef:  apiGroup: rbac.authorization.k8s.io  kind: ClusterRole  name: admin  IMPORTANT  The label clew.sbb.ch/project-type can only be changed by a cluster admin. Reach out to the CON team to get this done.  (B) Create a new OpenShift Namespace  Order a new OpenShift namespace via the CLEW Self Service Portal. Tekton namespaces can only be created on the clusters aws01t and aws02t.  In order to keep the URL to your Tekton instance unchanged, we recommend to choose the same name as the existing namespace (e.g. clew-tekton) but select another cluster. So if your current namespace is on aws01t, create the new one on aws02t and vice versa. Of course, you can choose any name you want but the URL pointing to your Tekton instance will contain the namespace name.  IMPORTANT  At the time of writing, some changes to the namespace template need to be applied manually be the Container Team. Please open a CLEW Support issue with the component \"OpenShift\" to get the default limit ranges and resource quotas removed from your Tekton namespace and to get the label clew.sbb.ch/project-type: build-self added.  Shut down the managed ESTA Tekton instance  1.  Remove the according application from the ESTA ArgoCD Git     repository.  2.  Sync ArgoCD (should be done automatically)  Install ESTA Tekton via ArgoCD  1.  Follow the \"How to use\" section in the README and create a new     application in your in your ArgoCD Git repository with two values     files providing all the mandatory chart values listed in the README.     One containing the public settings for your setup and one containing     the secret values like client secrets, usernames, passwords, etc.     The latter one should be encrypted with SOPS before checking it in     to Git.  2.  applications/esta-tekton/  3.  - Chart.yaml  4.  - values.yaml    - secrets.yaml    See this example for reference.  5.  Add an application template to your app-of-apps chart for the     cluster where Tekton is supposed to be installed (example)  6.  Permit your ArgoCD instance to manage the new Tekton namespace (see     Namespace management)  7.  Sync your app-of-apps chart in ArgoCD and let the deployment start  Restore the Tekton Results Database  Similar to backing up the database, we use the (new) credentials from the \"tekton-results-postgres\" secret to connect to the new database and then use pgsql to import the backupped records.  restore-tekton-results.sh  # 1. log in to the cluster that hosts your current Tekton namespace  # oc login ....  export OLD_TEKTON_NAMESPACE=<your-tekton-namespace>  export NEW_TEKTON_NAMESPACE=$OLD_TEKTON_NAMESPACE  export OLD_POSTGRES_SCHEMA=$(echo \"$OLD_TEKTON_NAMESPACE\" | sed 's/-/_/g')  export NEW_NAMESPACE_SNAKE=$(echo \"$NEW_TEKTON_NAMESPACE\" | sed 's/-/_/g')  export NEW_POSTGRES_SCHEMA=\"${NEW_NAMESPACE_SNAKE}_<cluster>\"  # migrate DB dump to be restored into new schema  echo \"TRUNCATE TABLE $NEW_POSTGRES_SCHEMA.results CASCADE;\" > tekton-results-dump.sql.new  cat tekton-results-dump.sql | sed \"s/$OLD_POSTGRES_SCHEMA./$NEW_POSTGRES_SCHEMA./\" >> tekton-results-dump.sql.new  for key in DB_HOST POSTGRES_DB POSTGRES_USER POSTGRES_PASSWORD; do  export $key=$(oc get secret tekton-results-postgres -n $NEW_TEKTON_NAMESPACE -o jsonpath=\"{.data.$key}\" | base64 -d);  done  PGPASSWORD=\"$POSTGRES_PASSWORD\" psql -U $POSTGRES_USER -h $DB_HOST -p 5432 -d $POSTGRES_DB -f tekton-results-dump.sql.new  Finally, restart the controller to pick-up the new records from the database:  oc rollout resart deployment esta-tekton-pipeline-controller -n <your-tekton-namespace> "}, {"text": "Tagging Pipelines via estaTektonPipeline.json konfigurierbar  +--------------------------+------------------------------------------+ | Fragestellung            | Aus ersten Pilotprojekten ergibt sich    | |                          | die Anforderung, den Release-Prozess (\u2192  | |                          | Tagging Pipelines) auch automatisiert    | |                          | aus Git Events starten zu k\u00f6nnen.        | |                          | Aktuell ist dies nur \u00fcber das Tekton     | |                          | Control Panel oder \u00fcber das REST API des | |                          | Controllers m\u00f6glich und es gibt keine    | |                          | Einstellungsm\u00f6glichkeiten. Tagging       | |                          | Pipelines sollen daher auch \u00fcber die     | |                          | Step Konfiguration im                    | |                          | estaTektonPipeline.json gesteuert werden | |                          | k\u00f6nnen. Bislang definieren die Steps     | |                          | lediglich Build Pipelines. Auch f\u00fcr das  | |                          | automatisierte Tagging sollen            | |                          | Trigger-Kriterien wie triggerTypes und   | |                          | branchNamePrefixes konfiguriert werden   | |                          | k\u00f6nnen.                                  | |                          |                                          | |                          | ESTA-4906 - Der Jira-Vorgang existiert   | |                          | nicht oder Sie sind nicht                | |                          | anzeigeberechtigt.                       | +==========================+==========================================+ | Rahmenbedingungen        | -   Konfiguration \u00fcber                   | |                          |     estaTektonPipeline.json              | |                          |                                          | |                          | -   Anpassungen r\u00fcckw\u00e4rtskompatibel zum  | |                          |     bisherigen Schema von                | |                          |     estaTektonPipeline.json              | |                          |                                          | |                          | -   Steuerung \u00fcber den ESTA Tekton       | |                          |     Controller                           | |                          |                                          | |                          | -   Die automatische Versionierung       | |                          |     (major, minor, patch) muss           | |                          |     konfigurierbar sein                  | +--------------------------+------------------------------------------+ | Annahmen                 | --                                       | +--------------------------+------------------------------------------+ | Varianten / Alternativen | Variante 1                               | |                          |                                          | |                          | Die bestehende Step                      | |                          | Konfigurationsstruktur wird um ein       | |                          | Property \"pipelineType\" (\"TAGGING\" |     | |                          | \"BUILD\") erg\u00e4nzt.                        | |                          |                                          | |                          | Beispiel:                                | |                          |                                          | |                          | Step Config mit pipelineType Quelle      | |                          | erweitern                                | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"name\": \"continuous-release\",            | |                          |                                          | |                          | \"pipelineType\": \"TAGGING\",               | |                          |                                          | |                          | \"enabled\": true,                         | |                          |                                          | |                          | \"updateHelmChart\": false,                | |                          |                                          | |                          | \"versionIncrement\": \"minor\",             | |                          |                                          | |                          | \"triggerType\": [                         | |                          |                                          | |                          | \"USER\",                                  | |                          |                                          | |                          | \"GITEVENT\"                               | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"branchNamePrefixes\": [                  | |                          |                                          | |                          | \"master\",                                | |                          |                                          | |                          | \"hotifx\"                                 | |                          |                                          | |                          | ]                                        | |                          |                                          | |                          | }                                        | |                          |                                          | |                          |   Vorteile                               | |                          |                                Nachteile | |                          |   -----------------                      | |                          | --------------------------------- ------ | |                          | ---------------------------------------- | |                          |   Einfache Int                           | |                          | egration \u2192 wenig Entwicklungsaufwand   S | |                          | chlechte Unterscheidung der Step-Configs | |                          |   Explizite Angab                        | |                          | e                                   Inko | |                          | nsistenz mit dem Staging Konzept im JSON | |                          |   Vollst\u00e4ndig                            | |                          |  r\u00fcckw\u00e4rtskompatibel                     | |                          |                                          | |                          | Variante 2                               | |                          |                                          | |                          | Separate Step Konfigurationsstrukturen   | |                          | f\u00fcr Tagging und Build Pipelines.         | |                          |                                          | |                          | Im JSON Schema gibt es eine neue Liste   | |                          | \"releases\" mit Step configs f\u00fcr          | |                          | Tagging/Release Pipelines und \"builds\"   | |                          | f\u00fcr Build Pipelines. Diese Terminologie  | |                          | integriert sich gut mit den bestehenden  | |                          | \"stages\" f\u00fcr die Staging Pipelines. Die  | |                          | bisherigen \"steps\" w\u00fcrden in \"builds\"    | |                          | umbenannt, was eine Breaking Change      | |                          | darstellt.                               | |                          |                                          | |                          | Release, Build, Staging                  | |                          | Konfiguration           | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"stages\": [                              | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"stageName\": \"dev\",                      | |                          |                                          | |                          | \"argoCD\": {                              | |                          |                                          | |                          | \"autoSync\": true                         | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"builds\": [                              | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"name\": \"continuous-build\",              | |                          |                                          | |                          | \"enabled\": true,                         | |                          |                                          | |                          | \"additionalBuildParams\": \"-DskipITs\",    | |                          |                                          | |                          | \"triggerType\": [                         | |                          |                                          | |                          | \"USER\",                                  | |                          |                                          | |                          | \"GITEVENT\"                               | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"branchNamePrefixes\": [                  | |                          |                                          | |                          | \"feature\",                               | |                          |                                          | |                          | \"hotfix\"                                 | |                          |                                          | |                          | ]                                        | |                          |                                          | |                          | },                                       | |                          |                                          | |                          | { ... }                                  | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"releases\": [                            | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"name\": \"continuous-release\",            | |                          |                                          | |                          | \"enabled\": true,                         | |                          |                                          | |                          | \"versionIncrement\": \"patch\",             | |                          |                                          | |                          | \"triggerType\": [                         | |                          |                                          | |                          | \"USER\",                                  | |                          |                                          | |                          | \"GITEVENT\"                               | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"branchNamePrefixes\": [                  | |                          |                                          | |                          | \"master\",                                | |                          |                                          | |                          | \"hotfix\"                                 | |                          |                                          | |                          | ]                                        | |                          |                                          | |                          | },                                       | |                          |                                          | |                          | { ... }                                  | |                          |                                          | |                          | ]                                        | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | Die R\u00fcckw\u00e4rtskompatibilit\u00e4t zum          | |                          | bisherigen Schema von                    | |                          | estaTektonPipeline.json kann             | |                          | gew\u00e4hrleistet werden, indem die          | |                          | bisherige \"steps\" Liste vom Controller   | |                          | als \"builds\" gelesen und sinngem\u00e4ss als  | |                          | Alias behandelt wird.                    | |                          |                                          | |                          |   Vorteile                               | |                          |                                          | |                          |                                Nachteile | |                          |   -------------------------------        | |                          | ---------------------------------------- | |                          | ------------------------------- -------- | |                          | ---------------------------------------- | |                          |   Konsequentes und verst\u00e4ndliches Naming | |                          |                                          | |                          |                          Breaking Change | |                          |   Klare Unterscheidung                   | |                          |                                          | |                          |                                   Gr\u00f6sse | |                          | re Abweichung von estaCloudPipeline.json | |                          |   Individuelle Schema De                 | |                          | finitionen (build, release, stage) und s | |                          | omit bessere Validierungsm\u00f6glichkeiten   | |                          |  Custom Pipelines unter \"builds\" gef\u00fchrt | |                          |                                          | |                          | Variante 3                               | |                          |                                          | |                          | Die Step Konfigurationsstruktur wird     | |                          | komplett neu strukturiert                | |                          |                                          | |                          | -   Die Liste \"steps\" wird in            | |                          |     \"pipelines\" umbenannt                | |                          |                                          | |                          | -   Die bisherige \"step\" Config erh\u00e4lt   | |                          |     neue Unterobjekte je nach            | |                          |     Pipeline-Typ:                        | |                          |                                          | |                          |     -   \"build\": buildDockerImage,       | |                          |         packageAndDeployHelmChart,       | |                          |         additionalBuildParams,           | |                          |         deployArtifacts                  | |                          |                                          | |                          |     -   \"tagging\":                       | |                          |         versionIncrementPattern,         | |                          |         updateHelm Chart                 | |                          |                                          | |                          |     -   \"custom\": pipelineRef,           | |                          |         pipelineTemplate, params         | |                          |                                          | |                          | -   Folgende Properties sind allgemein   | |                          |     f\u00fcr alle Pipeline Configs:           | |                          |     name, enabled, triggerType,          | |                          |     branchNamePrefixes,                  | |                          |     versionTagEventPatterns, stages      | |                          |                                          | |                          | Beispiel:                                | |                          |                                          | |                          | Pipelines Config        | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"stages\": [                              | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"stageName\": \"dev\",                      | |                          |                                          | |                          | \"argoCD\": {                              | |                          |                                          | |                          | \"autoSync\": true                         | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"pipelines\": [                           | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"name\": \"continuous-build\",              | |                          |                                          | |                          | \"enabled\": true,                         | |                          |                                          | |                          | \"triggerType\": [                         | |                          |                                          | |                          | \"USER\",                                  | |                          |                                          | |                          | \"GITEVENT\"                               | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"branchNamePrefixes\": [                  | |                          |                                          | |                          | \"feature\",                               | |                          |                                          | |                          | \"development\"                            | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"build\": {                               | |                          |                                          | |                          | \"additionalBuildParams\": \"-DskipITs\"     | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | },                                       | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"name\": \"continuous-release\",            | |                          |                                          | |                          | \"enabled\": true,                         | |                          |                                          | |                          | \"triggerType\": [                         | |                          |                                          | |                          | \"USER\",                                  | |                          |                                          | |                          | \"GITEVENT\"                               | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"branchNamePrefixes\": [                  | |                          |                                          | |                          | \"master\",                                | |                          |                                          | |                          | \"hotfix\"                                 | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"tagging\": {                             | |                          |                                          | |                          | \"versionIncrementPattern\":               | |                          | \"\\\\d+\\\\.(\\\\d+)-saturn-2\"                 | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | },                                       | |                          |                                          | |                          | {                                        | |                          |                                          | |                          | \"name\": \"custom-build\",                  | |                          |                                          | |                          | \"enabled\": true,                         | |                          |                                          | |                          | \"triggerType\": [                         | |                          |                                          | |                          | \"GITEVENT\"                               | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"versionTagEventPatterns\": [             | |                          |                                          | |                          | \"^custom-(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\*|\\\\d+)$\"  | |                          |                                          | |                          | ],                                       | |                          |                                          | |                          | \"custom\": {                              | |                          |                                          | |                          | \"pipelineTemplate\":                      | |                          | \"foo-bar-pipeline.yaml\",                 | |                          |                                          | |                          | \"params\": {                              | |                          |                                          | |                          | \"FOO\": \"BAR\"                             | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | },                                       | |                          |                                          | |                          | \"stages\": [\"dev\"]                        | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | ]                                        | |                          |                                          | |                          | }                                        | |                          |                                          | |                          | Die R\u00fcckw\u00e4rtskompatibilit\u00e4t ist mit      | |                          | dieser Variante nicht gew\u00e4hrleistet. Es  | |                          | ist somit eine Migration der bestehenden | |                          | Tekton-enabled Projekte notwendig. Eine  | |                          | automatisierter Check von alten Schemas  | |                          | mit Konvertierung ins neue Schema (es    | |                          | wird ein PR erstellt) k\u00f6nnte im ESTA     | |                          | Tekton Controller implementiert werden   | |                          | und auch f\u00fcr sp\u00e4tere Schema-Anpassungen  | |                          | n\u00fctzlich sein.                           | |                          |                                          | |                          |   Vo                                     | |                          | rteile                                   | |                          |                                Nachteile | |                          |   ------------------------               | |                          | ---------------------------------------- | |                          | -------- ------------------------------- | |                          | ---------------------------------------- | |                          |   Konseque                               | |                          | ntes und verst\u00e4ndliches Naming           | |                          |                          Breaking Change | |                          |   Bessere Struktur f                     | |                          | \u00fcr Custom Pipelines                      | |                          |                Hoher Entwicklungsaufwand | |                          |   Individuelle Schema De                 | |                          | finitionen und bessere Validierungsm\u00f6gli | |                          | chkeiten   Pipeline Config etwas un\u00fcbers | |                          | ichtlich wegen zus\u00e4tzlicher Unterobjekte | |                          |                                          | |                          |                                          | |                          | Migration bestehender Projekte notwendig | +--------------------------+------------------------------------------+ | Entscheidung             | Es wurde Variante 3 gew\u00e4hlt              | +--------------------------+------------------------------------------+ | Begr\u00fcndung               | Mit dieser strukturellen \u00c4nderung legen  | |                          | wir eine solide Basis f\u00fcr die Umsetzung  | |                          | dieser Anforderung sowie f\u00fcr die         | |                          | Weiterentwicklung des ESTA Tekton        | |                          | Pipeline. Solche grundlegenden           | |                          | Anpassungen k\u00f6nnen wir in der aktuellen  | |                          | Phase des Projekts noch machen, sp\u00e4ter   | |                          | wird es dann schwieriger.                | +--------------------------+------------------------------------------+ | Wer/Wann                 | 30.09.2021  Br\u00fcderli Thomas              | |                          | (IT-PTR-CEN2-SL2) Wallrapp Manuel        | |                          | (IT-PTR-EXT-EXT2 - Extern) Spirig Lukas  | |                          | (IT-PTR-CEN2-SL3)                        | +--------------------------+------------------------------------------+ "}, {"text": "Dynamische Pipeline Tasks (Draft)  tekton.dev/v1beta1Idee/Entwurf f\u00fcr frei konfigurierbare Pipeline Tasks/Steps/Actions (\u2192 analog GitHub Actions) innerhalb der ESTA Tekton Standard Pipelines.  Anforderungen  Abnehmer von ESTA Tekton sollen einfach die standardisierten Pipelines via estaTektonPipeline.json um weitere Tasks erweitern k\u00f6nnen, ohne eine Custom Pipeline selbst bauen und pflegen zu m\u00fcssen.  ESTA pflegt eine Palette von Tekton Tasks f\u00fcr unterschiedliche Funktionen, die nicht zum Standard Buildprozess geh\u00f6ren. Abnehmer k\u00f6nnen zudem eigene Tekton Tasks erstellen und \u00fcber ein Custom Template Repository in ihrem Build Namespace verf\u00fcgbar machen.  Die Tasks k\u00f6nnen an beliebiger Stelle in die Pipeline eingeh\u00e4ngt werden (\u2192 runAfter/runBefore).  Beispiel (S3 Push)  Tekton Task Definition  Inspired by https://hub.tekton.dev/tekton/task/aws-cli  esta-s2-push.yaml  apiVersion: tekton.dev/v1beta1  kind: Task  metadata:  name: esta-s3-push  spec:  description: |  This task can push files from the workspace directory to a given S3 bucket  params:  - name: BUCKET_URL  description: URL to destination bucket and subdirectory (e.g. s3://bucket-name/subdir)  - name: SOURCE_DIR  description: Source directory for files to push  - name: GLOB_PATTERN  description: Glob pattern for files to push from SOURCE_DIR  default: '*'  - name: AWS_DEFAULT_REGION  description: AWS region  default: us-east-1  - name: AWS_CREDENTIALS_SECRET  description: |  Secret name to read AWS credentails from.  Must contain entries named AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY  workspaces:  - name: source  - name: env-vars  optional: true  steps:  - name: push  image: remote.docker.bin.sbb.ch/amazon/aws-cli:2.0.5  workingDir: $(workspaces.source.path)  env:  - name: AWS_DEFAULT_REGION  value: $(params.AWS_DEFAULT_REGION)  - name: AWS_ACCESS_KEY_ID  valueFrom:  secretKeyRef:  name: $(params.AWS_CREDENTIALS_SECRET)  key: AWS_ACCESS_KEY_ID  - name: AWS_ACCESS_KEY_ID  valueFrom:  secretKeyRef:  name: $(params.AWS_CREDENTIALS_SECRET)  key: AWS_SECRET_ACCESS_KEY  script: |  aws s3 cp $(params.SOURCE_DIR)/$(params.GLOB_PATTERN) $(params.BUCKET_URL)/  Action in estaTektonPipeline.json  estaTektonPipeline.json  {  \"$schema\": \"https://clew-resources.sbb-cloud.net/tekton-schema.json\",  ...  \"pipelines\": [  {  \"name\": \"release\",  \"triggerType\": [\"GITEVENT\"],  \"versionTagEventPatterns\": \"^(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\*|\\\\d+)\",  \"build\": {  },  \"tasks\": [  {  \"name\": \"s3-push\",  \"taskRef\": \"esta-s3-push\",  \"params\": {  \"BUCKET_URL\": \"s3://test-bucket/static-www\",  \"SOURCE_DIR\": \"./dist\",  \"AWS_DEFAULT_REGION\": \"us-east-1\",  \"AWS_CREDENTIALS_SECRET\": \"pipeline-env-aws-credentails\"  },  \"runAfter\": \"quality-gate-check\",  \"runBefore\": \"helm-package-deploy\"  }  ]  }  ]  }  \u2192 per Template Modifier wird folgendes ins Pipelinerun Template eingef\u00fcgt:  - kind: PipelineRun  ...  spec:  params:  ...  - name: S3_PUSH_BUCKET_URL  value: ${S3_PUSH_BUCKET_URL}  - name: S3_PUSH_SOURCE_DIR  value: ${S3_PUSH_SOURCE_DIR}  - name: S3_PUSH_AWS_DEFAULT_REGION  value: ${S3_PUSH_AWS_DEFAULT_REGION}  - name: S3_PUSH_AWS_CREDENTIALS_SECRET  value: ${S3_PUSH_AWS_CREDENTIALS_SECRET}  pipelineSpec:  params:  ...  - name: S3_PUSH_BUCKET_URL  - name: S3_PUSH_SOURCE_DIR  - name: S3_PUSH_AWS_DEFAULT_REGION  - name: S3_PUSH_AWS_CREDENTIALS_SECRET  tasks:  ...  - name: helm-package-deploy  ...  runAfter:  ...  - s3-push  # injected task from json action  - name: s3-push  taskRef:  name: esta-s3-push  runAfter:  - quality-gate-check  params:  - name: BUCKET_URL  value: $(params.S3_PUSH_BUCKET_URL)  - name: SOURCE_DIR  value: $(params.S3_PUSH_SOURCE_DIR)  - name: AWS_DEFAULT_REGION  value: $(params.S3_PUSH_AWS_DEFAULT_REGION)  - name: AWS_CREDENTIALS_SECRET  value: $(params.S3_PUSH_AWS_CREDENTIALS_SECRET)  workspaces:  - name: source  workspace: pipeline-workspace  - name: env-vars  workspace: pipeline-env  parameters:  ...  - name: S3_PUSH_BUCKET_URL  type: string  - name: S3_PUSH_SOURCE_DIR  type: string  - name: S3_PUSH_AWS_DEFAULT_REGION  type: string  - name: S3_PUSH_AWS_CREDENTIALS_SECRET  type: string  Konventionen f\u00fcr Tasks  -   Definiert genau einen Workspace mit den Namen \"source\"  -   Akzeptiert nur Parameter vom type: string "}, {"text": "OpenShift Pipelines Operator Update  So wird ein Update des Openshift Pipeline Operators (aka Tekton) durchgef\u00fchrt:  Readme First  Basis-Informationen mit Links zu den relevanten Repos und ArgoCD Instanzen siehe CON Fact Sheet for ESTA  1. Changes in den Release Notes lesen  Allenfalls Massnahmen in ESTA Tekton planen und umsetzen.  2. Update Infos in Openshift lesen  1.  Operators > Installed Operators > Red Hat OpenShift Pipelines >     Subscriptions  2.  Klick auf Upgrade status / Upgrade available  3.  Neue Version: openshift-pipelines-operator-XXXX  3. Operator Version in Git/ArgoCD f\u00fcr Stage \"DEV\" aktualisieren  1.  stage-specific pipelines-operator values updaten      1.  installPlanApprover.operatorVersion auf die zu deployende         Version \u00e4ndern      2.  falls eine neue Major Version ver\u00f6ffentlicht wurde, den         subscription.spec.channel ebenfalls auf die neue Verision         anpassen  2.  PR erstellen und von CON approven lassen  3.  ArgoCD Sync f\u00fcr Dev Cluster (clew01d) ausf\u00fchren  4. Integration Tests auf Dev Cluster ausf\u00fchren  1.  Checkout esta-tekton-integrationtests  2.  Anpassen des Run Templates mit aktuellen Versionen  3.  Oc Login auf dem Dev Cluster  4.  $ oc create -f statics/esta-tekton-integrationtests-clew01d.yaml -n     esta-tekton-it  5.  Pr\u00fcfung der Resultate  6.  Falls n\u00f6tig ESTA Tekton Komponenten fixen und retest  5. Operator Version f\u00fcr Stages TEST und PROD aktualisieren  1.  Vorgehen analog 3. (ohne ArgoCD Sync)  2.  Neue Version f\u00fcr ESTA Tekton erstellen  6. Ank\u00fcndigung des Updates via Blogpost  1.  Falls es Breaking Changes gibt, m\u00fcssen diese angek\u00fcndigt werden  2.  Zeitpunkt f\u00fcr das Rollout des Updates festlegen (ca. 2 Wochen)  7. Rollout zum angek\u00fcndigten Zeitpunkt  1.  PRs aus 5. mergen  2.  ArgoCD Sync f\u00fcr Test und Prod Cluster ausf\u00fchren  3.  ESTA Tekton Update ausrollen (via clew-esta-argocd) "}, {"text": "Known Issues  This is a collection of issues or regressions known when building your projects with Tekton.  -   Dockerfile: tar command fails with \"Cannot change ownership to uid     xxx\"  -   NPM Builds with Karma Tests time-out  -   NPM Builds with Playwright WebKit tests fail  -   Tagging pipeline fails with reject from server  -   Maven builds fail with \"invalid CEN header (encrypted entry)\" errors  -   maven-assembly-plugin fails with \"group id '1001230000' is too big\"     errors  -   Staging pipeline fails at argocd-sync-and-wait  -   Docker build fails to download files from archive.apache.org  Dockerfile: tar command fails with \"Cannot change ownership to uid xxx\"  When running in a Docker build environment, tar tries to apply the ownership information from the archive. The following error may occur when processing your Dockerfile:  [docker-build - build-push]  tar: some/path: Cannot change ownership to uid 1000960000, gid 1000960000: Invalid argument  Workaround  Execute tar with the --no-same-owner option in your Dockerfile.  NPM Builds with Karma Tests time-out  The default test configuration from Angular uses the ChromeHeadless launcher. This one doesn't run properly in Tekton pipelines which leads to the test process either failing or timing out.  Workaround  Create a customLauncher in your karma.conf.js using ChromiumHeadless as base and adding the --no-sandbox flag:  karma.conf.js  customLaunchers: {  ChromiumHeadlessCI: {  base: 'ChromiumHeadless',  flags: ['--no-sandbox']  },  },  Then use this launcher in the CI test config of your angular.json profile:  angular.json  \"test\": {  \"builder\": \"@angular-devkit/build-angular:karma\",  \"options\": {  ...  },  \"configurations\": {  \"ci\": {  \"browsers\": \"ChromiumHeadlessCI\",  ...  }  }  },  When running ng test -c ci, the ChromiumHeadless browser will be started which runs successfully in Tekton.  NPM Builds with Playwright WebKit tests fail  If your e2e tests with playwright, and you use WebKit as the browser, the pipeline will fail because of missing dependencies.  Workaround  Use Firefox or Chromium as the browser in the pipeline. These will work correctly.  Tagging pipeline fails with reject from server  If your tagging pipelines fail with the error \"you can only push annotated tags that you created\", then your repository has the \"Verify Committer activated which rejects the Git tags created by the Tekton pipeline.  Workaround  Go to the Repository settings in Bitbucket, select Hooks and then disable the \"Verify Committer\" hook.  Maven builds fail with \"invalid CEN header (encrypted entry)\" errors  This rather cryptic error message means that a specific maven dependency was blocked by CyberArt and cannot be used anymore.  Check this repository for a list of blocked java modules.  Workaround  Update your project's dependencies to a more recent version that is not on the blocked list or request an Exception to Policy (EtP).  maven-assembly-plugin fails with \"group id '1001230000' is too big\" errors  By default the maven-assembly-plugin (and maybe other plugins) struggle with the large UIDs randomly assigned to the pipeline containers by OpenShift.  Workaround  As the full error messages suggests: Use STAR or POSIX extensions to overcome this limit. An effektive fix is to add the tarLongFileMode configuration option for the according plugin in your pom.xml:  pom.xml  <configuration>  ...  <tarLongFileMode>posix</tarLongFileMode>  </configuration>  Staging pipeline fails at argocd-sync-and-wait  Staging pipelines wich attempt to perform a sync in ArgoCD may fail with an error printed to the logs like this:  FailedPrecondition desc = Cannot sync to xxxxx: auto-sync currently set to HEAD  This error occurs if the application in ArgoCD which Tekton wants to sync has the automated sync policy set. In this case ArgoCD refuses to sync to an explicit revision and the pipeline command fails with the given error.  Solution  Either disable the autoSync flag in estaTektonPipeline.json or remove the auto sync policy in your ArgoCD application resource.  Docker build fails to download files from archive.apache.org  RUN or ADD commands which download a file from archive.apache.org fail with an \"i/o timeout\" error. Unfortunately connections from OpenShift to archive.apache.org cannot be established.  Solution  Use the mirrored repository at https://bin.sbb.ch/artifactory/apache-archive. Read more in Use of artifactory remote repo for archive.apache.org. "}]